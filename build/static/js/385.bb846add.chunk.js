"use strict";(self.webpackChunkaudesp_connect_phase_v=self.webpackChunkaudesp_connect_phase_v||[]).push([[385],{2750(e,s,t){t.d(s,{D0:()=>d,MG:()=>l,T6:()=>i,VR:()=>n,X3:()=>c});var a=t(9379),o=(t(5043),t(6034)),r=t(579);const n={INPUT:"w-full h-10 px-3 rounded-md border border-slate-300 text-sm text-slate-700 shadow-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none transition-all placeholder:text-slate-400 disabled:bg-slate-50 disabled:text-slate-500",CHECKBOX:"w-5 h-5 rounded border-slate-300 text-blue-600 focus:ring-blue-500 cursor-pointer transition-colors",LABEL:"block text-xs font-bold text-slate-500 uppercase mb-1.5 tracking-wider",SECTION:"bg-white p-6 rounded-lg shadow-sm border border-slate-200 mb-6 animate-in fade-in slide-in-from-bottom-2 duration-500",BTN_ADD:"h-9 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium shadow-sm transition-colors flex items-center gap-2 cursor-pointer",BTN_REMOVE:"text-red-500 hover:text-red-700 text-xs font-bold uppercase tracking-wide transition-colors px-2 py-1 rounded hover:bg-red-50 cursor-pointer",BTN_SUB:"h-7 px-3 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded text-xs font-bold",HEADER_TITLE:"text-xl font-bold text-slate-800",HEADER_DIVIDER:"flex justify-between items-center mb-6 pb-4 border-b border-slate-100",GRID_CONTAINER:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",FLEX_ROW_CENTER:"flex items-center gap-3"},c=e=>{let{title:s,children:t}=e;return(0,r.jsxs)("div",{className:n.HEADER_DIVIDER,children:[(0,r.jsx)("h2",{className:n.HEADER_TITLE,children:s}),(0,r.jsx)("div",{className:"flex gap-2",children:t})]})},l=e=>{let{label:s,error:t,children:a}=e;return(0,r.jsxs)("div",{className:"mb-1",children:[(0,r.jsx)("label",{className:n.LABEL,children:s}),a,t&&(0,r.jsx)("div",{className:"text-red-600 text-[10px] font-bold uppercase mt-1 animate-pulse",children:t})]})};function i(e){let{title:s,items:t,newItemTemplate:l,onAdd:i,onRemove:d,onUpdate:p,renderItem:m,ocrSection:u,onOcrData:g}=e;return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(c,{title:s,children:(0,r.jsx)("button",{onClick:()=>i(l),className:n.BTN_ADD,children:"+ Adicionar Item"})}),u&&(0,r.jsx)(o.O,{section:u,onDataExtracted:e=>{e&&("relacao_empregados"===u&&e.empregados&&Array.isArray(e.empregados)?e.empregados.forEach(e=>i(e)):g?g(e):i((0,a.A)((0,a.A)({},l),e)))}}),t&&t.length>0?t.map((e,s)=>(0,r.jsxs)("div",{className:n.SECTION+" relative border-l-4 border-l-slate-400",children:[(0,r.jsx)("div",{className:"absolute top-4 right-4 z-10",children:(0,r.jsx)("button",{onClick:()=>d(s),className:n.BTN_REMOVE,children:"\ud83d\uddd1 Remover"})}),(0,r.jsx)("div",{className:"pt-2",children:m(e,s,(e,t)=>p(s,e,t))})]},s)):(0,r.jsx)("div",{className:"text-center p-8 border-2 border-dashed border-slate-200 rounded-lg bg-slate-50",children:(0,r.jsx)("p",{className:"text-slate-400 text-sm font-medium",children:"Nenhum registro adicionado."})})]})}const d=e=>{let{label:s,value:t,onChange:a,type:o="text",error:c,options:i}=e;return(0,r.jsx)(l,{label:s,error:c,children:i?(0,r.jsx)("select",{className:n.INPUT,value:t,onChange:e=>a(e.target.value),children:i.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))}):(0,r.jsx)("input",{type:o,className:n.INPUT,value:t,onChange:e=>a("number"===o?Number(e.target.value):e.target.value),step:"number"===o?"0.01":void 0})})}},3620(e,s,t){t.d(s,{IK:()=>l,J5:()=>d,Oy:()=>i});var a=t(2332),o=t(1257),r=t.n(o);function n(e){return e.replace(/\D/g,"")}function c(e){try{if(e.match(/\d{4}[\/\-]\d{2}[\/\-]\d{2}/)){const[s,t,a]=e.replace(/\//g,"-").split("-");return"".concat(s,"-").concat(t,"-").concat(a)}const[s,t,a]=e.replace(/\//g,"-").split("-");if(parseInt(a)>1900&&parseInt(t)>0&&parseInt(t)<=12&&parseInt(s)>0&&parseInt(s)<=31)return"".concat(a,"-").concat(t.padStart(2,"0"),"-").concat(s.padStart(2,"0"))}catch(s){return null}return null}async function l(e){try{console.log("[OCR] Iniciando processamento de:",e.name);const s=await async function(e){console.log("[OCR] Iniciando extra\xe7\xe3o de PDF:",e.name);const s=await e.arrayBuffer(),t=await a.YE({data:s}).promise;let o="";for(let a=1;a<=Math.min(t.numPages,10);a++){const e=await t.getPage(a),s=e.getViewport({scale:2}),n=document.createElement("canvas"),c=n.getContext("2d");c&&(n.width=s.width,n.height=s.height,await e.render({canvasContext:c,viewport:s}).promise,console.log("[OCR] Processando p\xe1gina ".concat(a,"/").concat(t.numPages,"...")),o+=(await r().recognize(n,"por+eng",{logger:e=>{"recognizing"===e.status&&console.log("[OCR] P\xe1gina ".concat(a,": ").concat(Math.round(100*e.progress),"%"))}})).data.text+"\n")}return console.log("[OCR] Extra\xe7\xe3o completa, tamanho:",o.length),o}(e),t=function(e){var s;const t={confidence:.5,rawText:e,valores:{},responsaveis:[],cpfs:[],datas:[],documentos_fiscais:[],contratos:[]},a=e.match(/(\d{2}\.?\d{3}\.?\d{3}\/?\d{4}-?\d{2})/);a&&(t.cnpj=a[1].replace(/\D/g,""),console.log("[OCR] CNPJ detectado:",t.cnpj));const o=e.matchAll(/(\d{3}\.?\d{3}\.?\d{3}-?\d{2})/g);for(const c of o){const e=n(c[1]);t.cpfs.includes(e)||t.cpfs.push(e)}console.log("[OCR] CPFs detectados:",t.cpfs);const r=e.matchAll(/(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{4}|\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2})/g);for(const n of r){const e=c(n[1]);e&&!t.datas.includes(e)&&t.datas.push(e)}console.log("[OCR] Datas detectadas:",t.datas);const l=e.match(/R\$[\s]*([\d.,]+)/gi);if(l){const e=l.map(e=>parseFloat(e.replace(/[^\d,]/g,"").replace(",",".")));e.length>0&&(t.valores.despesas=e.reduce((e,s)=>e+s,0)/e.length,console.log("[OCR] Valores detectados:",e))}const i=e.match(/(\d{4})/);i&&(t.ano=parseInt(i[1]),console.log("[OCR] Ano detectado:",t.ano));const d=["janeiro","fevereiro","mar\xe7o","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"];for(let n=0;n<d.length;n++)if(e.toLowerCase().includes(d[n])){t.mes=n+1,console.log("[OCR] M\xeas detectado:",t.mes,d[n]);break}(e.toLowerCase().includes("presta\xe7\xe3o")||e.toLowerCase().includes("contas"))&&(t.mes=12,console.log("[OCR] Detectado presta\xe7\xe3o de contas - for\xe7ando m\xeas 12"));const p=e.match(/(35\d{5})/);p&&(t.municipio=parseInt(p[1]),console.log("[OCR] Munic\xedpio detectado:",t.municipio));const m={responsaveis:["respons\xe1vel","diretor","presidente","gestor","ordenador"],documentos:["nf","nota fiscal","recibo","comprovante","fatura"],contratos:["contrato","termo","acordo","licita\xe7\xe3o"]},u=e.split("\n");for(const n of u)for(const[e,s]of Object.entries(m))s.some(e=>n.toLowerCase().includes(e))&&("responsaveis"!==e||t.responsaveis.includes(n.trim())?"documentos"!==e||t.documentos_fiscais.includes(n.trim())?"contratos"!==e||t.contratos.includes(n.trim())||t.contratos.push(n.trim()):t.documentos_fiscais.push(n.trim()):t.responsaveis.push(n.trim()));const g=[t.cnpj,t.ano,t.mes,t.cpfs&&t.cpfs.length>0,t.datas&&t.datas.length>0,null===(s=t.valores)||void 0===s?void 0:s.despesas].filter(Boolean).length;return t.confidence=Math.min(.95,g/6),console.log("[OCR] Confian\xe7a da extra\xe7\xe3o:",Math.round(100*t.confidence)+"%"),t}(s);return t}catch(s){throw console.error("[OCR] Erro ao processar PDF:",s),new Error("Erro ao processar PDF: ".concat(s instanceof Error?s.message:"Desconhecido"))}}function i(e){var s,t;return{descritor:{municipio:e.municipio,entidade:e.entidade||1,ano:e.ano,mes:e.mes||12},dados_gerais_entidade_beneficiaria:{cnpj:e.cnpj,razao_social:e.razao_social},receitas:{repasses_recebidos:(null===(s=e.valores)||void 0===s?void 0:s.repasses)||0},disponibilidades:{saldos:[{saldo_bancario:(null===(t=e.valores)||void 0===t?void 0:t.disponibilidades)||0}]},extraction_metadata:{source:"PDF_OCR",confidence:e.confidence,timestamp:(new Date).toISOString(),extracted_cpfs:e.cpfs,extracted_datas:e.datas,raw_text_preview:e.rawText.substring(0,500)}}}async function d(e,s,t){console.log("[OCR] Extracting block data for section: ".concat(t)),console.log("[OCR] Mime type: ".concat(s));try{if("application/pdf"===s){const a=atob(e),o=new Uint8Array(a.length);for(let e=0;e<a.length;e++)o[e]=a.charCodeAt(e);const r=new Blob([o],{type:s}),n=new File([r],"document.pdf",{type:s}),c=await l(n),d=i(c);return console.log("[OCR] Extraction complete for section ".concat(t,". Confidence: ").concat(c.confidence)),{success:!0,source:"PDF_OCR",confidence:c.confidence,data:d,section:t}}throw new Error("Apenas PDF \xe9 suportado. Recebido: ".concat(s))}catch(a){throw console.error("[OCR] Error in extractBlockData:",a),new Error("Erro ao processar PDF: ".concat(a.message))}}"undefined"!==typeof window&&(a.EA.workerSrc="https://cdn.jsdelivr.net/npm/pdfjs-dist@".concat(a.rE,"/build/pdf.worker.min.js"))},5385(e,s,t){t.d(s,{Dashboard:()=>r});t(5043);var a=t(2750),o=t(579);const r=e=>{var s,t,r,n,c,l,i,d,p;let{data:m,sectionStatus:u,onNavigate:g}=e;const x=((null===(s=m.receitas)||void 0===s||null===(t=s.repasses_recebidos)||void 0===t?void 0:t.reduce((e,s)=>e+(s.valor||0),0))||0)+(((null===(r=m.receitas)||void 0===r||null===(n=r.outras_receitas)||void 0===n?void 0:n.reduce((e,s)=>e+(s.valor||0),0))||0)+((null===(c=m.receitas)||void 0===c?void 0:c.receitas_aplic_financ_repasses_publicos_municipais)||0)+((null===(l=m.receitas)||void 0===l?void 0:l.receitas_aplic_financ_repasses_publicos_estaduais)||0)+((null===(i=m.receitas)||void 0===i?void 0:i.receitas_aplic_financ_repasses_publicos_federais)||0)),h=((null===(d=m.pagamentos)||void 0===d?void 0:d.reduce((e,s)=>e+(s.pagamento_valor||0),0))||0)+((null===(p=m.devolucoes)||void 0===p?void 0:p.reduce((e,s)=>e+(s.valor||0),0))||0),b=x-h,f=["descritor","codigo_ajuste","dados_gerais","responsaveis","empenhos","contratos","documentos_fiscais","pagamentos","repasses","receitas","glosas","ajustes_saldo","descontos","devolucoes","disponibilidades","relatorio_atividades","relatorio_gov","relacao_empregados","servidores_cedidos","relacao_bens","demonstracoes","publicacoes","declaracoes","transparencia","parecer"],v=f.length,j=Object.values(u).filter(e=>"valid"===e.status).length,w=Math.round(j/v*100);return(0,o.jsxs)("div",{className:"space-y-8 animate-in fade-in duration-500",children:[(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,o.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[(0,o.jsx)("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2",children:"Progresso do Preenchimento"}),(0,o.jsxs)("div",{className:"flex items-end gap-2",children:[(0,o.jsxs)("span",{className:"text-3xl font-bold text-slate-800",children:[w,"%"]}),(0,o.jsxs)("span",{className:"text-sm text-slate-500 mb-1",children:[j,"/",v," Blocos"]})]}),(0,o.jsx)("div",{className:"w-full bg-slate-100 h-2 mt-3 rounded-full overflow-hidden",children:(0,o.jsx)("div",{className:"bg-blue-600 h-full transition-all duration-1000",style:{width:"".concat(w,"%")}})})]}),(0,o.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[(0,o.jsx)("h3",{className:"text-xs font-bold text-emerald-600 uppercase tracking-wider mb-2",children:"Total Receitas"}),(0,o.jsx)("span",{className:"text-2xl font-bold text-slate-800",children:x.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),(0,o.jsx)("p",{className:"text-[10px] text-slate-400 mt-1",children:"Repasses + Rendimentos"})]}),(0,o.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[(0,o.jsx)("h3",{className:"text-xs font-bold text-red-500 uppercase tracking-wider mb-2",children:"Total Despesas"}),(0,o.jsx)("span",{className:"text-2xl font-bold text-slate-800",children:h.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),(0,o.jsx)("p",{className:"text-[10px] text-slate-400 mt-1",children:"Pagamentos + Devolu\xe7\xf5es"})]}),(0,o.jsxs)("div",{className:"p-6 rounded-lg shadow-sm border ".concat(b>=0?"bg-blue-50 border-blue-200":"bg-red-50 border-red-200"),children:[(0,o.jsx)("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Saldo Final Estimado"}),(0,o.jsx)("span",{className:"text-2xl font-bold ".concat(b>=0?"text-blue-700":"text-red-700"),children:b.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),(0,o.jsx)("p",{className:"text-[10px] text-slate-500 mt-1",children:"Calculado automaticamente"})]})]}),(0,o.jsxs)("div",{className:a.VR.SECTION,children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,o.jsx)("h2",{className:a.VR.HEADER_TITLE,children:"Status dos Blocos"}),(0,o.jsxs)("div",{className:"flex gap-4 text-xs font-medium",children:[(0,o.jsxs)("span",{className:"flex items-center gap-1",children:[(0,o.jsx)("span",{className:"w-2 h-2 rounded-full bg-green-500"})," Completo"]}),(0,o.jsxs)("span",{className:"flex items-center gap-1",children:[(0,o.jsx)("span",{className:"w-2 h-2 rounded-full bg-red-500"})," Inv\xe1lido/Pendente"]}),(0,o.jsxs)("span",{className:"flex items-center gap-1",children:[(0,o.jsx)("span",{className:"w-2 h-2 rounded-full bg-slate-300"})," Vazio (Opcional)"]})]})]}),(0,o.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:f.map(e=>{const s=u[e];let t="bg-slate-50 border-slate-200 text-slate-400",a="\u26aa";"valid"===(null===s||void 0===s?void 0:s.status)?(t="bg-green-50 border-green-200 text-green-800 hover:bg-green-100",a="\u2705"):"invalid"===(null===s||void 0===s?void 0:s.status)&&(t="bg-red-50 border-red-200 text-red-800 hover:bg-red-100",a="\u26a0\ufe0f");return(0,o.jsxs)("button",{onClick:()=>g(e),className:"p-3 rounded border text-left transition-all ".concat(t," relative group"),children:[(0,o.jsxs)("div",{className:"flex justify-between items-start",children:[(0,o.jsx)("span",{className:"font-bold text-xs uppercase tracking-wide opacity-70",children:"Se\xe7\xe3o"}),(0,o.jsx)("span",{children:a})]}),(0,o.jsx)("div",{className:"font-semibold text-sm mt-1 truncate",children:{descritor:"Descritor",codigo_ajuste:"C\xf3digo Ajuste",dados_gerais:"Dados Gerais",responsaveis:"Respons\xe1veis",empenhos:"Empenhos",contratos:"Contratos",documentos_fiscais:"Docs Fiscais",pagamentos:"Pagamentos",repasses:"Repasses",receitas:"Receitas",glosas:"Glosas",ajustes_saldo:"Ajustes Saldo",descontos:"Descontos",devolucoes:"Devolu\xe7\xf5es",disponibilidades:"Disponibilidades",relatorio_atividades:"Rel. Atividades",relatorio_gov:"Rel. Governo",relacao_empregados:"Empregados",servidores_cedidos:"Cedidos",relacao_bens:"Bens",demonstracoes:"Dem. Cont\xe1beis",publicacoes:"Publica\xe7\xf5es",declaracoes:"Declara\xe7\xf5es",transparencia:"Transpar\xeancia",parecer:"Parecer"}[e]||e}),(null===s||void 0===s?void 0:s.errors.length)>0&&(0,o.jsxs)("div",{className:"hidden group-hover:block absolute bottom-full left-0 w-full bg-slate-800 text-white text-[10px] p-2 rounded mb-2 z-10 shadow-lg",children:[s.errors[0]," ",s.errors.length>1&&"(+".concat(s.errors.length-1,")")]})]},e)})})]})]})}},6034(e,s,t){t.d(s,{O:()=>n});var a=t(5043),o=t(3620),r=t(579);const n=e=>{let{section:s,onDataExtracted:t}=e;const[n,c]=(0,a.useState)(!1),[l,i]=(0,a.useState)(null);return(0,r.jsxs)("div",{className:"mb-6 p-4 bg-indigo-50 border border-indigo-200 rounded-lg shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-sm font-bold text-indigo-800 flex items-center gap-2",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z",clipRule:"evenodd"})}),"OCR Inteligente (Gemini 2.0)"]}),(0,r.jsxs)("p",{className:"text-xs text-indigo-600 mt-1",children:["Extra\xe7\xe3o autom\xe1tica para se\xe7\xe3o: ",(0,r.jsx)("strong",{children:s})]})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"file",accept:"application/pdf",onChange:async e=>{if(e.target.files&&e.target.files[0]){const a=e.target.files[0];c(!0),i(null);const r=new FileReader;r.onloadend=async()=>{try{const e=r.result.split(",")[1],n=a.type;console.log("[GeminiUploader] Processing file: ".concat(a.name,", type: ").concat(n));const c=await(0,o.J5)(e,n,s);c&&c.success?(console.log("[GeminiUploader] Data extracted successfully:",c),t(c)):(console.warn("[GeminiUploader] No data extracted from document"),i("OCR: N\xe3o foi poss\xedvel identificar dados estruturados neste documento."))}catch(e){console.error("[GeminiUploader] Error processing file:",e);const s=(null===e||void 0===e?void 0:e.message)||"Erro desconhecido";i("\u274c ".concat(s,". Tente um PDF com melhor qualidade."))}finally{c(!1)}},r.readAsDataURL(a)}},disabled:n,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",title:"Selecione um arquivo PDF"}),(0,r.jsx)("button",{disabled:n,className:"px-4 py-2 rounded text-sm font-medium shadow transition-colors ".concat(n?"bg-indigo-300":"bg-indigo-600 hover:bg-indigo-700"," text-white"),children:n?"Lendo Documento...":"Upload PDF/Imagem"})]})]}),l&&(0,r.jsx)("p",{className:"text-red-600 text-xs mt-2 font-medium",children:l})]})}}}]);
//# sourceMappingURL=385.bb846add.chunk.js.map