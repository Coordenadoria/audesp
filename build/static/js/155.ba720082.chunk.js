"use strict";(self.webpackChunkaudesp_connect_phase_v=self.webpackChunkaudesp_connect_phase_v||[]).push([[155],{3155(e,t,s){s.r(t),s.d(t,{EnhancedLoginComponent:()=>d,default:()=>u});var n=s(5043);const a={piloto:"https://audesp-piloto.tce.sp.gov.br",producao:"https://audesp.tce.sp.gov.br"},o="audesp_auth_token",r="audesp_environment";class l{static setEnvironment(e){this.currentEnvironment=e,localStorage.setItem(r,e)}static getEnvironment(){return localStorage.getItem(r)||"piloto"}static getBaseUrl(){const e=this.getEnvironment();return a[e]}static async login(e){const t=this.getBaseUrl(),s="".concat(t,"/login");try{console.log("[Auth] Fazendo login em ".concat(this.getEnvironment()," (").concat(s,")"));const t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e.email,password:e.password}),credentials:"include"});if(!t.ok){const e=await t.text();throw new Error("Login falhou: ".concat(t.status," - ").concat(e))}const n=await t.json(),a={token:n.token,expire_in:n.expire_in||3600,token_type:n.token_type||"bearer",environment:this.getEnvironment(),timestamp:Date.now()};return localStorage.setItem(o,JSON.stringify(a)),this.currentToken=a,console.log("[Auth] Login bem-sucedido em ".concat(this.getEnvironment())),a}catch(n){throw console.error("[Auth] Erro no login:",n),new Error("Erro ao autenticar: ".concat(n.message))}}static logout(){localStorage.removeItem(o),this.currentToken=null,console.log("[Auth] Logout realizado")}static getToken(){if(this.currentToken){const e=this.currentToken.timestamp+1e3*this.currentToken.expire_in;return Date.now()>e?(this.logout(),null):this.currentToken}const e=localStorage.getItem(o);if(e)try{this.currentToken=JSON.parse(e);const t=this.currentToken.timestamp+1e3*this.currentToken.expire_in;return Date.now()>t?(this.logout(),null):this.currentToken}catch(t){return null}return null}static isAuthenticated(){return null!==this.getToken()}static getAuthHeader(){const e=this.getToken();return e?{Authorization:"".concat(e.token_type," ").concat(e.token)}:{}}}l.currentEnvironment="piloto",l.currentToken=null;const i=l;var c=s(579);const d=e=>{let{onLoginSuccess:t,onError:s}=e;const[a,o]=(0,n.useState)("piloto"),[r,l]=(0,n.useState)("afpereira@saude.sp.gov.br"),[d,u]=(0,n.useState)(""),[m,x]=(0,n.useState)(!1),[h,p]=(0,n.useState)(!1),[b,g]=(0,n.useState)(!1),j=e=>{o(e),i.setEnvironment(e)},f=i.getBaseUrl();return(0,c.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-600 to-blue-800 flex items-center justify-center p-4",children:(0,c.jsxs)("div",{className:"w-full max-w-md",children:[(0,c.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 border border-slate-100",children:[(0,c.jsxs)("div",{className:"text-center mb-8",children:[(0,c.jsx)("div",{className:"flex justify-center mb-4",children:(0,c.jsx)("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center",children:(0,c.jsx)("span",{className:"text-white text-2xl font-bold",children:"\ud83c\udfdb\ufe0f"})})}),(0,c.jsx)("h1",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Audesp Connect"}),(0,c.jsx)("p",{className:"text-sm text-slate-500",children:"Presta\xe7\xe3o de Contas v2.0"})]}),(0,c.jsxs)("div",{className:"mb-6",children:[(0,c.jsx)("label",{className:"block text-xs font-bold uppercase text-slate-600 mb-3",children:"Ambiente"}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,c.jsxs)("button",{onClick:()=>j("piloto"),className:"p-3 rounded-lg border-2 font-bold text-sm transition-all ".concat("piloto"===a?"border-blue-600 bg-blue-50 text-blue-700":"border-slate-200 bg-white text-slate-700 hover:border-slate-300"),children:[(0,c.jsx)("span",{className:"block mb-1",children:"\ud83e\uddea"}),(0,c.jsx)("span",{className:"text-xs",children:"Piloto (Teste)"})]}),(0,c.jsxs)("button",{onClick:()=>j("producao"),className:"p-3 rounded-lg border-2 font-bold text-sm transition-all ".concat("producao"===a?"border-red-600 bg-red-50 text-red-700":"border-slate-200 bg-white text-slate-700 hover:border-slate-300"),children:[(0,c.jsx)("span",{className:"block mb-1",children:"\ud83d\ude80"}),(0,c.jsx)("span",{className:"text-xs",children:"Produ\xe7\xe3o"})]})]}),"producao"===a&&(0,c.jsxs)("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,c.jsx)("p",{className:"text-xs text-red-700 font-bold",children:"\u26a0\ufe0f Voc\xea est\xe1 conectando ao ambiente de PRODU\xc7\xc3O."}),(0,c.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"Certifique-se de estar enviando dados reais."})]}),(0,c.jsxs)("div",{className:"mt-3 p-2 bg-slate-50 rounded text-xs text-slate-600",children:[(0,c.jsx)("strong",{children:"Endpoint:"})," ",(0,c.jsx)("span",{className:"font-mono text-[10px]",children:f})]})]}),(0,c.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),r&&d){x(!0);try{const e=await i.login({email:r,password:d});b&&(localStorage.setItem("audesp_last_environment",a),localStorage.setItem("audesp_last_email",r)),t(e.token,a)}catch(n){s(n.message||"Erro ao fazer login")}finally{x(!1)}}else s("E-mail e senha s\xe3o obrigat\xf3rios")},className:"space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-xs font-bold uppercase text-slate-600 mb-2",children:"E-mail"}),(0,c.jsx)("input",{type:"email",value:r,onChange:e=>l(e.target.value),placeholder:"seu.email@saude.sp.gov.br",className:"w-full h-11 px-4 border border-slate-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition text-slate-700 placeholder:text-slate-400",disabled:m,required:!0})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-xs font-bold uppercase text-slate-600 mb-2",children:"Senha"}),(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsx)("input",{type:h?"text":"password",value:d,onChange:e=>u(e.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",className:"w-full h-11 px-4 border border-slate-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition text-slate-700 placeholder:text-slate-400",disabled:m,required:!0}),(0,c.jsx)("button",{type:"button",onClick:()=>p(!h),className:"absolute right-3 top-3 text-slate-500 hover:text-slate-700",children:h?"\ud83d\udc41\ufe0f":"\ud83d\ude48"})]})]}),(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsx)("input",{type:"checkbox",id:"rememberMe",checked:b,onChange:e=>g(e.target.checked),className:"w-4 h-4 border-slate-300 rounded text-blue-600 focus:ring-blue-500 cursor-pointer",disabled:m}),(0,c.jsx)("label",{htmlFor:"rememberMe",className:"text-sm text-slate-600 cursor-pointer",children:"Lembrar ambiente e e-mail"})]}),(0,c.jsx)("button",{type:"submit",disabled:m,className:"w-full h-11 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-bold rounded-lg hover:from-blue-700 hover:to-blue-800 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:m?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{className:"animate-spin",children:"\u23f3"}),"Autenticando..."]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{children:"\ud83d\udd10"}),"Acessar Audesp"]})})]}),(0,c.jsxs)("div",{className:"mt-6 pt-4 border-t border-slate-200 text-center",children:[(0,c.jsx)("p",{className:"text-xs text-slate-500 mb-2",children:"Sistema de Presta\xe7\xe3o de Contas Eletr\xf4nica"}),(0,c.jsxs)("p",{className:"text-xs text-slate-600",children:[(0,c.jsx)("strong",{children:"Ambiente:"})," ","piloto"===a?"\ud83e\uddea Teste (dados n\xe3o-reais)":"\ud83d\ude80 Produ\xe7\xe3o (dados reais)"]})]})]}),(0,c.jsxs)("div",{className:"mt-6 bg-white bg-opacity-10 rounded-lg p-4 text-white text-sm",children:[(0,c.jsxs)("p",{className:"mb-2",children:[(0,c.jsx)("strong",{children:"\ud83d\udca1 Dica:"})," Use o ambiente Piloto para testar antes de enviar em Produ\xe7\xe3o."]}),(0,c.jsx)("p",{className:"text-xs opacity-90",children:"\xa9 2024 Tribunal de Contas do Estado de S\xe3o Paulo"})]})]})})},u=d}}]);
//# sourceMappingURL=155.ba720082.chunk.js.map