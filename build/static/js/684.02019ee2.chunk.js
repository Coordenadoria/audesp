"use strict";(self.webpackChunkaudesp_connect_phase_v=self.webpackChunkaudesp_connect_phase_v||[]).push([[684],{8684(e,t,a){a.r(t),a.d(t,{BatchPDFImporter:()=>c,default:()=>l});var s=a(5043);class o{static async processBatchPDFs(e){console.log("[AI] Iniciando processamento em lote de ".concat(e.length," PDFs"));const t=[];for(let s=0;s<e.length;s++)try{console.log("[AI] Processando arquivo ".concat(s+1,"/").concat(e.length,": ").concat(e[s].name));const a=await this.processDocument(e[s]);t.push(a)}catch(a){console.error("[AI] Erro ao processar ".concat(e[s].name,":"),a),t.push({filename:e[s].name,type:"outro",confidence:0,extractedData:{},suggestedFields:[],rawText:""})}return this.generateBatchSummary(t)}static async processDocument(e){const t=await this.extractTextFromPDF(e),a=await this.classifyDocument(t),s=await this.extractStructuredData(t,a),o=await this.generateSuggestions(t,s,a);return{filename:e.name,type:a,confidence:this.calculateConfidence(s),extractedData:s,suggestedFields:o,rawText:t}}static async extractTextFromPDF(e){try{const t=window.pdfjsLib;if(!t)throw new Error("PDFjs n\xe3o carregado");const a=await e.arrayBuffer(),s=await t.getDocument(a).promise;let o="";for(let e=1;e<=s.numPages;e++){const t=await s.getPage(e),a=await t.getTextContent();o+=a.items.map(e=>e.str).join(" ")+"\n"}return o}catch(t){return console.warn("[PDF] PDFjs n\xe3o dispon\xedvel, usando fallback"),"N\xe3o foi poss\xedvel extrair texto de ".concat(e.name)}}static async classifyDocument(e){if(!this.anthropicApiKey)return this.classifyDocumentLocally(e);try{const t=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.anthropicApiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-3-5-sonnet-20241022",max_tokens:200,messages:[{role:"user",content:"Classifique este documento em uma destas categorias: edital, licitacao, ata, contrato, empenho, pagamento, outro.\n\nTexto do documento (primeiros 2000 caracteres):\n".concat(e.substring(0,2e3),"\n\nResponda apenas com uma palavra da lista acima, sem explica\xe7\xe3o.")}]})}),a=(await t.json()).content[0].text.toLowerCase().trim();return["edital","licitacao","ata","contrato","empenho","pagamento","outro"].includes(a)?a:this.classifyDocumentLocally(e)}catch(t){return console.error("[AI] Erro ao classificar com Claude:",t),this.classifyDocumentLocally(e)}}static classifyDocumentLocally(e){const t=e.toLowerCase();return t.includes("edital")?"edital":t.includes("licita\xe7\xe3o")||t.includes("licitacao")?"licitacao":t.includes("ata")?"ata":t.includes("contrato")?"contrato":t.includes("empenho")?"empenho":t.includes("pagamento")?"pagamento":"outro"}static async extractStructuredData(e,t){if(!this.anthropicApiKey)return this.extractDataLocally(e,t);try{const s=this.buildExtractionPrompt(e,t),o=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.anthropicApiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-3-5-sonnet-20241022",max_tokens:2e3,messages:[{role:"user",content:s}]})}),n=(await o.json()).content[0].text;try{return JSON.parse(n)}catch(a){return this.extractDataLocally(e,t)}}catch(s){return console.error("[AI] Erro ao extrair dados:",s),this.extractDataLocally(e,t)}}static buildExtractionPrompt(e,t){const a={edital:["numero_edital","data_publicacao","modalidade","objeto","valor_estimado","data_abertura"],licitacao:["numero_processo","data","vencedor","valor_contratado","modalidade"],ata:["data_assinatura","signatarios","objeto","valor"],contrato:["numero_contrato","data_assinatura","partes","vigencia","valor","objeto"],empenho:["numero_empenho","data","valor","favorecido","descricao"],pagamento:["data_pagamento","valor","beneficiario","numero_nota","referencia"],outro:["informacoes_principais","valores","datas"]},s=a[t]||a.outro;return"Extraia os seguintes campos deste documento ".concat(t,":\n").concat(s.map(e=>"- ".concat(e)).join("\n"),"\n\nDocumento:\n").concat(e.substring(0,3e3),'\n\nResponda em JSON v\xe1lido com os campos extra\xeddos. Se um campo n\xe3o for encontrado, use null.\nExemplo: {"numero_contrato": "123/2024", "valor": 50000.00}')}static extractDataLocally(e,t){const a={},s={cpf:/\d{3}\.\d{3}\.\d{3}-\d{2}/g,cnpj:/\d{2}\.\d{3}\.\d{3}\/\d{4}-\d{2}/g,valores:/R\$\s*[\d.,]+/g,datas:/\d{2}\/\d{2}\/\d{4}/g,numeros:/[N\xba#]\s*(\d+)/g};for(const[o,n]of Object.entries(s)){const t=e.match(n);t&&(a[o]=t.slice(0,5))}return a}static async generateSuggestions(e,t,a){const s=[];for(const[o,n]of Object.entries(t))n&&Array.isArray(n)&&n.length>0?s.push({field:o,value:String(n[0]),confidence:.85}):n&&null!==n&&s.push({field:o,value:String(n),confidence:.8});return s.slice(0,10)}static calculateConfidence(e){const t=Object.keys(e).length,a=Object.values(e).filter(e=>null!==e).length;return t>0?a/t:0}static generateBatchSummary(e){const t=e.reduce((e,t)=>e+t.confidence,0)/Math.max(e.length,1),a=e.reduce((e,t)=>e+t.suggestedFields.length,0);return{totalFiles:e.length,processedFiles:e.filter(e=>e.confidence>0).length,extractedDocuments:e,summary:{estimatedCompleteness:t,suggestedNextSteps:["Revisar campos extra\xeddos automaticamente",a>0?"".concat(a," campos sugeridos para preenchimento"):"Nenhuma sugest\xe3o autom\xe1tica dispon\xedvel","Validar dados cr\xedticos antes de enviar"],warnings:t<.5?["Baixa confian\xe7a na extra\xe7\xe3o. Revise manualmente os dados extra\xeddos."]:[]}}}}o.anthropicApiKey={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GEMINI_API_KEY:"sua_chave_aqui",REACT_APP_OCR_API:"http://localhost:8000",REACT_APP_API_TIMEOUT:"60000"}.REACT_APP_ANTHROPIC_API_KEY,o.openaiApiKey={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GEMINI_API_KEY:"sua_chave_aqui",REACT_APP_OCR_API:"http://localhost:8000",REACT_APP_API_TIMEOUT:"60000"}.REACT_APP_OPENAI_API_KEY;const n=o;var r=a(579);const c=e=>{let{onDocumentsProcessed:t,onApplySuggestions:a,formData:o}=e;const[c,l]=(0,s.useState)([]),[i,d]=(0,s.useState)(!1),[m,u]=(0,s.useState)(null),[p,h]=(0,s.useState)(null),x=(0,s.useRef)(null);return(0,r.jsxs)("div",{className:"w-full bg-white rounded-lg shadow-lg border border-slate-200 p-6",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"\ud83d\udcc4 Importar M\xfaltiplos PDFs"}),(0,r.jsx)("p",{className:"text-sm text-slate-500",children:"Envie v\xe1rios PDFs e deixe a IA ajudar no preenchimento autom\xe1tico"})]}),m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,r.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[m.processedFiles,"/",m.totalFiles]}),(0,r.jsx)("div",{className:"text-xs text-blue-700 font-bold",children:"Arquivos Processados"})]}),(0,r.jsxs)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[(0,r.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:[Math.round(100*m.summary.estimatedCompleteness),"%"]}),(0,r.jsx)("div",{className:"text-xs text-green-700 font-bold",children:"Completude Estimada"})]}),(0,r.jsxs)("div",{className:"p-4 bg-purple-50 rounded-lg border border-purple-200",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:m.extractedDocuments.reduce((e,t)=>e+t.suggestedFields.length,0)}),(0,r.jsx)("div",{className:"text-xs text-purple-700 font-bold",children:"Sugest\xf5es Dispon\xedveis"})]})]}),m.summary.warnings.length>0&&(0,r.jsxs)("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg mb-6",children:[(0,r.jsx)("h4",{className:"font-bold text-yellow-700 mb-2",children:"\u26a0\ufe0f Avisos:"}),(0,r.jsx)("ul",{className:"space-y-1",children:m.summary.warnings.map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-yellow-800",children:["\u2022 ",e]},t))})]}),(0,r.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg mb-6",children:[(0,r.jsx)("h4",{className:"font-bold text-green-700 mb-2",children:"\u2713 Pr\xf3ximos Passos:"}),(0,r.jsx)("ol",{className:"space-y-1 list-decimal list-inside",children:m.summary.suggestedNextSteps.map((e,t)=>(0,r.jsx)("li",{className:"text-sm text-green-800",children:e},t))})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h3",{className:"font-bold text-slate-700 mb-3",children:"\ud83d\udccb Documentos Extra\xeddos:"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-3 mb-4",children:m.extractedDocuments.map((e,t)=>(0,r.jsxs)("button",{onClick:()=>h(e),className:"p-3 rounded-lg border-2 text-left transition ".concat((null===p||void 0===p?void 0:p.filename)===e.filename?"border-blue-600 bg-blue-50":"border-slate-200 bg-white hover:border-slate-300"),children:[(0,r.jsx)("div",{className:"font-bold text-slate-700 text-sm truncate",children:e.filename}),(0,r.jsxs)("div",{className:"text-xs text-slate-500 mt-1",children:[(0,r.jsx)("span",{className:"inline-block px-2 py-0.5 bg-slate-100 rounded mr-2",children:e.type}),(0,r.jsxs)("span",{children:[Math.round(100*e.confidence),"% confian\xe7a"]})]})]},t))})]}),p&&(0,r.jsxs)("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-4",children:[(0,r.jsxs)("h4",{className:"font-bold text-slate-700 mb-3",children:["Sugest\xf5es para: ",p.filename]}),p.suggestedFields.length>0?(0,r.jsx)("div",{className:"space-y-2",children:p.suggestedFields.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white rounded border border-slate-200 hover:border-blue-300 transition",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-bold text-slate-700 text-sm",children:e.field}),(0,r.jsx)("div",{className:"text-sm text-slate-600 font-mono",children:e.value}),(0,r.jsxs)("div",{className:"text-xs text-slate-500 mt-1",children:["Confian\xe7a: ",Math.round(100*e.confidence),"%"]})]}),(0,r.jsx)("button",{onClick:()=>{return t=e.field,s=e.value,a(t,s),void alert("Campo '".concat(t,"' preenchido com: ").concat(s));var t,s},className:"px-3 py-1 bg-blue-600 text-white rounded text-xs font-bold hover:bg-blue-700 transition whitespace-nowrap ml-2",children:"\u2713 Usar"})]},t))}):(0,r.jsx)("p",{className:"text-sm text-slate-500",children:"Nenhuma sugest\xe3o dispon\xedvel para este documento."})]}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)("button",{onClick:()=>{u(null),l([]),h(null),x.current&&(x.current.value="")},className:"w-full px-4 py-2 bg-slate-200 text-slate-700 rounded-lg font-bold hover:bg-slate-300 transition",children:"\u2190 Voltar e Importar Novos PDFs"})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault();const t=Array.from(e.dataTransfer.files).filter(e=>"application/pdf"===e.type);l(t)},className:"border-2 border-dashed border-blue-300 rounded-lg p-8 text-center bg-blue-50 mb-4 hover:bg-blue-100 transition cursor-pointer",children:[(0,r.jsx)("div",{className:"text-4xl mb-2",children:"\ud83d\udcc1"}),(0,r.jsx)("p",{className:"font-bold text-slate-700 mb-1",children:"Arraste PDFs aqui"}),(0,r.jsx)("p",{className:"text-sm text-slate-500",children:"ou clique para selecionar"}),(0,r.jsx)("input",{ref:x,type:"file",multiple:!0,accept:".pdf",onChange:e=>{const t=Array.from(e.target.files||[]).filter(e=>"application/pdf"===e.type);0!==t.length?l(t):alert("Por favor, selecione apenas arquivos PDF")},className:"hidden"}),(0,r.jsx)("button",{onClick:()=>{var e;return null===(e=x.current)||void 0===e?void 0:e.click()},className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition",children:"Selecionar PDFs"})]}),c.length>0&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("h3",{className:"font-bold text-slate-700 mb-2",children:["Arquivos Selecionados (",c.length,"):"]}),(0,r.jsx)("div",{className:"space-y-2",children:c.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center gap-3 p-2 bg-slate-50 rounded border border-slate-200",children:[(0,r.jsx)("span",{className:"text-lg",children:"\ud83d\udcc4"}),(0,r.jsx)("span",{className:"flex-1 text-sm text-slate-700 font-medium",children:e.name}),(0,r.jsxs)("span",{className:"text-xs text-slate-500",children:[(e.size/1024).toFixed(1)," KB"]}),(0,r.jsx)("button",{onClick:()=>l(c.filter((e,a)=>a!==t)),className:"text-red-600 hover:text-red-700 font-bold",children:"\u2715"})]},t))})]}),(0,r.jsx)("button",{onClick:async()=>{if(0!==c.length){d(!0);try{const e=await n.processBatchPDFs(c);u(e),t(e),e.extractedDocuments.length>0&&h(e.extractedDocuments[0])}catch(e){alert("Erro ao processar PDFs: ".concat(e.message))}finally{d(!1)}}else alert("Selecione pelo menos um arquivo PDF")},disabled:0===c.length||i,className:"w-full h-11 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"animate-spin",children:"\u23f3"}),"Processando com IA..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:"\ud83d\ude80"}),"Processar ",c.length," PDF(s) com IA"]})})]})]})},l=c}}]);
//# sourceMappingURL=684.02019ee2.chunk.js.map