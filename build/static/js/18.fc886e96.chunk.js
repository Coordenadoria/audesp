"use strict";(self.webpackChunkaudesp_connect_phase_v=self.webpackChunkaudesp_connect_phase_v||[]).push([[18],{2750(e,t,a){a.d(t,{D0:()=>d,MG:()=>i,T6:()=>c,VR:()=>n,X3:()=>l});var s=a(9379),o=(a(5043),a(4516)),r=a(579);const n={INPUT:"w-full h-10 px-3 rounded-md border border-slate-300 text-sm text-slate-700 shadow-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none transition-all placeholder:text-slate-400 disabled:bg-slate-50 disabled:text-slate-500",CHECKBOX:"w-5 h-5 rounded border-slate-300 text-blue-600 focus:ring-blue-500 cursor-pointer transition-colors",LABEL:"block text-xs font-bold text-slate-500 uppercase mb-1.5 tracking-wider",SECTION:"bg-white p-6 rounded-lg shadow-sm border border-slate-200 mb-6 animate-in fade-in slide-in-from-bottom-2 duration-500",BTN_ADD:"h-9 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium shadow-sm transition-colors flex items-center gap-2 cursor-pointer",BTN_REMOVE:"text-red-500 hover:text-red-700 text-xs font-bold uppercase tracking-wide transition-colors px-2 py-1 rounded hover:bg-red-50 cursor-pointer",BTN_SUB:"h-7 px-3 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded text-xs font-bold",HEADER_TITLE:"text-xl font-bold text-slate-800",HEADER_DIVIDER:"flex justify-between items-center mb-6 pb-4 border-b border-slate-100",GRID_CONTAINER:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",FLEX_ROW_CENTER:"flex items-center gap-3"},l=e=>{let{title:t,children:a}=e;return(0,r.jsxs)("div",{className:n.HEADER_DIVIDER,children:[(0,r.jsx)("h2",{className:n.HEADER_TITLE,children:t}),(0,r.jsx)("div",{className:"flex gap-2",children:a})]})},i=e=>{let{label:t,error:a,children:s}=e;return(0,r.jsxs)("div",{className:"mb-1",children:[(0,r.jsx)("label",{className:n.LABEL,children:t}),s,a&&(0,r.jsx)("div",{className:"text-red-600 text-[10px] font-bold uppercase mt-1 animate-pulse",children:a})]})};function c(e){let{title:t,items:a,newItemTemplate:i,onAdd:c,onRemove:d,onUpdate:p,renderItem:u,ocrSection:m,onOcrData:x}=e;return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(l,{title:t,children:(0,r.jsx)("button",{onClick:()=>c(i),className:n.BTN_ADD,children:"+ Adicionar Item"})}),m&&(0,r.jsx)(o.O,{section:m,onDataExtracted:e=>{e&&("relacao_empregados"===m&&e.empregados&&Array.isArray(e.empregados)?e.empregados.forEach(e=>c(e)):x?x(e):c((0,s.A)((0,s.A)({},i),e)))}}),a&&a.length>0?a.map((e,t)=>(0,r.jsxs)("div",{className:n.SECTION+" relative border-l-4 border-l-slate-400",children:[(0,r.jsx)("div",{className:"absolute top-4 right-4 z-10",children:(0,r.jsx)("button",{onClick:()=>d(t),className:n.BTN_REMOVE,children:"\ud83d\uddd1 Remover"})}),(0,r.jsx)("div",{className:"pt-2",children:u(e,t,(e,a)=>p(t,e,a))})]},t)):(0,r.jsx)("div",{className:"text-center p-8 border-2 border-dashed border-slate-200 rounded-lg bg-slate-50",children:(0,r.jsx)("p",{className:"text-slate-400 text-sm font-medium",children:"Nenhum registro adicionado."})})]})}const d=e=>{let{label:t,value:a,onChange:s,type:o="text",error:l,options:c}=e;return(0,r.jsx)(i,{label:t,error:l,children:c?(0,r.jsx)("select",{className:n.INPUT,value:a,onChange:e=>s(e.target.value),children:c.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))}):(0,r.jsx)("input",{type:o,className:n.INPUT,value:a,onChange:e=>s("number"===o?Number(e.target.value):e.target.value),step:"number"===o?"0.01":void 0})})}},4516(e,t,a){a.d(t,{O:()=>n});var s=a(5043);const o="http://localhost:8000";var r=a(579);const n=e=>{let{section:t,onDataExtracted:a}=e;const[n,l]=(0,s.useState)(!1),[i,c]=(0,s.useState)(null);s.useEffect(()=>{!async function(){try{return(await fetch("".concat(o,"/health"))).ok}catch(i){return console.warn("[OCRService] Backend n\xe3o dispon\xedvel:",i),!1}}()},[]);return(0,r.jsxs)("div",{className:"mb-6 p-4 bg-indigo-50 border border-indigo-200 rounded-lg shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-sm font-bold text-indigo-800 flex items-center gap-2",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z",clipRule:"evenodd"})}),"OCR Inteligente (Gemini 2.0)"]}),(0,r.jsxs)("p",{className:"text-xs text-indigo-600 mt-1",children:["Extra\xe7\xe3o autom\xe1tica para se\xe7\xe3o: ",(0,r.jsx)("strong",{children:t})]})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"file",accept:"application/pdf",onChange:async e=>{if(e.target.files&&e.target.files[0]){const s=e.target.files[0];if(!s.type.includes("pdf"))return void c("\u274c Apenas PDF \xe9 suportado. Recebido: ".concat(s.type||"tipo desconhecido"));l(!0),c(null);try{console.log("[GeminiUploader] Enviando PDF para backend: ".concat(s.name));const e=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"general";if(!e.type.includes("pdf"))throw new Error("\u274c Apenas PDF \xe9 suportado");const a=new FormData;a.append("file",e);try{console.log("[OCRService] Extraindo dados de bloco:",t);const e=await fetch("".concat(o,"/api/ocr/extract-block?block_type=").concat(t),{method:"POST",body:a});if(!e.ok){const t=await e.json();throw new Error(t.detail||"HTTP ".concat(e.status))}return function(e,t){const a={};switch(t){case"general":e.cnpj&&e.cnpj.length>0&&(a.cnpj=e.cnpj[0]),e.cpf&&e.cpf.length>0&&(a.cpf=e.cpf[0]),e.dates&&e.dates.length>0&&(a.dates=e.dates),e.phones&&e.phones.length>0&&(a.phone=e.phones[0]),e.emails&&e.emails.length>0&&(a.email=e.emails[0]);break;case"finance":if(e.currency&&e.currency.length>0){a.values=e.currency;const t=e.currency[0].match(/[\d.,]+/);t&&(a.primary_value=t[0])}e.percentages&&e.percentages.length>0&&(a.percentages=e.percentages);break;default:a.patterns=e}return a}((await e.json()).patterns,t)}catch(i){const t=i.message||"Erro ao extrair dados de bloco";throw console.error("[OCRService] Erro ao extrair bloco:",t),new Error("\u274c Erro na extra\xe7\xe3o: ".concat(t))}}(s,"general");console.log("[GeminiUploader] Dados extra\xeddos com sucesso:",e),a(e)}catch(t){console.error("[GeminiUploader] Erro ao processar arquivo:",t);const e=(null===t||void 0===t?void 0:t.message)||"Erro ao processar PDF";c(e)}finally{l(!1)}}},disabled:n,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",title:"Selecione um arquivo PDF"}),(0,r.jsx)("button",{disabled:n,className:"px-4 py-2 rounded text-sm font-medium shadow transition-colors ".concat(n?"bg-indigo-300":"bg-indigo-600 hover:bg-indigo-700"," text-white"),children:n?"Lendo Documento...":"Upload PDF/Imagem"})]})]}),i&&(0,r.jsx)("p",{className:"text-red-600 text-xs mt-2 font-medium",children:i})]})}},5018(e,t,a){a.d(t,{FullReportImporter:()=>N});var s=a(5043),o=a(7756);const r=e=>{if(!e)return"";return String(e).replace(/\D/g,"")},n=e=>{if(!e)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const t=e.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(t){const e=t[1].padStart(2,"0"),a=t[2].padStart(2,"0"),s=t[3];return"".concat(s,"-").concat(a,"-").concat(e)}return e},l=e=>{if("number"===typeof e)return e;if(!e)return 0;let t=String(e);t.includes(",")&&!t.includes("US")&&(t=t.replace(/\./g,"").replace(",",".")),t=t.replace(/[^\d.-]/g,"");const a=parseFloat(t);return isNaN(a)?0:a};function i(e){if(Array.isArray(e))return e.map(e=>i(e));if("object"===typeof e&&null!==e){const t={};for(const a in e){const s=e[a];a.includes("cpf")||a.includes("cnpj")||a.includes("documento_numero")?t[a]=r(s):a.includes("data")||"vigencia_data_inicial"===a||"vigencia_data_final"===a?t[a]=n(s):a.includes("valor")||a.includes("saldo")||a.includes("remuneracao")||a.includes("montante")?t[a]=l(s):t[a]="object"===typeof s?i(s):s}return t}return e}let c=null;"undefined"===typeof window&&{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GEMINI_API_KEY:"sua_chave_aqui",REACT_APP_OCR_API:"http://localhost:8000",REACT_APP_API_TIMEOUT:"60000"}.API_KEY&&(c=new o.M4({apiKey:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GEMINI_API_KEY:"sua_chave_aqui",REACT_APP_OCR_API:"http://localhost:8000",REACT_APP_API_TIMEOUT:"60000"}.API_KEY}));const d={type:o.ZU.OBJECT,properties:{documento_numero:{type:o.ZU.STRING,description:"CNPJ or CPF numbers only"},nome:{type:o.ZU.STRING},documento_tipo:{type:o.ZU.NUMBER,description:"2 for CNPJ, 1 for CPF"}}},p={type:o.ZU.OBJECT,properties:{numero:{type:o.ZU.STRING},data_emissao:{type:o.ZU.STRING,description:"YYYY-MM-DD"},valor_bruto:{type:o.ZU.NUMBER},credor:d,descricao:{type:o.ZU.STRING},categoria_despesas_tipo:{type:o.ZU.NUMBER}}},u={type:o.ZU.OBJECT,properties:{cpf:{type:o.ZU.STRING},data_admissao:{type:o.ZU.STRING},salario_contratual:{type:o.ZU.NUMBER},cbo:{type:o.ZU.STRING},periodos_remuneracao:{type:o.ZU.ARRAY,items:{type:o.ZU.OBJECT,properties:{mes:{type:o.ZU.NUMBER},carga_horaria:{type:o.ZU.NUMBER},remuneracao_bruta:{type:o.ZU.NUMBER}}}}}},m={type:o.ZU.OBJECT,properties:{numero:{type:o.ZU.STRING},objeto:{type:o.ZU.STRING},data_assinatura:{type:o.ZU.STRING},valor_montante:{type:o.ZU.NUMBER},vigencia_data_inicial:{type:o.ZU.STRING},credor:d}},x={type:o.ZU.OBJECT,properties:{pagamento_data:{type:o.ZU.STRING},pagamento_valor:{type:o.ZU.NUMBER},numero_transacao:{type:o.ZU.STRING},identificacao_documento_fiscal:{type:o.ZU.OBJECT,properties:{numero:{type:o.ZU.STRING}}},meio_pagamento_tipo:{type:o.ZU.NUMBER}}};o.ZU.OBJECT,o.ZU.STRING,o.ZU.STRING,o.ZU.STRING,o.ZU.NUMBER,o.ZU.OBJECT,o.ZU.NUMBER,o.ZU.NUMBER,o.ZU.STRING,o.ZU.NUMBER,o.ZU.NUMBER,o.ZU.OBJECT,o.ZU.STRING,o.ZU.NUMBER,o.ZU.STRING,o.ZU.OBJECT,o.ZU.STRING,o.ZU.STRING,o.ZU.STRING,o.ZU.NUMBER;async function h(e,t){const a={type:o.ZU.OBJECT,properties:{descritor:{type:o.ZU.OBJECT,properties:{ano:{type:o.ZU.NUMBER},mes:{type:o.ZU.NUMBER},entidade:{type:o.ZU.NUMBER},municipio:{type:o.ZU.NUMBER}}},relacao_empregados:{type:o.ZU.ARRAY,items:u},contratos:{type:o.ZU.ARRAY,items:m},documentos_fiscais:{type:o.ZU.ARRAY,items:p},pagamentos:{type:o.ZU.ARRAY,items:x},empenhos:{type:o.ZU.ARRAY,items:{type:o.ZU.OBJECT,properties:{numero:{type:o.ZU.STRING},data_emissao:{type:o.ZU.STRING},valor:{type:o.ZU.NUMBER},historico:{type:o.ZU.STRING}}}},repasses:{type:o.ZU.ARRAY,items:{type:o.ZU.OBJECT,properties:{data_repasse:{type:o.ZU.STRING},valor_repasse:{type:o.ZU.NUMBER},numero_documento:{type:o.ZU.STRING}}}}}};try{const s=await c.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:t,data:e}},{text:"\n    You are an expert accountant and auditor for TCESP Audesp Phase V.\n    Analyze this ENTIRE document (Accountability Report / Presta\xe7\xe3o de Contas).\n    \n    Your task is to identify and extract ALL relevant sections into a single JSON structure.\n    \n    1. Identify the 'Descritor' (Year, Month, Entity, City).\n    2. Identify 'Empregados' (Payroll).\n    3. Identify 'Contratos' (Contracts).\n    4. Identify 'Documentos Fiscais' (Invoices, Receipts).\n    5. Identify 'Pagamentos' (Bank transfers, checks).\n    6. Identify 'Empenhos' (Commitments).\n    7. Identify 'Repasses' (Transfers received).\n    \n    If a section is not found, return an empty array for it.\n    Normalize all dates to YYYY-MM-DD.\n    Normalize all values to float (e.g. 1250.50).\n    Clean CPF/CNPJ (numbers only).\n    "}]},config:{responseMimeType:"application/json",responseSchema:a}});if(s.text){return i(JSON.parse(s.text))}return null}catch(s){throw console.error("Full Report Extraction Error:",s),s}}var f=a(2750),g=a(579);const N=e=>{let{onDataMerge:t,onCancel:a}=e;const[o,r]=(0,s.useState)(!1),[n,l]=(0,s.useState)(""),[i,c]=(0,s.useState)(null),d=()=>{i&&t(i)};var p,u,m,x;return i?(0,g.jsx)("div",{className:"fixed inset-0 bg-slate-900/80 z-50 flex items-center justify-center p-4",children:(0,g.jsxs)("div",{className:"bg-white w-full max-w-4xl h-[90vh] rounded-lg shadow-2xl flex flex-col",children:[(0,g.jsxs)("div",{className:"p-6 border-b border-slate-200 flex justify-between items-center bg-slate-50",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("h2",{className:"text-xl font-bold text-slate-800",children:"Revis\xe3o da Importa\xe7\xe3o Inteligente"}),(0,g.jsx)("p",{className:"text-sm text-slate-500",children:"O OCR identificou os seguintes registros no seu documento."})]}),(0,g.jsxs)("div",{className:"flex gap-3",children:[(0,g.jsx)("button",{onClick:a,className:"text-slate-500 hover:text-slate-800 font-bold text-sm px-4",children:"Cancelar"}),(0,g.jsx)("button",{onClick:d,className:f.VR.BTN_ADD,children:"Confirmar e Importar Tudo"})]})]}),(0,g.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-100 space-y-6",children:[(0,g.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,g.jsx)(b,{label:"Empregados",count:(null===(p=i.relacao_empregados)||void 0===p?void 0:p.length)||0}),(0,g.jsx)(b,{label:"Contratos",count:(null===(u=i.contratos)||void 0===u?void 0:u.length)||0}),(0,g.jsx)(b,{label:"Notas Fiscais",count:(null===(m=i.documentos_fiscais)||void 0===m?void 0:m.length)||0}),(0,g.jsx)(b,{label:"Pagamentos",count:(null===(x=i.pagamentos)||void 0===x?void 0:x.length)||0})]}),(0,g.jsxs)("div",{className:"bg-white p-4 rounded border border-slate-200",children:[(0,g.jsx)("h3",{className:"font-bold text-sm mb-2 text-slate-700",children:"Pr\xe9-visualiza\xe7\xe3o dos Dados Estruturados"}),(0,g.jsx)("pre",{className:"text-xs font-mono bg-slate-900 text-green-400 p-4 rounded overflow-auto max-h-96",children:JSON.stringify(i,null,2)})]})]})]})}):(0,g.jsx)("div",{className:"fixed inset-0 bg-slate-900/80 z-50 flex items-center justify-center p-4",children:(0,g.jsxs)("div",{className:"bg-white w-full max-w-lg rounded-lg shadow-2xl p-8 text-center",children:[(0,g.jsxs)("div",{className:"mb-6",children:[(0,g.jsx)("div",{className:"w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,g.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,g.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 011.414.586l4.414 4.414a1 1 0 01.586 1.414V19a2 2 0 01-2 2z"})})}),(0,g.jsx)("h2",{className:"text-2xl font-bold text-slate-800",children:"Importar Presta\xe7\xe3o Completa"}),(0,g.jsx)("p",{className:"text-slate-500 mt-2 text-sm",children:"Fa\xe7a upload de um PDF contendo m\xfaltiplos documentos (Notas, Extratos, Folha). A IA ir\xe1 separar e classificar tudo automaticamente."})]}),(0,g.jsxs)("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-8 hover:bg-slate-50 transition-colors relative cursor-pointer",children:[(0,g.jsx)("input",{type:"file",accept:"application/pdf",onChange:async e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0];r(!0),l("Lendo arquivo (Isso pode levar alguns segundos)...");const a=new FileReader;a.onloadend=async()=>{try{const e=a.result.split(",")[1];l("Enviando para IA (Gemini 2.0)...");const s=await h(e,t.type);s?(c(s),l("An\xe1lise conclu\xedda. Revise os dados abaixo.")):l("Falha: Nenhum dado estruturado encontrado.")}catch(e){l("Erro: ".concat(e.message))}finally{r(!1)}},a.readAsDataURL(t)}},disabled:o,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),o?(0,g.jsxs)("div",{className:"space-y-3",children:[(0,g.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"}),(0,g.jsx)("p",{className:"text-sm font-bold text-blue-600",children:n})]}):(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"font-bold text-slate-700",children:"Clique ou arraste o PDF aqui"}),(0,g.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:"Suporta arquivos PDF digitalizados (OCR via Gemini)"})]})]}),(0,g.jsx)("button",{onClick:a,className:"mt-6 text-slate-400 hover:text-slate-600 text-sm font-medium",children:"Cancelar"})]})})},b=e=>{let{label:t,count:a}=e;return(0,g.jsxs)("div",{className:"bg-white p-4 rounded border border-slate-200 shadow-sm text-center",children:[(0,g.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:a}),(0,g.jsx)("div",{className:"text-xs text-slate-500 uppercase font-bold",children:t})]})}}}]);
//# sourceMappingURL=18.fc886e96.chunk.js.map