"use strict";(self.webpackChunkaudesp_connect_phase_v=self.webpackChunkaudesp_connect_phase_v||[]).push([[714],{1714(e,a,s){s.r(a),s.d(a,{ValidationDashboard:()=>i,default:()=>c});var t=s(5043),o=s(3563),n=s(2521),r=s(579);const i=e=>{let{formData:a,userId:s="anonymous"}=e;const[i,c]=(0,t.useState)(!1),l=(0,t.useMemo)(()=>(0,o.Zl)(a),[a]),d={totalErrors:l.errors.length,totalWarnings:l.warnings.length,isValid:l.isValid,completeness:Object.keys(l.summary.sections).length},m=l.errors.reduce((e,a)=>{const s=a.section||"Geral";return e[s]||(e[s]=[]),e[s].push(a),e},{});return(0,r.jsxs)("div",{className:"w-full bg-white rounded-lg shadow-lg border border-slate-200 p-6",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"\u2713 Valida\xe7\xe3o da Presta\xe7\xe3o de Contas"}),(0,r.jsx)("p",{className:"text-sm text-slate-500",children:"Sistema autom\xe1tico de valida\xe7\xe3o com sugest\xf5es de corre\xe7\xe3o"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"p-4 rounded-lg border-l-4 ".concat(d.isValid?"bg-green-50 border-green-500":"bg-red-50 border-red-500"),children:[(0,r.jsx)("div",{className:"text-xs font-bold uppercase text-slate-600 mb-1",children:"Status"}),(0,r.jsx)("div",{className:"text-2xl font-bold ".concat(d.isValid?"text-green-600":"text-red-600"),children:d.isValid?"\u2705 OK":"\u274c Erros"})]}),(0,r.jsxs)("div",{className:"p-4 rounded-lg bg-red-50 border-l-4 border-red-500",children:[(0,r.jsx)("div",{className:"text-xs font-bold uppercase text-slate-600 mb-1",children:"Erros"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-red-600",children:d.totalErrors})]}),(0,r.jsxs)("div",{className:"p-4 rounded-lg bg-yellow-50 border-l-4 border-yellow-500",children:[(0,r.jsx)("div",{className:"text-xs font-bold uppercase text-slate-600 mb-1",children:"Avisos"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:d.totalWarnings})]}),(0,r.jsxs)("div",{className:"p-4 rounded-lg bg-blue-50 border-l-4 border-blue-500",children:[(0,r.jsx)("div",{className:"text-xs font-bold uppercase text-slate-600 mb-1",children:"Se\xe7\xf5es"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:d.completeness})]})]}),!d.isValid&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-sm font-bold text-slate-700",children:"Corre\xe7\xe3o necess\xe1ria"}),(0,r.jsxs)("span",{className:"text-sm font-bold text-slate-600",children:[Math.round((d.completeness-d.totalErrors)/d.completeness*100),"%"]})]}),(0,r.jsx)("div",{className:"w-full bg-slate-200 rounded-full h-3 overflow-hidden",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-red-500 to-orange-500 h-full transition-all",style:{width:"".concat(Math.max(5,(d.completeness-d.totalErrors)/d.completeness*100),"%")}})})]}),d.totalErrors>0&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("button",{onClick:()=>c(!i),className:"w-full flex items-center justify-between p-4 bg-red-50 rounded-lg border border-red-200 hover:bg-red-100 transition",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xl",children:"\ud83d\udd34"}),(0,r.jsxs)("span",{className:"font-bold text-red-700",children:[d.totalErrors," Erro(s) Encontrado(s)"]})]}),(0,r.jsx)("span",{className:"text-slate-500",children:i?"\u25bc":"\u25b6"})]}),i&&(0,r.jsx)("div",{className:"mt-4 space-y-4",children:Object.entries(m).map(e=>{let[a,s]=e;return(0,r.jsxs)("div",{className:"border-l-4 border-red-500 pl-4",children:[(0,r.jsxs)("h4",{className:"font-bold text-slate-700 mb-2",children:["\ud83d\udccb ",a]}),(0,r.jsx)("ul",{className:"space-y-1",children:s.map((e,a)=>(0,r.jsxs)("li",{className:"text-sm text-slate-600 bg-red-50 p-2 rounded",children:[(0,r.jsxs)("strong",{children:[e.field,":"]})," ",e.message]},a))})]},a)})})]}),d.totalWarnings>0&&(0,r.jsxs)("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("span",{className:"text-xl",children:"\u26a0\ufe0f"}),(0,r.jsxs)("span",{className:"font-bold text-yellow-700",children:[d.totalWarnings," Aviso(s)"]})]}),(0,r.jsx)("ul",{className:"space-y-1",children:l.warnings.slice(0,5).map((e,a)=>(0,r.jsxs)("li",{className:"text-sm text-yellow-800",children:["\u2022 ",e.message]},a))})]}),d.isValid&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-2xl",children:"\u2705"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-bold text-green-700",children:"Valida\xe7\xe3o Conclu\xedda!"}),(0,r.jsx)("p",{className:"text-sm text-green-600",children:"Nenhum erro encontrado. Sistema pronto para transmiss\xe3o."})]})]})}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsxs)("button",{onClick:()=>{n.gT.logValidation(!d.isValid,d.totalErrors,s)},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition flex items-center justify-center gap-2",children:[(0,r.jsx)("span",{children:"\ud83d\udcca"})," Registrar Valida\xe7\xe3o"]}),(0,r.jsx)("button",{onClick:()=>c(!i),className:"flex-1 px-4 py-2 bg-slate-200 text-slate-700 rounded-lg font-bold hover:bg-slate-300 transition",children:i?"Ocultar Detalhes":"Ver Detalhes"})]}),(0,r.jsx)("div",{className:"mt-6 pt-4 border-t border-slate-200",children:(0,r.jsx)("p",{className:"text-xs text-slate-500",children:"\u2139\ufe0f Valida\xe7\xe3o autom\xe1tica baseada em 20+ regras de neg\xf3cio. Para altera\xe7\xf5es, revise os campos indicados acima."})})]})},c=i},3563(e,a,s){s.d(a,{Zl:()=>i,lr:()=>r});class t{static isValidCPF(e){const a=e.replace(/\D/g,"");if(11!==a.length)return!1;if(/^(\d)\1{10}$/.test(a))return!1;let s,t=0;for(let o=1;o<=9;o++)t+=parseInt(a.substring(o-1,o))*(11-o);if(s=10*t%11,10!==s&&11!==s||(s=0),s!==parseInt(a.substring(9,10)))return!1;t=0;for(let o=1;o<=10;o++)t+=parseInt(a.substring(o-1,o))*(12-o);return s=10*t%11,10!==s&&11!==s||(s=0),s===parseInt(a.substring(10,11))}static isValidCNPJ(e){const a=e.replace(/\D/g,"");if(14!==a.length)return!1;if(/^(\d)\1{13}$/.test(a))return!1;let s=a.length-2,t=a.substring(0,s),o=a.substring(s),n=0,r=s-7;for(let c=s;c>=1;c--)n+=t.charAt(s-c)*r--,r<2&&(r=9);let i=n%11<2?0:11-n%11;if(i!==parseInt(o.charAt(0)))return!1;s+=1,t=a.substring(0,s),n=0,r=s-7;for(let c=s;c>=1;c--)n+=t.charAt(s-c)*r--,r<2&&(r=9);return i=n%11<2?0:11-n%11,i===parseInt(o.charAt(1))}static isValidDate(e){if(!/^\d{4}-\d{2}-\d{2}$/.test(e))return!1;const a=new Date(e+"T00:00:00Z");return!isNaN(a.getTime())}static isValidCurrency(e){return"number"===typeof e&&!isNaN(e)&&isFinite(e)}static isValidCBO(e){const a=e.replace("-","");return/^\d{4}$/.test(a)}static isValidCNS(e){const a=e.replace(/\D/g,"");return 15===a.length&&/^\d+$/.test(a)}static isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static isValidPhone(e){const a=e.replace(/\D/g,"");return a.length>=10&&a.length<=11}}class o{static isValidFiscalMonth(e){return e>=1&&e<=12}static isDateInFiscalPeriod(e,a,s){try{const t=new Date(e),o=t.getMonth()+1;return t.getFullYear()===s&&o===a}catch(t){return!1}}static isVigencyWithinFiscalPeriod(e,a,s,t){try{const o=new Date(e),n=a?new Date(a):new Date(e),r=new Date("".concat(t,"-").concat(String(s).padStart(2,"0"),"-01"));return o<=new Date(t,s,0)&&n>=r}catch(o){return!1}}}class n{static validateInvoiceReferences(e){var a,s;const t=[],o=new Set((null===(a=e.documentos_fiscais)||void 0===a?void 0:a.map(e=>e.numero))||[]);return null===(s=e.pagamentos)||void 0===s||s.forEach((e,a)=>{o.has(e.identificacao_documento_fiscal.numero)||t.push({field:"pagamentos[".concat(a,"].identificacao_documento_fiscal.numero"),message:'Documento fiscal "'.concat(e.identificacao_documento_fiscal.numero,'" n\xe3o encontrado na se\xe7\xe3o 7'),severity:"error",section:"8",value:e.identificacao_documento_fiscal.numero})}),t}static validateContractReferences(e){var a,s;const t=[],o=new Set((null===(a=e.contratos)||void 0===a?void 0:a.map(e=>e.numero))||[]);return null===(s=e.documentos_fiscais)||void 0===s||s.forEach((e,a)=>{var s;null!==(s=e.identificacao_contrato)&&void 0!==s&&s.numero&&!o.has(e.identificacao_contrato.numero)&&t.push({field:"documentos_fiscais[".concat(a,"].identificacao_contrato.numero"),message:'Contrato "'.concat(e.identificacao_contrato.numero,'" n\xe3o encontrado na se\xe7\xe3o 6'),severity:"error",section:"7",value:e.identificacao_contrato.numero})}),t}static validatePaymentConsistency(e){var a;const s=[],t=new Map((e.documentos_fiscais||[]).map(e=>[e.numero,e]));return null===(a=e.pagamentos)||void 0===a||a.forEach((e,a)=>{const o=t.get(e.identificacao_documento_fiscal.numero);if(o){if(e.pagamento_data&&o.data_emissao){new Date(e.pagamento_data)<new Date(o.data_emissao)&&s.push({field:"pagamentos[".concat(a,"].pagamento_data"),message:"Data do pagamento (".concat(e.pagamento_data,") anterior \xe0 emiss\xe3o do documento (").concat(o.data_emissao,")"),severity:"error",section:"8"})}e.pagamento_valor>1.05*o.valor_bruto&&s.push({field:"pagamentos[".concat(a,"].pagamento_valor"),message:"Valor do pagamento (R$ ".concat(e.pagamento_valor,") superior em mais de 5% ao documento (R$ ").concat(o.valor_bruto,")"),severity:"warning",section:"8"})}}),s}static validateBalanceConsistency(e){var a,s;const t=[];return null===(a=e.disponibilidades)||void 0===a||null===(s=a.saldos)||void 0===s||s.forEach((e,a)=>{e.saldo_contabil<0&&t.push({field:"disponibilidades.saldos[".concat(a,"].saldo_contabil"),message:"Saldo cont\xe1bil n\xe3o pode ser negativo (".concat(e.saldo_contabil,")"),severity:"error",section:"9"});const s=Math.abs(e.saldo_bancario-e.saldo_contabil);s>Math.max(100,.01*e.saldo_contabil)&&t.push({field:"disponibilidades.saldos[".concat(a,"]"),message:"Diferen\xe7a significativa entre saldo banc\xe1rio (R$ ".concat(e.saldo_bancario,") e cont\xe1bil (R$ ").concat(e.saldo_contabil,") - Diferen\xe7a: R$ ").concat(s),severity:"warning",section:"9"})}),t}}class r{static validate(e){const a=[],s=[];this.validateBasicFormats(e,a),this.validateFiscalPeriod(e,a,s),a.push(...n.validateInvoiceReferences(e)),a.push(...n.validateContractReferences(e)),s.push(...n.validatePaymentConsistency(e)),s.push(...n.validateBalanceConsistency(e));const t=a.filter(e=>"error"===e.severity),o=[...s,...a.filter(e=>"warning"===e.severity)];return{isValid:0===t.length,errors:t,warnings:o,summary:this.generateSummary(t,o)}}static validateBasicFormats(e,a){var s,o,n;e.descritor.municipio||a.push({field:"descritor.municipio",message:"Munic\xedpio \xe9 obrigat\xf3rio",severity:"error",section:"1"}),null===(s=e.relacao_empregados)||void 0===s||s.forEach((e,s)=>{t.isValidCPF(e.cpf)||a.push({field:"relacao_empregados[".concat(s,"].cpf"),message:"CPF inv\xe1lido: ".concat(e.cpf),severity:"error",section:"4",value:e.cpf}),t.isValidDate(e.data_admissao)||a.push({field:"relacao_empregados[".concat(s,"].data_admissao"),message:"Data de admiss\xe3o em formato inv\xe1lido: ".concat(e.data_admissao),severity:"error",section:"4",value:e.data_admissao}),t.isValidCBO(e.cbo)||a.push({field:"relacao_empregados[".concat(s,"].cbo"),message:"CBO inv\xe1lido: ".concat(e.cbo),severity:"error",section:"4",value:e.cbo})}),null===(o=e.contratos)||void 0===o||o.forEach((e,s)=>{t.isValidCNPJ(e.credor.documento_numero)||t.isValidCPF(e.credor.documento_numero)||a.push({field:"contratos[".concat(s,"].credor.documento_numero"),message:"CPF/CNPJ inv\xe1lido: ".concat(e.credor.documento_numero),severity:"error",section:"6",value:e.credor.documento_numero}),t.isValidDate(e.data_assinatura)||a.push({field:"contratos[".concat(s,"].data_assinatura"),message:"Data de assinatura em formato inv\xe1lido: ".concat(e.data_assinatura),severity:"error",section:"6",value:e.data_assinatura})}),null===(n=e.documentos_fiscais)||void 0===n||n.forEach((e,s)=>{t.isValidCNPJ(e.credor.documento_numero)||t.isValidCPF(e.credor.documento_numero)||a.push({field:"documentos_fiscais[".concat(s,"].credor.documento_numero"),message:"CPF/CNPJ inv\xe1lido: ".concat(e.credor.documento_numero),severity:"error",section:"7",value:e.credor.documento_numero})})}static validateFiscalPeriod(e,a,s){var t,n;const{mes:r,ano:i}=e.descritor;o.isValidFiscalMonth(r)||a.push({field:"descritor.mes",message:"M\xeas inv\xe1lido: ".concat(r),severity:"error",section:"1"}),null===(t=e.relacao_empregados)||void 0===t||t.forEach((e,a)=>{o.isDateInFiscalPeriod(e.data_admissao,r,i)||s.push({field:"relacao_empregados[".concat(a,"].data_admissao"),message:"Data de admiss\xe3o (".concat(e.data_admissao,") fora do per\xedodo de refer\xeancia (").concat(r,"/").concat(i,")"),severity:"warning",section:"4"})}),null===(n=e.contratos)||void 0===n||n.forEach((e,a)=>{o.isVigencyWithinFiscalPeriod(e.vigencia_data_inicial,e.vigencia_data_final,r,i)||s.push({field:"contratos[".concat(a,"].vigencia"),message:"Vig\xeancia do contrato n\xe3o se sobrep\xf5e com per\xedodo fiscal (".concat(r,"/").concat(i,")"),severity:"warning",section:"6"})})}static generateSummary(e,a){const s={};return e.forEach(e=>{e.section&&(s[e.section]||(s[e.section]={errors:0,warnings:0}),s[e.section].errors++)}),a.forEach(e=>{e.section&&(s[e.section]||(s[e.section]={errors:0,warnings:0}),s[e.section].warnings++)}),{totalErrors:e.length,totalWarnings:a.length,sections:s}}static generateConsistencyReport(e){var a,s,t,o;const n=new Set((null===(a=e.documentos_fiscais)||void 0===a?void 0:a.map(e=>e.numero))||[]),r=new Set((null===(s=e.contratos)||void 0===s?void 0:s.map(e=>e.numero))||[]);let i=0,c=0;null===(t=e.pagamentos)||void 0===t||t.forEach(e=>{n.has(e.identificacao_documento_fiscal.numero)?i++:c++});let l=0,d=0;return null===(o=e.documentos_fiscais)||void 0===o||o.forEach(e=>{var a,s;null!==(a=e.identificacao_contrato)&&void 0!==a&&a.numero&&r.has(e.identificacao_contrato.numero)?l++:null!==(s=e.identificacao_contrato)&&void 0!==s&&s.numero&&d++}),{hasConsistencyIssues:c>0||d>0,issues:[],crossReferences:{paymentToInvoice:{found:i,missing:c},contractToInvoice:{found:l,missing:d},employeeToPayment:{found:0,missing:0}}}}}const i=e=>r.validate(e)}}]);
//# sourceMappingURL=714.60973768.chunk.js.map