{"version":3,"file":"static/js/484.d1db2c70.chunk.js","mappings":"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","sources":["../node_modules/tesseract.js/src/worker/browser/loadImage.js","../node_modules/tesseract.js/src/index.js","../node_modules/tesseract.js/src/createScheduler.js","../node_modules/tesseract.js/src/constants/OEM.js","../node_modules/tesseract.js/src/utils/getId.js","../node_modules/tesseract.js/src/utils/getEnvironment.js","../node_modules/@babel/runtime/helpers/objectWithoutProperties.js","../node_modules/tesseract.js/src/Tesseract.js","../node_modules/@babel/runtime/helpers/esm/toSetter.js","../node_modules/@babel/runtime/helpers/esm/checkPrivateRedeclaration.js","../node_modules/@babel/runtime/helpers/esm/classPrivateMethodInitSpec.js","../node_modules/@babel/runtime/helpers/esm/classPrivateFieldInitSpec.js","../node_modules/@babel/runtime/helpers/esm/assertClassBrand.js","../node_modules/@babel/runtime/helpers/esm/classPrivateGetter.js","../node_modules/@babel/runtime/helpers/esm/classPrivateFieldGet2.js","../node_modules/@babel/runtime/helpers/esm/classPrivateFieldSet2.js","../node_modules/@babel/runtime/helpers/esm/asyncIterator.js","../pdf.js/src/shared/util.js","../pdf.js/src/display/xfa_text.js","../pdf.js/src/display/xfa_layer.js","../pdf.js/src/display/display_utils.js","../pdf.js/src/display/editor/toolbar.js","../pdf.js/src/display/editor/tools.js","../pdf.js/src/display/editor/alt_text.js","../pdf.js/src/display/editor/comment.js","../pdf.js/src/display/touch_manager.js","../pdf.js/src/display/editor/editor.js","../pdf.js/src/shared/murmurhash3.js","../pdf.js/src/display/annotation_storage.js","../pdf.js/src/display/font_loader.js","../pdf.js/src/shared/obj-bin-transform.js","../pdf.js/src/display/api_utils.js","../pdf.js/src/shared/message_handler.js","../pdf.js/src/display/canvas_factory.js","../pdf.js/src/display/cmap_reader_factory.js","../pdf.js/src/display/filter_factory.js","../pdf.js/src/display/standard_fontdata_factory.js","../pdf.js/src/display/wasm_factory.js","../pdf.js/src/display/node_utils.js","../pdf.js/src/display/canvas_dependency_tracker.js","../pdf.js/src/display/pattern_helper.js","../pdf.js/src/shared/image_utils.js","../pdf.js/src/display/canvas.js","../pdf.js/src/display/worker_options.js","../pdf.js/src/display/metadata.js","../pdf.js/src/display/optional_content_config.js","../pdf.js/src/display/transport_stream.js","../pdf.js/src/display/network_utils.js","../pdf.js/src/display/content_disposition.js","../pdf.js/src/display/fetch_stream.js","../pdf.js/src/display/network.js","../pdf.js/src/display/node_stream.js","../pdf.js/src/display/pdf_objects.js","../pdf.js/src/display/text_layer.js","../pdf.js/src/display/api.js","../pdf.js/src/display/editor/color_picker.js","../pdf.js/src/shared/scripting_utils.js","../pdf.js/src/display/svg_factory.js","../pdf.js/src/display/annotation_layer.js","../pdf.js/src/display/editor/freetext.js","../pdf.js/src/display/editor/drawers/outline.js","../pdf.js/src/display/editor/drawers/freedraw.js","../pdf.js/src/display/editor/drawers/highlight.js","../pdf.js/src/display/editor/highlight.js","../pdf.js/src/display/editor/draw.js","../pdf.js/src/display/editor/drawers/inkdraw.js","../pdf.js/src/display/editor/ink.js","../pdf.js/src/display/editor/drawers/contour.js","../pdf.js/src/display/editor/drawers/signaturedraw.js","../pdf.js/src/display/editor/signature.js","../pdf.js/src/display/editor/stamp.js","../pdf.js/src/display/editor/annotation_editor_layer.js","../pdf.js/src/display/draw_layer.js","../pdf.js/src/pdf.js","../node_modules/tesseract.js/src/worker/browser/defaultOptions.js","../node_modules/tesseract.js/src/worker/browser/index.js","../node_modules/tesseract.js/src/worker/browser/spawnWorker.js","../node_modules/tesseract.js/src/worker/browser/terminateWorker.js","../node_modules/@babel/runtime/helpers/objectWithoutPropertiesLoose.js","../node_modules/tesseract.js/src/createJob.js","../node_modules/tesseract.js/src/utils/log.js","../node_modules/tesseract.js/src/constants/PSM.js","../node_modules/tesseract.js/src/worker/browser/onMessage.js","../node_modules/tesseract.js/src/worker/browser/send.js","../node_modules/tesseract.js/src/constants/defaultOptions.js","../node_modules/tesseract.js/src/constants/languages.js","../node_modules/tesseract.js/src/utils/resolvePaths.js","../node_modules/tesseract.js/src/createWorker.js"],"sourcesContent":["'use strict';\n\n/**\n * readFromBlobOrFile\n *\n * @name readFromBlobOrFile\n * @function\n * @access private\n */\nconst readFromBlobOrFile = (blob) => (\n  new Promise((resolve, reject) => {\n    const fileReader = new FileReader();\n    fileReader.onload = () => {\n      resolve(fileReader.result);\n    };\n    fileReader.onerror = ({ target: { error: { code } } }) => {\n      reject(Error(`File could not be read! Code=${code}`));\n    };\n    fileReader.readAsArrayBuffer(blob);\n  })\n);\n\n/**\n * loadImage\n *\n * @name loadImage\n * @function load image from different source\n * @access private\n */\nconst loadImage = async (image) => {\n  let data = image;\n  if (typeof image === 'undefined') {\n    return 'undefined';\n  }\n\n  if (typeof image === 'string') {\n    // Base64 Image\n    if (/data:image\\/([a-zA-Z]*);base64,([^\"]*)/.test(image)) {\n      data = atob(image.split(',')[1])\n        .split('')\n        .map((c) => c.charCodeAt(0));\n    } else {\n      const resp = await fetch(image);\n      data = await resp.arrayBuffer();\n    }\n  } else if (typeof HTMLElement !== 'undefined' && image instanceof HTMLElement) {\n    if (image.tagName === 'IMG') {\n      data = await loadImage(image.src);\n    }\n    if (image.tagName === 'VIDEO') {\n      data = await loadImage(image.poster);\n    }\n    if (image.tagName === 'CANVAS') {\n      await new Promise((resolve) => {\n        image.toBlob(async (blob) => {\n          data = await readFromBlobOrFile(blob);\n          resolve();\n        });\n      });\n    }\n  } else if (typeof OffscreenCanvas !== 'undefined' && image instanceof OffscreenCanvas) {\n    const blob = await image.convertToBlob();\n    data = await readFromBlobOrFile(blob);\n  } else if (image instanceof File || image instanceof Blob) {\n    data = await readFromBlobOrFile(image);\n  }\n\n  return new Uint8Array(data);\n};\n\nmodule.exports = loadImage;\n","'use strict';\n\n/**\n *\n * Entry point for tesseract.js, should be the entry when bundling.\n *\n * @fileoverview entry point for tesseract.js\n * @author Kevin Kwok <antimatter15@gmail.com>\n * @author Guillermo Webster <gui@mit.edu>\n * @author Jerome Wu <jeromewus@gmail.com>\n */\nrequire('regenerator-runtime/runtime');\nconst createScheduler = require('./createScheduler');\nconst createWorker = require('./createWorker');\nconst Tesseract = require('./Tesseract');\nconst languages = require('./constants/languages');\nconst OEM = require('./constants/OEM');\nconst PSM = require('./constants/PSM');\nconst { setLogging } = require('./utils/log');\n\nmodule.exports = {\n  languages,\n  OEM,\n  PSM,\n  createScheduler,\n  createWorker,\n  setLogging,\n  ...Tesseract,\n};\n","'use strict';\n\nconst createJob = require('./createJob');\nconst { log } = require('./utils/log');\nconst getId = require('./utils/getId');\n\nlet schedulerCounter = 0;\n\nmodule.exports = () => {\n  const id = getId('Scheduler', schedulerCounter);\n  const workers = {};\n  const runningWorkers = {};\n  let jobQueue = [];\n\n  schedulerCounter += 1;\n\n  const getQueueLen = () => jobQueue.length;\n  const getNumWorkers = () => Object.keys(workers).length;\n\n  const dequeue = () => {\n    if (jobQueue.length !== 0) {\n      const wIds = Object.keys(workers);\n      for (let i = 0; i < wIds.length; i += 1) {\n        if (typeof runningWorkers[wIds[i]] === 'undefined') {\n          jobQueue[0](workers[wIds[i]]);\n          break;\n        }\n      }\n    }\n  };\n\n  const queue = (action, payload) => (\n    new Promise((resolve, reject) => {\n      const job = createJob({ action, payload });\n      jobQueue.push(async (w) => {\n        jobQueue.shift();\n        runningWorkers[w.id] = job;\n        try {\n          resolve(await w[action].apply(this, [...payload, job.id]));\n        } catch (err) {\n          reject(err);\n        } finally {\n          delete runningWorkers[w.id];\n          dequeue();\n        }\n      });\n      log(`[${id}]: Add ${job.id} to JobQueue`);\n      log(`[${id}]: JobQueue length=${jobQueue.length}`);\n      dequeue();\n    })\n  );\n\n  const addWorker = (w) => {\n    workers[w.id] = w;\n    log(`[${id}]: Add ${w.id}`);\n    log(`[${id}]: Number of workers=${getNumWorkers()}`);\n    dequeue();\n    return w.id;\n  };\n\n  const addJob = async (action, ...payload) => {\n    if (getNumWorkers() === 0) {\n      throw Error(`[${id}]: You need to have at least one worker before adding jobs`);\n    }\n    return queue(action, payload);\n  };\n\n  const terminate = async () => {\n    Object.keys(workers).forEach(async (wid) => {\n      await workers[wid].terminate();\n    });\n    jobQueue = [];\n  };\n\n  return {\n    addWorker,\n    addJob,\n    terminate,\n    getQueueLen,\n    getNumWorkers,\n  };\n};\n","'use strict';\n\n/*\n * OEM = OCR Engine Mode, and there are 4 possible modes.\n *\n * By default tesseract.js uses LSTM_ONLY mode.\n *\n */\nmodule.exports = {\n  TESSERACT_ONLY: 0,\n  LSTM_ONLY: 1,\n  TESSERACT_LSTM_COMBINED: 2,\n  DEFAULT: 3,\n};\n","'use strict';\n\nmodule.exports = (prefix, cnt) => (\n  `${prefix}-${cnt}-${Math.random().toString(16).slice(3, 8)}`\n);\n","'use strict';\n\nmodule.exports = (key) => {\n  const env = {};\n\n  if (typeof WorkerGlobalScope !== 'undefined') {\n    env.type = 'webworker';\n  } else if (typeof document === 'object') {\n    env.type = 'browser';\n  } else if (typeof process === 'object' && typeof require === 'function') {\n    env.type = 'node';\n  }\n\n  if (typeof key === 'undefined') {\n    return env;\n  }\n\n  return env[key];\n};\n","var objectWithoutPropertiesLoose = require(\"./objectWithoutPropertiesLoose.js\");\nfunction _objectWithoutProperties(e, t) {\n  if (null == e) return {};\n  var o,\n    r,\n    i = objectWithoutPropertiesLoose(e, t);\n  if (Object.getOwnPropertySymbols) {\n    var n = Object.getOwnPropertySymbols(e);\n    for (r = 0; r < n.length; r++) o = n[r], -1 === t.indexOf(o) && {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]);\n  }\n  return i;\n}\nmodule.exports = _objectWithoutProperties, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","'use strict';\n\nconst createWorker = require('./createWorker');\n\nconst recognize = async (image, langs, options) => {\n  const worker = await createWorker(langs, 1, options);\n  return worker.recognize(image)\n    .finally(async () => {\n      await worker.terminate();\n    });\n};\n\nconst detect = async (image, options) => {\n  const worker = await createWorker('osd', 0, options);\n  return worker.detect(image)\n    .finally(async () => {\n      await worker.terminate();\n    });\n};\n\nmodule.exports = {\n  recognize,\n  detect,\n};\n","function _toSetter(t, e, n) {\n  e || (e = []);\n  var r = e.length++;\n  return Object.defineProperty({}, \"_\", {\n    set: function set(o) {\n      e[r] = o, t.apply(n, e);\n    }\n  });\n}\nexport { _toSetter as default };","function _checkPrivateRedeclaration(e, t) {\n  if (t.has(e)) throw new TypeError(\"Cannot initialize the same private elements twice on an object\");\n}\nexport { _checkPrivateRedeclaration as default };","import checkPrivateRedeclaration from \"./checkPrivateRedeclaration.js\";\nfunction _classPrivateMethodInitSpec(e, a) {\n  checkPrivateRedeclaration(e, a), a.add(e);\n}\nexport { _classPrivateMethodInitSpec as default };","import checkPrivateRedeclaration from \"./checkPrivateRedeclaration.js\";\nfunction _classPrivateFieldInitSpec(e, t, a) {\n  checkPrivateRedeclaration(e, t), t.set(e, a);\n}\nexport { _classPrivateFieldInitSpec as default };","function _assertClassBrand(e, t, n) {\n  if (\"function\" == typeof e ? e === t : e.has(t)) return arguments.length < 3 ? t : n;\n  throw new TypeError(\"Private element is not present on this object\");\n}\nexport { _assertClassBrand as default };","import assertClassBrand from \"./assertClassBrand.js\";\nfunction _classPrivateGetter(s, r, a) {\n  return a(assertClassBrand(s, r));\n}\nexport { _classPrivateGetter as default };","import assertClassBrand from \"./assertClassBrand.js\";\nfunction _classPrivateFieldGet2(s, a) {\n  return s.get(assertClassBrand(s, a));\n}\nexport { _classPrivateFieldGet2 as default };","import assertClassBrand from \"./assertClassBrand.js\";\nfunction _classPrivateFieldSet2(s, a, r) {\n  return s.set(assertClassBrand(s, a), r), r;\n}\nexport { _classPrivateFieldSet2 as default };","function _asyncIterator(r) {\n  var n,\n    t,\n    o,\n    e = 2;\n  for (\"undefined\" != typeof Symbol && (t = Symbol.asyncIterator, o = Symbol.iterator); e--;) {\n    if (t && null != (n = r[t])) return n.call(r);\n    if (o && null != (n = r[o])) return new AsyncFromSyncIterator(n.call(r));\n    t = \"@@asyncIterator\", o = \"@@iterator\";\n  }\n  throw new TypeError(\"Object is not async iterable\");\n}\nfunction AsyncFromSyncIterator(r) {\n  function AsyncFromSyncIteratorContinuation(r) {\n    if (Object(r) !== r) return Promise.reject(new TypeError(r + \" is not an object.\"));\n    var n = r.done;\n    return Promise.resolve(r.value).then(function (r) {\n      return {\n        value: r,\n        done: n\n      };\n    });\n  }\n  return AsyncFromSyncIterator = function AsyncFromSyncIterator(r) {\n    this.s = r, this.n = r.next;\n  }, AsyncFromSyncIterator.prototype = {\n    s: null,\n    n: null,\n    next: function next() {\n      return AsyncFromSyncIteratorContinuation(this.n.apply(this.s, arguments));\n    },\n    \"return\": function _return(r) {\n      var n = this.s[\"return\"];\n      return void 0 === n ? Promise.resolve({\n        value: r,\n        done: !0\n      }) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments));\n    },\n    \"throw\": function _throw(r) {\n      var n = this.s[\"return\"];\n      return void 0 === n ? Promise.reject(r) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments));\n    }\n  }, new AsyncFromSyncIterator(r);\n}\nexport { _asyncIterator as default };","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* globals process */\n\n// NW.js / Electron is a browser context, but copies some Node.js objects; see\n// http://docs.nwjs.io/en/latest/For%20Users/Advanced/JavaScript%20Contexts%20in%20NW.js/#access-nodejs-and-nwjs-api-in-browser-context\n// https://www.electronjs.org/docs/api/process#processversionselectron-readonly\n// https://www.electronjs.org/docs/api/process#processtype-readonly\nconst isNodeJS =\n  (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n  typeof process === \"object\" &&\n  process + \"\" === \"[object process]\" &&\n  !process.versions.nw &&\n  !(process.versions.electron && process.type && process.type !== \"browser\");\n\nconst FONT_IDENTITY_MATRIX = [0.001, 0, 0, 0.001, 0, 0];\n\n// Represent the percentage of the height of a single-line field over\n// the font size. Acrobat seems to use this value.\nconst LINE_FACTOR = 1.35;\nconst LINE_DESCENT_FACTOR = 0.35;\nconst BASELINE_FACTOR = LINE_DESCENT_FACTOR / LINE_FACTOR;\n\n/**\n * Refer to the `WorkerTransport.getRenderingIntent`-method in the API, to see\n * how these flags are being used:\n *  - ANY, DISPLAY, and PRINT are the normal rendering intents, note the\n *    `PDFPageProxy.{render, getOperatorList, getAnnotations}`-methods.\n *  - SAVE is used, on the worker-thread, when saving modified annotations.\n *  - ANNOTATIONS_FORMS, ANNOTATIONS_STORAGE, ANNOTATIONS_DISABLE control which\n *    annotations are rendered onto the canvas (i.e. by being included in the\n *    operatorList), note the `PDFPageProxy.{render, getOperatorList}`-methods\n *    and their `annotationMode`-option.\n *  - IS_EDITING is used when editing is active in the viewer.\n *  - OPLIST is used with the `PDFPageProxy.getOperatorList`-method, note the\n *    `OperatorList`-constructor (on the worker-thread).\n */\nconst RenderingIntentFlag = {\n  ANY: 0x01,\n  DISPLAY: 0x02,\n  PRINT: 0x04,\n  SAVE: 0x08,\n  ANNOTATIONS_FORMS: 0x10,\n  ANNOTATIONS_STORAGE: 0x20,\n  ANNOTATIONS_DISABLE: 0x40,\n  IS_EDITING: 0x80,\n  OPLIST: 0x100,\n};\n\nconst AnnotationMode = {\n  DISABLE: 0,\n  ENABLE: 1,\n  ENABLE_FORMS: 2,\n  ENABLE_STORAGE: 3,\n};\n\nconst AnnotationEditorPrefix = \"pdfjs_internal_editor_\";\n\nconst AnnotationEditorType = {\n  DISABLE: -1,\n  NONE: 0,\n  FREETEXT: 3,\n  HIGHLIGHT: 9,\n  STAMP: 13,\n  INK: 15,\n  POPUP: 16,\n  SIGNATURE: 101,\n  COMMENT: 102,\n};\n\nconst AnnotationEditorParamsType = {\n  RESIZE: 1,\n  CREATE: 2,\n  FREETEXT_SIZE: 11,\n  FREETEXT_COLOR: 12,\n  FREETEXT_OPACITY: 13,\n  INK_COLOR: 21,\n  INK_THICKNESS: 22,\n  INK_OPACITY: 23,\n  HIGHLIGHT_COLOR: 31,\n  HIGHLIGHT_THICKNESS: 32,\n  HIGHLIGHT_FREE: 33,\n  HIGHLIGHT_SHOW_ALL: 34,\n  DRAW_STEP: 41,\n};\n\n// Permission flags from Table 22, Section 7.6.3.2 of the PDF specification.\nconst PermissionFlag = {\n  PRINT: 0x04,\n  MODIFY_CONTENTS: 0x08,\n  COPY: 0x10,\n  MODIFY_ANNOTATIONS: 0x20,\n  FILL_INTERACTIVE_FORMS: 0x100,\n  COPY_FOR_ACCESSIBILITY: 0x200,\n  ASSEMBLE: 0x400,\n  PRINT_HIGH_QUALITY: 0x800,\n};\n\nconst MeshFigureType = {\n  TRIANGLES: 1,\n  LATTICE: 2,\n  PATCH: 3,\n};\n\nconst TextRenderingMode = {\n  FILL: 0,\n  STROKE: 1,\n  FILL_STROKE: 2,\n  INVISIBLE: 3,\n  FILL_ADD_TO_PATH: 4,\n  STROKE_ADD_TO_PATH: 5,\n  FILL_STROKE_ADD_TO_PATH: 6,\n  ADD_TO_PATH: 7,\n  FILL_STROKE_MASK: 3,\n  ADD_TO_PATH_FLAG: 4,\n};\n\nconst ImageKind = {\n  GRAYSCALE_1BPP: 1,\n  RGB_24BPP: 2,\n  RGBA_32BPP: 3,\n};\n\nconst AnnotationType = {\n  TEXT: 1,\n  LINK: 2,\n  FREETEXT: 3,\n  LINE: 4,\n  SQUARE: 5,\n  CIRCLE: 6,\n  POLYGON: 7,\n  POLYLINE: 8,\n  HIGHLIGHT: 9,\n  UNDERLINE: 10,\n  SQUIGGLY: 11,\n  STRIKEOUT: 12,\n  STAMP: 13,\n  CARET: 14,\n  INK: 15,\n  POPUP: 16,\n  FILEATTACHMENT: 17,\n  SOUND: 18,\n  MOVIE: 19,\n  WIDGET: 20,\n  SCREEN: 21,\n  PRINTERMARK: 22,\n  TRAPNET: 23,\n  WATERMARK: 24,\n  THREED: 25,\n  REDACT: 26,\n};\n\nconst AnnotationReplyType = {\n  GROUP: \"Group\",\n  REPLY: \"R\",\n};\n\nconst AnnotationFlag = {\n  INVISIBLE: 0x01,\n  HIDDEN: 0x02,\n  PRINT: 0x04,\n  NOZOOM: 0x08,\n  NOROTATE: 0x10,\n  NOVIEW: 0x20,\n  READONLY: 0x40,\n  LOCKED: 0x80,\n  TOGGLENOVIEW: 0x100,\n  LOCKEDCONTENTS: 0x200,\n};\n\nconst AnnotationFieldFlag = {\n  READONLY: 0x0000001,\n  REQUIRED: 0x0000002,\n  NOEXPORT: 0x0000004,\n  MULTILINE: 0x0001000,\n  PASSWORD: 0x0002000,\n  NOTOGGLETOOFF: 0x0004000,\n  RADIO: 0x0008000,\n  PUSHBUTTON: 0x0010000,\n  COMBO: 0x0020000,\n  EDIT: 0x0040000,\n  SORT: 0x0080000,\n  FILESELECT: 0x0100000,\n  MULTISELECT: 0x0200000,\n  DONOTSPELLCHECK: 0x0400000,\n  DONOTSCROLL: 0x0800000,\n  COMB: 0x1000000,\n  RICHTEXT: 0x2000000,\n  RADIOSINUNISON: 0x2000000,\n  COMMITONSELCHANGE: 0x4000000,\n};\n\nconst AnnotationBorderStyleType = {\n  SOLID: 1,\n  DASHED: 2,\n  BEVELED: 3,\n  INSET: 4,\n  UNDERLINE: 5,\n};\n\nconst AnnotationActionEventType = {\n  E: \"Mouse Enter\",\n  X: \"Mouse Exit\",\n  D: \"Mouse Down\",\n  U: \"Mouse Up\",\n  Fo: \"Focus\",\n  Bl: \"Blur\",\n  PO: \"PageOpen\",\n  PC: \"PageClose\",\n  PV: \"PageVisible\",\n  PI: \"PageInvisible\",\n  K: \"Keystroke\",\n  F: \"Format\",\n  V: \"Validate\",\n  C: \"Calculate\",\n};\n\nconst DocumentActionEventType = {\n  WC: \"WillClose\",\n  WS: \"WillSave\",\n  DS: \"DidSave\",\n  WP: \"WillPrint\",\n  DP: \"DidPrint\",\n};\n\nconst PageActionEventType = {\n  O: \"PageOpen\",\n  C: \"PageClose\",\n};\n\nconst VerbosityLevel = {\n  ERRORS: 0,\n  WARNINGS: 1,\n  INFOS: 5,\n};\n\n// All the possible operations for an operator list.\nconst OPS = {\n  // Intentionally start from 1 so it is easy to spot bad operators that will be\n  // 0's.\n  // PLEASE NOTE: We purposely keep any removed operators commented out, since\n  //              re-numbering the list would risk breaking third-party users.\n  dependency: 1,\n  setLineWidth: 2,\n  setLineCap: 3,\n  setLineJoin: 4,\n  setMiterLimit: 5,\n  setDash: 6,\n  setRenderingIntent: 7,\n  setFlatness: 8,\n  setGState: 9,\n  save: 10,\n  restore: 11,\n  transform: 12,\n  moveTo: 13,\n  lineTo: 14,\n  curveTo: 15,\n  curveTo2: 16,\n  curveTo3: 17,\n  closePath: 18,\n  rectangle: 19,\n  stroke: 20,\n  closeStroke: 21,\n  fill: 22,\n  eoFill: 23,\n  fillStroke: 24,\n  eoFillStroke: 25,\n  closeFillStroke: 26,\n  closeEOFillStroke: 27,\n  endPath: 28,\n  clip: 29,\n  eoClip: 30,\n  beginText: 31,\n  endText: 32,\n  setCharSpacing: 33,\n  setWordSpacing: 34,\n  setHScale: 35,\n  setLeading: 36,\n  setFont: 37,\n  setTextRenderingMode: 38,\n  setTextRise: 39,\n  moveText: 40,\n  setLeadingMoveText: 41,\n  setTextMatrix: 42,\n  nextLine: 43,\n  showText: 44,\n  showSpacedText: 45,\n  nextLineShowText: 46,\n  nextLineSetSpacingShowText: 47,\n  setCharWidth: 48,\n  setCharWidthAndBounds: 49,\n  setStrokeColorSpace: 50,\n  setFillColorSpace: 51,\n  setStrokeColor: 52,\n  setStrokeColorN: 53,\n  setFillColor: 54,\n  setFillColorN: 55,\n  setStrokeGray: 56,\n  setFillGray: 57,\n  setStrokeRGBColor: 58,\n  setFillRGBColor: 59,\n  setStrokeCMYKColor: 60,\n  setFillCMYKColor: 61,\n  shadingFill: 62,\n  beginInlineImage: 63,\n  beginImageData: 64,\n  endInlineImage: 65,\n  paintXObject: 66,\n  markPoint: 67,\n  markPointProps: 68,\n  beginMarkedContent: 69,\n  beginMarkedContentProps: 70,\n  endMarkedContent: 71,\n  beginCompat: 72,\n  endCompat: 73,\n  paintFormXObjectBegin: 74,\n  paintFormXObjectEnd: 75,\n  beginGroup: 76,\n  endGroup: 77,\n  // beginAnnotations: 78,\n  // endAnnotations: 79,\n  beginAnnotation: 80,\n  endAnnotation: 81,\n  // paintJpegXObject: 82,\n  paintImageMaskXObject: 83,\n  paintImageMaskXObjectGroup: 84,\n  paintImageXObject: 85,\n  paintInlineImageXObject: 86,\n  paintInlineImageXObjectGroup: 87,\n  paintImageXObjectRepeat: 88,\n  paintImageMaskXObjectRepeat: 89,\n  paintSolidColorImageMask: 90,\n  constructPath: 91,\n  setStrokeTransparent: 92,\n  setFillTransparent: 93,\n  rawFillPath: 94,\n};\n\n// In order to have a switch statement that is fast (i.e. which use a jump\n// table), we need to have the OPS in a contiguous range.\nconst DrawOPS = {\n  moveTo: 0,\n  lineTo: 1,\n  curveTo: 2,\n  quadraticCurveTo: 3,\n  closePath: 4,\n};\n\nconst PasswordResponses = {\n  NEED_PASSWORD: 1,\n  INCORRECT_PASSWORD: 2,\n};\n\nlet verbosity = VerbosityLevel.WARNINGS;\n\nfunction setVerbosityLevel(level) {\n  if (Number.isInteger(level)) {\n    verbosity = level;\n  }\n}\n\nfunction getVerbosityLevel() {\n  return verbosity;\n}\n\n// A notice for devs. These are good for things that are helpful to devs, such\n// as warning that Workers were disabled, which is important to devs but not\n// end users.\nfunction info(msg) {\n  if (verbosity >= VerbosityLevel.INFOS) {\n    // eslint-disable-next-line no-console\n    console.info(`Info: ${msg}`);\n  }\n}\n\n// Non-fatal warnings.\nfunction warn(msg) {\n  if (verbosity >= VerbosityLevel.WARNINGS) {\n    // eslint-disable-next-line no-console\n    console.warn(`Warning: ${msg}`);\n  }\n}\n\nfunction unreachable(msg) {\n  throw new Error(msg);\n}\n\nfunction assert(cond, msg) {\n  if (!cond) {\n    unreachable(msg);\n  }\n}\n\n// Checks if URLs use one of the allowed protocols, e.g. to avoid XSS.\nfunction _isValidProtocol(url) {\n  switch (url?.protocol) {\n    case \"http:\":\n    case \"https:\":\n    case \"ftp:\":\n    case \"mailto:\":\n    case \"tel:\":\n      return true;\n    default:\n      return false;\n  }\n}\n\n/**\n * Attempts to create a valid absolute URL.\n *\n * @param {URL|string} url - An absolute, or relative, URL.\n * @param {URL|string} [baseUrl] - An absolute URL.\n * @param {Object} [options]\n * @returns Either a valid {URL}, or `null` otherwise.\n */\nfunction createValidAbsoluteUrl(url, baseUrl = null, options = null) {\n  if (!url) {\n    return null;\n  }\n  if (options && typeof url === \"string\") {\n    // Let URLs beginning with \"www.\" default to using the \"http://\" protocol.\n    if (options.addDefaultProtocol && url.startsWith(\"www.\")) {\n      const dots = url.match(/\\./g);\n      // Avoid accidentally matching a *relative* URL pointing to a file named\n      // e.g. \"www.pdf\" or similar.\n      if (dots?.length >= 2) {\n        url = `http://${url}`;\n      }\n    }\n\n    // According to ISO 32000-1:2008, section 12.6.4.7, URIs should be encoded\n    // in 7-bit ASCII. Some bad PDFs use UTF-8 encoding; see bug 1122280.\n    if (options.tryConvertEncoding) {\n      try {\n        url = stringToUTF8String(url);\n      } catch {}\n    }\n  }\n\n  const absoluteUrl = baseUrl ? URL.parse(url, baseUrl) : URL.parse(url);\n  return _isValidProtocol(absoluteUrl) ? absoluteUrl : null;\n}\n\n/**\n * Remove, or replace, the hash property of the URL.\n *\n * @param {URL|string} url - The absolute, or relative, URL.\n * @param {string} hash - The hash property (use an empty string to remove it).\n * @param {boolean} [allowRel] - Allow relative URLs.\n * @returns {string} The resulting URL string.\n */\nfunction updateUrlHash(url, hash, allowRel = false) {\n  const res = URL.parse(url);\n  if (res) {\n    res.hash = hash;\n    return res.href;\n  }\n  // Support well-formed relative URLs, necessary for `web/app.js` in GENERIC\n  // builds, by optionally falling back to string parsing.\n  if (allowRel && createValidAbsoluteUrl(url, \"http://example.com\")) {\n    return url.split(\"#\", 1)[0] + `${hash ? `#${hash}` : \"\"}`;\n  }\n  return \"\";\n}\n\nfunction shadow(obj, prop, value, nonSerializable = false) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    assert(\n      prop in obj,\n      `shadow: Property \"${prop && prop.toString()}\" not found in object.`\n    );\n  }\n  Object.defineProperty(obj, prop, {\n    value,\n    enumerable: !nonSerializable,\n    configurable: true,\n    writable: false,\n  });\n  return value;\n}\n\n/**\n * @type {any}\n */\nconst BaseException = (function BaseExceptionClosure() {\n  // eslint-disable-next-line no-shadow\n  function BaseException(message, name) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseException\n    ) {\n      unreachable(\"Cannot initialize BaseException.\");\n    }\n    this.message = message;\n    this.name = name;\n  }\n  BaseException.prototype = new Error();\n  BaseException.constructor = BaseException;\n\n  return BaseException;\n})();\n\nclass PasswordException extends BaseException {\n  constructor(msg, code) {\n    super(msg, \"PasswordException\");\n    this.code = code;\n  }\n}\n\nclass UnknownErrorException extends BaseException {\n  constructor(msg, details) {\n    super(msg, \"UnknownErrorException\");\n    this.details = details;\n  }\n}\n\nclass InvalidPDFException extends BaseException {\n  constructor(msg) {\n    super(msg, \"InvalidPDFException\");\n  }\n}\n\nclass ResponseException extends BaseException {\n  constructor(msg, status, missing) {\n    super(msg, \"ResponseException\");\n    this.status = status;\n    this.missing = missing;\n  }\n}\n\n/**\n * Error caused during parsing PDF data.\n */\nclass FormatError extends BaseException {\n  constructor(msg) {\n    super(msg, \"FormatError\");\n  }\n}\n\n/**\n * Error used to indicate task cancellation.\n */\nclass AbortException extends BaseException {\n  constructor(msg) {\n    super(msg, \"AbortException\");\n  }\n}\n\nfunction bytesToString(bytes) {\n  if (typeof bytes !== \"object\" || bytes?.length === undefined) {\n    unreachable(\"Invalid argument for bytesToString\");\n  }\n  const length = bytes.length;\n  const MAX_ARGUMENT_COUNT = 8192;\n  if (length < MAX_ARGUMENT_COUNT) {\n    return String.fromCharCode.apply(null, bytes);\n  }\n  const strBuf = [];\n  for (let i = 0; i < length; i += MAX_ARGUMENT_COUNT) {\n    const chunkEnd = Math.min(i + MAX_ARGUMENT_COUNT, length);\n    const chunk = bytes.subarray(i, chunkEnd);\n    strBuf.push(String.fromCharCode.apply(null, chunk));\n  }\n  return strBuf.join(\"\");\n}\n\nfunction stringToBytes(str) {\n  if (typeof str !== \"string\") {\n    unreachable(\"Invalid argument for stringToBytes\");\n  }\n  const length = str.length;\n  const bytes = new Uint8Array(length);\n  for (let i = 0; i < length; ++i) {\n    bytes[i] = str.charCodeAt(i) & 0xff;\n  }\n  return bytes;\n}\n\nfunction string32(value) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    assert(\n      typeof value === \"number\" && Math.abs(value) < 2 ** 32,\n      `string32: Unexpected input \"${value}\".`\n    );\n  }\n  return String.fromCharCode(\n    (value >> 24) & 0xff,\n    (value >> 16) & 0xff,\n    (value >> 8) & 0xff,\n    value & 0xff\n  );\n}\n\nfunction objectSize(obj) {\n  return Object.keys(obj).length;\n}\n\n// Checks the endianness of the platform.\nfunction isLittleEndian() {\n  const buffer8 = new Uint8Array(4);\n  buffer8[0] = 1;\n  const view32 = new Uint32Array(buffer8.buffer, 0, 1);\n  return view32[0] === 1;\n}\n\n// Checks if it's possible to eval JS expressions.\nfunction isEvalSupported() {\n  try {\n    new Function(\"\"); // eslint-disable-line no-new, no-new-func\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nclass FeatureTest {\n  static get isLittleEndian() {\n    return shadow(this, \"isLittleEndian\", isLittleEndian());\n  }\n\n  static get isEvalSupported() {\n    return shadow(this, \"isEvalSupported\", isEvalSupported());\n  }\n\n  static get isOffscreenCanvasSupported() {\n    return shadow(\n      this,\n      \"isOffscreenCanvasSupported\",\n      typeof OffscreenCanvas !== \"undefined\"\n    );\n  }\n\n  static get isImageDecoderSupported() {\n    return shadow(\n      this,\n      \"isImageDecoderSupported\",\n      typeof ImageDecoder !== \"undefined\"\n    );\n  }\n\n  static get isFloat16ArraySupported() {\n    return shadow(\n      this,\n      \"isFloat16ArraySupported\",\n      typeof Float16Array !== \"undefined\"\n    );\n  }\n\n  static get isSanitizerSupported() {\n    return shadow(\n      this,\n      \"isSanitizerSupported\",\n      // eslint-disable-next-line no-undef\n      typeof Sanitizer !== \"undefined\"\n    );\n  }\n\n  static get platform() {\n    const { platform, userAgent } = navigator;\n\n    return shadow(this, \"platform\", {\n      isAndroid: userAgent.includes(\"Android\"),\n      isLinux: platform.includes(\"Linux\"),\n      isMac: platform.includes(\"Mac\"),\n      isWindows: platform.includes(\"Win\"),\n      isFirefox:\n        (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n        userAgent.includes(\"Firefox\"),\n    });\n  }\n\n  static get isCSSRoundSupported() {\n    return shadow(\n      this,\n      \"isCSSRoundSupported\",\n      globalThis.CSS?.supports?.(\"width: round(1.5px, 1px)\")\n    );\n  }\n}\n\nconst hexNumbers = Array.from(Array(256).keys(), n =>\n  n.toString(16).padStart(2, \"0\")\n);\n\nclass Util {\n  static makeHexColor(r, g, b) {\n    return `#${hexNumbers[r]}${hexNumbers[g]}${hexNumbers[b]}`;\n  }\n\n  static domMatrixToTransform(dm) {\n    return [dm.a, dm.b, dm.c, dm.d, dm.e, dm.f];\n  }\n\n  // Apply a scaling matrix to some min/max values.\n  // If a scaling factor is negative then min and max must be\n  // swapped.\n  static scaleMinMax(transform, minMax) {\n    let temp;\n    if (transform[0]) {\n      if (transform[0] < 0) {\n        temp = minMax[0];\n        minMax[0] = minMax[2];\n        minMax[2] = temp;\n      }\n      minMax[0] *= transform[0];\n      minMax[2] *= transform[0];\n\n      if (transform[3] < 0) {\n        temp = minMax[1];\n        minMax[1] = minMax[3];\n        minMax[3] = temp;\n      }\n      minMax[1] *= transform[3];\n      minMax[3] *= transform[3];\n    } else {\n      temp = minMax[0];\n      minMax[0] = minMax[1];\n      minMax[1] = temp;\n      temp = minMax[2];\n      minMax[2] = minMax[3];\n      minMax[3] = temp;\n\n      if (transform[1] < 0) {\n        temp = minMax[1];\n        minMax[1] = minMax[3];\n        minMax[3] = temp;\n      }\n      minMax[1] *= transform[1];\n      minMax[3] *= transform[1];\n\n      if (transform[2] < 0) {\n        temp = minMax[0];\n        minMax[0] = minMax[2];\n        minMax[2] = temp;\n      }\n      minMax[0] *= transform[2];\n      minMax[2] *= transform[2];\n    }\n    minMax[0] += transform[4];\n    minMax[1] += transform[5];\n    minMax[2] += transform[4];\n    minMax[3] += transform[5];\n  }\n\n  // Concatenates two transformation matrices together and returns the result.\n  static transform(m1, m2) {\n    return [\n      m1[0] * m2[0] + m1[2] * m2[1],\n      m1[1] * m2[0] + m1[3] * m2[1],\n      m1[0] * m2[2] + m1[2] * m2[3],\n      m1[1] * m2[2] + m1[3] * m2[3],\n      m1[0] * m2[4] + m1[2] * m2[5] + m1[4],\n      m1[1] * m2[4] + m1[3] * m2[5] + m1[5],\n    ];\n  }\n\n  // Multiplies m (an array-based transform) by md (a DOMMatrix transform).\n  static multiplyByDOMMatrix(m, md) {\n    return [\n      m[0] * md.a + m[2] * md.b,\n      m[1] * md.a + m[3] * md.b,\n      m[0] * md.c + m[2] * md.d,\n      m[1] * md.c + m[3] * md.d,\n      m[0] * md.e + m[2] * md.f + m[4],\n      m[1] * md.e + m[3] * md.f + m[5],\n    ];\n  }\n\n  // For 2d affine transforms\n  static applyTransform(p, m, pos = 0) {\n    const p0 = p[pos];\n    const p1 = p[pos + 1];\n    p[pos] = p0 * m[0] + p1 * m[2] + m[4];\n    p[pos + 1] = p0 * m[1] + p1 * m[3] + m[5];\n  }\n\n  static applyTransformToBezier(p, transform, pos = 0) {\n    const m0 = transform[0];\n    const m1 = transform[1];\n    const m2 = transform[2];\n    const m3 = transform[3];\n    const m4 = transform[4];\n    const m5 = transform[5];\n    for (let i = 0; i < 6; i += 2) {\n      const pI = p[pos + i];\n      const pI1 = p[pos + i + 1];\n      p[pos + i] = pI * m0 + pI1 * m2 + m4;\n      p[pos + i + 1] = pI * m1 + pI1 * m3 + m5;\n    }\n  }\n\n  static applyInverseTransform(p, m) {\n    const p0 = p[0];\n    const p1 = p[1];\n    const d = m[0] * m[3] - m[1] * m[2];\n    p[0] = (p0 * m[3] - p1 * m[2] + m[2] * m[5] - m[4] * m[3]) / d;\n    p[1] = (-p0 * m[1] + p1 * m[0] + m[4] * m[1] - m[5] * m[0]) / d;\n  }\n\n  // Applies the transform to the rectangle and finds the minimum axially\n  // aligned bounding box.\n  static axialAlignedBoundingBox(rect, transform, output) {\n    const m0 = transform[0];\n    const m1 = transform[1];\n    const m2 = transform[2];\n    const m3 = transform[3];\n    const m4 = transform[4];\n    const m5 = transform[5];\n    const r0 = rect[0];\n    const r1 = rect[1];\n    const r2 = rect[2];\n    const r3 = rect[3];\n\n    let a0 = m0 * r0 + m4;\n    let a2 = a0;\n    let a1 = m0 * r2 + m4;\n    let a3 = a1;\n    let b0 = m3 * r1 + m5;\n    let b2 = b0;\n    let b1 = m3 * r3 + m5;\n    let b3 = b1;\n\n    if (m1 !== 0 || m2 !== 0) {\n      // Non-scaling matrix: shouldn't be frequent.\n      const m1r0 = m1 * r0;\n      const m1r2 = m1 * r2;\n      const m2r1 = m2 * r1;\n      const m2r3 = m2 * r3;\n      a0 += m2r1;\n      a3 += m2r1;\n      a1 += m2r3;\n      a2 += m2r3;\n      b0 += m1r0;\n      b3 += m1r0;\n      b1 += m1r2;\n      b2 += m1r2;\n    }\n\n    output[0] = Math.min(output[0], a0, a1, a2, a3);\n    output[1] = Math.min(output[1], b0, b1, b2, b3);\n    output[2] = Math.max(output[2], a0, a1, a2, a3);\n    output[3] = Math.max(output[3], b0, b1, b2, b3);\n  }\n\n  static inverseTransform(m) {\n    const d = m[0] * m[3] - m[1] * m[2];\n    return [\n      m[3] / d,\n      -m[1] / d,\n      -m[2] / d,\n      m[0] / d,\n      (m[2] * m[5] - m[4] * m[3]) / d,\n      (m[4] * m[1] - m[5] * m[0]) / d,\n    ];\n  }\n\n  // This calculation uses Singular Value Decomposition.\n  // The SVD can be represented with formula A = USV. We are interested in the\n  // matrix S here because it represents the scale values.\n  static singularValueDecompose2dScale(matrix, output) {\n    const m0 = matrix[0];\n    const m1 = matrix[1];\n    const m2 = matrix[2];\n    const m3 = matrix[3];\n    // Multiply matrix m with its transpose.\n    const a = m0 ** 2 + m1 ** 2;\n    const b = m0 * m2 + m1 * m3;\n    const c = m2 ** 2 + m3 ** 2;\n\n    // Solve the second degree polynomial to get roots.\n    const first = (a + c) / 2;\n    const second = Math.sqrt(first ** 2 - (a * c - b ** 2));\n    output[0] = Math.sqrt(first + second || 1);\n    output[1] = Math.sqrt(first - second || 1);\n  }\n\n  // Normalize rectangle rect=[x1, y1, x2, y2] so that (x1,y1) < (x2,y2)\n  // For coordinate systems whose origin lies in the bottom-left, this\n  // means normalization to (BL,TR) ordering. For systems with origin in the\n  // top-left, this means (TL,BR) ordering.\n  static normalizeRect(rect) {\n    const r = rect.slice(0); // clone rect\n    if (rect[0] > rect[2]) {\n      r[0] = rect[2];\n      r[2] = rect[0];\n    }\n    if (rect[1] > rect[3]) {\n      r[1] = rect[3];\n      r[3] = rect[1];\n    }\n    return r;\n  }\n\n  // Returns a rectangle [x1, y1, x2, y2] corresponding to the\n  // intersection of rect1 and rect2. If no intersection, returns 'null'\n  // The rectangle coordinates of rect1, rect2 should be [x1, y1, x2, y2]\n  static intersect(rect1, rect2) {\n    const xLow = Math.max(\n      Math.min(rect1[0], rect1[2]),\n      Math.min(rect2[0], rect2[2])\n    );\n    const xHigh = Math.min(\n      Math.max(rect1[0], rect1[2]),\n      Math.max(rect2[0], rect2[2])\n    );\n    if (xLow > xHigh) {\n      return null;\n    }\n    const yLow = Math.max(\n      Math.min(rect1[1], rect1[3]),\n      Math.min(rect2[1], rect2[3])\n    );\n    const yHigh = Math.min(\n      Math.max(rect1[1], rect1[3]),\n      Math.max(rect2[1], rect2[3])\n    );\n    if (yLow > yHigh) {\n      return null;\n    }\n\n    return [xLow, yLow, xHigh, yHigh];\n  }\n\n  static pointBoundingBox(x, y, minMax) {\n    minMax[0] = Math.min(minMax[0], x);\n    minMax[1] = Math.min(minMax[1], y);\n    minMax[2] = Math.max(minMax[2], x);\n    minMax[3] = Math.max(minMax[3], y);\n  }\n\n  static rectBoundingBox(x0, y0, x1, y1, minMax) {\n    minMax[0] = Math.min(minMax[0], x0, x1);\n    minMax[1] = Math.min(minMax[1], y0, y1);\n    minMax[2] = Math.max(minMax[2], x0, x1);\n    minMax[3] = Math.max(minMax[3], y0, y1);\n  }\n\n  static #getExtremumOnCurve(x0, x1, x2, x3, y0, y1, y2, y3, t, minMax) {\n    if (t <= 0 || t >= 1) {\n      return;\n    }\n    const mt = 1 - t;\n    const tt = t * t;\n    const ttt = tt * t;\n    const x = mt * (mt * (mt * x0 + 3 * t * x1) + 3 * tt * x2) + ttt * x3;\n    const y = mt * (mt * (mt * y0 + 3 * t * y1) + 3 * tt * y2) + ttt * y3;\n    minMax[0] = Math.min(minMax[0], x);\n    minMax[1] = Math.min(minMax[1], y);\n    minMax[2] = Math.max(minMax[2], x);\n    minMax[3] = Math.max(minMax[3], y);\n  }\n\n  static #getExtremum(x0, x1, x2, x3, y0, y1, y2, y3, a, b, c, minMax) {\n    if (Math.abs(a) < 1e-12) {\n      if (Math.abs(b) >= 1e-12) {\n        this.#getExtremumOnCurve(\n          x0,\n          x1,\n          x2,\n          x3,\n          y0,\n          y1,\n          y2,\n          y3,\n          -c / b,\n          minMax\n        );\n      }\n      return;\n    }\n\n    const delta = b ** 2 - 4 * c * a;\n    if (delta < 0) {\n      return;\n    }\n    const sqrtDelta = Math.sqrt(delta);\n    const a2 = 2 * a;\n    this.#getExtremumOnCurve(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      (-b + sqrtDelta) / a2,\n      minMax\n    );\n    this.#getExtremumOnCurve(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      (-b - sqrtDelta) / a2,\n      minMax\n    );\n  }\n\n  // From https://github.com/adobe-webplatform/Snap.svg/blob/b365287722a72526000ac4bfcf0ce4cac2faa015/src/path.js#L852\n  static bezierBoundingBox(x0, y0, x1, y1, x2, y2, x3, y3, minMax) {\n    minMax[0] = Math.min(minMax[0], x0, x3);\n    minMax[1] = Math.min(minMax[1], y0, y3);\n    minMax[2] = Math.max(minMax[2], x0, x3);\n    minMax[3] = Math.max(minMax[3], y0, y3);\n\n    this.#getExtremum(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      3 * (-x0 + 3 * (x1 - x2) + x3),\n      6 * (x0 - 2 * x1 + x2),\n      3 * (x1 - x0),\n      minMax\n    );\n    this.#getExtremum(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      3 * (-y0 + 3 * (y1 - y2) + y3),\n      6 * (y0 - 2 * y1 + y2),\n      3 * (y1 - y0),\n      minMax\n    );\n  }\n}\n\nconst PDFStringTranslateTable = [\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0x2d8,\n  0x2c7, 0x2c6, 0x2d9, 0x2dd, 0x2db, 0x2da, 0x2dc, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0x2022, 0x2020, 0x2021, 0x2026, 0x2014, 0x2013, 0x192,\n  0x2044, 0x2039, 0x203a, 0x2212, 0x2030, 0x201e, 0x201c, 0x201d, 0x2018,\n  0x2019, 0x201a, 0x2122, 0xfb01, 0xfb02, 0x141, 0x152, 0x160, 0x178, 0x17d,\n  0x131, 0x142, 0x153, 0x161, 0x17e, 0, 0x20ac,\n];\n\nfunction stringToPDFString(str, keepEscapeSequence = false) {\n  // See section 7.9.2.2 Text String Type.\n  // The string can contain some language codes bracketed with 0x1b,\n  // so we must remove them.\n  if (str[0] >= \"\\xEF\") {\n    let encoding;\n    if (str[0] === \"\\xFE\" && str[1] === \"\\xFF\") {\n      encoding = \"utf-16be\";\n      if (str.length % 2 === 1) {\n        str = str.slice(0, -1);\n      }\n    } else if (str[0] === \"\\xFF\" && str[1] === \"\\xFE\") {\n      encoding = \"utf-16le\";\n      if (str.length % 2 === 1) {\n        str = str.slice(0, -1);\n      }\n    } else if (str[0] === \"\\xEF\" && str[1] === \"\\xBB\" && str[2] === \"\\xBF\") {\n      encoding = \"utf-8\";\n    }\n\n    if (encoding) {\n      try {\n        const decoder = new TextDecoder(encoding, { fatal: true });\n        const buffer = stringToBytes(str);\n        const decoded = decoder.decode(buffer);\n        if (keepEscapeSequence || !decoded.includes(\"\\x1b\")) {\n          return decoded;\n        }\n        return decoded.replaceAll(/\\x1b[^\\x1b]*(?:\\x1b|$)/g, \"\");\n      } catch (ex) {\n        warn(`stringToPDFString: \"${ex}\".`);\n      }\n    }\n  }\n  // ISO Latin 1\n  const strBuf = [];\n  for (let i = 0, ii = str.length; i < ii; i++) {\n    const charCode = str.charCodeAt(i);\n    if (!keepEscapeSequence && charCode === 0x1b) {\n      // eslint-disable-next-line no-empty\n      while (++i < ii && str.charCodeAt(i) !== 0x1b) {}\n      continue;\n    }\n    const code = PDFStringTranslateTable[charCode];\n    strBuf.push(code ? String.fromCharCode(code) : str.charAt(i));\n  }\n  return strBuf.join(\"\");\n}\n\nfunction stringToUTF8String(str) {\n  return decodeURIComponent(escape(str));\n}\n\nfunction utf8StringToString(str) {\n  return unescape(encodeURIComponent(str));\n}\n\nfunction isArrayEqual(arr1, arr2) {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  for (let i = 0, ii = arr1.length; i < ii; i++) {\n    if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction getModificationDate(date = new Date()) {\n  if (!(date instanceof Date)) {\n    date = new Date(date);\n  }\n  const buffer = [\n    date.getUTCFullYear().toString(),\n    (date.getUTCMonth() + 1).toString().padStart(2, \"0\"),\n    date.getUTCDate().toString().padStart(2, \"0\"),\n    date.getUTCHours().toString().padStart(2, \"0\"),\n    date.getUTCMinutes().toString().padStart(2, \"0\"),\n    date.getUTCSeconds().toString().padStart(2, \"0\"),\n  ];\n\n  return buffer.join(\"\");\n}\n\nlet NormalizeRegex = null;\nlet NormalizationMap = null;\nfunction normalizeUnicode(str) {\n  if (!NormalizeRegex) {\n    // In order to generate the following regex:\n    //  - create a PDF containing all the chars in the range 0000-FFFF with\n    //    a NFKC which is different of the char.\n    //  - copy and paste all those chars and get the ones where NFKC is\n    //    required.\n    // It appears that most the chars here contain some ligatures.\n    NormalizeRegex =\n      /([\\u00a0\\u00b5\\u037e\\u0eb3\\u2000-\\u200a\\u202f\\u2126\\ufb00-\\ufb04\\ufb06\\ufb20-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40-\\ufb41\\ufb43-\\ufb44\\ufb46-\\ufba1\\ufba4-\\ufba9\\ufbae-\\ufbb1\\ufbd3-\\ufbdc\\ufbde-\\ufbe7\\ufbea-\\ufbf8\\ufbfc-\\ufbfd\\ufc00-\\ufc5d\\ufc64-\\ufcf1\\ufcf5-\\ufd3d\\ufd88\\ufdf4\\ufdfa-\\ufdfb\\ufe71\\ufe77\\ufe79\\ufe7b\\ufe7d]+)|(\\ufb05+)/gu;\n    NormalizationMap = new Map([[\"\", \"t\"]]);\n  }\n  return str.replaceAll(NormalizeRegex, (_, p1, p2) =>\n    p1 ? p1.normalize(\"NFKC\") : NormalizationMap.get(p2)\n  );\n}\n\nfunction getUuid() {\n  if (\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n    typeof crypto.randomUUID === \"function\"\n  ) {\n    return crypto.randomUUID();\n  }\n  const buf = new Uint8Array(32);\n  crypto.getRandomValues(buf);\n  return bytesToString(buf);\n}\n\nconst AnnotationPrefix = \"pdfjs_internal_id_\";\n\nfunction _isValidExplicitDest(validRef, validName, dest) {\n  if (!Array.isArray(dest) || dest.length < 2) {\n    return false;\n  }\n  const [page, zoom, ...args] = dest;\n  if (!validRef(page) && !Number.isInteger(page)) {\n    return false;\n  }\n  if (!validName(zoom)) {\n    return false;\n  }\n  const argsLen = args.length;\n  let allowNull = true;\n  switch (zoom.name) {\n    case \"XYZ\":\n      if (argsLen < 2 || argsLen > 3) {\n        return false;\n      }\n      break;\n    case \"Fit\":\n    case \"FitB\":\n      return argsLen === 0;\n    case \"FitH\":\n    case \"FitBH\":\n    case \"FitV\":\n    case \"FitBV\":\n      if (argsLen > 1) {\n        return false;\n      }\n      break;\n    case \"FitR\":\n      if (argsLen !== 4) {\n        return false;\n      }\n      allowNull = false;\n      break;\n    default:\n      return false;\n  }\n  for (const arg of args) {\n    if (typeof arg === \"number\" || (allowNull && arg === null)) {\n      continue;\n    }\n    return false;\n  }\n  return true;\n}\n\n// TODO: Replace all occurrences of this function with `Math.clamp` once\n//       https://github.com/tc39/proposal-math-clamp/ is generally available.\nfunction MathClamp(v, min, max) {\n  return Math.min(Math.max(v, min), max);\n}\n\n// TODO: Remove this once `Uint8Array.prototype.toHex` is generally available.\nfunction toHexUtil(arr) {\n  if (Uint8Array.prototype.toHex) {\n    return arr.toHex();\n  }\n  return Array.from(arr, num => hexNumbers[num]).join(\"\");\n}\n\n// TODO: Remove this once `Uint8Array.prototype.toBase64` is generally\n//       available.\nfunction toBase64Util(arr) {\n  if (Uint8Array.prototype.toBase64) {\n    return arr.toBase64();\n  }\n  return btoa(bytesToString(arr));\n}\n\n// TODO: Remove this once `Uint8Array.fromBase64` is generally available.\nfunction fromBase64Util(str) {\n  if (Uint8Array.fromBase64) {\n    return Uint8Array.fromBase64(str);\n  }\n  return stringToBytes(atob(str));\n}\n\n// TODO: Remove this once https://bugzilla.mozilla.org/show_bug.cgi?id=1928493\n//       is fixed.\nif (\n  (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"SKIP_BABEL\")) &&\n  typeof Promise.try !== \"function\"\n) {\n  Promise.try = function (fn, ...args) {\n    return new Promise(resolve => {\n      resolve(fn(...args));\n    });\n  };\n}\n\n// TODO: Remove this once the `javascript.options.experimental.math_sumprecise`\n//       preference is removed from Firefox.\nif (typeof Math.sumPrecise !== \"function\") {\n  // Note that this isn't a \"proper\" polyfill, but since we're only using it to\n  // replace `Array.prototype.reduce()` invocations it should be fine.\n  Math.sumPrecise = function (numbers) {\n    return numbers.reduce((a, b) => a + b, 0);\n  };\n}\n\nif (\n  typeof PDFJSDev !== \"undefined\" &&\n  !PDFJSDev.test(\"SKIP_BABEL\") &&\n  typeof AbortSignal.any !== \"function\"\n) {\n  AbortSignal.any = function (iterable) {\n    const ac = new AbortController();\n    const { signal } = ac;\n\n    // Return immediately if any of the signals are already aborted.\n    for (const s of iterable) {\n      if (s.aborted) {\n        ac.abort(s.reason);\n        return signal;\n      }\n    }\n    // Register \"abort\" listeners for all signals.\n    for (const s of iterable) {\n      s.addEventListener(\n        \"abort\",\n        () => {\n          ac.abort(s.reason);\n        },\n        { signal } // Automatically remove the listener.\n      );\n    }\n\n    return signal;\n  };\n}\n\nexport {\n  _isValidExplicitDest,\n  AbortException,\n  AnnotationActionEventType,\n  AnnotationBorderStyleType,\n  AnnotationEditorParamsType,\n  AnnotationEditorPrefix,\n  AnnotationEditorType,\n  AnnotationFieldFlag,\n  AnnotationFlag,\n  AnnotationMode,\n  AnnotationPrefix,\n  AnnotationReplyType,\n  AnnotationType,\n  assert,\n  BaseException,\n  BASELINE_FACTOR,\n  bytesToString,\n  createValidAbsoluteUrl,\n  DocumentActionEventType,\n  DrawOPS,\n  FeatureTest,\n  FONT_IDENTITY_MATRIX,\n  FormatError,\n  fromBase64Util,\n  getModificationDate,\n  getUuid,\n  getVerbosityLevel,\n  hexNumbers,\n  ImageKind,\n  info,\n  InvalidPDFException,\n  isArrayEqual,\n  isNodeJS,\n  LINE_DESCENT_FACTOR,\n  LINE_FACTOR,\n  MathClamp,\n  MeshFigureType,\n  normalizeUnicode,\n  objectSize,\n  OPS,\n  PageActionEventType,\n  PasswordException,\n  PasswordResponses,\n  PermissionFlag,\n  RenderingIntentFlag,\n  ResponseException,\n  setVerbosityLevel,\n  shadow,\n  string32,\n  stringToBytes,\n  stringToPDFString,\n  stringToUTF8String,\n  TextRenderingMode,\n  toBase64Util,\n  toHexUtil,\n  UnknownErrorException,\n  unreachable,\n  updateUrlHash,\n  utf8StringToString,\n  Util,\n  VerbosityLevel,\n  warn,\n};\n","/* Copyright 2021 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./api\").TextContent} TextContent */\n\nclass XfaText {\n  /**\n   * Walk an XFA tree and create an array of text nodes that is compatible\n   * with a regular PDFs TextContent. Currently, only TextItem.str is supported,\n   * all other fields and styles haven't been implemented.\n   *\n   * @param {Object} xfa - An XFA fake DOM object.\n   *\n   * @returns {TextContent}\n   */\n  static textContent(xfa) {\n    const items = [];\n    const output = {\n      items,\n      styles: Object.create(null),\n    };\n    function walk(node) {\n      if (!node) {\n        return;\n      }\n      let str = null;\n      const name = node.name;\n      if (name === \"#text\") {\n        str = node.value;\n      } else if (!XfaText.shouldBuildText(name)) {\n        return;\n      } else if (node?.attributes?.textContent) {\n        str = node.attributes.textContent;\n      } else if (node.value) {\n        str = node.value;\n      }\n      if (str !== null) {\n        items.push({\n          str,\n        });\n      }\n      if (!node.children) {\n        return;\n      }\n      for (const child of node.children) {\n        walk(child);\n      }\n    }\n    walk(xfa);\n    return output;\n  }\n\n  /**\n   * @param {string} name - DOM node name. (lower case)\n   *\n   * @returns {boolean} true if the DOM node should have a corresponding text\n   * node.\n   */\n  static shouldBuildText(name) {\n    return !(\n      name === \"textarea\" ||\n      name === \"input\" ||\n      name === \"option\" ||\n      name === \"select\"\n    );\n  }\n}\n\nexport { XfaText };\n","/* Copyright 2021 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_storage\").AnnotationStorage} AnnotationStorage */\n/** @typedef {import(\"./display_utils\").PageViewport} PageViewport */\n/** @typedef {import(\"../../web/interfaces\").IPDFLinkService} IPDFLinkService */\n\nimport { XfaText } from \"./xfa_text.js\";\n\n/**\n * @typedef {Object} XfaLayerParameters\n * @property {PageViewport} viewport\n * @property {HTMLDivElement} div\n * @property {Object} xfaHtml\n * @property {AnnotationStorage} [annotationStorage]\n * @property {IPDFLinkService} linkService\n * @property {string} [intent] - (default value is 'display').\n */\n\nclass XfaLayer {\n  static setupStorage(html, id, element, storage, intent) {\n    const storedData = storage.getValue(id, { value: null });\n    switch (element.name) {\n      case \"textarea\":\n        if (storedData.value !== null) {\n          html.textContent = storedData.value;\n        }\n        if (intent === \"print\") {\n          break;\n        }\n        html.addEventListener(\"input\", event => {\n          storage.setValue(id, { value: event.target.value });\n        });\n        break;\n      case \"input\":\n        if (\n          element.attributes.type === \"radio\" ||\n          element.attributes.type === \"checkbox\"\n        ) {\n          if (storedData.value === element.attributes.xfaOn) {\n            html.setAttribute(\"checked\", true);\n          } else if (storedData.value === element.attributes.xfaOff) {\n            // The checked attribute may have been set when opening the file,\n            // unset through the UI and we're here because of printing.\n            html.removeAttribute(\"checked\");\n          }\n          if (intent === \"print\") {\n            break;\n          }\n          html.addEventListener(\"change\", event => {\n            storage.setValue(id, {\n              value: event.target.checked\n                ? event.target.getAttribute(\"xfaOn\")\n                : event.target.getAttribute(\"xfaOff\"),\n            });\n          });\n        } else {\n          if (storedData.value !== null) {\n            html.setAttribute(\"value\", storedData.value);\n          }\n          if (intent === \"print\") {\n            break;\n          }\n          html.addEventListener(\"input\", event => {\n            storage.setValue(id, { value: event.target.value });\n          });\n        }\n        break;\n      case \"select\":\n        if (storedData.value !== null) {\n          html.setAttribute(\"value\", storedData.value);\n          for (const option of element.children) {\n            if (option.attributes.value === storedData.value) {\n              option.attributes.selected = true;\n            } else if (option.attributes.hasOwnProperty(\"selected\")) {\n              delete option.attributes.selected;\n            }\n          }\n        }\n        html.addEventListener(\"input\", event => {\n          const options = event.target.options;\n          const value =\n            options.selectedIndex === -1\n              ? \"\"\n              : options[options.selectedIndex].value;\n          storage.setValue(id, { value });\n        });\n        break;\n    }\n  }\n\n  static setAttributes({ html, element, storage = null, intent, linkService }) {\n    const { attributes } = element;\n    const isHTMLAnchorElement = html instanceof HTMLAnchorElement;\n\n    if (attributes.type === \"radio\") {\n      // Avoid to have a radio group when printing with the same as one\n      // already displayed.\n      attributes.name = `${attributes.name}-${intent}`;\n    }\n    for (const [key, value] of Object.entries(attributes)) {\n      if (value === null || value === undefined) {\n        continue;\n      }\n\n      switch (key) {\n        case \"class\":\n          if (value.length) {\n            html.setAttribute(key, value.join(\" \"));\n          }\n          break;\n        case \"dataId\":\n          // We don't need to add dataId in the html object but it can\n          // be useful to know its value when writing printing tests:\n          // in this case, don't skip dataId to have its value.\n          break;\n        case \"id\":\n          html.setAttribute(\"data-element-id\", value);\n          break;\n        case \"style\":\n          Object.assign(html.style, value);\n          break;\n        case \"textContent\":\n          html.textContent = value;\n          break;\n        default:\n          if (!isHTMLAnchorElement || (key !== \"href\" && key !== \"newWindow\")) {\n            html.setAttribute(key, value);\n          }\n      }\n    }\n\n    if (isHTMLAnchorElement) {\n      linkService.addLinkAttributes(\n        html,\n        attributes.href,\n        attributes.newWindow\n      );\n    }\n\n    // Set the value after the others to be sure to overwrite any other values.\n    if (storage && attributes.dataId) {\n      this.setupStorage(html, attributes.dataId, element, storage);\n    }\n  }\n\n  /**\n   * Render the XFA layer.\n   *\n   * @param {XfaLayerParameters} parameters\n   */\n  static render(parameters) {\n    const storage = parameters.annotationStorage;\n    const linkService = parameters.linkService;\n    const root = parameters.xfaHtml;\n    const intent = parameters.intent || \"display\";\n    const rootHtml = document.createElement(root.name);\n    if (root.attributes) {\n      this.setAttributes({\n        html: rootHtml,\n        element: root,\n        intent,\n        linkService,\n      });\n    }\n\n    const isNotForRichText = intent !== \"richText\";\n    const rootDiv = parameters.div;\n    rootDiv.append(rootHtml);\n\n    if (parameters.viewport) {\n      const transform = `matrix(${parameters.viewport.transform.join(\",\")})`;\n      rootDiv.style.transform = transform;\n    }\n\n    // Set defaults.\n    if (isNotForRichText) {\n      rootDiv.setAttribute(\"class\", \"xfaLayer xfaFont\");\n    }\n\n    // Text nodes used for the text highlighter.\n    const textDivs = [];\n\n    // In the rich text context, it's possible to just have a text node without\n    // a root element, so we handle this case here (see issue 17215).\n    if (root.children.length === 0) {\n      if (root.value) {\n        const node = document.createTextNode(root.value);\n        rootHtml.append(node);\n        if (isNotForRichText && XfaText.shouldBuildText(root.name)) {\n          textDivs.push(node);\n        }\n      }\n      return { textDivs };\n    }\n\n    const stack = [[root, -1, rootHtml]];\n\n    while (stack.length > 0) {\n      const [parent, i, html] = stack.at(-1);\n      if (i + 1 === parent.children.length) {\n        stack.pop();\n        continue;\n      }\n\n      const child = parent.children[++stack.at(-1)[1]];\n      if (child === null) {\n        continue;\n      }\n\n      const { name } = child;\n      if (name === \"#text\") {\n        const node = document.createTextNode(child.value);\n        textDivs.push(node);\n        html.append(node);\n        continue;\n      }\n\n      const childHtml = child?.attributes?.xmlns\n        ? document.createElementNS(child.attributes.xmlns, name)\n        : document.createElement(name);\n\n      html.append(childHtml);\n      if (child.attributes) {\n        this.setAttributes({\n          html: childHtml,\n          element: child,\n          storage,\n          intent,\n          linkService,\n        });\n      }\n\n      if (child.children?.length > 0) {\n        stack.push([child, -1, childHtml]);\n      } else if (child.value) {\n        const node = document.createTextNode(child.value);\n        if (isNotForRichText && XfaText.shouldBuildText(name)) {\n          textDivs.push(node);\n        }\n        childHtml.append(node);\n      }\n    }\n\n    /**\n     * TODO: re-enable that stuff once we've JS implementation.\n     * See https://bugzilla.mozilla.org/show_bug.cgi?id=1719465.\n     *\n     * for (const el of rootDiv.querySelectorAll(\n     * \".xfaDisabled input, .xfaDisabled textarea\"\n     * )) {\n     * el.setAttribute(\"disabled\", true);\n     * }\n     * for (const el of rootDiv.querySelectorAll(\n     * \".xfaReadOnly input, .xfaReadOnly textarea\"\n     * )) {\n     * el.setAttribute(\"readOnly\", true);\n     * }\n     */\n\n    for (const el of rootDiv.querySelectorAll(\n      \".xfaNonInteractive input, .xfaNonInteractive textarea\"\n    )) {\n      el.setAttribute(\"readOnly\", true);\n    }\n\n    return {\n      textDivs,\n    };\n  }\n\n  /**\n   * Update the XFA layer.\n   *\n   * @param {XfaLayerParameters} parameters\n   */\n  static update(parameters) {\n    const transform = `matrix(${parameters.viewport.transform.join(\",\")})`;\n    parameters.div.style.transform = transform;\n    parameters.div.hidden = false;\n  }\n}\n\nexport { XfaLayer };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BaseException,\n  DrawOPS,\n  FeatureTest,\n  shadow,\n  Util,\n  warn,\n} from \"../shared/util.js\";\nimport { XfaLayer } from \"./xfa_layer.js\";\n\nconst SVG_NS = \"http://www.w3.org/2000/svg\";\n\nclass PixelsPerInch {\n  static CSS = 96.0;\n\n  static PDF = 72.0;\n\n  static PDF_TO_CSS_UNITS = this.CSS / this.PDF;\n}\n\nasync function fetchData(url, type = \"text\") {\n  if (\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n    isValidFetchUrl(url, document.baseURI)\n  ) {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new Error(response.statusText);\n    }\n    switch (type) {\n      case \"arraybuffer\":\n        return response.arrayBuffer();\n      case \"blob\":\n        return response.blob();\n      case \"json\":\n        return response.json();\n    }\n    return response.text();\n  }\n\n  // The Fetch API is not supported.\n  return new Promise((resolve, reject) => {\n    const request = new XMLHttpRequest();\n    request.open(\"GET\", url, /* async = */ true);\n    request.responseType = type;\n\n    request.onreadystatechange = () => {\n      if (request.readyState !== XMLHttpRequest.DONE) {\n        return;\n      }\n      if (request.status === 200 || request.status === 0) {\n        switch (type) {\n          case \"arraybuffer\":\n          case \"blob\":\n          case \"json\":\n            resolve(request.response);\n            return;\n        }\n        resolve(request.responseText);\n        return;\n      }\n      reject(new Error(request.statusText));\n    };\n\n    request.send(null);\n  });\n}\n\n/**\n * @typedef {Object} PageViewportParameters\n * @property {Array<number>} viewBox - The xMin, yMin, xMax and\n *   yMax coordinates.\n * @property {number} userUnit - The size of units.\n * @property {number} scale - The scale of the viewport.\n * @property {number} rotation - The rotation, in degrees, of the viewport.\n * @property {number} [offsetX] - The horizontal, i.e. x-axis, offset. The\n *   default value is `0`.\n * @property {number} [offsetY] - The vertical, i.e. y-axis, offset. The\n *   default value is `0`.\n * @property {boolean} [dontFlip] - If true, the y-axis will not be flipped.\n *   The default value is `false`.\n */\n\n/**\n * @typedef {Object} PageViewportCloneParameters\n * @property {number} [scale] - The scale, overriding the one in the cloned\n *   viewport. The default value is `this.scale`.\n * @property {number} [rotation] - The rotation, in degrees, overriding the one\n *   in the cloned viewport. The default value is `this.rotation`.\n * @property {number} [offsetX] - The horizontal, i.e. x-axis, offset.\n *   The default value is `this.offsetX`.\n * @property {number} [offsetY] - The vertical, i.e. y-axis, offset.\n *   The default value is `this.offsetY`.\n * @property {boolean} [dontFlip] - If true, the x-axis will not be flipped.\n *   The default value is `false`.\n */\n\n/**\n * PDF page viewport created based on scale, rotation and offset.\n */\nclass PageViewport {\n  /**\n   * @param {PageViewportParameters}\n   */\n  constructor({\n    viewBox,\n    userUnit,\n    scale,\n    rotation,\n    offsetX = 0,\n    offsetY = 0,\n    dontFlip = false,\n  }) {\n    this.viewBox = viewBox;\n    this.userUnit = userUnit;\n    this.scale = scale;\n    this.rotation = rotation;\n    this.offsetX = offsetX;\n    this.offsetY = offsetY;\n\n    scale *= userUnit; // Take the userUnit into account.\n\n    // creating transform to convert pdf coordinate system to the normal\n    // canvas like coordinates taking in account scale and rotation\n    const centerX = (viewBox[2] + viewBox[0]) / 2;\n    const centerY = (viewBox[3] + viewBox[1]) / 2;\n    let rotateA, rotateB, rotateC, rotateD;\n    // Normalize the rotation, by clamping it to the [0, 360) range.\n    rotation %= 360;\n    if (rotation < 0) {\n      rotation += 360;\n    }\n    switch (rotation) {\n      case 180:\n        rotateA = -1;\n        rotateB = 0;\n        rotateC = 0;\n        rotateD = 1;\n        break;\n      case 90:\n        rotateA = 0;\n        rotateB = 1;\n        rotateC = 1;\n        rotateD = 0;\n        break;\n      case 270:\n        rotateA = 0;\n        rotateB = -1;\n        rotateC = -1;\n        rotateD = 0;\n        break;\n      case 0:\n        rotateA = 1;\n        rotateB = 0;\n        rotateC = 0;\n        rotateD = -1;\n        break;\n      default:\n        throw new Error(\n          \"PageViewport: Invalid rotation, must be a multiple of 90 degrees.\"\n        );\n    }\n\n    if (dontFlip) {\n      rotateC = -rotateC;\n      rotateD = -rotateD;\n    }\n\n    let offsetCanvasX, offsetCanvasY;\n    let width, height;\n    if (rotateA === 0) {\n      offsetCanvasX = Math.abs(centerY - viewBox[1]) * scale + offsetX;\n      offsetCanvasY = Math.abs(centerX - viewBox[0]) * scale + offsetY;\n      width = (viewBox[3] - viewBox[1]) * scale;\n      height = (viewBox[2] - viewBox[0]) * scale;\n    } else {\n      offsetCanvasX = Math.abs(centerX - viewBox[0]) * scale + offsetX;\n      offsetCanvasY = Math.abs(centerY - viewBox[1]) * scale + offsetY;\n      width = (viewBox[2] - viewBox[0]) * scale;\n      height = (viewBox[3] - viewBox[1]) * scale;\n    }\n    // creating transform for the following operations:\n    // translate(-centerX, -centerY), rotate and flip vertically,\n    // scale, and translate(offsetCanvasX, offsetCanvasY)\n    this.transform = [\n      rotateA * scale,\n      rotateB * scale,\n      rotateC * scale,\n      rotateD * scale,\n      offsetCanvasX - rotateA * scale * centerX - rotateC * scale * centerY,\n      offsetCanvasY - rotateB * scale * centerX - rotateD * scale * centerY,\n    ];\n\n    this.width = width;\n    this.height = height;\n  }\n\n  /**\n   * The original, un-scaled, viewport dimensions.\n   * @type {Object}\n   */\n  get rawDims() {\n    const dims = this.viewBox;\n\n    return shadow(this, \"rawDims\", {\n      pageWidth: dims[2] - dims[0],\n      pageHeight: dims[3] - dims[1],\n      pageX: dims[0],\n      pageY: dims[1],\n    });\n  }\n\n  /**\n   * Clones viewport, with optional additional properties.\n   * @param {PageViewportCloneParameters} [params]\n   * @returns {PageViewport} Cloned viewport.\n   */\n  clone({\n    scale = this.scale,\n    rotation = this.rotation,\n    offsetX = this.offsetX,\n    offsetY = this.offsetY,\n    dontFlip = false,\n  } = {}) {\n    return new PageViewport({\n      viewBox: this.viewBox.slice(),\n      userUnit: this.userUnit,\n      scale,\n      rotation,\n      offsetX,\n      offsetY,\n      dontFlip,\n    });\n  }\n\n  /**\n   * Converts PDF point to the viewport coordinates. For examples, useful for\n   * converting PDF location into canvas pixel coordinates.\n   * @param {number} x - The x-coordinate.\n   * @param {number} y - The y-coordinate.\n   * @returns {Array} Array containing `x`- and `y`-coordinates of the\n   *   point in the viewport coordinate space.\n   * @see {@link convertToPdfPoint}\n   * @see {@link convertToViewportRectangle}\n   */\n  convertToViewportPoint(x, y) {\n    const p = [x, y];\n    Util.applyTransform(p, this.transform);\n    return p;\n  }\n\n  /**\n   * Converts PDF rectangle to the viewport coordinates.\n   * @param {Array} rect - The xMin, yMin, xMax and yMax coordinates.\n   * @returns {Array} Array containing corresponding coordinates of the\n   *   rectangle in the viewport coordinate space.\n   * @see {@link convertToViewportPoint}\n   */\n  convertToViewportRectangle(rect) {\n    const topLeft = [rect[0], rect[1]];\n    Util.applyTransform(topLeft, this.transform);\n    const bottomRight = [rect[2], rect[3]];\n    Util.applyTransform(bottomRight, this.transform);\n    return [topLeft[0], topLeft[1], bottomRight[0], bottomRight[1]];\n  }\n\n  /**\n   * Converts viewport coordinates to the PDF location. For examples, useful\n   * for converting canvas pixel location into PDF one.\n   * @param {number} x - The x-coordinate.\n   * @param {number} y - The y-coordinate.\n   * @returns {Array} Array containing `x`- and `y`-coordinates of the\n   *   point in the PDF coordinate space.\n   * @see {@link convertToViewportPoint}\n   */\n  convertToPdfPoint(x, y) {\n    const p = [x, y];\n    Util.applyInverseTransform(p, this.transform);\n    return p;\n  }\n}\n\nclass RenderingCancelledException extends BaseException {\n  constructor(msg, extraDelay = 0) {\n    super(msg, \"RenderingCancelledException\");\n    this.extraDelay = extraDelay;\n  }\n}\n\nfunction isDataScheme(url) {\n  const ii = url.length;\n  let i = 0;\n  while (i < ii && url[i].trim() === \"\") {\n    i++;\n  }\n  return url.substring(i, i + 5).toLowerCase() === \"data:\";\n}\n\nfunction isPdfFile(filename) {\n  return typeof filename === \"string\" && /\\.pdf$/i.test(filename);\n}\n\n/**\n * Gets the filename from a given URL.\n * @param {string} url\n * @returns {string}\n */\nfunction getFilenameFromUrl(url) {\n  [url] = url.split(/[#?]/, 1);\n  return url.substring(url.lastIndexOf(\"/\") + 1);\n}\n\n/**\n * Returns the filename or guessed filename from the url (see issue 3455).\n * @param {string} url - The original PDF location.\n * @param {string} defaultFilename - The value returned if the filename is\n *   unknown, or the protocol is unsupported.\n * @returns {string} Guessed PDF filename.\n */\nfunction getPdfFilenameFromUrl(url, defaultFilename = \"document.pdf\") {\n  if (typeof url !== \"string\") {\n    return defaultFilename;\n  }\n  if (isDataScheme(url)) {\n    warn('getPdfFilenameFromUrl: ignore \"data:\"-URL for performance reasons.');\n    return defaultFilename;\n  }\n\n  const getURL = urlString => {\n    try {\n      return new URL(urlString);\n    } catch {\n      try {\n        return new URL(decodeURIComponent(urlString));\n      } catch {\n        try {\n          // Attempt to parse the URL using the document's base URI.\n          return new URL(urlString, \"https://foo.bar\");\n        } catch {\n          try {\n            return new URL(decodeURIComponent(urlString), \"https://foo.bar\");\n          } catch {\n            return null;\n          }\n        }\n      }\n    }\n  };\n\n  const newURL = getURL(url);\n  if (!newURL) {\n    // If the URL is invalid, return the default filename.\n    return defaultFilename;\n  }\n\n  const decode = name => {\n    try {\n      let decoded = decodeURIComponent(name);\n      if (decoded.includes(\"/\")) {\n        decoded = decoded.split(\"/\").at(-1);\n        if (decoded.test(/^\\.pdf$/i)) {\n          return decoded;\n        }\n        return name;\n      }\n      return decoded;\n    } catch {\n      return name;\n    }\n  };\n\n  const pdfRegex = /\\.pdf$/i;\n  const filename = newURL.pathname.split(\"/\").at(-1);\n  if (pdfRegex.test(filename)) {\n    return decode(filename);\n  }\n\n  if (newURL.searchParams.size > 0) {\n    const values = Array.from(newURL.searchParams.values()).reverse();\n    for (const value of values) {\n      if (pdfRegex.test(value)) {\n        // If any of the search parameters ends with \".pdf\", return it.\n        return decode(value);\n      }\n    }\n    const keys = Array.from(newURL.searchParams.keys()).reverse();\n    for (const key of keys) {\n      if (pdfRegex.test(key)) {\n        // If any of the search parameter keys ends with \".pdf\", return it.\n        return decode(key);\n      }\n    }\n  }\n\n  if (newURL.hash) {\n    const reFilename = /[^/?#=]+\\.pdf\\b(?!.*\\.pdf\\b)/i;\n    const hashFilename = reFilename.exec(newURL.hash);\n    if (hashFilename) {\n      return decode(hashFilename[0]);\n    }\n  }\n\n  return defaultFilename;\n}\n\nclass StatTimer {\n  started = Object.create(null);\n\n  times = [];\n\n  time(name) {\n    if (name in this.started) {\n      warn(`Timer is already running for ${name}`);\n    }\n    this.started[name] = Date.now();\n  }\n\n  timeEnd(name) {\n    if (!(name in this.started)) {\n      warn(`Timer has not been started for ${name}`);\n    }\n    this.times.push({\n      name,\n      start: this.started[name],\n      end: Date.now(),\n    });\n    // Remove timer from started so it can be called again.\n    delete this.started[name];\n  }\n\n  toString() {\n    // Find the longest name for padding purposes.\n    const outBuf = [];\n    let longest = 0;\n    for (const { name } of this.times) {\n      longest = Math.max(name.length, longest);\n    }\n    for (const { name, start, end } of this.times) {\n      outBuf.push(`${name.padEnd(longest)} ${end - start}ms\\n`);\n    }\n    return outBuf.join(\"\");\n  }\n}\n\nfunction isValidFetchUrl(url, baseUrl) {\n  if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n    throw new Error(\"Not implemented: isValidFetchUrl\");\n  }\n  const res = baseUrl ? URL.parse(url, baseUrl) : URL.parse(url);\n  // The Fetch API only supports the http/https protocols, and not file/ftp.\n  return res?.protocol === \"http:\" || res?.protocol === \"https:\";\n}\n\n/**\n * Event handler to suppress context menu.\n */\nfunction noContextMenu(e) {\n  e.preventDefault();\n}\n\nfunction stopEvent(e) {\n  e.preventDefault();\n  e.stopPropagation();\n}\n\n// Deprecated API function -- display regardless of the `verbosity` setting.\nfunction deprecated(details) {\n  // eslint-disable-next-line no-console\n  console.log(\"Deprecated API usage: \" + details);\n}\n\nclass PDFDateString {\n  static #regex;\n\n  /**\n   * Convert a PDF date string to a JavaScript `Date` object.\n   *\n   * The PDF date string format is described in section 7.9.4 of the official\n   * PDF 32000-1:2008 specification. However, in the PDF 1.7 reference (sixth\n   * edition) Adobe describes the same format including a trailing apostrophe.\n   * This syntax in incorrect, but Adobe Acrobat creates PDF files that contain\n   * them. We ignore all apostrophes as they are not necessary for date parsing.\n   *\n   * Moreover, Adobe Acrobat doesn't handle changing the date to universal time\n   * and doesn't use the user's time zone (effectively ignoring the HH' and mm'\n   * parts of the date string).\n   *\n   * @param {string} input\n   * @returns {Date|null}\n   */\n  static toDateObject(input) {\n    if (input instanceof Date) {\n      return input;\n    }\n    if (!input || typeof input !== \"string\") {\n      return null;\n    }\n\n    // Lazily initialize the regular expression.\n    this.#regex ||= new RegExp(\n      \"^D:\" + // Prefix (required)\n        \"(\\\\d{4})\" + // Year (required)\n        \"(\\\\d{2})?\" + // Month (optional)\n        \"(\\\\d{2})?\" + // Day (optional)\n        \"(\\\\d{2})?\" + // Hour (optional)\n        \"(\\\\d{2})?\" + // Minute (optional)\n        \"(\\\\d{2})?\" + // Second (optional)\n        \"([Z|+|-])?\" + // Universal time relation (optional)\n        \"(\\\\d{2})?\" + // Offset hour (optional)\n        \"'?\" + // Splitting apostrophe (optional)\n        \"(\\\\d{2})?\" + // Offset minute (optional)\n        \"'?\" // Trailing apostrophe (optional)\n    );\n\n    // Optional fields that don't satisfy the requirements from the regular\n    // expression (such as incorrect digit counts or numbers that are out of\n    // range) will fall back the defaults from the specification.\n    const matches = this.#regex.exec(input);\n    if (!matches) {\n      return null;\n    }\n\n    // JavaScript's `Date` object expects the month to be between 0 and 11\n    // instead of 1 and 12, so we have to correct for that.\n    const year = parseInt(matches[1], 10);\n    let month = parseInt(matches[2], 10);\n    month = month >= 1 && month <= 12 ? month - 1 : 0;\n    let day = parseInt(matches[3], 10);\n    day = day >= 1 && day <= 31 ? day : 1;\n    let hour = parseInt(matches[4], 10);\n    hour = hour >= 0 && hour <= 23 ? hour : 0;\n    let minute = parseInt(matches[5], 10);\n    minute = minute >= 0 && minute <= 59 ? minute : 0;\n    let second = parseInt(matches[6], 10);\n    second = second >= 0 && second <= 59 ? second : 0;\n    const universalTimeRelation = matches[7] || \"Z\";\n    let offsetHour = parseInt(matches[8], 10);\n    offsetHour = offsetHour >= 0 && offsetHour <= 23 ? offsetHour : 0;\n    let offsetMinute = parseInt(matches[9], 10) || 0;\n    offsetMinute = offsetMinute >= 0 && offsetMinute <= 59 ? offsetMinute : 0;\n\n    // Universal time relation 'Z' means that the local time is equal to the\n    // universal time, whereas the relations '+'/'-' indicate that the local\n    // time is later respectively earlier than the universal time. Every date\n    // is normalized to universal time.\n    if (universalTimeRelation === \"-\") {\n      hour += offsetHour;\n      minute += offsetMinute;\n    } else if (universalTimeRelation === \"+\") {\n      hour -= offsetHour;\n      minute -= offsetMinute;\n    }\n\n    return new Date(Date.UTC(year, month, day, hour, minute, second));\n  }\n}\n\n/**\n * NOTE: This is (mostly) intended to support printing of XFA forms.\n */\nfunction getXfaPageViewport(xfaPage, { scale = 1, rotation = 0 }) {\n  const { width, height } = xfaPage.attributes.style;\n  const viewBox = [0, 0, parseInt(width), parseInt(height)];\n\n  return new PageViewport({\n    viewBox,\n    userUnit: 1,\n    scale,\n    rotation,\n  });\n}\n\nfunction getRGB(color) {\n  if (color.startsWith(\"#\")) {\n    const colorRGB = parseInt(color.slice(1), 16);\n    return [\n      (colorRGB & 0xff0000) >> 16,\n      (colorRGB & 0x00ff00) >> 8,\n      colorRGB & 0x0000ff,\n    ];\n  }\n\n  if (color.startsWith(\"rgb(\")) {\n    // getComputedStyle(...).color returns a `rgb(R, G, B)` color.\n    return color\n      .slice(/* \"rgb(\".length */ 4, -1) // Strip out \"rgb(\" and \")\".\n      .split(\",\")\n      .map(x => parseInt(x));\n  }\n\n  if (color.startsWith(\"rgba(\")) {\n    return color\n      .slice(/* \"rgba(\".length */ 5, -1) // Strip out \"rgba(\" and \")\".\n      .split(\",\")\n      .map(x => parseInt(x))\n      .slice(0, 3);\n  }\n\n  warn(`Not a valid color format: \"${color}\"`);\n  return [0, 0, 0];\n}\n\nfunction getColorValues(colors) {\n  const span = document.createElement(\"span\");\n  span.style.visibility = \"hidden\";\n  // NOTE: The following does *not* affect `forced-colors: active` mode.\n  span.style.colorScheme = \"only light\";\n  document.body.append(span);\n  for (const name of colors.keys()) {\n    span.style.color = name;\n    const computedColor = window.getComputedStyle(span).color;\n    colors.set(name, getRGB(computedColor));\n  }\n  span.remove();\n}\n\nfunction getCurrentTransform(ctx) {\n  const { a, b, c, d, e, f } = ctx.getTransform();\n  return [a, b, c, d, e, f];\n}\n\nfunction getCurrentTransformInverse(ctx) {\n  const { a, b, c, d, e, f } = ctx.getTransform().invertSelf();\n  return [a, b, c, d, e, f];\n}\n\n/**\n * @param {HTMLDivElement} div\n * @param {PageViewport} viewport\n * @param {boolean} mustFlip\n * @param {boolean} mustRotate\n */\nfunction setLayerDimensions(\n  div,\n  viewport,\n  mustFlip = false,\n  mustRotate = true\n) {\n  if (viewport instanceof PageViewport) {\n    const { pageWidth, pageHeight } = viewport.rawDims;\n    const { style } = div;\n    const useRound = FeatureTest.isCSSRoundSupported;\n\n    const w = `var(--total-scale-factor) * ${pageWidth}px`,\n      h = `var(--total-scale-factor) * ${pageHeight}px`;\n    const widthStr = useRound\n        ? `round(down, ${w}, var(--scale-round-x))`\n        : `calc(${w})`,\n      heightStr = useRound\n        ? `round(down, ${h}, var(--scale-round-y))`\n        : `calc(${h})`;\n\n    if (!mustFlip || viewport.rotation % 180 === 0) {\n      style.width = widthStr;\n      style.height = heightStr;\n    } else {\n      style.width = heightStr;\n      style.height = widthStr;\n    }\n  }\n\n  if (mustRotate) {\n    div.setAttribute(\"data-main-rotation\", viewport.rotation);\n  }\n}\n\n/**\n * Scale factors for the canvas, necessary with HiDPI displays.\n */\nclass OutputScale {\n  constructor() {\n    const { pixelRatio } = OutputScale;\n\n    /**\n     * @type {number} Horizontal scale.\n     */\n    this.sx = pixelRatio;\n\n    /**\n     * @type {number} Vertical scale.\n     */\n    this.sy = pixelRatio;\n  }\n\n  /**\n   * @type {boolean} Returns `true` when scaling is required, `false` otherwise.\n   */\n  get scaled() {\n    return this.sx !== 1 || this.sy !== 1;\n  }\n\n  /**\n   * @type {boolean} Returns `true` when scaling is symmetric,\n   *   `false` otherwise.\n   */\n  get symmetric() {\n    return this.sx === this.sy;\n  }\n\n  /**\n   * @returns {boolean} Returns `true` if scaling was limited,\n   *   `false` otherwise.\n   */\n  limitCanvas(width, height, maxPixels, maxDim, capAreaFactor = -1) {\n    let maxAreaScale = Infinity,\n      maxWidthScale = Infinity,\n      maxHeightScale = Infinity;\n\n    maxPixels = OutputScale.capPixels(maxPixels, capAreaFactor);\n    if (maxPixels > 0) {\n      maxAreaScale = Math.sqrt(maxPixels / (width * height));\n    }\n    if (maxDim !== -1) {\n      maxWidthScale = maxDim / width;\n      maxHeightScale = maxDim / height;\n    }\n    const maxScale = Math.min(maxAreaScale, maxWidthScale, maxHeightScale);\n\n    if (this.sx > maxScale || this.sy > maxScale) {\n      this.sx = maxScale;\n      this.sy = maxScale;\n      return true;\n    }\n    return false;\n  }\n\n  static get pixelRatio() {\n    return globalThis.devicePixelRatio || 1;\n  }\n\n  static capPixels(maxPixels, capAreaFactor) {\n    if (capAreaFactor >= 0) {\n      const winPixels = Math.ceil(\n        (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")\n          ? window.innerWidth * window.innerHeight\n          : window.screen.availWidth * window.screen.availHeight) *\n          this.pixelRatio ** 2 *\n          (1 + capAreaFactor / 100)\n      );\n      return maxPixels > 0 ? Math.min(maxPixels, winPixels) : winPixels;\n    }\n    return maxPixels;\n  }\n}\n\n// See https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Image_types\n// to know which types are supported by the browser.\nconst SupportedImageMimeTypes = [\n  \"image/apng\",\n  \"image/avif\",\n  \"image/bmp\",\n  \"image/gif\",\n  \"image/jpeg\",\n  \"image/png\",\n  \"image/svg+xml\",\n  \"image/webp\",\n  \"image/x-icon\",\n];\n\nclass ColorScheme {\n  static get isDarkMode() {\n    return shadow(\n      this,\n      \"isDarkMode\",\n      !!window?.matchMedia?.(\"(prefers-color-scheme: dark)\").matches\n    );\n  }\n}\n\nclass CSSConstants {\n  static get commentForegroundColor() {\n    const element = document.createElement(\"span\");\n    element.classList.add(\"comment\", \"sidebar\");\n    const { style } = element;\n    style.width = style.height = \"0\";\n    style.display = \"none\";\n    style.color = \"var(--comment-fg-color)\";\n    document.body.append(element);\n    const { color } = window.getComputedStyle(element);\n    element.remove();\n    return shadow(this, \"commentForegroundColor\", getRGB(color));\n  }\n}\n\nfunction applyOpacity(r, g, b, opacity) {\n  opacity = Math.min(Math.max(opacity ?? 1, 0), 1);\n  const white = 255 * (1 - opacity);\n  r = Math.round(r * opacity + white);\n  g = Math.round(g * opacity + white);\n  b = Math.round(b * opacity + white);\n  return [r, g, b];\n}\n\nfunction RGBToHSL(rgb, output) {\n  const r = rgb[0] / 255;\n  const g = rgb[1] / 255;\n  const b = rgb[2] / 255;\n\n  const max = Math.max(r, g, b);\n  const min = Math.min(r, g, b);\n  const l = (max + min) / 2;\n\n  if (max === min) {\n    // achromatic\n    output[0] = output[1] = 0; // hue and saturation are 0\n  } else {\n    const d = max - min;\n    output[1] = l < 0.5 ? d / (max + min) : d / (2 - max - min);\n    // hue\n    switch (max) {\n      case r:\n        output[0] = ((g - b) / d + (g < b ? 6 : 0)) * 60;\n        break;\n      case g:\n        output[0] = ((b - r) / d + 2) * 60;\n        break;\n      case b:\n        output[0] = ((r - g) / d + 4) * 60;\n        break;\n    }\n  }\n  output[2] = l;\n}\n\nfunction HSLToRGB(hsl, output) {\n  const h = hsl[0];\n  const s = hsl[1];\n  const l = hsl[2];\n  const c = (1 - Math.abs(2 * l - 1)) * s; // chroma\n  const x = c * (1 - Math.abs(((h / 60) % 2) - 1));\n  const m = l - c / 2;\n\n  switch (Math.floor(h / 60)) {\n    case 0:\n      output[0] = c + m;\n      output[1] = x + m;\n      output[2] = m;\n      break;\n    case 1:\n      output[0] = x + m;\n      output[1] = c + m;\n      output[2] = m;\n      break;\n    case 2:\n      output[0] = m;\n      output[1] = c + m;\n      output[2] = x + m;\n      break;\n    case 3:\n      output[0] = m;\n      output[1] = x + m;\n      output[2] = c + m;\n      break;\n    case 4:\n      output[0] = x + m;\n      output[1] = m;\n      output[2] = c + m;\n      break;\n    case 5:\n    case 6:\n      output[0] = c + m;\n      output[1] = m;\n      output[2] = x + m;\n      break;\n  }\n}\n\nfunction computeLuminance(x) {\n  return x <= 0.03928 ? x / 12.92 : ((x + 0.055) / 1.055) ** 2.4;\n}\n\nfunction contrastRatio(hsl1, hsl2, output) {\n  HSLToRGB(hsl1, output);\n  output.map(computeLuminance);\n  const lum1 = 0.2126 * output[0] + 0.7152 * output[1] + 0.0722 * output[2];\n  HSLToRGB(hsl2, output);\n  output.map(computeLuminance);\n  const lum2 = 0.2126 * output[0] + 0.7152 * output[1] + 0.0722 * output[2];\n  return lum1 > lum2\n    ? (lum1 + 0.05) / (lum2 + 0.05)\n    : (lum2 + 0.05) / (lum1 + 0.05);\n}\n\n// Cache for the findContrastColor function, to improve performance.\nconst contrastCache = new Map();\n\n/**\n * Find a color that has sufficient contrast against a fixed color.\n * The luminance (in HSL color space) of the base color is adjusted\n * until the contrast ratio between the base color and the fixed color\n * is at least the minimum contrast ratio required by WCAG 2.1.\n * @param {Array<number>} baseColor\n * @param {Array<number>} fixedColor\n * @returns {string}\n */\nfunction findContrastColor(baseColor, fixedColor) {\n  const key =\n    baseColor[0] +\n    baseColor[1] * 0x100 +\n    baseColor[2] * 0x10000 +\n    fixedColor[0] * 0x1000000 +\n    fixedColor[1] * 0x100000000 +\n    fixedColor[2] * 0x10000000000;\n  let cachedValue = contrastCache.get(key);\n  if (cachedValue) {\n    return cachedValue;\n  }\n  const array = new Float32Array(9);\n  const output = array.subarray(0, 3);\n  const baseHSL = array.subarray(3, 6);\n  RGBToHSL(baseColor, baseHSL);\n  const fixedHSL = array.subarray(6, 9);\n  RGBToHSL(fixedColor, fixedHSL);\n  const isFixedColorDark = fixedHSL[2] < 0.5;\n\n  // Use the contrast ratio requirements from WCAG 2.1.\n  // https://www.w3.org/TR/WCAG21/#contrast-minimum\n  // https://www.w3.org/TR/WCAG21/#contrast-enhanced\n  const minContrast = isFixedColorDark ? 12 : 4.5;\n\n  baseHSL[2] = isFixedColorDark\n    ? Math.sqrt(baseHSL[2])\n    : 1 - Math.sqrt(1 - baseHSL[2]);\n\n  if (contrastRatio(baseHSL, fixedHSL, output) < minContrast) {\n    let start, end;\n    if (isFixedColorDark) {\n      start = baseHSL[2];\n      end = 1;\n    } else {\n      start = 0;\n      end = baseHSL[2];\n    }\n    const PRECISION = 0.005;\n    while (end - start > PRECISION) {\n      const mid = (baseHSL[2] = (start + end) / 2);\n      if (\n        isFixedColorDark ===\n        contrastRatio(baseHSL, fixedHSL, output) < minContrast\n      ) {\n        start = mid;\n      } else {\n        end = mid;\n      }\n    }\n    baseHSL[2] = isFixedColorDark ? end : start;\n  }\n\n  HSLToRGB(baseHSL, output);\n  cachedValue = Util.makeHexColor(\n    Math.round(output[0] * 255),\n    Math.round(output[1] * 255),\n    Math.round(output[2] * 255)\n  );\n  contrastCache.set(key, cachedValue);\n  return cachedValue;\n}\n\nfunction renderRichText({ html, dir, className }, container) {\n  const fragment = document.createDocumentFragment();\n  if (typeof html === \"string\") {\n    const p = document.createElement(\"p\");\n    p.dir = dir || \"auto\";\n    const lines = html.split(/(?:\\r\\n?|\\n)/);\n    for (let i = 0, ii = lines.length; i < ii; ++i) {\n      const line = lines[i];\n      p.append(document.createTextNode(line));\n      if (i < ii - 1) {\n        p.append(document.createElement(\"br\"));\n      }\n    }\n    fragment.append(p);\n  } else {\n    XfaLayer.render({\n      xfaHtml: html,\n      div: fragment,\n      intent: \"richText\",\n    });\n  }\n  fragment.firstElementChild.classList.add(\"richText\", className);\n  container.append(fragment);\n}\n\nfunction makePathFromDrawOPS(data) {\n  // Using a SVG string is slightly slower than using the following loop.\n  const path = new Path2D();\n  if (!data) {\n    return path;\n  }\n  for (let i = 0, ii = data.length; i < ii; ) {\n    switch (data[i++]) {\n      case DrawOPS.moveTo:\n        path.moveTo(data[i++], data[i++]);\n        break;\n      case DrawOPS.lineTo:\n        path.lineTo(data[i++], data[i++]);\n        break;\n      case DrawOPS.curveTo:\n        path.bezierCurveTo(\n          data[i++],\n          data[i++],\n          data[i++],\n          data[i++],\n          data[i++],\n          data[i++]\n        );\n        break;\n      case DrawOPS.quadraticCurveTo:\n        path.quadraticCurveTo(data[i++], data[i++], data[i++], data[i++]);\n        break;\n      case DrawOPS.closePath:\n        path.closePath();\n        break;\n      default:\n        warn(`Unrecognized drawing path operator: ${data[i - 1]}`);\n        break;\n    }\n  }\n  return path;\n}\n\nexport {\n  applyOpacity,\n  ColorScheme,\n  CSSConstants,\n  deprecated,\n  fetchData,\n  findContrastColor,\n  getColorValues,\n  getCurrentTransform,\n  getCurrentTransformInverse,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getRGB,\n  getXfaPageViewport,\n  isDataScheme,\n  isPdfFile,\n  isValidFetchUrl,\n  makePathFromDrawOPS,\n  noContextMenu,\n  OutputScale,\n  PageViewport,\n  PDFDateString,\n  PixelsPerInch,\n  RenderingCancelledException,\n  renderRichText,\n  setLayerDimensions,\n  StatTimer,\n  stopEvent,\n  SupportedImageMimeTypes,\n  SVG_NS,\n};\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { noContextMenu, stopEvent } from \"../display_utils.js\";\n\nclass EditorToolbar {\n  #toolbar = null;\n\n  #colorPicker = null;\n\n  #editor;\n\n  #buttons = null;\n\n  #altText = null;\n\n  #comment = null;\n\n  #commentButtonDivider = null;\n\n  #signatureDescriptionButton = null;\n\n  static #l10nRemove = null;\n\n  constructor(editor) {\n    this.#editor = editor;\n\n    EditorToolbar.#l10nRemove ||= Object.freeze({\n      freetext: \"pdfjs-editor-remove-freetext-button\",\n      highlight: \"pdfjs-editor-remove-highlight-button\",\n      ink: \"pdfjs-editor-remove-ink-button\",\n      stamp: \"pdfjs-editor-remove-stamp-button\",\n      signature: \"pdfjs-editor-remove-signature-button\",\n    });\n  }\n\n  render() {\n    const editToolbar = (this.#toolbar = document.createElement(\"div\"));\n    editToolbar.classList.add(\"editToolbar\", \"hidden\");\n    editToolbar.setAttribute(\"role\", \"toolbar\");\n\n    const signal = this.#editor._uiManager._signal;\n    if (signal instanceof AbortSignal && !signal.aborted) {\n      editToolbar.addEventListener(\"contextmenu\", noContextMenu, { signal });\n      editToolbar.addEventListener(\"pointerdown\", EditorToolbar.#pointerDown, {\n        signal,\n      });\n    }\n\n    const buttons = (this.#buttons = document.createElement(\"div\"));\n    buttons.className = \"buttons\";\n    editToolbar.append(buttons);\n\n    const position = this.#editor.toolbarPosition;\n    if (position) {\n      const { style } = editToolbar;\n      const x =\n        this.#editor._uiManager.direction === \"ltr\"\n          ? 1 - position[0]\n          : position[0];\n      style.insetInlineEnd = `${100 * x}%`;\n      style.top = `calc(${\n        100 * position[1]\n      }% + var(--editor-toolbar-vert-offset))`;\n    }\n\n    return editToolbar;\n  }\n\n  get div() {\n    return this.#toolbar;\n  }\n\n  static #pointerDown(e) {\n    e.stopPropagation();\n  }\n\n  #focusIn(e) {\n    this.#editor._focusEventsAllowed = false;\n    stopEvent(e);\n  }\n\n  #focusOut(e) {\n    this.#editor._focusEventsAllowed = true;\n    stopEvent(e);\n  }\n\n  #addListenersToElement(element) {\n    // If we're clicking on a button with the keyboard or with\n    // the mouse, we don't want to trigger any focus events on\n    // the editor.\n    const signal = this.#editor._uiManager._signal;\n    if (!(signal instanceof AbortSignal) || signal.aborted) {\n      return false;\n    }\n    element.addEventListener(\"focusin\", this.#focusIn.bind(this), {\n      capture: true,\n      signal,\n    });\n    element.addEventListener(\"focusout\", this.#focusOut.bind(this), {\n      capture: true,\n      signal,\n    });\n    element.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    return true;\n  }\n\n  hide() {\n    this.#toolbar.classList.add(\"hidden\");\n    this.#colorPicker?.hideDropdown();\n  }\n\n  show() {\n    this.#toolbar.classList.remove(\"hidden\");\n    this.#altText?.shown();\n    this.#comment?.shown();\n  }\n\n  addDeleteButton() {\n    const { editorType, _uiManager } = this.#editor;\n\n    const button = document.createElement(\"button\");\n    button.classList.add(\"basic\", \"deleteButton\");\n    button.tabIndex = 0;\n    button.setAttribute(\"data-l10n-id\", EditorToolbar.#l10nRemove[editorType]);\n    if (this.#addListenersToElement(button)) {\n      button.addEventListener(\n        \"click\",\n        e => {\n          _uiManager.delete();\n        },\n        { signal: _uiManager._signal }\n      );\n    }\n    this.#buttons.append(button);\n  }\n\n  get #divider() {\n    const divider = document.createElement(\"div\");\n    divider.className = \"divider\";\n    return divider;\n  }\n\n  async addAltText(altText) {\n    const button = await altText.render();\n    this.#addListenersToElement(button);\n    this.#buttons.append(button, this.#divider);\n    this.#altText = altText;\n  }\n\n  addComment(comment, beforeElement = null) {\n    if (this.#comment) {\n      return;\n    }\n    const button = comment.renderForToolbar();\n    if (!button) {\n      return;\n    }\n    this.#addListenersToElement(button);\n    const divider = (this.#commentButtonDivider = this.#divider);\n    if (!beforeElement) {\n      this.#buttons.append(button, divider);\n    } else {\n      this.#buttons.insertBefore(button, beforeElement);\n      this.#buttons.insertBefore(divider, beforeElement);\n    }\n    this.#comment = comment;\n    comment.toolbar = this;\n  }\n\n  addColorPicker(colorPicker) {\n    if (this.#colorPicker) {\n      return;\n    }\n    this.#colorPicker = colorPicker;\n    const button = colorPicker.renderButton();\n    this.#addListenersToElement(button);\n    this.#buttons.append(button, this.#divider);\n  }\n\n  async addEditSignatureButton(signatureManager) {\n    const button = (this.#signatureDescriptionButton =\n      await signatureManager.renderEditButton(this.#editor));\n    this.#addListenersToElement(button);\n    this.#buttons.append(button, this.#divider);\n  }\n\n  removeButton(name) {\n    switch (name) {\n      case \"comment\":\n        this.#comment?.removeToolbarCommentButton();\n        this.#comment = null;\n        this.#commentButtonDivider?.remove();\n        this.#commentButtonDivider = null;\n        break;\n    }\n  }\n\n  async addButton(name, tool) {\n    switch (name) {\n      case \"colorPicker\":\n        if (tool) {\n          this.addColorPicker(tool);\n        }\n        break;\n      case \"altText\":\n        if (tool) {\n          await this.addAltText(tool);\n        }\n        break;\n      case \"editSignature\":\n        if (tool) {\n          await this.addEditSignatureButton(tool);\n        }\n        break;\n      case \"delete\":\n        this.addDeleteButton();\n        break;\n      case \"comment\":\n        if (tool) {\n          this.addComment(tool);\n        }\n        break;\n    }\n  }\n\n  async addButtonBefore(name, tool, beforeSelector) {\n    if (!tool && name === \"comment\") {\n      return;\n    }\n    const beforeElement = this.#buttons.querySelector(beforeSelector);\n    if (!beforeElement) {\n      return;\n    }\n    if (name === \"comment\") {\n      this.addComment(tool, beforeElement);\n    }\n  }\n\n  updateEditSignatureButton(description) {\n    if (this.#signatureDescriptionButton) {\n      this.#signatureDescriptionButton.title = description;\n    }\n  }\n\n  remove() {\n    this.#toolbar.remove();\n    this.#colorPicker?.destroy();\n    this.#colorPicker = null;\n  }\n}\n\nclass FloatingToolbar {\n  #buttons = null;\n\n  #toolbar = null;\n\n  #uiManager;\n\n  constructor(uiManager) {\n    this.#uiManager = uiManager;\n  }\n\n  #render() {\n    const editToolbar = (this.#toolbar = document.createElement(\"div\"));\n    editToolbar.className = \"editToolbar\";\n    editToolbar.setAttribute(\"role\", \"toolbar\");\n\n    const signal = this.#uiManager._signal;\n    if (signal instanceof AbortSignal && !signal.aborted) {\n      editToolbar.addEventListener(\"contextmenu\", noContextMenu, {\n        signal,\n      });\n    }\n\n    const buttons = (this.#buttons = document.createElement(\"div\"));\n    buttons.className = \"buttons\";\n    editToolbar.append(buttons);\n\n    if (this.#uiManager.hasCommentManager()) {\n      this.#makeButton(\n        \"commentButton\",\n        `pdfjs-comment-floating-button`,\n        \"pdfjs-comment-floating-button-label\",\n        () => {\n          this.#uiManager.commentSelection(\"floating_button\");\n        }\n      );\n    }\n\n    this.#makeButton(\n      \"highlightButton\",\n      `pdfjs-highlight-floating-button1`,\n      \"pdfjs-highlight-floating-button-label\",\n      () => {\n        this.#uiManager.highlightSelection(\"floating_button\");\n      }\n    );\n\n    return editToolbar;\n  }\n\n  #getLastPoint(boxes, isLTR) {\n    let lastY = 0;\n    let lastX = 0;\n    for (const box of boxes) {\n      const y = box.y + box.height;\n      if (y < lastY) {\n        continue;\n      }\n      const x = box.x + (isLTR ? box.width : 0);\n      if (y > lastY) {\n        lastX = x;\n        lastY = y;\n        continue;\n      }\n      if (isLTR) {\n        if (x > lastX) {\n          lastX = x;\n        }\n      } else if (x < lastX) {\n        lastX = x;\n      }\n    }\n    return [isLTR ? 1 - lastX : lastX, lastY];\n  }\n\n  show(parent, boxes, isLTR) {\n    const [x, y] = this.#getLastPoint(boxes, isLTR);\n    const { style } = (this.#toolbar ||= this.#render());\n    parent.append(this.#toolbar);\n    style.insetInlineEnd = `${100 * x}%`;\n    style.top = `calc(${100 * y}% + var(--editor-toolbar-vert-offset))`;\n  }\n\n  hide() {\n    this.#toolbar.remove();\n  }\n\n  #makeButton(buttonClass, l10nId, labelL10nId, clickHandler) {\n    const button = document.createElement(\"button\");\n    button.classList.add(\"basic\", buttonClass);\n    button.tabIndex = 0;\n    button.setAttribute(\"data-l10n-id\", l10nId);\n    const span = document.createElement(\"span\");\n    button.append(span);\n    span.className = \"visuallyHidden\";\n    span.setAttribute(\"data-l10n-id\", labelL10nId);\n    const signal = this.#uiManager._signal;\n    if (signal instanceof AbortSignal && !signal.aborted) {\n      button.addEventListener(\"contextmenu\", noContextMenu, { signal });\n      button.addEventListener(\"click\", clickHandler, { signal });\n    }\n    this.#buttons.append(button);\n  }\n}\n\nexport { EditorToolbar, FloatingToolbar };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./editor.js\").AnnotationEditor} AnnotationEditor */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_editor_layer.js\").AnnotationEditorLayer} AnnotationEditorLayer */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorPrefix,\n  AnnotationEditorType,\n  FeatureTest,\n  getUuid,\n  shadow,\n  Util,\n  warn,\n} from \"../../shared/util.js\";\nimport {\n  fetchData,\n  getColorValues,\n  getRGB,\n  PixelsPerInch,\n  stopEvent,\n} from \"../display_utils.js\";\nimport { FloatingToolbar } from \"./toolbar.js\";\n\nfunction bindEvents(obj, element, names) {\n  for (const name of names) {\n    element.addEventListener(name, obj[name].bind(obj));\n  }\n}\n\n/**\n * Class to store current pointers used by the editor to be able to handle\n * multiple pointers (e.g. two fingers, a pen, a mouse, ...).\n */\nclass CurrentPointers {\n  // To manage the pointer events.\n\n  // The pointerId  and pointerIds are used to keep track of\n  // the pointers with a same type (e.g. two fingers).\n  static #pointerId = NaN;\n\n  static #pointerIds = null;\n\n  // Track the timestamp to know if the touchmove event is used.\n  static #moveTimestamp = NaN;\n\n  // The pointerType is used to know if we are using a mouse, a pen or a touch.\n  static #pointerType = null;\n\n  static initializeAndAddPointerId(pointerId) {\n    // Store pointer ids. For example, the user is using a second finger.\n    (CurrentPointers.#pointerIds ||= new Set()).add(pointerId);\n  }\n\n  static setPointer(pointerType, pointerId) {\n    CurrentPointers.#pointerId ||= pointerId;\n    CurrentPointers.#pointerType ??= pointerType;\n  }\n\n  static setTimeStamp(timeStamp) {\n    CurrentPointers.#moveTimestamp = timeStamp;\n  }\n\n  static isSamePointerId(pointerId) {\n    return CurrentPointers.#pointerId === pointerId;\n  }\n\n  // Check if it's the same pointer id, otherwise remove it from the set.\n  static isSamePointerIdOrRemove(pointerId) {\n    if (CurrentPointers.#pointerId === pointerId) {\n      return true;\n    }\n\n    CurrentPointers.#pointerIds?.delete(pointerId);\n    return false;\n  }\n\n  static isSamePointerType(pointerType) {\n    return CurrentPointers.#pointerType === pointerType;\n  }\n\n  static isInitializedAndDifferentPointerType(pointerType) {\n    return (\n      CurrentPointers.#pointerType !== null &&\n      !CurrentPointers.isSamePointerType(pointerType)\n    );\n  }\n\n  static isSameTimeStamp(timeStamp) {\n    return CurrentPointers.#moveTimestamp === timeStamp;\n  }\n\n  static isUsingMultiplePointers() {\n    // Check if the user is using multiple fingers\n    return CurrentPointers.#pointerIds?.size >= 1;\n  }\n\n  static clearPointerType() {\n    CurrentPointers.#pointerType = null;\n  }\n\n  static clearPointerIds() {\n    CurrentPointers.#pointerId = NaN;\n    CurrentPointers.#pointerIds = null;\n  }\n\n  static clearTimeStamp() {\n    CurrentPointers.#moveTimestamp = NaN;\n  }\n}\n\n/**\n * Class to create some unique ids for the different editors.\n */\nclass IdManager {\n  #id = 0;\n\n  constructor() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      Object.defineProperty(this, \"reset\", {\n        value: () => (this.#id = 0),\n      });\n      Object.defineProperty(this, \"getNextId\", {\n        value: () => this.#id,\n      });\n    }\n  }\n\n  /**\n   * Get a unique id.\n   * @returns {string}\n   */\n  get id() {\n    return `${AnnotationEditorPrefix}${this.#id++}`;\n  }\n}\n\n/**\n * Class to manage the images used by the editors.\n * The main idea is to try to minimize the memory used by the images.\n * The images are cached and reused when possible\n * We use a refCounter to know when an image is not used anymore but we need to\n * be able to restore an image after a remove+undo, so we keep a file reference\n * or an url one.\n */\nclass ImageManager {\n  #baseId = getUuid();\n\n  #id = 0;\n\n  #cache = null;\n\n  static get _isSVGFittingCanvas() {\n    // By default, Firefox doesn't rescale without preserving the aspect ratio\n    // when drawing an SVG image on a canvas, see https://bugzilla.mozilla.org/1547776.\n    // The \"workaround\" is to append \"svgView(preserveAspectRatio(none))\" to the\n    // url, but according to comment #15, it seems that it leads to unexpected\n    // behavior in Safari.\n    const svg = `data:image/svg+xml;charset=UTF-8,<svg viewBox=\"0 0 1 1\" width=\"1\" height=\"1\" xmlns=\"http://www.w3.org/2000/svg\"><rect width=\"1\" height=\"1\" style=\"fill:red;\"/></svg>`;\n    const canvas = new OffscreenCanvas(1, 3);\n    const ctx = canvas.getContext(\"2d\", { willReadFrequently: true });\n    const image = new Image();\n    image.src = svg;\n    const promise = image.decode().then(() => {\n      ctx.drawImage(image, 0, 0, 1, 1, 0, 0, 1, 3);\n      return new Uint32Array(ctx.getImageData(0, 0, 1, 1).data.buffer)[0] === 0;\n    });\n\n    return shadow(this, \"_isSVGFittingCanvas\", promise);\n  }\n\n  async #get(key, rawData) {\n    this.#cache ||= new Map();\n    let data = this.#cache.get(key);\n    if (data === null) {\n      // We already tried to load the image but it failed.\n      return null;\n    }\n    if (data?.bitmap) {\n      data.refCounter += 1;\n      return data;\n    }\n    try {\n      data ||= {\n        bitmap: null,\n        id: `image_${this.#baseId}_${this.#id++}`,\n        refCounter: 0,\n        isSvg: false,\n      };\n      let image;\n      if (typeof rawData === \"string\") {\n        data.url = rawData;\n        image = await fetchData(rawData, \"blob\");\n      } else if (rawData instanceof File) {\n        image = data.file = rawData;\n      } else if (rawData instanceof Blob) {\n        image = rawData;\n      }\n\n      if (image.type === \"image/svg+xml\") {\n        // Unfortunately, createImageBitmap doesn't work with SVG images.\n        // (see https://bugzilla.mozilla.org/1841972).\n        const mustRemoveAspectRatioPromise = ImageManager._isSVGFittingCanvas;\n        const fileReader = new FileReader();\n        const imageElement = new Image();\n        const imagePromise = new Promise((resolve, reject) => {\n          imageElement.onload = () => {\n            data.bitmap = imageElement;\n            data.isSvg = true;\n            resolve();\n          };\n          fileReader.onload = async () => {\n            const url = (data.svgUrl = fileReader.result);\n            // We need to set the preserveAspectRatio to none in order to let\n            // the image fits the canvas when resizing.\n            imageElement.src = (await mustRemoveAspectRatioPromise)\n              ? `${url}#svgView(preserveAspectRatio(none))`\n              : url;\n          };\n          imageElement.onerror = fileReader.onerror = reject;\n        });\n        fileReader.readAsDataURL(image);\n        await imagePromise;\n      } else {\n        data.bitmap = await createImageBitmap(image);\n      }\n      data.refCounter = 1;\n    } catch (e) {\n      warn(e);\n      data = null;\n    }\n    this.#cache.set(key, data);\n    if (data) {\n      this.#cache.set(data.id, data);\n    }\n    return data;\n  }\n\n  async getFromFile(file) {\n    const { lastModified, name, size, type } = file;\n    return this.#get(`${lastModified}_${name}_${size}_${type}`, file);\n  }\n\n  async getFromUrl(url) {\n    return this.#get(url, url);\n  }\n\n  async getFromBlob(id, blobPromise) {\n    const blob = await blobPromise;\n    return this.#get(id, blob);\n  }\n\n  async getFromId(id) {\n    this.#cache ||= new Map();\n    const data = this.#cache.get(id);\n    if (!data) {\n      return null;\n    }\n    if (data.bitmap) {\n      data.refCounter += 1;\n      return data;\n    }\n\n    if (data.file) {\n      return this.getFromFile(data.file);\n    }\n    if (data.blobPromise) {\n      const { blobPromise } = data;\n      delete data.blobPromise;\n      return this.getFromBlob(data.id, blobPromise);\n    }\n    return this.getFromUrl(data.url);\n  }\n\n  getFromCanvas(id, canvas) {\n    this.#cache ||= new Map();\n    let data = this.#cache.get(id);\n    if (data?.bitmap) {\n      data.refCounter += 1;\n      return data;\n    }\n    const offscreen = new OffscreenCanvas(canvas.width, canvas.height);\n    const ctx = offscreen.getContext(\"2d\");\n    ctx.drawImage(canvas, 0, 0);\n    data = {\n      bitmap: offscreen.transferToImageBitmap(),\n      id: `image_${this.#baseId}_${this.#id++}`,\n      refCounter: 1,\n      isSvg: false,\n    };\n    this.#cache.set(id, data);\n    this.#cache.set(data.id, data);\n    return data;\n  }\n\n  getSvgUrl(id) {\n    const data = this.#cache.get(id);\n    if (!data?.isSvg) {\n      return null;\n    }\n    return data.svgUrl;\n  }\n\n  deleteId(id) {\n    this.#cache ||= new Map();\n    const data = this.#cache.get(id);\n    if (!data) {\n      return;\n    }\n    data.refCounter -= 1;\n    if (data.refCounter !== 0) {\n      return;\n    }\n    const { bitmap } = data;\n    if (!data.url && !data.file) {\n      // The image has no way to be restored (ctrl+z) so we must fix that.\n      const canvas = new OffscreenCanvas(bitmap.width, bitmap.height);\n      const ctx = canvas.getContext(\"bitmaprenderer\");\n      ctx.transferFromImageBitmap(bitmap);\n      data.blobPromise = canvas.convertToBlob();\n    }\n\n    bitmap.close?.();\n    data.bitmap = null;\n  }\n\n  // We can use the id only if it belongs this manager.\n  // We must take care of having the right manager because we can copy/paste\n  // some images from other documents, hence it'd be a pity to use an id from an\n  // other manager.\n  isValidId(id) {\n    return id.startsWith(`image_${this.#baseId}_`);\n  }\n}\n\n/**\n * Class to handle undo/redo.\n * Commands are just saved in a buffer.\n * If we hit some memory issues we could likely use a circular buffer.\n * It has to be used as a singleton.\n */\nclass CommandManager {\n  #commands = [];\n\n  #locked = false;\n\n  #maxSize;\n\n  #position = -1;\n\n  constructor(maxSize = 128) {\n    this.#maxSize = maxSize;\n  }\n\n  /**\n   * @typedef {Object} addOptions\n   * @property {function} cmd\n   * @property {function} undo\n   * @property {function} [post]\n   * @property {boolean} mustExec\n   * @property {number} type\n   * @property {boolean} overwriteIfSameType\n   * @property {boolean} keepUndo\n   */\n\n  /**\n   * Add a new couple of commands to be used in case of redo/undo.\n   * @param {addOptions} options\n   */\n  add({\n    cmd,\n    undo,\n    post,\n    mustExec,\n    type = NaN,\n    overwriteIfSameType = false,\n    keepUndo = false,\n  }) {\n    if (mustExec) {\n      cmd();\n    }\n\n    if (this.#locked) {\n      return;\n    }\n\n    const save = { cmd, undo, post, type };\n    if (this.#position === -1) {\n      if (this.#commands.length > 0) {\n        // All the commands have been undone and then a new one is added\n        // hence we clear the queue.\n        this.#commands.length = 0;\n      }\n      this.#position = 0;\n      this.#commands.push(save);\n      return;\n    }\n\n    if (overwriteIfSameType && this.#commands[this.#position].type === type) {\n      // For example when we change a color we don't want to\n      // be able to undo all the steps, hence we only want to\n      // keep the last undoable action in this sequence of actions.\n      if (keepUndo) {\n        save.undo = this.#commands[this.#position].undo;\n      }\n      this.#commands[this.#position] = save;\n      return;\n    }\n\n    const next = this.#position + 1;\n    if (next === this.#maxSize) {\n      this.#commands.splice(0, 1);\n    } else {\n      this.#position = next;\n      if (next < this.#commands.length) {\n        this.#commands.splice(next);\n      }\n    }\n\n    this.#commands.push(save);\n  }\n\n  /**\n   * Undo the last command.\n   */\n  undo() {\n    if (this.#position === -1) {\n      // Nothing to undo.\n      return;\n    }\n\n    // Avoid to insert something during the undo execution.\n    this.#locked = true;\n    const { undo, post } = this.#commands[this.#position];\n    undo();\n    post?.();\n    this.#locked = false;\n\n    this.#position -= 1;\n  }\n\n  /**\n   * Redo the last command.\n   */\n  redo() {\n    if (this.#position < this.#commands.length - 1) {\n      this.#position += 1;\n\n      // Avoid to insert something during the redo execution.\n      this.#locked = true;\n      const { cmd, post } = this.#commands[this.#position];\n      cmd();\n      post?.();\n      this.#locked = false;\n    }\n  }\n\n  /**\n   * Check if there is something to undo.\n   * @returns {boolean}\n   */\n  hasSomethingToUndo() {\n    return this.#position !== -1;\n  }\n\n  /**\n   * Check if there is something to redo.\n   * @returns {boolean}\n   */\n  hasSomethingToRedo() {\n    return this.#position < this.#commands.length - 1;\n  }\n\n  cleanType(type) {\n    if (this.#position === -1) {\n      return;\n    }\n    for (let i = this.#position; i >= 0; i--) {\n      if (this.#commands[i].type !== type) {\n        this.#commands.splice(i + 1, this.#position - i);\n        this.#position = i;\n        return;\n      }\n    }\n    this.#commands.length = 0;\n    this.#position = -1;\n  }\n\n  destroy() {\n    this.#commands = null;\n  }\n}\n\n/**\n * Class to handle the different keyboards shortcuts we can have on mac or\n * non-mac OSes.\n */\nclass KeyboardManager {\n  /**\n   * Create a new keyboard manager class.\n   * @param {Array<Array>} callbacks - an array containing an array of shortcuts\n   * and a callback to call.\n   * A shortcut is a string like `ctrl+c` or `mac+ctrl+c` for mac OS.\n   */\n  constructor(callbacks) {\n    this.buffer = [];\n    this.callbacks = new Map();\n    this.allKeys = new Set();\n\n    const { isMac } = FeatureTest.platform;\n    for (const [keys, callback, options = {}] of callbacks) {\n      for (const key of keys) {\n        const isMacKey = key.startsWith(\"mac+\");\n        if (isMac && isMacKey) {\n          this.callbacks.set(key.slice(4), { callback, options });\n          this.allKeys.add(key.split(\"+\").at(-1));\n        } else if (!isMac && !isMacKey) {\n          this.callbacks.set(key, { callback, options });\n          this.allKeys.add(key.split(\"+\").at(-1));\n        }\n      }\n    }\n  }\n\n  /**\n   * Serialize an event into a string in order to match a\n   * potential key for a callback.\n   * @param {KeyboardEvent} event\n   * @returns {string}\n   */\n  #serialize(event) {\n    if (event.altKey) {\n      this.buffer.push(\"alt\");\n    }\n    if (event.ctrlKey) {\n      this.buffer.push(\"ctrl\");\n    }\n    if (event.metaKey) {\n      this.buffer.push(\"meta\");\n    }\n    if (event.shiftKey) {\n      this.buffer.push(\"shift\");\n    }\n    this.buffer.push(event.key);\n    const str = this.buffer.join(\"+\");\n    this.buffer.length = 0;\n\n    return str;\n  }\n\n  /**\n   * Execute a callback, if any, for a given keyboard event.\n   * The self is used as `this` in the callback.\n   * @param {Object} self\n   * @param {KeyboardEvent} event\n   * @returns\n   */\n  exec(self, event) {\n    if (!this.allKeys.has(event.key)) {\n      return;\n    }\n    const info = this.callbacks.get(this.#serialize(event));\n    if (!info) {\n      return;\n    }\n    const {\n      callback,\n      options: { bubbles = false, args = [], checker = null },\n    } = info;\n\n    if (checker && !checker(self, event)) {\n      return;\n    }\n    callback.bind(self, ...args, event)();\n\n    // For example, ctrl+s in a FreeText must be handled by the viewer, hence\n    // the event must bubble.\n    if (!bubbles) {\n      stopEvent(event);\n    }\n  }\n}\n\nclass ColorManager {\n  static _colorsMapping = new Map([\n    [\"CanvasText\", [0, 0, 0]],\n    [\"Canvas\", [255, 255, 255]],\n  ]);\n\n  get _colors() {\n    if (\n      typeof PDFJSDev !== \"undefined\" &&\n      PDFJSDev.test(\"LIB\") &&\n      typeof document === \"undefined\"\n    ) {\n      return shadow(this, \"_colors\", ColorManager._colorsMapping);\n    }\n\n    const colors = new Map([\n      [\"CanvasText\", null],\n      [\"Canvas\", null],\n    ]);\n    getColorValues(colors);\n    return shadow(this, \"_colors\", colors);\n  }\n\n  /**\n   * In High Contrast Mode, the color on the screen is not always the\n   * real color used in the pdf.\n   * For example in some cases white can appear to be black but when saving\n   * we want to have white.\n   * @param {string} color\n   * @returns {Array<number>}\n   */\n  convert(color) {\n    const rgb = getRGB(color);\n    if (!window.matchMedia(\"(forced-colors: active)\").matches) {\n      return rgb;\n    }\n\n    for (const [name, RGB] of this._colors) {\n      if (RGB.every((x, i) => x === rgb[i])) {\n        return ColorManager._colorsMapping.get(name);\n      }\n    }\n    return rgb;\n  }\n\n  /**\n   * An input element must have its color value as a hex string\n   * and not as color name.\n   * So this function converts a name into an hex string.\n   * @param {string} name\n   * @returns {string}\n   */\n  getHexCode(name) {\n    const rgb = this._colors.get(name);\n    if (!rgb) {\n      return name;\n    }\n    return Util.makeHexColor(...rgb);\n  }\n}\n\n/**\n * A pdf has several pages and each of them when it will rendered\n * will have an AnnotationEditorLayer which will contain the some\n * new Annotations associated to an editor in order to modify them.\n *\n * This class is used to manage all the different layers, editors and\n * some action like copy/paste, undo/redo, ...\n */\nclass AnnotationEditorUIManager {\n  #abortController = new AbortController();\n\n  #activeEditor = null;\n\n  #allEditableAnnotations = null;\n\n  #allEditors = new Map();\n\n  #allLayers = new Map();\n\n  #altTextManager = null;\n\n  #annotationStorage = null;\n\n  #changedExistingAnnotations = null;\n\n  #commandManager = new CommandManager();\n\n  #commentManager = null;\n\n  #copyPasteAC = null;\n\n  #currentDrawingSession = null;\n\n  #currentPageIndex = 0;\n\n  #deletedAnnotationsElementIds = new Set();\n\n  #draggingEditors = null;\n\n  #editorTypes = null;\n\n  #editorsToRescale = new Set();\n\n  _editorUndoBar = null;\n\n  #enableHighlightFloatingButton = false;\n\n  #enableUpdatedAddImage = false;\n\n  #enableNewAltTextWhenAddingImage = false;\n\n  #filterFactory = null;\n\n  #focusMainContainerTimeoutId = null;\n\n  #focusManagerAC = null;\n\n  #highlightColors = null;\n\n  #highlightWhenShiftUp = false;\n\n  #floatingToolbar = null;\n\n  #idManager = new IdManager();\n\n  #isEnabled = false;\n\n  #isPointerDown = false;\n\n  #isWaiting = false;\n\n  #keyboardManagerAC = null;\n\n  #lastActiveElement = null;\n\n  #mainHighlightColorPicker = null;\n\n  #missingCanvases = null;\n\n  #mlManager = null;\n\n  #mode = AnnotationEditorType.NONE;\n\n  #selectedEditors = new Set();\n\n  #selectedTextNode = null;\n\n  #signatureManager = null;\n\n  #pageColors = null;\n\n  #showAllStates = null;\n\n  #pdfDocument = null;\n\n  #previousStates = {\n    isEditing: false,\n    isEmpty: true,\n    hasSomethingToUndo: false,\n    hasSomethingToRedo: false,\n    hasSelectedEditor: false,\n    hasSelectedText: false,\n  };\n\n  #translation = [0, 0];\n\n  #translationTimeoutId = null;\n\n  #container = null;\n\n  #viewer = null;\n\n  #viewerAlert = null;\n\n  #updateModeCapability = null;\n\n  static TRANSLATE_SMALL = 1; // page units.\n\n  static TRANSLATE_BIG = 10; // page units.\n\n  static get _keyboardManager() {\n    const proto = AnnotationEditorUIManager.prototype;\n\n    /**\n     * If the focused element is an input, we don't want to handle the arrow.\n     * For example, sliders can be controlled with the arrow keys.\n     */\n    const arrowChecker = self =>\n      self.#container.contains(document.activeElement) &&\n      document.activeElement.tagName !== \"BUTTON\" &&\n      self.hasSomethingToControl();\n\n    const textInputChecker = (_self, { target: el }) => {\n      if (el instanceof HTMLInputElement) {\n        const { type } = el;\n        return type !== \"text\" && type !== \"number\";\n      }\n      return true;\n    };\n\n    const small = this.TRANSLATE_SMALL;\n    const big = this.TRANSLATE_BIG;\n\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [\n          [\"ctrl+a\", \"mac+meta+a\"],\n          proto.selectAll,\n          { checker: textInputChecker },\n        ],\n        [[\"ctrl+z\", \"mac+meta+z\"], proto.undo, { checker: textInputChecker }],\n        [\n          // On mac, depending of the OS version, the event.key is either \"z\" or\n          // \"Z\" when the user presses \"meta+shift+z\".\n          [\n            \"ctrl+y\",\n            \"ctrl+shift+z\",\n            \"mac+meta+shift+z\",\n            \"ctrl+shift+Z\",\n            \"mac+meta+shift+Z\",\n          ],\n          proto.redo,\n          { checker: textInputChecker },\n        ],\n        [\n          [\n            \"Backspace\",\n            \"alt+Backspace\",\n            \"ctrl+Backspace\",\n            \"shift+Backspace\",\n            \"mac+Backspace\",\n            \"mac+alt+Backspace\",\n            \"mac+ctrl+Backspace\",\n            \"Delete\",\n            \"ctrl+Delete\",\n            \"shift+Delete\",\n            \"mac+Delete\",\n          ],\n          proto.delete,\n          { checker: textInputChecker },\n        ],\n        [\n          [\"Enter\", \"mac+Enter\"],\n          proto.addNewEditorFromKeyboard,\n          {\n            // Those shortcuts can be used in the toolbar for some other actions\n            // like zooming, hence we need to check if the container has the\n            // focus.\n            checker: (self, { target: el }) =>\n              !(el instanceof HTMLButtonElement) &&\n              self.#container.contains(el) &&\n              !self.isEnterHandled,\n          },\n        ],\n        [\n          [\" \", \"mac+ \"],\n          proto.addNewEditorFromKeyboard,\n          {\n            // Those shortcuts can be used in the toolbar for some other actions\n            // like zooming, hence we need to check if the container has the\n            // focus.\n            checker: (self, { target: el }) =>\n              !(el instanceof HTMLButtonElement) &&\n              self.#container.contains(document.activeElement),\n          },\n        ],\n        [[\"Escape\", \"mac+Escape\"], proto.unselectAll],\n        [\n          [\"ArrowLeft\", \"mac+ArrowLeft\"],\n          proto.translateSelectedEditors,\n          { args: [-small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowLeft\", \"mac+shift+ArrowLeft\"],\n          proto.translateSelectedEditors,\n          { args: [-big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowRight\", \"mac+ArrowRight\"],\n          proto.translateSelectedEditors,\n          { args: [small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowRight\", \"mac+shift+ArrowRight\"],\n          proto.translateSelectedEditors,\n          { args: [big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowUp\", \"mac+ArrowUp\"],\n          proto.translateSelectedEditors,\n          { args: [0, -small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowUp\", \"mac+shift+ArrowUp\"],\n          proto.translateSelectedEditors,\n          { args: [0, -big], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowDown\", \"mac+ArrowDown\"],\n          proto.translateSelectedEditors,\n          { args: [0, small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowDown\", \"mac+shift+ArrowDown\"],\n          proto.translateSelectedEditors,\n          { args: [0, big], checker: arrowChecker },\n        ],\n      ])\n    );\n  }\n\n  constructor(\n    container,\n    viewer,\n    viewerAlert,\n    altTextManager,\n    commentManager,\n    signatureManager,\n    eventBus,\n    pdfDocument,\n    pageColors,\n    highlightColors,\n    enableHighlightFloatingButton,\n    enableUpdatedAddImage,\n    enableNewAltTextWhenAddingImage,\n    mlManager,\n    editorUndoBar,\n    supportsPinchToZoom\n  ) {\n    const signal = (this._signal = this.#abortController.signal);\n    this.#container = container;\n    this.#viewer = viewer;\n    this.#viewerAlert = viewerAlert;\n    this.#altTextManager = altTextManager;\n    this.#commentManager = commentManager;\n    this.#signatureManager = signatureManager;\n    this.#pdfDocument = pdfDocument;\n    this._eventBus = eventBus;\n    eventBus._on(\"editingaction\", this.onEditingAction.bind(this), { signal });\n    eventBus._on(\"pagechanging\", this.onPageChanging.bind(this), { signal });\n    eventBus._on(\"scalechanging\", this.onScaleChanging.bind(this), { signal });\n    eventBus._on(\"rotationchanging\", this.onRotationChanging.bind(this), {\n      signal,\n    });\n    eventBus._on(\"setpreference\", this.onSetPreference.bind(this), { signal });\n    eventBus._on(\n      \"switchannotationeditorparams\",\n      evt => this.updateParams(evt.type, evt.value),\n      { signal }\n    );\n    window.addEventListener(\n      \"pointerdown\",\n      () => {\n        this.#isPointerDown = true;\n      },\n      { capture: true, signal }\n    );\n    window.addEventListener(\n      \"pointerup\",\n      () => {\n        this.#isPointerDown = false;\n      },\n      { capture: true, signal }\n    );\n    this.#addSelectionListener();\n    this.#addDragAndDropListeners();\n    this.#addKeyboardManager();\n    this.#annotationStorage = pdfDocument.annotationStorage;\n    this.#filterFactory = pdfDocument.filterFactory;\n    this.#pageColors = pageColors;\n    this.#highlightColors = highlightColors || null;\n    this.#enableHighlightFloatingButton = enableHighlightFloatingButton;\n    this.#enableUpdatedAddImage = enableUpdatedAddImage;\n    this.#enableNewAltTextWhenAddingImage = enableNewAltTextWhenAddingImage;\n    this.#mlManager = mlManager || null;\n    this.viewParameters = {\n      realScale: PixelsPerInch.PDF_TO_CSS_UNITS,\n      rotation: 0,\n    };\n    this.isShiftKeyDown = false;\n    this._editorUndoBar = editorUndoBar || null;\n    this._supportsPinchToZoom = supportsPinchToZoom !== false;\n    commentManager?.setSidebarUiManager(this);\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      Object.defineProperty(this, \"reset\", {\n        value: () => {\n          this.selectAll();\n          this.delete();\n          this.#idManager.reset();\n        },\n      });\n      Object.defineProperty(this, \"getNextEditorId\", {\n        value: () => this.#idManager.getNextId(),\n      });\n    }\n  }\n\n  destroy() {\n    this.#updateModeCapability?.resolve();\n    this.#updateModeCapability = null;\n\n    this.#abortController?.abort();\n    this.#abortController = null;\n    this._signal = null;\n\n    for (const layer of this.#allLayers.values()) {\n      layer.destroy();\n    }\n    this.#allLayers.clear();\n    this.#allEditors.clear();\n    this.#editorsToRescale.clear();\n    this.#missingCanvases?.clear();\n    this.#activeEditor = null;\n    this.#selectedEditors.clear();\n    this.#commandManager.destroy();\n    this.#altTextManager?.destroy();\n    this.#commentManager?.destroy();\n    this.#signatureManager?.destroy();\n    this.#floatingToolbar?.hide();\n    this.#floatingToolbar = null;\n    this.#mainHighlightColorPicker?.destroy();\n    this.#mainHighlightColorPicker = null;\n    this.#allEditableAnnotations = null;\n    if (this.#focusMainContainerTimeoutId) {\n      clearTimeout(this.#focusMainContainerTimeoutId);\n      this.#focusMainContainerTimeoutId = null;\n    }\n    if (this.#translationTimeoutId) {\n      clearTimeout(this.#translationTimeoutId);\n      this.#translationTimeoutId = null;\n    }\n    this._editorUndoBar?.destroy();\n    this.#pdfDocument = null;\n  }\n\n  combinedSignal(ac) {\n    return AbortSignal.any([this._signal, ac.signal]);\n  }\n\n  get mlManager() {\n    return this.#mlManager;\n  }\n\n  get useNewAltTextFlow() {\n    return this.#enableUpdatedAddImage;\n  }\n\n  get useNewAltTextWhenAddingImage() {\n    return this.#enableNewAltTextWhenAddingImage;\n  }\n\n  get hcmFilter() {\n    return shadow(\n      this,\n      \"hcmFilter\",\n      this.#pageColors\n        ? this.#filterFactory.addHCMFilter(\n            this.#pageColors.foreground,\n            this.#pageColors.background\n          )\n        : \"none\"\n    );\n  }\n\n  get direction() {\n    return shadow(\n      this,\n      \"direction\",\n      getComputedStyle(this.#container).direction\n    );\n  }\n\n  get _highlightColors() {\n    return shadow(\n      this,\n      \"_highlightColors\",\n      this.#highlightColors\n        ? new Map(\n            this.#highlightColors.split(\",\").map(pair => {\n              pair = pair.split(\"=\").map(x => x.trim());\n              pair[1] = pair[1].toUpperCase();\n              return pair;\n            })\n          )\n        : null\n    );\n  }\n\n  get highlightColors() {\n    const { _highlightColors } = this;\n    if (!_highlightColors) {\n      return shadow(this, \"highlightColors\", null);\n    }\n    const map = new Map();\n    const hasHCM = !!this.#pageColors;\n    for (const [name, color] of _highlightColors) {\n      const isNameForHCM = name.endsWith(\"_HCM\");\n      if (hasHCM && isNameForHCM) {\n        map.set(name.replace(\"_HCM\", \"\"), color);\n        continue;\n      }\n      if (!hasHCM && !isNameForHCM) {\n        map.set(name, color);\n      }\n    }\n    return shadow(this, \"highlightColors\", map);\n  }\n\n  get highlightColorNames() {\n    return shadow(\n      this,\n      \"highlightColorNames\",\n      this.highlightColors\n        ? new Map(Array.from(this.highlightColors, e => e.reverse()))\n        : null\n    );\n  }\n\n  getNonHCMColor(color) {\n    if (!this._highlightColors) {\n      return color;\n    }\n    const colorName = this.highlightColorNames.get(color);\n    return this._highlightColors.get(colorName) || color;\n  }\n\n  getNonHCMColorName(color) {\n    return this.highlightColorNames.get(color) || color;\n  }\n\n  /**\n   * Set the current drawing session.\n   * @param {AnnotationEditorLayer} layer\n   */\n  setCurrentDrawingSession(layer) {\n    if (layer) {\n      this.unselectAll();\n      this.disableUserSelect(true);\n    } else {\n      this.disableUserSelect(false);\n    }\n    this.#currentDrawingSession = layer;\n  }\n\n  setMainHighlightColorPicker(colorPicker) {\n    this.#mainHighlightColorPicker = colorPicker;\n  }\n\n  editAltText(editor, firstTime = false) {\n    this.#altTextManager?.editAltText(this, editor, firstTime);\n  }\n\n  hasCommentManager() {\n    return !!this.#commentManager;\n  }\n\n  editComment(editor, posX, posY, options) {\n    this.#commentManager?.showDialog(this, editor, posX, posY, options);\n  }\n\n  selectComment(pageIndex, uid) {\n    const layer = this.#allLayers.get(pageIndex);\n    const editor = layer?.getEditorByUID(uid);\n    editor?.toggleComment(/* isSelected */ true, /* visibility */ true);\n  }\n\n  updateComment(editor) {\n    this.#commentManager?.updateComment(editor.getData());\n  }\n\n  updatePopupColor(editor) {\n    this.#commentManager?.updatePopupColor(editor);\n  }\n\n  removeComment(editor) {\n    this.#commentManager?.removeComments([editor.uid]);\n  }\n\n  toggleComment(editor, isSelected, visibility = undefined) {\n    this.#commentManager?.toggleCommentPopup(editor, isSelected, visibility);\n  }\n\n  makeCommentColor(color, opacity) {\n    return (\n      (color && this.#commentManager?.makeCommentColor(color, opacity)) || null\n    );\n  }\n\n  getCommentDialogElement() {\n    return this.#commentManager?.dialogElement || null;\n  }\n\n  async waitForEditorsRendered(pageNumber) {\n    if (this.#allLayers.has(pageNumber - 1)) {\n      return;\n    }\n    const { resolve, promise } = Promise.withResolvers();\n    const onEditorsRendered = evt => {\n      if (evt.pageNumber === pageNumber) {\n        this._eventBus._off(\"editorsrendered\", onEditorsRendered);\n        resolve();\n      }\n    };\n    this._eventBus.on(\"editorsrendered\", onEditorsRendered);\n    await promise;\n  }\n\n  getSignature(editor) {\n    this.#signatureManager?.getSignature({ uiManager: this, editor });\n  }\n\n  get signatureManager() {\n    return this.#signatureManager;\n  }\n\n  switchToMode(mode, callback) {\n    // Switching to a mode can be asynchronous.\n    this._eventBus.on(\"annotationeditormodechanged\", callback, {\n      once: true,\n      signal: this._signal,\n    });\n    this._eventBus.dispatch(\"showannotationeditorui\", {\n      source: this,\n      mode,\n    });\n  }\n\n  setPreference(name, value) {\n    this._eventBus.dispatch(\"setpreference\", {\n      source: this,\n      name,\n      value,\n    });\n  }\n\n  onSetPreference({ name, value }) {\n    switch (name) {\n      case \"enableNewAltTextWhenAddingImage\":\n        this.#enableNewAltTextWhenAddingImage = value;\n        break;\n    }\n  }\n\n  onPageChanging({ pageNumber }) {\n    this.#currentPageIndex = pageNumber - 1;\n  }\n\n  focusMainContainer() {\n    this.#container.focus();\n  }\n\n  findParent(x, y) {\n    for (const layer of this.#allLayers.values()) {\n      const {\n        x: layerX,\n        y: layerY,\n        width,\n        height,\n      } = layer.div.getBoundingClientRect();\n      if (\n        x >= layerX &&\n        x <= layerX + width &&\n        y >= layerY &&\n        y <= layerY + height\n      ) {\n        return layer;\n      }\n    }\n    return null;\n  }\n\n  disableUserSelect(value = false) {\n    this.#viewer.classList.toggle(\"noUserSelect\", value);\n  }\n\n  addShouldRescale(editor) {\n    this.#editorsToRescale.add(editor);\n  }\n\n  removeShouldRescale(editor) {\n    this.#editorsToRescale.delete(editor);\n  }\n\n  onScaleChanging({ scale }) {\n    this.commitOrRemove();\n    this.viewParameters.realScale = scale * PixelsPerInch.PDF_TO_CSS_UNITS;\n    for (const editor of this.#editorsToRescale) {\n      editor.onScaleChanging();\n    }\n    this.#currentDrawingSession?.onScaleChanging();\n  }\n\n  onRotationChanging({ pagesRotation }) {\n    this.commitOrRemove();\n    this.viewParameters.rotation = pagesRotation;\n  }\n\n  #getAnchorElementForSelection({ anchorNode }) {\n    return anchorNode.nodeType === Node.TEXT_NODE\n      ? anchorNode.parentElement\n      : anchorNode;\n  }\n\n  #getLayerForTextLayer(textLayer) {\n    const { currentLayer } = this;\n    if (currentLayer.hasTextLayer(textLayer)) {\n      return currentLayer;\n    }\n    for (const layer of this.#allLayers.values()) {\n      if (layer.hasTextLayer(textLayer)) {\n        return layer;\n      }\n    }\n    return null;\n  }\n\n  highlightSelection(methodOfCreation = \"\", comment = false) {\n    const selection = document.getSelection();\n    if (!selection || selection.isCollapsed) {\n      return;\n    }\n    const { anchorNode, anchorOffset, focusNode, focusOffset } = selection;\n    const text = selection.toString();\n    const anchorElement = this.#getAnchorElementForSelection(selection);\n    const textLayer = anchorElement.closest(\".textLayer\");\n    const boxes = this.getSelectionBoxes(textLayer);\n    if (!boxes) {\n      return;\n    }\n    selection.empty();\n\n    const layer = this.#getLayerForTextLayer(textLayer);\n    const isNoneMode = this.#mode === AnnotationEditorType.NONE;\n    const callback = () => {\n      const editor = layer?.createAndAddNewEditor({ x: 0, y: 0 }, false, {\n        methodOfCreation,\n        boxes,\n        anchorNode,\n        anchorOffset,\n        focusNode,\n        focusOffset,\n        text,\n      });\n      if (isNoneMode) {\n        this.showAllEditors(\"highlight\", true, /* updateButton = */ true);\n      }\n      if (comment) {\n        editor?.editComment();\n      }\n    };\n    if (isNoneMode) {\n      this.switchToMode(AnnotationEditorType.HIGHLIGHT, callback);\n      return;\n    }\n    callback();\n  }\n\n  commentSelection(methodOfCreation = \"\") {\n    this.highlightSelection(methodOfCreation, /* comment */ true);\n  }\n\n  #displayFloatingToolbar() {\n    const selection = document.getSelection();\n    if (!selection || selection.isCollapsed) {\n      return;\n    }\n    const anchorElement = this.#getAnchorElementForSelection(selection);\n    const textLayer = anchorElement.closest(\".textLayer\");\n    const boxes = this.getSelectionBoxes(textLayer);\n    if (!boxes) {\n      return;\n    }\n    this.#floatingToolbar ||= new FloatingToolbar(this);\n    this.#floatingToolbar.show(textLayer, boxes, this.direction === \"ltr\");\n  }\n\n  /**\n   * Some annotations may have been modified in the annotation layer\n   * (e.g. comments added or modified).\n   * So this function retrieves the data from the storage and removes\n   * them from the storage in order to be able to save them later.\n   * @param {string} annotationId\n   * @returns {Object|null} The data associated to the annotation or null.\n   */\n  getAndRemoveDataFromAnnotationStorage(annotationId) {\n    if (!this.#annotationStorage) {\n      return null;\n    }\n    const key = `${AnnotationEditorPrefix}${annotationId}`;\n    const storedValue = this.#annotationStorage.getRawValue(key);\n    if (storedValue) {\n      this.#annotationStorage.remove(key);\n    }\n    return storedValue;\n  }\n\n  /**\n   * Add an editor in the annotation storage.\n   * @param {AnnotationEditor} editor\n   */\n  addToAnnotationStorage(editor) {\n    if (\n      !editor.isEmpty() &&\n      this.#annotationStorage &&\n      !this.#annotationStorage.has(editor.id)\n    ) {\n      this.#annotationStorage.setValue(editor.id, editor);\n    }\n  }\n\n  a11yAlert(messageId, args = null) {\n    const viewerAlert = this.#viewerAlert;\n    if (!viewerAlert) {\n      return;\n    }\n    viewerAlert.setAttribute(\"data-l10n-id\", messageId);\n    if (args) {\n      viewerAlert.setAttribute(\"data-l10n-args\", JSON.stringify(args));\n    } else {\n      viewerAlert.removeAttribute(\"data-l10n-args\");\n    }\n  }\n\n  #selectionChange() {\n    const selection = document.getSelection();\n    if (!selection || selection.isCollapsed) {\n      if (this.#selectedTextNode) {\n        this.#floatingToolbar?.hide();\n        this.#selectedTextNode = null;\n        this.#dispatchUpdateStates({\n          hasSelectedText: false,\n        });\n      }\n      return;\n    }\n    const { anchorNode } = selection;\n    if (anchorNode === this.#selectedTextNode) {\n      return;\n    }\n\n    const anchorElement = this.#getAnchorElementForSelection(selection);\n    const textLayer = anchorElement.closest(\".textLayer\");\n    if (!textLayer) {\n      if (this.#selectedTextNode) {\n        this.#floatingToolbar?.hide();\n        this.#selectedTextNode = null;\n        this.#dispatchUpdateStates({\n          hasSelectedText: false,\n        });\n      }\n      return;\n    }\n\n    this.#floatingToolbar?.hide();\n    this.#selectedTextNode = anchorNode;\n    this.#dispatchUpdateStates({\n      hasSelectedText: true,\n    });\n\n    if (\n      this.#mode !== AnnotationEditorType.HIGHLIGHT &&\n      this.#mode !== AnnotationEditorType.NONE\n    ) {\n      return;\n    }\n\n    if (this.#mode === AnnotationEditorType.HIGHLIGHT) {\n      this.showAllEditors(\"highlight\", true, /* updateButton = */ true);\n    }\n\n    this.#highlightWhenShiftUp = this.isShiftKeyDown;\n    if (!this.isShiftKeyDown) {\n      const activeLayer =\n        this.#mode === AnnotationEditorType.HIGHLIGHT\n          ? this.#getLayerForTextLayer(textLayer)\n          : null;\n      activeLayer?.toggleDrawing();\n\n      if (this.#isPointerDown) {\n        const ac = new AbortController();\n        const signal = this.combinedSignal(ac);\n\n        const pointerup = e => {\n          if (e.type === \"pointerup\" && e.button !== 0) {\n            // Do nothing on right click.\n            return;\n          }\n          ac.abort();\n          activeLayer?.toggleDrawing(true);\n          if (e.type === \"pointerup\") {\n            this.#onSelectEnd(\"main_toolbar\");\n          }\n        };\n        window.addEventListener(\"pointerup\", pointerup, { signal });\n        window.addEventListener(\"blur\", pointerup, { signal });\n      } else {\n        // Here neither the shift key nor the pointer is down and we've\n        // something in the selection: we can be in the case where the user is\n        // using a screen reader (see bug 1976597).\n        activeLayer?.toggleDrawing(true);\n        this.#onSelectEnd(\"main_toolbar\");\n      }\n    }\n  }\n\n  #onSelectEnd(methodOfCreation = \"\") {\n    if (this.#mode === AnnotationEditorType.HIGHLIGHT) {\n      this.highlightSelection(methodOfCreation);\n    } else if (this.#enableHighlightFloatingButton) {\n      this.#displayFloatingToolbar();\n    }\n  }\n\n  #addSelectionListener() {\n    document.addEventListener(\n      \"selectionchange\",\n      this.#selectionChange.bind(this),\n      { signal: this._signal }\n    );\n  }\n\n  #addFocusManager() {\n    if (this.#focusManagerAC) {\n      return;\n    }\n    this.#focusManagerAC = new AbortController();\n    const signal = this.combinedSignal(this.#focusManagerAC);\n\n    window.addEventListener(\"focus\", this.focus.bind(this), { signal });\n    window.addEventListener(\"blur\", this.blur.bind(this), { signal });\n  }\n\n  #removeFocusManager() {\n    this.#focusManagerAC?.abort();\n    this.#focusManagerAC = null;\n  }\n\n  blur() {\n    this.isShiftKeyDown = false;\n    if (this.#highlightWhenShiftUp) {\n      this.#highlightWhenShiftUp = false;\n      this.#onSelectEnd(\"main_toolbar\");\n    }\n    if (!this.hasSelection) {\n      return;\n    }\n    // When several editors are selected and the window loses focus, we want to\n    // keep the last active element in order to be able to focus it again when\n    // the window gets the focus back but we don't want to trigger any focus\n    // callbacks else only one editor will be selected.\n    const { activeElement } = document;\n    for (const editor of this.#selectedEditors) {\n      if (editor.div.contains(activeElement)) {\n        this.#lastActiveElement = [editor, activeElement];\n        editor._focusEventsAllowed = false;\n        break;\n      }\n    }\n  }\n\n  focus() {\n    if (!this.#lastActiveElement) {\n      return;\n    }\n    const [lastEditor, lastActiveElement] = this.#lastActiveElement;\n    this.#lastActiveElement = null;\n    lastActiveElement.addEventListener(\n      \"focusin\",\n      () => {\n        lastEditor._focusEventsAllowed = true;\n      },\n      { once: true, signal: this._signal }\n    );\n    lastActiveElement.focus();\n  }\n\n  #addKeyboardManager() {\n    if (this.#keyboardManagerAC) {\n      return;\n    }\n    this.#keyboardManagerAC = new AbortController();\n    const signal = this.combinedSignal(this.#keyboardManagerAC);\n\n    // The keyboard events are caught at the container level in order to be able\n    // to execute some callbacks even if the current page doesn't have focus.\n    window.addEventListener(\"keydown\", this.keydown.bind(this), { signal });\n    window.addEventListener(\"keyup\", this.keyup.bind(this), { signal });\n  }\n\n  #removeKeyboardManager() {\n    this.#keyboardManagerAC?.abort();\n    this.#keyboardManagerAC = null;\n  }\n\n  #addCopyPasteListeners() {\n    if (this.#copyPasteAC) {\n      return;\n    }\n    this.#copyPasteAC = new AbortController();\n    const signal = this.combinedSignal(this.#copyPasteAC);\n\n    document.addEventListener(\"copy\", this.copy.bind(this), { signal });\n    document.addEventListener(\"cut\", this.cut.bind(this), { signal });\n    document.addEventListener(\"paste\", this.paste.bind(this), { signal });\n  }\n\n  #removeCopyPasteListeners() {\n    this.#copyPasteAC?.abort();\n    this.#copyPasteAC = null;\n  }\n\n  #addDragAndDropListeners() {\n    const signal = this._signal;\n    document.addEventListener(\"dragover\", this.dragOver.bind(this), { signal });\n    document.addEventListener(\"drop\", this.drop.bind(this), { signal });\n  }\n\n  addEditListeners() {\n    this.#addKeyboardManager();\n    this.setEditingState(true);\n  }\n\n  removeEditListeners() {\n    this.#removeKeyboardManager();\n    this.setEditingState(false);\n  }\n\n  dragOver(event) {\n    for (const { type } of event.dataTransfer.items) {\n      for (const editorType of this.#editorTypes) {\n        if (editorType.isHandlingMimeForPasting(type)) {\n          event.dataTransfer.dropEffect = \"copy\";\n          event.preventDefault();\n          return;\n        }\n      }\n    }\n  }\n\n  /**\n   * Drop callback.\n   * @param {DragEvent} event\n   */\n  drop(event) {\n    for (const item of event.dataTransfer.items) {\n      for (const editorType of this.#editorTypes) {\n        if (editorType.isHandlingMimeForPasting(item.type)) {\n          editorType.paste(item, this.currentLayer);\n          event.preventDefault();\n          return;\n        }\n      }\n    }\n  }\n\n  /**\n   * Copy callback.\n   * @param {ClipboardEvent} event\n   */\n  copy(event) {\n    event.preventDefault();\n\n    // An editor is being edited so just commit it.\n    this.#activeEditor?.commitOrRemove();\n\n    if (!this.hasSelection) {\n      return;\n    }\n\n    const editors = [];\n    for (const editor of this.#selectedEditors) {\n      const serialized = editor.serialize(/* isForCopying = */ true);\n      if (serialized) {\n        editors.push(serialized);\n      }\n    }\n    if (editors.length === 0) {\n      return;\n    }\n\n    event.clipboardData.setData(\"application/pdfjs\", JSON.stringify(editors));\n  }\n\n  /**\n   * Cut callback.\n   * @param {ClipboardEvent} event\n   */\n  cut(event) {\n    this.copy(event);\n    this.delete();\n  }\n\n  /**\n   * Paste callback.\n   * @param {ClipboardEvent} event\n   */\n  async paste(event) {\n    event.preventDefault();\n    const { clipboardData } = event;\n    for (const item of clipboardData.items) {\n      for (const editorType of this.#editorTypes) {\n        if (editorType.isHandlingMimeForPasting(item.type)) {\n          editorType.paste(item, this.currentLayer);\n          return;\n        }\n      }\n    }\n\n    let data = clipboardData.getData(\"application/pdfjs\");\n    if (!data) {\n      return;\n    }\n\n    try {\n      data = JSON.parse(data);\n    } catch (ex) {\n      warn(`paste: \"${ex.message}\".`);\n      return;\n    }\n\n    if (!Array.isArray(data)) {\n      return;\n    }\n\n    this.unselectAll();\n    const layer = this.currentLayer;\n\n    try {\n      const newEditors = [];\n      for (const editor of data) {\n        const deserializedEditor = await layer.deserialize(editor);\n        if (!deserializedEditor) {\n          return;\n        }\n        newEditors.push(deserializedEditor);\n      }\n\n      const cmd = () => {\n        for (const editor of newEditors) {\n          this.#addEditorToLayer(editor);\n        }\n        this.#selectEditors(newEditors);\n      };\n      const undo = () => {\n        for (const editor of newEditors) {\n          editor.remove();\n        }\n      };\n      this.addCommands({ cmd, undo, mustExec: true });\n    } catch (ex) {\n      warn(`paste: \"${ex.message}\".`);\n    }\n  }\n\n  /**\n   * Keydown callback.\n   * @param {KeyboardEvent} event\n   */\n  keydown(event) {\n    if (!this.isShiftKeyDown && event.key === \"Shift\") {\n      this.isShiftKeyDown = true;\n    }\n    if (\n      this.#mode !== AnnotationEditorType.NONE &&\n      !this.isEditorHandlingKeyboard\n    ) {\n      AnnotationEditorUIManager._keyboardManager.exec(this, event);\n    }\n  }\n\n  /**\n   * Keyup callback.\n   * @param {KeyboardEvent} event\n   */\n  keyup(event) {\n    if (this.isShiftKeyDown && event.key === \"Shift\") {\n      this.isShiftKeyDown = false;\n      if (this.#highlightWhenShiftUp) {\n        this.#highlightWhenShiftUp = false;\n        this.#onSelectEnd(\"main_toolbar\");\n      }\n    }\n  }\n\n  /**\n   * Execute an action for a given name.\n   * For example, the user can click on the \"Undo\" entry in the context menu\n   * and it'll trigger the undo action.\n   */\n  onEditingAction({ name }) {\n    switch (name) {\n      case \"undo\":\n      case \"redo\":\n      case \"delete\":\n      case \"selectAll\":\n        this[name]();\n        break;\n      case \"highlightSelection\":\n        this.highlightSelection(\"context_menu\");\n        break;\n      case \"commentSelection\":\n        this.commentSelection(\"context_menu\");\n        break;\n    }\n  }\n\n  /**\n   * Update the different possible states of this manager, e.g. is there\n   * something to undo, redo, ...\n   * @param {Object} details\n   */\n  #dispatchUpdateStates(details) {\n    const hasChanged = Object.entries(details).some(\n      ([key, value]) => this.#previousStates[key] !== value\n    );\n\n    if (hasChanged) {\n      this._eventBus.dispatch(\"annotationeditorstateschanged\", {\n        source: this,\n        details: Object.assign(this.#previousStates, details),\n      });\n      // We could listen on our own event but it sounds like a bit weird and\n      // it's a way to simpler to handle that stuff here instead of having to\n      // add something in every place where an editor can be unselected.\n      if (\n        this.#mode === AnnotationEditorType.HIGHLIGHT &&\n        details.hasSelectedEditor === false\n      ) {\n        this.#dispatchUpdateUI([\n          [AnnotationEditorParamsType.HIGHLIGHT_FREE, true],\n        ]);\n      }\n    }\n  }\n\n  #dispatchUpdateUI(details) {\n    this._eventBus.dispatch(\"annotationeditorparamschanged\", {\n      source: this,\n      details,\n    });\n  }\n\n  /**\n   * Set the editing state.\n   * It can be useful to temporarily disable it when the user is editing a\n   * FreeText annotation.\n   * @param {boolean} isEditing\n   */\n  setEditingState(isEditing) {\n    if (isEditing) {\n      this.#addFocusManager();\n      this.#addCopyPasteListeners();\n      this.#dispatchUpdateStates({\n        isEditing: this.#mode !== AnnotationEditorType.NONE,\n        isEmpty: this.#isEmpty(),\n        hasSomethingToUndo: this.#commandManager.hasSomethingToUndo(),\n        hasSomethingToRedo: this.#commandManager.hasSomethingToRedo(),\n        hasSelectedEditor: false,\n      });\n    } else {\n      this.#removeFocusManager();\n      this.#removeCopyPasteListeners();\n      this.#dispatchUpdateStates({\n        isEditing: false,\n      });\n      this.disableUserSelect(false);\n    }\n  }\n\n  registerEditorTypes(types) {\n    if (this.#editorTypes) {\n      return;\n    }\n    this.#editorTypes = types;\n    for (const editorType of this.#editorTypes) {\n      this.#dispatchUpdateUI(editorType.defaultPropertiesToUpdate);\n    }\n  }\n\n  /**\n   * Get an id.\n   * @returns {string}\n   */\n  getId() {\n    return this.#idManager.id;\n  }\n\n  get currentLayer() {\n    return this.#allLayers.get(this.#currentPageIndex);\n  }\n\n  getLayer(pageIndex) {\n    return this.#allLayers.get(pageIndex);\n  }\n\n  get currentPageIndex() {\n    return this.#currentPageIndex;\n  }\n\n  /**\n   * Add a new layer for a page which will contains the editors.\n   * @param {AnnotationEditorLayer} layer\n   */\n  addLayer(layer) {\n    this.#allLayers.set(layer.pageIndex, layer);\n    if (this.#isEnabled) {\n      layer.enable();\n    } else {\n      layer.disable();\n    }\n  }\n\n  /**\n   * Remove a layer.\n   * @param {AnnotationEditorLayer} layer\n   */\n  removeLayer(layer) {\n    this.#allLayers.delete(layer.pageIndex);\n  }\n\n  /**\n   * Change the editor mode (None, FreeText, Ink, ...)\n   * @param {number} mode\n   * @param {string|null} editId\n   * @param {boolean} [isFromUser] - true if the mode change is due to a\n   *   user action.\n   * @param {boolean} [isFromKeyboard] - true if the mode change is due to a\n   *   keyboard action.\n   * @param {boolean} [mustEnterInEditMode] - true if the editor must enter in\n   *   edit mode.\n   * @param {boolean} [editComment] - true if the mode change is due to a\n   *   comment edit.\n   */\n  async updateMode(\n    mode,\n    editId = null,\n    isFromUser = false,\n    isFromKeyboard = false,\n    mustEnterInEditMode = false,\n    editComment = false\n  ) {\n    if (this.#mode === mode) {\n      return;\n    }\n\n    if (this.#updateModeCapability) {\n      await this.#updateModeCapability.promise;\n      if (!this.#updateModeCapability) {\n        // This ui manager has been destroyed.\n        return;\n      }\n    }\n\n    this.#updateModeCapability = Promise.withResolvers();\n    this.#currentDrawingSession?.commitOrRemove();\n\n    if (this.#mode === AnnotationEditorType.POPUP) {\n      this.#commentManager?.hideSidebar();\n    }\n    this.#commentManager?.destroyPopup();\n\n    this.#mode = mode;\n    if (mode === AnnotationEditorType.NONE) {\n      this.setEditingState(false);\n      this.#disableAll();\n      for (const editor of this.#allEditors.values()) {\n        editor.hideStandaloneCommentButton();\n      }\n\n      this._editorUndoBar?.hide();\n      this.toggleComment(/* editor = */ null);\n\n      this.#updateModeCapability.resolve();\n      return;\n    }\n\n    for (const editor of this.#allEditors.values()) {\n      editor.addStandaloneCommentButton();\n    }\n\n    if (mode === AnnotationEditorType.SIGNATURE) {\n      await this.#signatureManager?.loadSignatures();\n    }\n\n    if (isFromUser) {\n      // reinitialize the pointer type when the mode is changed by the user\n      CurrentPointers.clearPointerType();\n    }\n\n    this.setEditingState(true);\n    await this.#enableAll();\n    this.unselectAll();\n    for (const layer of this.#allLayers.values()) {\n      layer.updateMode(mode);\n    }\n\n    if (mode === AnnotationEditorType.POPUP) {\n      this.#allEditableAnnotations ||=\n        await this.#pdfDocument.getAnnotationsByType(\n          new Set(this.#editorTypes.map(editorClass => editorClass._editorType))\n        );\n      const elementIds = new Set();\n      const allComments = [];\n      for (const editor of this.#allEditors.values()) {\n        const { annotationElementId, hasComment, deleted } = editor;\n        if (annotationElementId) {\n          elementIds.add(annotationElementId);\n        }\n        if (hasComment && !deleted) {\n          allComments.push(editor.getData());\n        }\n      }\n      for (const annotation of this.#allEditableAnnotations) {\n        const { id, popupRef, contentsObj } = annotation;\n        if (\n          popupRef &&\n          contentsObj?.str &&\n          !elementIds.has(id) &&\n          !this.#deletedAnnotationsElementIds.has(id)\n        ) {\n          // The annotation exists in the PDF and has a comment but there\n          // is no editor for it (anymore).\n          allComments.push(annotation);\n        }\n      }\n      this.#commentManager?.showSidebar(allComments);\n    }\n\n    if (!editId) {\n      if (isFromKeyboard) {\n        this.addNewEditorFromKeyboard();\n      }\n\n      this.#updateModeCapability.resolve();\n      return;\n    }\n\n    for (const editor of this.#allEditors.values()) {\n      if (editor.uid === editId) {\n        this.setSelected(editor);\n        if (editComment) {\n          editor.editComment();\n        } else if (mustEnterInEditMode) {\n          editor.enterInEditMode();\n        } else {\n          editor.focus();\n        }\n      } else {\n        editor.unselect();\n      }\n    }\n\n    this.#updateModeCapability.resolve();\n  }\n\n  addNewEditorFromKeyboard() {\n    if (this.currentLayer.canCreateNewEmptyEditor()) {\n      this.currentLayer.addNewEditor();\n    }\n  }\n\n  /**\n   * Update the toolbar if it's required to reflect the tool currently used.\n   * @param {Object} options\n   * @param {number} mode\n   * @returns {undefined}\n   */\n  updateToolbar(options) {\n    if (options.mode === this.#mode) {\n      return;\n    }\n    this._eventBus.dispatch(\"switchannotationeditormode\", {\n      source: this,\n      ...options,\n    });\n  }\n\n  /**\n   * Update a parameter in the current editor or globally.\n   * @param {number} type\n   * @param {*} value\n   */\n  updateParams(type, value) {\n    if (!this.#editorTypes) {\n      return;\n    }\n\n    switch (type) {\n      case AnnotationEditorParamsType.CREATE:\n        this.currentLayer.addNewEditor(value);\n        return;\n      case AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL:\n        this._eventBus.dispatch(\"reporttelemetry\", {\n          source: this,\n          details: {\n            type: \"editing\",\n            data: {\n              type: \"highlight\",\n              action: \"toggle_visibility\",\n            },\n          },\n        });\n        (this.#showAllStates ||= new Map()).set(type, value);\n        this.showAllEditors(\"highlight\", value);\n        break;\n    }\n\n    if (this.hasSelection) {\n      for (const editor of this.#selectedEditors) {\n        editor.updateParams(type, value);\n      }\n    } else {\n      for (const editorType of this.#editorTypes) {\n        editorType.updateDefaultParams(type, value);\n      }\n    }\n  }\n\n  showAllEditors(type, visible, updateButton = false) {\n    for (const editor of this.#allEditors.values()) {\n      if (editor.editorType === type) {\n        editor.show(visible);\n      }\n    }\n    const state =\n      this.#showAllStates?.get(AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL) ??\n      true;\n    if (state !== visible) {\n      this.#dispatchUpdateUI([\n        [AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL, visible],\n      ]);\n    }\n  }\n\n  enableWaiting(mustWait = false) {\n    if (this.#isWaiting === mustWait) {\n      return;\n    }\n    this.#isWaiting = mustWait;\n    for (const layer of this.#allLayers.values()) {\n      if (mustWait) {\n        layer.disableClick();\n      } else {\n        layer.enableClick();\n      }\n      layer.div.classList.toggle(\"waiting\", mustWait);\n    }\n  }\n\n  /**\n   * Enable all the layers.\n   */\n  async #enableAll() {\n    if (!this.#isEnabled) {\n      this.#isEnabled = true;\n      const promises = [];\n      for (const layer of this.#allLayers.values()) {\n        promises.push(layer.enable());\n      }\n      await Promise.all(promises);\n      for (const editor of this.#allEditors.values()) {\n        editor.enable();\n      }\n    }\n  }\n\n  /**\n   * Disable all the layers.\n   */\n  #disableAll() {\n    this.unselectAll();\n    if (this.#isEnabled) {\n      this.#isEnabled = false;\n      for (const layer of this.#allLayers.values()) {\n        layer.disable();\n      }\n      for (const editor of this.#allEditors.values()) {\n        editor.disable();\n      }\n    }\n  }\n\n  /**\n   * Get all the editors belonging to a given page.\n   * @param {number} pageIndex\n   * @yields {AnnotationEditor}\n   */\n  *getEditors(pageIndex) {\n    for (const editor of this.#allEditors.values()) {\n      if (editor.pageIndex === pageIndex) {\n        yield editor;\n      }\n    }\n  }\n\n  /**\n   * Get an editor with the given id.\n   * @param {string} id\n   * @returns {AnnotationEditor}\n   */\n  getEditor(id) {\n    return this.#allEditors.get(id);\n  }\n\n  /**\n   * Add a new editor.\n   * @param {AnnotationEditor} editor\n   */\n  addEditor(editor) {\n    this.#allEditors.set(editor.id, editor);\n  }\n\n  /**\n   * Remove an editor.\n   * @param {AnnotationEditor} editor\n   */\n  removeEditor(editor) {\n    if (editor.div.contains(document.activeElement)) {\n      if (this.#focusMainContainerTimeoutId) {\n        clearTimeout(this.#focusMainContainerTimeoutId);\n      }\n      this.#focusMainContainerTimeoutId = setTimeout(() => {\n        // When the div is removed from DOM the focus can move on the\n        // document.body, so we need to move it back to the main container.\n        this.focusMainContainer();\n        this.#focusMainContainerTimeoutId = null;\n      }, 0);\n    }\n    this.#allEditors.delete(editor.id);\n    if (editor.annotationElementId) {\n      this.#missingCanvases?.delete(editor.annotationElementId);\n    }\n    this.unselect(editor);\n    if (\n      !editor.annotationElementId ||\n      !this.#deletedAnnotationsElementIds.has(editor.annotationElementId)\n    ) {\n      this.#annotationStorage?.remove(editor.id);\n    }\n  }\n\n  /**\n   * The annotation element with the given id has been deleted.\n   * @param {AnnotationEditor} editor\n   */\n  addDeletedAnnotationElement(editor) {\n    this.#deletedAnnotationsElementIds.add(editor.annotationElementId);\n    this.addChangedExistingAnnotation(editor);\n    editor.deleted = true;\n  }\n\n  /**\n   * Check if the annotation element with the given id has been deleted.\n   * @param {string} annotationElementId\n   * @returns {boolean}\n   */\n  isDeletedAnnotationElement(annotationElementId) {\n    return this.#deletedAnnotationsElementIds.has(annotationElementId);\n  }\n\n  /**\n   * The annotation element with the given id have been restored.\n   * @param {AnnotationEditor} editor\n   */\n  removeDeletedAnnotationElement(editor) {\n    this.#deletedAnnotationsElementIds.delete(editor.annotationElementId);\n    this.removeChangedExistingAnnotation(editor);\n    editor.deleted = false;\n  }\n\n  /**\n   * Add an editor to the layer it belongs to or add it to the global map.\n   * @param {AnnotationEditor} editor\n   */\n  #addEditorToLayer(editor) {\n    const layer = this.#allLayers.get(editor.pageIndex);\n    if (layer) {\n      layer.addOrRebuild(editor);\n    } else {\n      this.addEditor(editor);\n      this.addToAnnotationStorage(editor);\n    }\n  }\n\n  /**\n   * Set the given editor as the active one.\n   * @param {AnnotationEditor} editor\n   */\n  setActiveEditor(editor) {\n    if (this.#activeEditor === editor) {\n      return;\n    }\n\n    this.#activeEditor = editor;\n    if (editor) {\n      this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    }\n  }\n\n  get #lastSelectedEditor() {\n    let ed = null;\n    for (ed of this.#selectedEditors) {\n      // Iterate to get the last element.\n    }\n    return ed;\n  }\n\n  /**\n   * Update the UI of the active editor.\n   * @param {AnnotationEditor} editor\n   */\n  updateUI(editor) {\n    if (this.#lastSelectedEditor === editor) {\n      this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    }\n  }\n\n  updateUIForDefaultProperties(editorType) {\n    this.#dispatchUpdateUI(editorType.defaultPropertiesToUpdate);\n  }\n\n  /**\n   * Add or remove an editor the current selection.\n   * @param {AnnotationEditor} editor\n   */\n  toggleSelected(editor) {\n    if (this.#selectedEditors.has(editor)) {\n      this.#selectedEditors.delete(editor);\n      editor.unselect();\n      this.#dispatchUpdateStates({\n        hasSelectedEditor: this.hasSelection,\n      });\n      return;\n    }\n    this.#selectedEditors.add(editor);\n    editor.select();\n    this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: true,\n    });\n  }\n\n  /**\n   * Set the last selected editor.\n   * @param {AnnotationEditor} editor\n   */\n  setSelected(editor) {\n    this.updateToolbar({\n      mode: editor.mode,\n      editId: editor.uid,\n    });\n\n    this.#currentDrawingSession?.commitOrRemove();\n    for (const ed of this.#selectedEditors) {\n      if (ed !== editor) {\n        ed.unselect();\n      }\n    }\n    this.#selectedEditors.clear();\n\n    this.#selectedEditors.add(editor);\n    editor.select();\n    this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: true,\n    });\n  }\n\n  /**\n   * Check if the editor is selected.\n   * @param {AnnotationEditor} editor\n   */\n  isSelected(editor) {\n    return this.#selectedEditors.has(editor);\n  }\n\n  get firstSelectedEditor() {\n    return this.#selectedEditors.values().next().value;\n  }\n\n  /**\n   * Unselect an editor.\n   * @param {AnnotationEditor} editor\n   */\n  unselect(editor) {\n    editor.unselect();\n    this.#selectedEditors.delete(editor);\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: this.hasSelection,\n    });\n  }\n\n  get hasSelection() {\n    return this.#selectedEditors.size !== 0;\n  }\n\n  get isEnterHandled() {\n    return (\n      this.#selectedEditors.size === 1 &&\n      this.firstSelectedEditor.isEnterHandled\n    );\n  }\n\n  /**\n   * Undo the last command.\n   */\n  undo() {\n    this.#commandManager.undo();\n    this.#dispatchUpdateStates({\n      hasSomethingToUndo: this.#commandManager.hasSomethingToUndo(),\n      hasSomethingToRedo: true,\n      isEmpty: this.#isEmpty(),\n    });\n    this._editorUndoBar?.hide();\n  }\n\n  /**\n   * Redo the last undoed command.\n   */\n  redo() {\n    this.#commandManager.redo();\n    this.#dispatchUpdateStates({\n      hasSomethingToUndo: true,\n      hasSomethingToRedo: this.#commandManager.hasSomethingToRedo(),\n      isEmpty: this.#isEmpty(),\n    });\n  }\n\n  /**\n   * Add a command to execute (cmd) and another one to undo it.\n   * @param {Object} params\n   */\n  addCommands(params) {\n    this.#commandManager.add(params);\n    this.#dispatchUpdateStates({\n      hasSomethingToUndo: true,\n      hasSomethingToRedo: false,\n      isEmpty: this.#isEmpty(),\n    });\n  }\n\n  cleanUndoStack(type) {\n    this.#commandManager.cleanType(type);\n  }\n\n  #isEmpty() {\n    if (this.#allEditors.size === 0) {\n      return true;\n    }\n\n    if (this.#allEditors.size === 1) {\n      for (const editor of this.#allEditors.values()) {\n        return editor.isEmpty();\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Delete the current editor or all.\n   */\n  delete() {\n    this.commitOrRemove();\n    const drawingEditor = this.currentLayer?.endDrawingSession(\n      /* isAborted = */ true\n    );\n    if (!this.hasSelection && !drawingEditor) {\n      return;\n    }\n\n    const editors = drawingEditor\n      ? [drawingEditor]\n      : [...this.#selectedEditors];\n    const cmd = () => {\n      this._editorUndoBar?.show(\n        undo,\n        editors.length === 1 ? editors[0].editorType : editors.length\n      );\n      for (const editor of editors) {\n        editor.remove();\n      }\n    };\n    const undo = () => {\n      for (const editor of editors) {\n        this.#addEditorToLayer(editor);\n      }\n    };\n\n    this.addCommands({ cmd, undo, mustExec: true });\n  }\n\n  commitOrRemove() {\n    // An editor is being edited so just commit it.\n    this.#activeEditor?.commitOrRemove();\n  }\n\n  hasSomethingToControl() {\n    return this.#activeEditor || this.hasSelection;\n  }\n\n  /**\n   * Select the editors.\n   * @param {Array<AnnotationEditor>} editors\n   */\n  #selectEditors(editors) {\n    for (const editor of this.#selectedEditors) {\n      editor.unselect();\n    }\n    this.#selectedEditors.clear();\n    for (const editor of editors) {\n      if (editor.isEmpty()) {\n        continue;\n      }\n      this.#selectedEditors.add(editor);\n      editor.select();\n    }\n    this.#dispatchUpdateStates({ hasSelectedEditor: this.hasSelection });\n  }\n\n  /**\n   * Select all the editors.\n   */\n  selectAll() {\n    for (const editor of this.#selectedEditors) {\n      editor.commit();\n    }\n    this.#selectEditors(this.#allEditors.values());\n  }\n\n  /**\n   * Unselect all the selected editors.\n   */\n  unselectAll() {\n    if (this.#activeEditor) {\n      // An editor is being edited so just commit it.\n      this.#activeEditor.commitOrRemove();\n      if (this.#mode !== AnnotationEditorType.NONE) {\n        // If the mode is NONE, we want to really unselect the editor, hence we\n        // mustn't return here.\n        return;\n      }\n    }\n\n    if (this.#currentDrawingSession?.commitOrRemove()) {\n      return;\n    }\n\n    if (!this.hasSelection) {\n      return;\n    }\n    for (const editor of this.#selectedEditors) {\n      editor.unselect();\n    }\n    this.#selectedEditors.clear();\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: false,\n    });\n  }\n\n  translateSelectedEditors(x, y, noCommit = false) {\n    if (!noCommit) {\n      this.commitOrRemove();\n    }\n    if (!this.hasSelection) {\n      return;\n    }\n\n    this.#translation[0] += x;\n    this.#translation[1] += y;\n    const [totalX, totalY] = this.#translation;\n    const editors = [...this.#selectedEditors];\n\n    // We don't want to have an undo/redo for each translation so we wait a bit\n    // before adding the command to the command manager.\n    const TIME_TO_WAIT = 1000;\n\n    if (this.#translationTimeoutId) {\n      clearTimeout(this.#translationTimeoutId);\n    }\n\n    this.#translationTimeoutId = setTimeout(() => {\n      this.#translationTimeoutId = null;\n      this.#translation[0] = this.#translation[1] = 0;\n\n      this.addCommands({\n        cmd: () => {\n          for (const editor of editors) {\n            if (this.#allEditors.has(editor.id)) {\n              editor.translateInPage(totalX, totalY);\n              editor.translationDone();\n            }\n          }\n        },\n        undo: () => {\n          for (const editor of editors) {\n            if (this.#allEditors.has(editor.id)) {\n              editor.translateInPage(-totalX, -totalY);\n              editor.translationDone();\n            }\n          }\n        },\n        mustExec: false,\n      });\n    }, TIME_TO_WAIT);\n\n    for (const editor of editors) {\n      editor.translateInPage(x, y);\n      editor.translationDone();\n    }\n  }\n\n  /**\n   * Set up the drag session for moving the selected editors.\n   */\n  setUpDragSession() {\n    // Note: don't use any references to the editor's parent which can be null\n    // if the editor belongs to a destroyed page.\n    if (!this.hasSelection) {\n      return;\n    }\n    // Avoid to have spurious text selection in the text layer when dragging.\n    this.disableUserSelect(true);\n    this.#draggingEditors = new Map();\n    for (const editor of this.#selectedEditors) {\n      this.#draggingEditors.set(editor, {\n        savedX: editor.x,\n        savedY: editor.y,\n        savedPageIndex: editor.pageIndex,\n        newX: 0,\n        newY: 0,\n        newPageIndex: -1,\n      });\n    }\n  }\n\n  /**\n   * Ends the drag session.\n   * @returns {boolean} true if at least one editor has been moved.\n   */\n  endDragSession() {\n    if (!this.#draggingEditors) {\n      return false;\n    }\n    this.disableUserSelect(false);\n    const map = this.#draggingEditors;\n    this.#draggingEditors = null;\n    let mustBeAddedInUndoStack = false;\n\n    for (const [{ x, y, pageIndex }, value] of map) {\n      value.newX = x;\n      value.newY = y;\n      value.newPageIndex = pageIndex;\n      mustBeAddedInUndoStack ||=\n        x !== value.savedX ||\n        y !== value.savedY ||\n        pageIndex !== value.savedPageIndex;\n    }\n\n    if (!mustBeAddedInUndoStack) {\n      return false;\n    }\n\n    const move = (editor, x, y, pageIndex) => {\n      if (this.#allEditors.has(editor.id)) {\n        // The editor can be undone/redone on a page which is not visible (and\n        // which potentially has no annotation editor layer), hence we need to\n        // use the pageIndex instead of the parent.\n        const parent = this.#allLayers.get(pageIndex);\n        if (parent) {\n          editor._setParentAndPosition(parent, x, y);\n        } else {\n          editor.pageIndex = pageIndex;\n          editor.x = x;\n          editor.y = y;\n        }\n      }\n    };\n\n    this.addCommands({\n      cmd: () => {\n        for (const [editor, { newX, newY, newPageIndex }] of map) {\n          move(editor, newX, newY, newPageIndex);\n        }\n      },\n      undo: () => {\n        for (const [editor, { savedX, savedY, savedPageIndex }] of map) {\n          move(editor, savedX, savedY, savedPageIndex);\n        }\n      },\n      mustExec: true,\n    });\n\n    return true;\n  }\n\n  /**\n   * Drag the set of selected editors.\n   * @param {number} tx\n   * @param {number} ty\n   */\n  dragSelectedEditors(tx, ty) {\n    if (!this.#draggingEditors) {\n      return;\n    }\n    for (const editor of this.#draggingEditors.keys()) {\n      editor.drag(tx, ty);\n    }\n  }\n\n  /**\n   * Rebuild the editor (usually on undo/redo actions) on a potentially\n   * non-rendered page.\n   * @param {AnnotationEditor} editor\n   */\n  rebuild(editor) {\n    if (editor.parent === null) {\n      const parent = this.getLayer(editor.pageIndex);\n      if (parent) {\n        parent.changeParent(editor);\n        parent.addOrRebuild(editor);\n      } else {\n        this.addEditor(editor);\n        this.addToAnnotationStorage(editor);\n        editor.rebuild();\n      }\n    } else {\n      editor.parent.addOrRebuild(editor);\n    }\n  }\n\n  get isEditorHandlingKeyboard() {\n    return (\n      this.getActive()?.shouldGetKeyboardEvents() ||\n      (this.#selectedEditors.size === 1 &&\n        this.firstSelectedEditor.shouldGetKeyboardEvents())\n    );\n  }\n\n  /**\n   * Is the current editor the one passed as argument?\n   * @param {AnnotationEditor} editor\n   * @returns\n   */\n  isActive(editor) {\n    return this.#activeEditor === editor;\n  }\n\n  /**\n   * Get the current active editor.\n   * @returns {AnnotationEditor|null}\n   */\n  getActive() {\n    return this.#activeEditor;\n  }\n\n  /**\n   * Get the current editor mode.\n   * @returns {number}\n   */\n  getMode() {\n    return this.#mode;\n  }\n\n  isEditingMode() {\n    return this.#mode !== AnnotationEditorType.NONE;\n  }\n\n  get imageManager() {\n    return shadow(this, \"imageManager\", new ImageManager());\n  }\n\n  getSelectionBoxes(textLayer) {\n    if (!textLayer) {\n      return null;\n    }\n    const selection = document.getSelection();\n    for (let i = 0, ii = selection.rangeCount; i < ii; i++) {\n      if (\n        !textLayer.contains(selection.getRangeAt(i).commonAncestorContainer)\n      ) {\n        return null;\n      }\n    }\n\n    const {\n      x: layerX,\n      y: layerY,\n      width: parentWidth,\n      height: parentHeight,\n    } = textLayer.getBoundingClientRect();\n\n    // We must rotate the boxes because we want to have them in the non-rotated\n    // page coordinates.\n    let rotator;\n    switch (textLayer.getAttribute(\"data-main-rotation\")) {\n      case \"90\":\n        rotator = (x, y, w, h) => ({\n          x: (y - layerY) / parentHeight,\n          y: 1 - (x + w - layerX) / parentWidth,\n          width: h / parentHeight,\n          height: w / parentWidth,\n        });\n        break;\n      case \"180\":\n        rotator = (x, y, w, h) => ({\n          x: 1 - (x + w - layerX) / parentWidth,\n          y: 1 - (y + h - layerY) / parentHeight,\n          width: w / parentWidth,\n          height: h / parentHeight,\n        });\n        break;\n      case \"270\":\n        rotator = (x, y, w, h) => ({\n          x: 1 - (y + h - layerY) / parentHeight,\n          y: (x - layerX) / parentWidth,\n          width: h / parentHeight,\n          height: w / parentWidth,\n        });\n        break;\n      default:\n        rotator = (x, y, w, h) => ({\n          x: (x - layerX) / parentWidth,\n          y: (y - layerY) / parentHeight,\n          width: w / parentWidth,\n          height: h / parentHeight,\n        });\n        break;\n    }\n\n    const boxes = [];\n    for (let i = 0, ii = selection.rangeCount; i < ii; i++) {\n      const range = selection.getRangeAt(i);\n      if (range.collapsed) {\n        continue;\n      }\n      for (const { x, y, width, height } of range.getClientRects()) {\n        if (width === 0 || height === 0) {\n          continue;\n        }\n        boxes.push(rotator(x, y, width, height));\n      }\n    }\n    return boxes.length === 0 ? null : boxes;\n  }\n\n  addChangedExistingAnnotation({ annotationElementId, id }) {\n    (this.#changedExistingAnnotations ||= new Map()).set(\n      annotationElementId,\n      id\n    );\n  }\n\n  removeChangedExistingAnnotation({ annotationElementId }) {\n    this.#changedExistingAnnotations?.delete(annotationElementId);\n  }\n\n  renderAnnotationElement(annotation) {\n    const editorId = this.#changedExistingAnnotations?.get(annotation.data.id);\n    if (!editorId) {\n      return;\n    }\n    const editor = this.#annotationStorage.getRawValue(editorId);\n    if (!editor) {\n      return;\n    }\n    if (this.#mode === AnnotationEditorType.NONE && !editor.hasBeenModified) {\n      return;\n    }\n    editor.renderAnnotationElement(annotation);\n  }\n\n  setMissingCanvas(annotationId, annotationElementId, canvas) {\n    const editor = this.#missingCanvases?.get(annotationId);\n    if (!editor) {\n      return;\n    }\n    editor.setCanvas(annotationElementId, canvas);\n    this.#missingCanvases.delete(annotationId);\n  }\n\n  addMissingCanvas(annotationId, editor) {\n    (this.#missingCanvases ||= new Map()).set(annotationId, editor);\n  }\n}\n\nexport {\n  AnnotationEditorUIManager,\n  bindEvents,\n  ColorManager,\n  CommandManager,\n  CurrentPointers,\n  KeyboardManager,\n};\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { noContextMenu } from \"../display_utils.js\";\n\nclass AltText {\n  #altText = null;\n\n  #altTextDecorative = false;\n\n  #altTextButton = null;\n\n  #altTextButtonLabel = null;\n\n  #altTextTooltip = null;\n\n  #altTextTooltipTimeout = null;\n\n  #altTextWasFromKeyBoard = false;\n\n  #badge = null;\n\n  #editor = null;\n\n  #guessedText = null;\n\n  #textWithDisclaimer = null;\n\n  #useNewAltTextFlow = false;\n\n  static #l10nNewButton = null;\n\n  static _l10n = null;\n\n  constructor(editor) {\n    this.#editor = editor;\n    this.#useNewAltTextFlow = editor._uiManager.useNewAltTextFlow;\n\n    AltText.#l10nNewButton ||= Object.freeze({\n      added: \"pdfjs-editor-new-alt-text-added-button\",\n      \"added-label\": \"pdfjs-editor-new-alt-text-added-button-label\",\n      missing: \"pdfjs-editor-new-alt-text-missing-button\",\n      \"missing-label\": \"pdfjs-editor-new-alt-text-missing-button-label\",\n      review: \"pdfjs-editor-new-alt-text-to-review-button\",\n      \"review-label\": \"pdfjs-editor-new-alt-text-to-review-button-label\",\n    });\n  }\n\n  static initialize(l10n) {\n    AltText._l10n ??= l10n;\n  }\n\n  async render() {\n    const altText = (this.#altTextButton = document.createElement(\"button\"));\n    altText.className = \"altText\";\n    altText.tabIndex = \"0\";\n\n    const label = (this.#altTextButtonLabel = document.createElement(\"span\"));\n    altText.append(label);\n\n    if (this.#useNewAltTextFlow) {\n      altText.classList.add(\"new\");\n      altText.setAttribute(\"data-l10n-id\", AltText.#l10nNewButton.missing);\n      label.setAttribute(\n        \"data-l10n-id\",\n        AltText.#l10nNewButton[\"missing-label\"]\n      );\n    } else {\n      altText.setAttribute(\"data-l10n-id\", \"pdfjs-editor-alt-text-button\");\n      label.setAttribute(\"data-l10n-id\", \"pdfjs-editor-alt-text-button-label\");\n    }\n\n    const signal = this.#editor._uiManager._signal;\n    altText.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    altText.addEventListener(\"pointerdown\", event => event.stopPropagation(), {\n      signal,\n    });\n\n    const onClick = event => {\n      event.preventDefault();\n      this.#editor._uiManager.editAltText(this.#editor);\n      if (this.#useNewAltTextFlow) {\n        this.#editor._reportTelemetry({\n          action: \"pdfjs.image.alt_text.image_status_label_clicked\",\n          data: { label: this.#label },\n        });\n      }\n    };\n    altText.addEventListener(\"click\", onClick, { capture: true, signal });\n    altText.addEventListener(\n      \"keydown\",\n      event => {\n        if (event.target === altText && event.key === \"Enter\") {\n          this.#altTextWasFromKeyBoard = true;\n          onClick(event);\n        }\n      },\n      { signal }\n    );\n    await this.#setState();\n\n    return altText;\n  }\n\n  get #label() {\n    return (\n      (this.#altText && \"added\") ||\n      (this.#altText === null && this.guessedText && \"review\") ||\n      \"missing\"\n    );\n  }\n\n  finish() {\n    if (!this.#altTextButton) {\n      return;\n    }\n    this.#altTextButton.focus({ focusVisible: this.#altTextWasFromKeyBoard });\n    this.#altTextWasFromKeyBoard = false;\n  }\n\n  isEmpty() {\n    if (this.#useNewAltTextFlow) {\n      return this.#altText === null;\n    }\n    return !this.#altText && !this.#altTextDecorative;\n  }\n\n  hasData() {\n    if (this.#useNewAltTextFlow) {\n      return this.#altText !== null || !!this.#guessedText;\n    }\n    return this.isEmpty();\n  }\n\n  get guessedText() {\n    return this.#guessedText;\n  }\n\n  async setGuessedText(guessedText) {\n    if (this.#altText !== null) {\n      // The user provided their own alt text, so we don't want to overwrite it.\n      return;\n    }\n    this.#guessedText = guessedText;\n    this.#textWithDisclaimer = await AltText._l10n.get(\n      \"pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer\",\n      { generatedAltText: guessedText }\n    );\n    this.#setState();\n  }\n\n  toggleAltTextBadge(visibility = false) {\n    if (!this.#useNewAltTextFlow || this.#altText) {\n      this.#badge?.remove();\n      this.#badge = null;\n      return;\n    }\n    if (!this.#badge) {\n      const badge = (this.#badge = document.createElement(\"div\"));\n      badge.className = \"noAltTextBadge\";\n      this.#editor.div.append(badge);\n    }\n    this.#badge.classList.toggle(\"hidden\", !visibility);\n  }\n\n  serialize(isForCopying) {\n    let altText = this.#altText;\n    if (!isForCopying && this.#guessedText === altText) {\n      altText = this.#textWithDisclaimer;\n    }\n    return {\n      altText,\n      decorative: this.#altTextDecorative,\n      guessedText: this.#guessedText,\n      textWithDisclaimer: this.#textWithDisclaimer,\n    };\n  }\n\n  get data() {\n    return {\n      altText: this.#altText,\n      decorative: this.#altTextDecorative,\n    };\n  }\n\n  /**\n   * Set the alt text data.\n   */\n  set data({\n    altText,\n    decorative,\n    guessedText,\n    textWithDisclaimer,\n    cancel = false,\n  }) {\n    if (guessedText) {\n      this.#guessedText = guessedText;\n      this.#textWithDisclaimer = textWithDisclaimer;\n    }\n    if (this.#altText === altText && this.#altTextDecorative === decorative) {\n      return;\n    }\n    if (!cancel) {\n      this.#altText = altText;\n      this.#altTextDecorative = decorative;\n    }\n    this.#setState();\n  }\n\n  toggle(enabled = false) {\n    if (!this.#altTextButton) {\n      return;\n    }\n    if (!enabled && this.#altTextTooltipTimeout) {\n      clearTimeout(this.#altTextTooltipTimeout);\n      this.#altTextTooltipTimeout = null;\n    }\n    this.#altTextButton.disabled = !enabled;\n  }\n\n  shown() {\n    this.#editor._reportTelemetry({\n      action: \"pdfjs.image.alt_text.image_status_label_displayed\",\n      data: { label: this.#label },\n    });\n  }\n\n  destroy() {\n    this.#altTextButton?.remove();\n    this.#altTextButton = null;\n    this.#altTextButtonLabel = null;\n    this.#altTextTooltip = null;\n    this.#badge?.remove();\n    this.#badge = null;\n  }\n\n  async #setState() {\n    const button = this.#altTextButton;\n    if (!button) {\n      return;\n    }\n\n    if (this.#useNewAltTextFlow) {\n      button.classList.toggle(\"done\", !!this.#altText);\n      button.setAttribute(\"data-l10n-id\", AltText.#l10nNewButton[this.#label]);\n\n      this.#altTextButtonLabel?.setAttribute(\n        \"data-l10n-id\",\n        AltText.#l10nNewButton[`${this.#label}-label`]\n      );\n      if (!this.#altText) {\n        this.#altTextTooltip?.remove();\n        return;\n      }\n    } else {\n      if (!this.#altText && !this.#altTextDecorative) {\n        button.classList.remove(\"done\");\n        this.#altTextTooltip?.remove();\n        return;\n      }\n      button.classList.add(\"done\");\n      button.setAttribute(\"data-l10n-id\", \"pdfjs-editor-alt-text-edit-button\");\n    }\n\n    let tooltip = this.#altTextTooltip;\n    if (!tooltip) {\n      this.#altTextTooltip = tooltip = document.createElement(\"span\");\n      tooltip.className = \"tooltip\";\n      tooltip.setAttribute(\"role\", \"tooltip\");\n      tooltip.id = `alt-text-tooltip-${this.#editor.id}`;\n\n      const DELAY_TO_SHOW_TOOLTIP = 100;\n      const signal = this.#editor._uiManager._signal;\n      signal.addEventListener(\n        \"abort\",\n        () => {\n          clearTimeout(this.#altTextTooltipTimeout);\n          this.#altTextTooltipTimeout = null;\n        },\n        { once: true }\n      );\n      button.addEventListener(\n        \"mouseenter\",\n        () => {\n          this.#altTextTooltipTimeout = setTimeout(() => {\n            this.#altTextTooltipTimeout = null;\n            this.#altTextTooltip.classList.add(\"show\");\n            this.#editor._reportTelemetry({\n              action: \"alt_text_tooltip\",\n            });\n          }, DELAY_TO_SHOW_TOOLTIP);\n        },\n        { signal }\n      );\n      button.addEventListener(\n        \"mouseleave\",\n        () => {\n          if (this.#altTextTooltipTimeout) {\n            clearTimeout(this.#altTextTooltipTimeout);\n            this.#altTextTooltipTimeout = null;\n          }\n          this.#altTextTooltip?.classList.remove(\"show\");\n        },\n        { signal }\n      );\n    }\n    if (this.#altTextDecorative) {\n      tooltip.setAttribute(\n        \"data-l10n-id\",\n        \"pdfjs-editor-alt-text-decorative-tooltip\"\n      );\n    } else {\n      tooltip.removeAttribute(\"data-l10n-id\");\n      tooltip.textContent = this.#altText;\n    }\n\n    if (!tooltip.parentNode) {\n      button.append(tooltip);\n    }\n\n    const element = this.#editor.getElementForAltText();\n    element?.setAttribute(\"aria-describedby\", tooltip.id);\n  }\n}\n\nexport { AltText };\n","/* Copyright 2025 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { noContextMenu, stopEvent } from \"../display_utils.js\";\n\nclass Comment {\n  #commentStandaloneButton = null;\n\n  #commentToolbarButton = null;\n\n  #commentWasFromKeyBoard = false;\n\n  #editor = null;\n\n  #initialText = null;\n\n  #richText = null;\n\n  #text = null;\n\n  #date = null;\n\n  #deleted = false;\n\n  #popupPosition = null;\n\n  constructor(editor) {\n    this.#editor = editor;\n  }\n\n  renderForToolbar() {\n    const button = (this.#commentToolbarButton =\n      document.createElement(\"button\"));\n    button.className = \"comment\";\n    return this.#render(button, false);\n  }\n\n  renderForStandalone() {\n    const button = (this.#commentStandaloneButton =\n      document.createElement(\"button\"));\n    button.className = \"annotationCommentButton\";\n\n    const position = this.#editor.commentButtonPosition;\n    if (position) {\n      const { style } = button;\n      style.insetInlineEnd = `calc(${\n        100 *\n        (this.#editor._uiManager.direction === \"ltr\"\n          ? 1 - position[0]\n          : position[0])\n      }% - var(--comment-button-dim))`;\n      style.top = `calc(${100 * position[1]}% - var(--comment-button-dim))`;\n      const color = this.#editor.commentButtonColor;\n      if (color) {\n        style.backgroundColor = color;\n      }\n    }\n\n    return this.#render(button, true);\n  }\n\n  focusButton() {\n    setTimeout(() => {\n      (this.#commentStandaloneButton ?? this.#commentToolbarButton)?.focus();\n    }, 0);\n  }\n\n  onUpdatedColor() {\n    if (!this.#commentStandaloneButton) {\n      return;\n    }\n    const color = this.#editor.commentButtonColor;\n    if (color) {\n      this.#commentStandaloneButton.style.backgroundColor = color;\n    }\n    this.#editor._uiManager.updatePopupColor(this.#editor);\n  }\n\n  get commentButtonWidth() {\n    return (\n      (this.#commentStandaloneButton?.getBoundingClientRect().width ?? 0) /\n      this.#editor.parent.boundingClientRect.width\n    );\n  }\n\n  get commentPopupPositionInLayer() {\n    if (this.#popupPosition) {\n      return this.#popupPosition;\n    }\n    if (!this.#commentStandaloneButton) {\n      return null;\n    }\n    const { x, y, height } =\n      this.#commentStandaloneButton.getBoundingClientRect();\n    const {\n      x: parentX,\n      y: parentY,\n      width: parentWidth,\n      height: parentHeight,\n    } = this.#editor.parent.boundingClientRect;\n    return [(x - parentX) / parentWidth, (y + height - parentY) / parentHeight];\n  }\n\n  set commentPopupPositionInLayer(pos) {\n    this.#popupPosition = pos;\n  }\n\n  hasDefaultPopupPosition() {\n    return this.#popupPosition === null;\n  }\n\n  removeStandaloneCommentButton() {\n    this.#commentStandaloneButton?.remove();\n    this.#commentStandaloneButton = null;\n  }\n\n  removeToolbarCommentButton() {\n    this.#commentToolbarButton?.remove();\n    this.#commentToolbarButton = null;\n  }\n\n  setCommentButtonStates({ selected, hasPopup }) {\n    if (!this.#commentStandaloneButton) {\n      return;\n    }\n    this.#commentStandaloneButton.classList.toggle(\"selected\", selected);\n    this.#commentStandaloneButton.ariaExpanded = hasPopup;\n  }\n\n  #render(comment, isStandalone) {\n    if (!this.#editor._uiManager.hasCommentManager()) {\n      return null;\n    }\n\n    comment.tabIndex = \"0\";\n    comment.ariaHasPopup = \"dialog\";\n\n    if (isStandalone) {\n      comment.ariaControls = \"commentPopup\";\n      comment.setAttribute(\"data-l10n-id\", \"pdfjs-show-comment-button\");\n    } else {\n      comment.ariaControlsElements = [\n        this.#editor._uiManager.getCommentDialogElement(),\n      ];\n      comment.setAttribute(\"data-l10n-id\", \"pdfjs-editor-add-comment-button\");\n    }\n\n    const signal = this.#editor._uiManager._signal;\n    if (!(signal instanceof AbortSignal) || signal.aborted) {\n      return comment;\n    }\n\n    comment.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    if (isStandalone) {\n      comment.addEventListener(\n        \"focusin\",\n        e => {\n          this.#editor._focusEventsAllowed = false;\n          stopEvent(e);\n        },\n        {\n          capture: true,\n          signal,\n        }\n      );\n      comment.addEventListener(\n        \"focusout\",\n        e => {\n          this.#editor._focusEventsAllowed = true;\n          stopEvent(e);\n        },\n        {\n          capture: true,\n          signal,\n        }\n      );\n    }\n    comment.addEventListener(\"pointerdown\", event => event.stopPropagation(), {\n      signal,\n    });\n\n    const onClick = event => {\n      event.preventDefault();\n      if (comment === this.#commentToolbarButton) {\n        this.edit();\n      } else {\n        this.#editor.toggleComment(/* isSelected = */ true);\n      }\n    };\n    comment.addEventListener(\"click\", onClick, { capture: true, signal });\n    comment.addEventListener(\n      \"keydown\",\n      event => {\n        if (event.target === comment && event.key === \"Enter\") {\n          this.#commentWasFromKeyBoard = true;\n          onClick(event);\n        }\n      },\n      { signal }\n    );\n\n    comment.addEventListener(\n      \"pointerenter\",\n      () => {\n        this.#editor.toggleComment(\n          /* isSelected = */ false,\n          /* visibility = */ true\n        );\n      },\n      { signal }\n    );\n    comment.addEventListener(\n      \"pointerleave\",\n      () => {\n        this.#editor.toggleComment(\n          /* isSelected = */ false,\n          /* visibility = */ false\n        );\n      },\n      { signal }\n    );\n\n    return comment;\n  }\n\n  edit(options) {\n    const position = this.commentPopupPositionInLayer;\n    let posX, posY;\n    if (position) {\n      [posX, posY] = position;\n    } else {\n      // The position is in the editor coordinates.\n      [posX, posY] = this.#editor.commentButtonPosition;\n      const { width, height, x, y } = this.#editor;\n      posX = x + posX * width;\n      posY = y + posY * height;\n    }\n    const parentDimensions = this.#editor.parent.boundingClientRect;\n    const {\n      x: parentX,\n      y: parentY,\n      width: parentWidth,\n      height: parentHeight,\n    } = parentDimensions;\n    this.#editor._uiManager.editComment(\n      this.#editor,\n      parentX + posX * parentWidth,\n      parentY + posY * parentHeight,\n      { ...options, parentDimensions }\n    );\n  }\n\n  finish() {\n    if (!this.#commentToolbarButton) {\n      return;\n    }\n    this.#commentToolbarButton.focus({\n      focusVisible: this.#commentWasFromKeyBoard,\n    });\n    this.#commentWasFromKeyBoard = false;\n  }\n\n  isDeleted() {\n    return this.#deleted || this.#text === \"\";\n  }\n\n  isEmpty() {\n    return this.#text === null;\n  }\n\n  hasBeenEdited() {\n    return this.isDeleted() || this.#text !== this.#initialText;\n  }\n\n  serialize() {\n    return this.data;\n  }\n\n  get data() {\n    return {\n      text: this.#text,\n      richText: this.#richText,\n      date: this.#date,\n      deleted: this.isDeleted(),\n    };\n  }\n\n  /**\n   * Set the comment data.\n   */\n  set data(text) {\n    if (text !== this.#text) {\n      this.#richText = null;\n    }\n    if (text === null) {\n      this.#text = \"\";\n      this.#deleted = true;\n      return;\n    }\n    this.#text = text;\n    this.#date = new Date();\n    this.#deleted = false;\n  }\n\n  setInitialText(text, richText = null) {\n    this.#initialText = text;\n    this.data = text;\n    this.#date = null;\n    this.#richText = richText;\n  }\n\n  shown() {}\n\n  destroy() {\n    this.#commentToolbarButton?.remove();\n    this.#commentToolbarButton = null;\n    this.#commentStandaloneButton?.remove();\n    this.#commentStandaloneButton = null;\n    this.#text = \"\";\n    this.#richText = null;\n    this.#date = null;\n    this.#editor = null;\n    this.#commentWasFromKeyBoard = false;\n    this.#deleted = false;\n  }\n}\n\nexport { Comment };\n","/* Copyright 2024 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { OutputScale, stopEvent } from \"./display_utils.js\";\n\nclass TouchManager {\n  #container;\n\n  #isPinching = false;\n\n  #isPinchingStopped = null;\n\n  #isPinchingDisabled;\n\n  #onPinchStart;\n\n  #onPinching;\n\n  #onPinchEnd;\n\n  #pointerDownAC = null;\n\n  #signal;\n\n  #touchInfo = null;\n\n  #touchManagerAC;\n\n  #touchMoveAC = null;\n\n  constructor({\n    container,\n    isPinchingDisabled = null,\n    isPinchingStopped = null,\n    onPinchStart = null,\n    onPinching = null,\n    onPinchEnd = null,\n    signal,\n  }) {\n    this.#container = container;\n    this.#isPinchingStopped = isPinchingStopped;\n    this.#isPinchingDisabled = isPinchingDisabled;\n    this.#onPinchStart = onPinchStart;\n    this.#onPinching = onPinching;\n    this.#onPinchEnd = onPinchEnd;\n    this.#touchManagerAC = new AbortController();\n    this.#signal = AbortSignal.any([signal, this.#touchManagerAC.signal]);\n\n    container.addEventListener(\"touchstart\", this.#onTouchStart.bind(this), {\n      passive: false,\n      signal: this.#signal,\n    });\n  }\n\n  /**\n   * NOTE: Don't shadow this value since `devicePixelRatio` may change if the\n   * window resolution changes, e.g. if the viewer is moved to another monitor.\n   */\n  get MIN_TOUCH_DISTANCE_TO_PINCH() {\n    // The 35 is coming from:\n    //  https://searchfox.org/mozilla-central/source/gfx/layers/apz/src/GestureEventListener.cpp#36\n    //\n    // The properties TouchEvent::screenX/Y are in screen CSS pixels:\n    //  https://developer.mozilla.org/en-US/docs/Web/API/Touch/screenX#examples\n    // MIN_TOUCH_DISTANCE_TO_PINCH is in CSS pixels.\n    return 35 / OutputScale.pixelRatio;\n  }\n\n  #onTouchStart(evt) {\n    if (this.#isPinchingDisabled?.()) {\n      return;\n    }\n\n    if (evt.touches.length === 1) {\n      if (this.#pointerDownAC) {\n        return;\n      }\n      const pointerDownAC = (this.#pointerDownAC = new AbortController());\n      const signal = AbortSignal.any([this.#signal, pointerDownAC.signal]);\n      const container = this.#container;\n\n      // We want to have the events at the capture phase to make sure we can\n      // cancel them.\n      const opts = { capture: true, signal, passive: false };\n      const cancelPointerDown = e => {\n        if (e.pointerType === \"touch\") {\n          this.#pointerDownAC?.abort();\n          this.#pointerDownAC = null;\n        }\n      };\n      container.addEventListener(\n        \"pointerdown\",\n        e => {\n          if (e.pointerType === \"touch\") {\n            // This is the second finger so we don't want it select something\n            // or whatever.\n            stopEvent(e);\n            cancelPointerDown(e);\n          }\n        },\n        opts\n      );\n      container.addEventListener(\"pointerup\", cancelPointerDown, opts);\n      container.addEventListener(\"pointercancel\", cancelPointerDown, opts);\n      return;\n    }\n\n    if (!this.#touchMoveAC) {\n      this.#touchMoveAC = new AbortController();\n      const signal = AbortSignal.any([this.#signal, this.#touchMoveAC.signal]);\n      const container = this.#container;\n\n      const opt = { signal, capture: false, passive: false };\n      container.addEventListener(\n        \"touchmove\",\n        this.#onTouchMove.bind(this),\n        opt\n      );\n      const onTouchEnd = this.#onTouchEnd.bind(this);\n      container.addEventListener(\"touchend\", onTouchEnd, opt);\n      container.addEventListener(\"touchcancel\", onTouchEnd, opt);\n\n      opt.capture = true;\n      container.addEventListener(\"pointerdown\", stopEvent, opt);\n      container.addEventListener(\"pointermove\", stopEvent, opt);\n      container.addEventListener(\"pointercancel\", stopEvent, opt);\n      container.addEventListener(\"pointerup\", stopEvent, opt);\n      this.#onPinchStart?.();\n    }\n\n    stopEvent(evt);\n\n    if (evt.touches.length !== 2 || this.#isPinchingStopped?.()) {\n      this.#touchInfo = null;\n      return;\n    }\n\n    let [touch0, touch1] = evt.touches;\n    if (touch0.identifier > touch1.identifier) {\n      [touch0, touch1] = [touch1, touch0];\n    }\n    this.#touchInfo = {\n      touch0X: touch0.screenX,\n      touch0Y: touch0.screenY,\n      touch1X: touch1.screenX,\n      touch1Y: touch1.screenY,\n    };\n  }\n\n  #onTouchMove(evt) {\n    if (!this.#touchInfo || evt.touches.length !== 2) {\n      return;\n    }\n\n    stopEvent(evt);\n\n    let [touch0, touch1] = evt.touches;\n    if (touch0.identifier > touch1.identifier) {\n      [touch0, touch1] = [touch1, touch0];\n    }\n    const { screenX: screen0X, screenY: screen0Y } = touch0;\n    const { screenX: screen1X, screenY: screen1Y } = touch1;\n    const touchInfo = this.#touchInfo;\n    const {\n      touch0X: pTouch0X,\n      touch0Y: pTouch0Y,\n      touch1X: pTouch1X,\n      touch1Y: pTouch1Y,\n    } = touchInfo;\n\n    const prevGapX = pTouch1X - pTouch0X;\n    const prevGapY = pTouch1Y - pTouch0Y;\n    const currGapX = screen1X - screen0X;\n    const currGapY = screen1Y - screen0Y;\n\n    const distance = Math.hypot(currGapX, currGapY) || 1;\n    const pDistance = Math.hypot(prevGapX, prevGapY) || 1;\n    if (\n      !this.#isPinching &&\n      Math.abs(pDistance - distance) <= TouchManager.MIN_TOUCH_DISTANCE_TO_PINCH\n    ) {\n      return;\n    }\n\n    touchInfo.touch0X = screen0X;\n    touchInfo.touch0Y = screen0Y;\n    touchInfo.touch1X = screen1X;\n    touchInfo.touch1Y = screen1Y;\n\n    if (!this.#isPinching) {\n      // Start pinching.\n      this.#isPinching = true;\n\n      // We return here else the first pinch is a bit too much\n      return;\n    }\n\n    const origin = [(screen0X + screen1X) / 2, (screen0Y + screen1Y) / 2];\n    this.#onPinching?.(origin, pDistance, distance);\n  }\n\n  #onTouchEnd(evt) {\n    if (evt.touches.length >= 2) {\n      return;\n    }\n    // #touchMoveAC shouldn't be null but it seems that irl it can (see #19793).\n    if (this.#touchMoveAC) {\n      this.#touchMoveAC.abort();\n      this.#touchMoveAC = null;\n      this.#onPinchEnd?.();\n    }\n\n    if (!this.#touchInfo) {\n      return;\n    }\n    stopEvent(evt);\n    this.#touchInfo = null;\n    this.#isPinching = false;\n  }\n\n  destroy() {\n    this.#touchManagerAC?.abort();\n    this.#touchManagerAC = null;\n    this.#pointerDownAC?.abort();\n    this.#pointerDownAC = null;\n  }\n}\n\nexport { TouchManager };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_editor_layer.js\").AnnotationEditorLayer} AnnotationEditorLayer */\n\nimport {\n  AnnotationEditorUIManager,\n  bindEvents,\n  ColorManager,\n  KeyboardManager,\n} from \"./tools.js\";\nimport {\n  FeatureTest,\n  MathClamp,\n  shadow,\n  unreachable,\n} from \"../../shared/util.js\";\nimport { noContextMenu, stopEvent } from \"../display_utils.js\";\nimport { AltText } from \"./alt_text.js\";\nimport { Comment } from \"./comment.js\";\nimport { EditorToolbar } from \"./toolbar.js\";\nimport { TouchManager } from \"../touch_manager.js\";\n\n/**\n * @typedef {Object} AnnotationEditorParameters\n * @property {AnnotationEditorUIManager} uiManager - the global manager\n * @property {AnnotationEditorLayer} parent - the layer containing this editor\n * @property {string} id - editor id\n * @property {number} x - x-coordinate\n * @property {number} y - y-coordinate\n */\n\n/**\n * Base class for editors.\n */\nclass AnnotationEditor {\n  #accessibilityData = null;\n\n  #allResizerDivs = null;\n\n  #altText = null;\n\n  #comment = null;\n\n  #commentStandaloneButton = null;\n\n  #disabled = false;\n\n  #dragPointerId = null;\n\n  #dragPointerType = \"\";\n\n  #resizersDiv = null;\n\n  #lastPointerCoords = null;\n\n  #savedDimensions = null;\n\n  #fakeAnnotation = null;\n\n  #focusAC = null;\n\n  #focusedResizerName = \"\";\n\n  #hasBeenClicked = false;\n\n  #initialRect = null;\n\n  #isEditing = false;\n\n  #isInEditMode = false;\n\n  #isResizerEnabledForKeyboard = false;\n\n  #moveInDOMTimeout = null;\n\n  #prevDragX = 0;\n\n  #prevDragY = 0;\n\n  #telemetryTimeouts = null;\n\n  #touchManager = null;\n\n  isSelected = false;\n\n  _isCopy = false;\n\n  _editToolbar = null;\n\n  _initialOptions = Object.create(null);\n\n  _initialData = null;\n\n  _isVisible = true;\n\n  _uiManager = null;\n\n  _focusEventsAllowed = true;\n\n  static _l10n = null;\n\n  static _l10nResizer = null;\n\n  #isDraggable = false;\n\n  #zIndex = AnnotationEditor._zIndex++;\n\n  static _borderLineWidth = -1;\n\n  static _colorManager = new ColorManager();\n\n  static _zIndex = 1;\n\n  // Time to wait (in ms) before sending the telemetry data.\n  // We wait a bit to avoid sending too many requests when changing something\n  // like the thickness of a line.\n  static _telemetryTimeout = 1000;\n\n  static get _resizerKeyboardManager() {\n    const resize = AnnotationEditor.prototype._resizeWithKeyboard;\n    const small = AnnotationEditorUIManager.TRANSLATE_SMALL;\n    const big = AnnotationEditorUIManager.TRANSLATE_BIG;\n\n    return shadow(\n      this,\n      \"_resizerKeyboardManager\",\n      new KeyboardManager([\n        [[\"ArrowLeft\", \"mac+ArrowLeft\"], resize, { args: [-small, 0] }],\n        [\n          [\"ctrl+ArrowLeft\", \"mac+shift+ArrowLeft\"],\n          resize,\n          { args: [-big, 0] },\n        ],\n        [[\"ArrowRight\", \"mac+ArrowRight\"], resize, { args: [small, 0] }],\n        [\n          [\"ctrl+ArrowRight\", \"mac+shift+ArrowRight\"],\n          resize,\n          { args: [big, 0] },\n        ],\n        [[\"ArrowUp\", \"mac+ArrowUp\"], resize, { args: [0, -small] }],\n        [[\"ctrl+ArrowUp\", \"mac+shift+ArrowUp\"], resize, { args: [0, -big] }],\n        [[\"ArrowDown\", \"mac+ArrowDown\"], resize, { args: [0, small] }],\n        [[\"ctrl+ArrowDown\", \"mac+shift+ArrowDown\"], resize, { args: [0, big] }],\n        [\n          [\"Escape\", \"mac+Escape\"],\n          AnnotationEditor.prototype._stopResizingWithKeyboard,\n        ],\n      ])\n    );\n  }\n\n  /**\n   * @param {AnnotationEditorParameters} parameters\n   */\n  constructor(parameters) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === AnnotationEditor\n    ) {\n      unreachable(\"Cannot initialize AnnotationEditor.\");\n    }\n\n    this.parent = parameters.parent;\n    this.id = parameters.id;\n    this.width = this.height = null;\n    this.pageIndex = parameters.parent.pageIndex;\n    this.name = parameters.name;\n    this.div = null;\n    this._uiManager = parameters.uiManager;\n    this.annotationElementId = null;\n    this._willKeepAspectRatio = false;\n    this._initialOptions.isCentered = parameters.isCentered;\n    this._structTreeParentId = null;\n    this.annotationElementId = parameters.annotationElementId || null;\n    this.creationDate = parameters.creationDate || new Date();\n    this.modificationDate = parameters.modificationDate || null;\n    this.canAddComment = true;\n\n    const {\n      rotation,\n      rawDims: { pageWidth, pageHeight, pageX, pageY },\n    } = this.parent.viewport;\n\n    this.rotation = rotation;\n    this.pageRotation =\n      (360 + rotation - this._uiManager.viewParameters.rotation) % 360;\n    this.pageDimensions = [pageWidth, pageHeight];\n    this.pageTranslation = [pageX, pageY];\n\n    const [width, height] = this.parentDimensions;\n    this.x = parameters.x / width;\n    this.y = parameters.y / height;\n\n    this.isAttachedToDOM = false;\n    this.deleted = false;\n  }\n\n  get editorType() {\n    return Object.getPrototypeOf(this).constructor._type;\n  }\n\n  get mode() {\n    return Object.getPrototypeOf(this).constructor._editorType;\n  }\n\n  static get isDrawer() {\n    return false;\n  }\n\n  static get _defaultLineColor() {\n    return shadow(\n      this,\n      \"_defaultLineColor\",\n      this._colorManager.getHexCode(\"CanvasText\")\n    );\n  }\n\n  static deleteAnnotationElement(editor) {\n    const fakeEditor = new FakeEditor({\n      id: editor.parent.getNextId(),\n      parent: editor.parent,\n      uiManager: editor._uiManager,\n    });\n    fakeEditor.annotationElementId = editor.annotationElementId;\n    fakeEditor.deleted = true;\n    fakeEditor._uiManager.addToAnnotationStorage(fakeEditor);\n  }\n\n  /**\n   * Initialize the l10n stuff for this type of editor.\n   * @param {Object} l10n\n   */\n  static initialize(l10n, _uiManager) {\n    AnnotationEditor._l10n ??= l10n;\n\n    AnnotationEditor._l10nResizer ||= Object.freeze({\n      topLeft: \"pdfjs-editor-resizer-top-left\",\n      topMiddle: \"pdfjs-editor-resizer-top-middle\",\n      topRight: \"pdfjs-editor-resizer-top-right\",\n      middleRight: \"pdfjs-editor-resizer-middle-right\",\n      bottomRight: \"pdfjs-editor-resizer-bottom-right\",\n      bottomMiddle: \"pdfjs-editor-resizer-bottom-middle\",\n      bottomLeft: \"pdfjs-editor-resizer-bottom-left\",\n      middleLeft: \"pdfjs-editor-resizer-middle-left\",\n    });\n\n    if (AnnotationEditor._borderLineWidth !== -1) {\n      return;\n    }\n    const style = getComputedStyle(document.documentElement);\n    AnnotationEditor._borderLineWidth =\n      parseFloat(style.getPropertyValue(\"--outline-width\")) || 0;\n  }\n\n  /**\n   * Update the default parameters for this type of editor.\n   * @param {number} _type\n   * @param {*} _value\n   */\n  static updateDefaultParams(_type, _value) {}\n\n  /**\n   * Get the default properties to set in the UI for this type of editor.\n   * @returns {Array}\n   */\n  static get defaultPropertiesToUpdate() {\n    return [];\n  }\n\n  /**\n   * Check if this kind of editor is able to handle the given mime type for\n   * pasting.\n   * @param {string} mime\n   * @returns {boolean}\n   */\n  static isHandlingMimeForPasting(mime) {\n    return false;\n  }\n\n  /**\n   * Extract the data from the clipboard item and delegate the creation of the\n   * editor to the parent.\n   * @param {DataTransferItem} item\n   * @param {AnnotationEditorLayer} parent\n   */\n  static paste(item, parent) {\n    unreachable(\"Not implemented\");\n  }\n\n  /**\n   * Get the properties to update in the UI for this editor.\n   * @returns {Array}\n   */\n  get propertiesToUpdate() {\n    return [];\n  }\n\n  get _isDraggable() {\n    return this.#isDraggable;\n  }\n\n  set _isDraggable(value) {\n    this.#isDraggable = value;\n    this.div?.classList.toggle(\"draggable\", value);\n  }\n\n  get uid() {\n    return this.annotationElementId || this.id;\n  }\n\n  /**\n   * @returns {boolean} true if the editor handles the Enter key itself.\n   */\n  get isEnterHandled() {\n    return true;\n  }\n\n  center() {\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    switch (this.parentRotation) {\n      case 90:\n        this.x -= (this.height * pageHeight) / (pageWidth * 2);\n        this.y += (this.width * pageWidth) / (pageHeight * 2);\n        break;\n      case 180:\n        this.x += this.width / 2;\n        this.y += this.height / 2;\n        break;\n      case 270:\n        this.x += (this.height * pageHeight) / (pageWidth * 2);\n        this.y -= (this.width * pageWidth) / (pageHeight * 2);\n        break;\n      default:\n        this.x -= this.width / 2;\n        this.y -= this.height / 2;\n        break;\n    }\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Add some commands into the CommandManager (undo/redo stuff).\n   * @param {Object} params\n   */\n  addCommands(params) {\n    this._uiManager.addCommands(params);\n  }\n\n  get currentLayer() {\n    return this._uiManager.currentLayer;\n  }\n\n  /**\n   * This editor will be behind the others.\n   */\n  setInBackground() {\n    this.div.style.zIndex = 0;\n  }\n\n  /**\n   * This editor will be in the foreground.\n   */\n  setInForeground() {\n    this.div.style.zIndex = this.#zIndex;\n  }\n\n  setParent(parent) {\n    if (parent !== null) {\n      this.pageIndex = parent.pageIndex;\n      this.pageDimensions = parent.pageDimensions;\n    } else {\n      // The editor is being removed from the DOM, so we need to stop resizing.\n      this.#stopResizing();\n\n      // Remove the fake annotation in the annotation layer.\n      this.#fakeAnnotation?.remove();\n      this.#fakeAnnotation = null;\n    }\n    this.parent = parent;\n  }\n\n  /**\n   * onfocus callback.\n   */\n  focusin(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n    if (!this.#hasBeenClicked) {\n      this.parent.setSelected(this);\n    } else {\n      this.#hasBeenClicked = false;\n    }\n  }\n\n  /**\n   * onblur callback.\n   * @param {FocusEvent} event\n   */\n  focusout(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n\n    if (!this.isAttachedToDOM) {\n      return;\n    }\n\n    // In case of focusout, the relatedTarget is the element which\n    // is grabbing the focus.\n    // So if the related target is an element under the div for this\n    // editor, then the editor isn't unactive.\n    const target = event.relatedTarget;\n    if (target?.closest(`#${this.id}`)) {\n      return;\n    }\n\n    event.preventDefault();\n\n    if (!this.parent?.isMultipleSelection) {\n      this.commitOrRemove();\n    }\n  }\n\n  commitOrRemove() {\n    if (this.isEmpty()) {\n      this.remove();\n    } else {\n      this.commit();\n    }\n  }\n\n  /**\n   * Commit the data contained in this editor.\n   */\n  commit() {\n    if (!this.isInEditMode()) {\n      return;\n    }\n    this.addToAnnotationStorage();\n  }\n\n  addToAnnotationStorage() {\n    this._uiManager.addToAnnotationStorage(this);\n  }\n\n  /**\n   * Set the editor position within its parent.\n   * @param {number} x\n   * @param {number} y\n   * @param {number} tx - x-translation in screen coordinates.\n   * @param {number} ty - y-translation in screen coordinates.\n   */\n  setAt(x, y, tx, ty) {\n    const [width, height] = this.parentDimensions;\n    [tx, ty] = this.screenToPageTranslation(tx, ty);\n\n    this.x = (x + tx) / width;\n    this.y = (y + ty) / height;\n\n    this.fixAndSetPosition();\n  }\n\n  _moveAfterPaste(baseX, baseY) {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.setAt(\n      baseX * parentWidth,\n      baseY * parentHeight,\n      this.width * parentWidth,\n      this.height * parentHeight\n    );\n    this._onTranslated();\n  }\n\n  #translate([width, height], x, y) {\n    [x, y] = this.screenToPageTranslation(x, y);\n\n    this.x += x / width;\n    this.y += y / height;\n\n    this._onTranslating(this.x, this.y);\n\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Translate the editor position within its parent.\n   * @param {number} x - x-translation in screen coordinates.\n   * @param {number} y - y-translation in screen coordinates.\n   */\n  translate(x, y) {\n    // We don't change the initial position because the move here hasn't been\n    // done by the user.\n    this.#translate(this.parentDimensions, x, y);\n  }\n\n  /**\n   * Translate the editor position within its page and adjust the scroll\n   * in order to have the editor in the view.\n   * @param {number} x - x-translation in page coordinates.\n   * @param {number} y - y-translation in page coordinates.\n   */\n  translateInPage(x, y) {\n    this.#initialRect ||= [this.x, this.y, this.width, this.height];\n    this.#translate(this.pageDimensions, x, y);\n    this.div.scrollIntoView({ block: \"nearest\" });\n  }\n\n  translationDone() {\n    this._onTranslated(this.x, this.y);\n  }\n\n  drag(tx, ty) {\n    this.#initialRect ||= [this.x, this.y, this.width, this.height];\n    const {\n      div,\n      parentDimensions: [parentWidth, parentHeight],\n    } = this;\n    this.x += tx / parentWidth;\n    this.y += ty / parentHeight;\n    if (this.parent && (this.x < 0 || this.x > 1 || this.y < 0 || this.y > 1)) {\n      // It's possible to not have a parent: for example, when the user is\n      // dragging all the selected editors but this one on a page which has been\n      // destroyed.\n      // It's why we need to check for it. In such a situation, it isn't really\n      // a problem to not find a new parent: it's something which is related to\n      // what the user is seeing, hence it depends on how pages are layed out.\n\n      // The element will be outside of its parent so change the parent.\n      const { x, y } = this.div.getBoundingClientRect();\n      if (this.parent.findNewParent(this, x, y)) {\n        this.x -= Math.floor(this.x);\n        this.y -= Math.floor(this.y);\n      }\n    }\n\n    // The editor can be moved wherever the user wants, so we don't need to fix\n    // the position: it'll be done when the user will release the mouse button.\n\n    let { x, y } = this;\n    const [bx, by] = this.getBaseTranslation();\n    x += bx;\n    y += by;\n\n    const { style } = div;\n    style.left = `${(100 * x).toFixed(2)}%`;\n    style.top = `${(100 * y).toFixed(2)}%`;\n\n    this._onTranslating(x, y);\n\n    div.scrollIntoView({ block: \"nearest\" });\n  }\n\n  /**\n   * Called when the editor is being translated.\n   * @param {number} x - in page coordinates.\n   * @param {number} y - in page coordinates.\n   */\n  _onTranslating(x, y) {}\n\n  /**\n   * Called when the editor has been translated.\n   * @param {number} x - in page coordinates.\n   * @param {number} y - in page coordinates.\n   */\n  _onTranslated(x, y) {}\n\n  get _hasBeenMoved() {\n    return (\n      !!this.#initialRect &&\n      (this.#initialRect[0] !== this.x || this.#initialRect[1] !== this.y)\n    );\n  }\n\n  get _hasBeenResized() {\n    return (\n      !!this.#initialRect &&\n      (this.#initialRect[2] !== this.width ||\n        this.#initialRect[3] !== this.height)\n    );\n  }\n\n  /**\n   * Get the translation to take into account the editor border.\n   * The CSS engine positions the element by taking the border into account so\n   * we must apply the opposite translation to have the editor in the right\n   * position.\n   * @returns {Array<number>}\n   */\n  getBaseTranslation() {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const { _borderLineWidth } = AnnotationEditor;\n    const x = _borderLineWidth / parentWidth;\n    const y = _borderLineWidth / parentHeight;\n    switch (this.rotation) {\n      case 90:\n        return [-x, y];\n      case 180:\n        return [x, y];\n      case 270:\n        return [x, -y];\n      default:\n        return [-x, -y];\n    }\n  }\n\n  /**\n   * @returns {boolean} true if position must be fixed (i.e. make the x and y\n   * living in the page).\n   */\n  get _mustFixPosition() {\n    return true;\n  }\n\n  /**\n   * Fix the position of the editor in order to keep it inside its parent page.\n   * @param {number} [rotation] - the rotation of the page.\n   */\n  fixAndSetPosition(rotation = this.rotation) {\n    const {\n      div: { style },\n      pageDimensions: [pageWidth, pageHeight],\n    } = this;\n    let { x, y, width, height } = this;\n    width *= pageWidth;\n    height *= pageHeight;\n    x *= pageWidth;\n    y *= pageHeight;\n\n    if (this._mustFixPosition) {\n      switch (rotation) {\n        case 0:\n          x = MathClamp(x, 0, pageWidth - width);\n          y = MathClamp(y, 0, pageHeight - height);\n          break;\n        case 90:\n          x = MathClamp(x, 0, pageWidth - height);\n          y = MathClamp(y, width, pageHeight);\n          break;\n        case 180:\n          x = MathClamp(x, width, pageWidth);\n          y = MathClamp(y, height, pageHeight);\n          break;\n        case 270:\n          x = MathClamp(x, height, pageWidth);\n          y = MathClamp(y, 0, pageHeight - width);\n          break;\n      }\n    }\n\n    this.x = x /= pageWidth;\n    this.y = y /= pageHeight;\n\n    const [bx, by] = this.getBaseTranslation();\n    x += bx;\n    y += by;\n\n    style.left = `${(100 * x).toFixed(2)}%`;\n    style.top = `${(100 * y).toFixed(2)}%`;\n\n    this.moveInDOM();\n  }\n\n  static #rotatePoint(x, y, angle) {\n    switch (angle) {\n      case 90:\n        return [y, -x];\n      case 180:\n        return [-x, -y];\n      case 270:\n        return [-y, x];\n      default:\n        return [x, y];\n    }\n  }\n\n  /**\n   * Convert a screen translation into a page one.\n   * @param {number} x\n   * @param {number} y\n   */\n  screenToPageTranslation(x, y) {\n    return AnnotationEditor.#rotatePoint(x, y, this.parentRotation);\n  }\n\n  /**\n   * Convert a page translation into a screen one.\n   * @param {number} x\n   * @param {number} y\n   */\n  pageTranslationToScreen(x, y) {\n    return AnnotationEditor.#rotatePoint(x, y, 360 - this.parentRotation);\n  }\n\n  #getRotationMatrix(rotation) {\n    switch (rotation) {\n      case 90: {\n        const [pageWidth, pageHeight] = this.pageDimensions;\n        return [0, -pageWidth / pageHeight, pageHeight / pageWidth, 0];\n      }\n      case 180:\n        return [-1, 0, 0, -1];\n      case 270: {\n        const [pageWidth, pageHeight] = this.pageDimensions;\n        return [0, pageWidth / pageHeight, -pageHeight / pageWidth, 0];\n      }\n      default:\n        return [1, 0, 0, 1];\n    }\n  }\n\n  get parentScale() {\n    return this._uiManager.viewParameters.realScale;\n  }\n\n  get parentRotation() {\n    return (this._uiManager.viewParameters.rotation + this.pageRotation) % 360;\n  }\n\n  get parentDimensions() {\n    const {\n      parentScale,\n      pageDimensions: [pageWidth, pageHeight],\n    } = this;\n    return [pageWidth * parentScale, pageHeight * parentScale];\n  }\n\n  /**\n   * Set the dimensions of this editor.\n   */\n  setDims() {\n    const {\n      div: { style },\n      width,\n      height,\n    } = this;\n    style.width = `${(100 * width).toFixed(2)}%`;\n    style.height = `${(100 * height).toFixed(2)}%`;\n  }\n\n  /**\n   * Get the translation used to position this editor when it's created.\n   * @returns {Array<number>}\n   */\n  getInitialTranslation() {\n    return [0, 0];\n  }\n\n  #createResizers() {\n    if (this.#resizersDiv) {\n      return;\n    }\n    this.#resizersDiv = document.createElement(\"div\");\n    this.#resizersDiv.classList.add(\"resizers\");\n    // When the resizers are used with the keyboard, they're focusable, hence\n    // we want to have them in this order (top left, top middle, top right, ...)\n    // in the DOM to have the focus order correct.\n    const classes = this._willKeepAspectRatio\n      ? [\"topLeft\", \"topRight\", \"bottomRight\", \"bottomLeft\"]\n      : [\n          \"topLeft\",\n          \"topMiddle\",\n          \"topRight\",\n          \"middleRight\",\n          \"bottomRight\",\n          \"bottomMiddle\",\n          \"bottomLeft\",\n          \"middleLeft\",\n        ];\n    const signal = this._uiManager._signal;\n    for (const name of classes) {\n      const div = document.createElement(\"div\");\n      this.#resizersDiv.append(div);\n      div.classList.add(\"resizer\", name);\n      div.setAttribute(\"data-resizer-name\", name);\n      div.addEventListener(\n        \"pointerdown\",\n        this.#resizerPointerdown.bind(this, name),\n        { signal }\n      );\n      div.addEventListener(\"contextmenu\", noContextMenu, { signal });\n      div.tabIndex = -1;\n    }\n    this.div.prepend(this.#resizersDiv);\n  }\n\n  #resizerPointerdown(name, event) {\n    event.preventDefault();\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      return;\n    }\n\n    this.#altText?.toggle(false);\n\n    const savedDraggable = this._isDraggable;\n    this._isDraggable = false;\n    this.#lastPointerCoords = [event.screenX, event.screenY];\n\n    const ac = new AbortController();\n    const signal = this._uiManager.combinedSignal(ac);\n\n    this.parent.togglePointerEvents(false);\n    window.addEventListener(\n      \"pointermove\",\n      this.#resizerPointermove.bind(this, name),\n      { passive: true, capture: true, signal }\n    );\n    window.addEventListener(\n      \"touchmove\",\n      stopEvent /* Prevent the page from scrolling */,\n      { passive: false, signal }\n    );\n    window.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    this.#savedDimensions = {\n      savedX: this.x,\n      savedY: this.y,\n      savedWidth: this.width,\n      savedHeight: this.height,\n    };\n    const savedParentCursor = this.parent.div.style.cursor;\n    const savedCursor = this.div.style.cursor;\n    this.div.style.cursor = this.parent.div.style.cursor =\n      window.getComputedStyle(event.target).cursor;\n\n    const pointerUpCallback = () => {\n      ac.abort();\n      this.parent.togglePointerEvents(true);\n      this.#altText?.toggle(true);\n      this._isDraggable = savedDraggable;\n      this.parent.div.style.cursor = savedParentCursor;\n      this.div.style.cursor = savedCursor;\n\n      this.#addResizeToUndoStack();\n    };\n    window.addEventListener(\"pointerup\", pointerUpCallback, { signal });\n    // If the user switches to another window (with alt+tab), then we end the\n    // resize session.\n    window.addEventListener(\"blur\", pointerUpCallback, { signal });\n  }\n\n  #resize(x, y, width, height) {\n    this.width = width;\n    this.height = height;\n    this.x = x;\n    this.y = y;\n    this.setDims();\n    this.fixAndSetPosition();\n    this._onResized();\n  }\n\n  /**\n   * Called when the editor has been resized.\n   */\n  _onResized() {}\n\n  #addResizeToUndoStack() {\n    if (!this.#savedDimensions) {\n      return;\n    }\n    const { savedX, savedY, savedWidth, savedHeight } = this.#savedDimensions;\n    this.#savedDimensions = null;\n\n    const newX = this.x;\n    const newY = this.y;\n    const newWidth = this.width;\n    const newHeight = this.height;\n    if (\n      newX === savedX &&\n      newY === savedY &&\n      newWidth === savedWidth &&\n      newHeight === savedHeight\n    ) {\n      return;\n    }\n\n    this.addCommands({\n      cmd: this.#resize.bind(this, newX, newY, newWidth, newHeight),\n      undo: this.#resize.bind(this, savedX, savedY, savedWidth, savedHeight),\n      mustExec: true,\n    });\n  }\n\n  static _round(x) {\n    // 10000 because we multiply by 100 and use toFixed(2) in fixAndSetPosition.\n    // Without rounding, the positions of the corners other than the top left\n    // one can be slightly wrong.\n    return Math.round(x * 10000) / 10000;\n  }\n\n  #resizerPointermove(name, event) {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const savedX = this.x;\n    const savedY = this.y;\n    const savedWidth = this.width;\n    const savedHeight = this.height;\n    const minWidth = AnnotationEditor.MIN_SIZE / parentWidth;\n    const minHeight = AnnotationEditor.MIN_SIZE / parentHeight;\n\n    const rotationMatrix = this.#getRotationMatrix(this.rotation);\n    const transf = (x, y) => [\n      rotationMatrix[0] * x + rotationMatrix[2] * y,\n      rotationMatrix[1] * x + rotationMatrix[3] * y,\n    ];\n    const invRotationMatrix = this.#getRotationMatrix(360 - this.rotation);\n    const invTransf = (x, y) => [\n      invRotationMatrix[0] * x + invRotationMatrix[2] * y,\n      invRotationMatrix[1] * x + invRotationMatrix[3] * y,\n    ];\n    let getPoint;\n    let getOpposite;\n    let isDiagonal = false;\n    let isHorizontal = false;\n\n    switch (name) {\n      case \"topLeft\":\n        isDiagonal = true;\n        getPoint = (w, h) => [0, 0];\n        getOpposite = (w, h) => [w, h];\n        break;\n      case \"topMiddle\":\n        getPoint = (w, h) => [w / 2, 0];\n        getOpposite = (w, h) => [w / 2, h];\n        break;\n      case \"topRight\":\n        isDiagonal = true;\n        getPoint = (w, h) => [w, 0];\n        getOpposite = (w, h) => [0, h];\n        break;\n      case \"middleRight\":\n        isHorizontal = true;\n        getPoint = (w, h) => [w, h / 2];\n        getOpposite = (w, h) => [0, h / 2];\n        break;\n      case \"bottomRight\":\n        isDiagonal = true;\n        getPoint = (w, h) => [w, h];\n        getOpposite = (w, h) => [0, 0];\n        break;\n      case \"bottomMiddle\":\n        getPoint = (w, h) => [w / 2, h];\n        getOpposite = (w, h) => [w / 2, 0];\n        break;\n      case \"bottomLeft\":\n        isDiagonal = true;\n        getPoint = (w, h) => [0, h];\n        getOpposite = (w, h) => [w, 0];\n        break;\n      case \"middleLeft\":\n        isHorizontal = true;\n        getPoint = (w, h) => [0, h / 2];\n        getOpposite = (w, h) => [w, h / 2];\n        break;\n    }\n\n    const point = getPoint(savedWidth, savedHeight);\n    const oppositePoint = getOpposite(savedWidth, savedHeight);\n    let transfOppositePoint = transf(...oppositePoint);\n    const oppositeX = AnnotationEditor._round(savedX + transfOppositePoint[0]);\n    const oppositeY = AnnotationEditor._round(savedY + transfOppositePoint[1]);\n    let ratioX = 1;\n    let ratioY = 1;\n\n    let deltaX, deltaY;\n\n    if (!event.fromKeyboard) {\n      // We can't use event.movementX/Y because they're not reliable:\n      //  https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/movementX\n      // (it was buggy on a laptop with a touch screen).\n      const { screenX, screenY } = event;\n      const [lastScreenX, lastScreenY] = this.#lastPointerCoords;\n      [deltaX, deltaY] = this.screenToPageTranslation(\n        screenX - lastScreenX,\n        screenY - lastScreenY\n      );\n      this.#lastPointerCoords[0] = screenX;\n      this.#lastPointerCoords[1] = screenY;\n    } else {\n      ({ deltaX, deltaY } = event);\n    }\n    [deltaX, deltaY] = invTransf(deltaX / parentWidth, deltaY / parentHeight);\n\n    if (isDiagonal) {\n      const oldDiag = Math.hypot(savedWidth, savedHeight);\n      ratioX = ratioY = Math.max(\n        Math.min(\n          Math.hypot(\n            oppositePoint[0] - point[0] - deltaX,\n            oppositePoint[1] - point[1] - deltaY\n          ) / oldDiag,\n          // Avoid the editor to be larger than the page.\n          1 / savedWidth,\n          1 / savedHeight\n        ),\n        // Avoid the editor to be smaller than the minimum size.\n        minWidth / savedWidth,\n        minHeight / savedHeight\n      );\n    } else if (isHorizontal) {\n      ratioX =\n        MathClamp(Math.abs(oppositePoint[0] - point[0] - deltaX), minWidth, 1) /\n        savedWidth;\n    } else {\n      ratioY =\n        MathClamp(\n          Math.abs(oppositePoint[1] - point[1] - deltaY),\n          minHeight,\n          1\n        ) / savedHeight;\n    }\n\n    const newWidth = AnnotationEditor._round(savedWidth * ratioX);\n    const newHeight = AnnotationEditor._round(savedHeight * ratioY);\n    transfOppositePoint = transf(...getOpposite(newWidth, newHeight));\n    const newX = oppositeX - transfOppositePoint[0];\n    const newY = oppositeY - transfOppositePoint[1];\n\n    this.#initialRect ||= [this.x, this.y, this.width, this.height];\n    this.width = newWidth;\n    this.height = newHeight;\n    this.x = newX;\n    this.y = newY;\n\n    this.setDims();\n    this.fixAndSetPosition();\n\n    this._onResizing();\n  }\n\n  /**\n   * Called when the editor is being resized.\n   */\n  _onResizing() {}\n\n  /**\n   * Called when the alt text dialog is closed.\n   */\n  altTextFinish() {\n    this.#altText?.finish();\n  }\n\n  /**\n   * Get the toolbar buttons for this editor.\n   * @returns {Array<Array<string|object|null>>|null}\n   */\n  get toolbarButtons() {\n    return null;\n  }\n\n  /**\n   * Add a toolbar for this editor.\n   * @returns {Promise<EditorToolbar|null>}\n   */\n  async addEditToolbar() {\n    if (this._editToolbar || this.#isInEditMode) {\n      return this._editToolbar;\n    }\n    this._editToolbar = new EditorToolbar(this);\n    this.div.append(this._editToolbar.render());\n    const { toolbarButtons } = this;\n    if (toolbarButtons) {\n      for (const [name, tool] of toolbarButtons) {\n        await this._editToolbar.addButton(name, tool);\n      }\n    }\n    if (!this.hasComment) {\n      this._editToolbar.addButton(\"comment\", this.addCommentButton());\n    }\n    this._editToolbar.addButton(\"delete\");\n\n    return this._editToolbar;\n  }\n\n  addCommentButtonInToolbar() {\n    this._editToolbar?.addButtonBefore(\n      \"comment\",\n      this.addCommentButton(),\n      \".deleteButton\"\n    );\n  }\n\n  removeCommentButtonFromToolbar() {\n    this._editToolbar?.removeButton(\"comment\");\n  }\n\n  removeEditToolbar() {\n    this._editToolbar?.remove();\n    this._editToolbar = null;\n\n    // We destroy the alt text but we don't null it because we want to be able\n    // to restore it in case the user undoes the deletion.\n    this.#altText?.destroy();\n  }\n\n  addContainer(container) {\n    const editToolbarDiv = this._editToolbar?.div;\n    if (editToolbarDiv) {\n      editToolbarDiv.before(container);\n    } else {\n      this.div.append(container);\n    }\n  }\n\n  getClientDimensions() {\n    return this.div.getBoundingClientRect();\n  }\n\n  /**\n   * Create the alt text for this editor.\n   * @returns {object}\n   */\n  createAltText() {\n    if (!this.#altText) {\n      AltText.initialize(AnnotationEditor._l10n);\n      this.#altText = new AltText(this);\n      if (this.#accessibilityData) {\n        this.#altText.data = this.#accessibilityData;\n        this.#accessibilityData = null;\n      }\n    }\n    return this.#altText;\n  }\n\n  get altTextData() {\n    return this.#altText?.data;\n  }\n\n  /**\n   * Set the alt text data.\n   */\n  set altTextData(data) {\n    if (!this.#altText) {\n      return;\n    }\n    this.#altText.data = data;\n  }\n\n  get guessedAltText() {\n    return this.#altText?.guessedText;\n  }\n\n  async setGuessedAltText(text) {\n    await this.#altText?.setGuessedText(text);\n  }\n\n  serializeAltText(isForCopying) {\n    return this.#altText?.serialize(isForCopying);\n  }\n\n  hasAltText() {\n    return !!this.#altText && !this.#altText.isEmpty();\n  }\n\n  hasAltTextData() {\n    return this.#altText?.hasData() ?? false;\n  }\n\n  focusCommentButton() {\n    this.#comment?.focusButton();\n  }\n\n  addCommentButton() {\n    return this.canAddComment ? (this.#comment ||= new Comment(this)) : null;\n  }\n\n  addStandaloneCommentButton() {\n    if (!this._uiManager.hasCommentManager()) {\n      return;\n    }\n    if (this.#commentStandaloneButton) {\n      if (this._uiManager.isEditingMode()) {\n        this.#commentStandaloneButton.classList.remove(\"hidden\");\n      }\n      return;\n    }\n    if (!this.hasComment) {\n      return;\n    }\n    this.#commentStandaloneButton = this.#comment.renderForStandalone();\n    this.div.append(this.#commentStandaloneButton);\n  }\n\n  removeStandaloneCommentButton() {\n    this.#comment.removeStandaloneCommentButton();\n    this.#commentStandaloneButton = null;\n  }\n\n  hideStandaloneCommentButton() {\n    this.#commentStandaloneButton?.classList.add(\"hidden\");\n  }\n\n  get comment() {\n    const {\n      data: { richText, text, date, deleted },\n    } = this.#comment;\n    return {\n      text,\n      richText,\n      date,\n      deleted,\n      color: this.getNonHCMColor(),\n      opacity: this.opacity ?? 1,\n    };\n  }\n\n  set comment(text) {\n    this.#comment ||= new Comment(this);\n    this.#comment.data = text;\n    if (this.hasComment) {\n      this.removeCommentButtonFromToolbar();\n      this.addStandaloneCommentButton();\n      this._uiManager.updateComment(this);\n    } else {\n      this.addCommentButtonInToolbar();\n      this.removeStandaloneCommentButton();\n      this._uiManager.removeComment(this);\n    }\n  }\n\n  setCommentData({ comment, popupRef, richText }) {\n    if (!popupRef) {\n      return;\n    }\n    this.#comment ||= new Comment(this);\n    this.#comment.setInitialText(comment, richText);\n\n    if (!this.annotationElementId) {\n      return;\n    }\n    const storedData = this._uiManager.getAndRemoveDataFromAnnotationStorage(\n      this.annotationElementId\n    );\n    if (storedData) {\n      this.updateFromAnnotationLayer(storedData);\n    }\n  }\n\n  get hasEditedComment() {\n    return this.#comment?.hasBeenEdited();\n  }\n\n  get hasDeletedComment() {\n    return this.#comment?.isDeleted();\n  }\n\n  get hasComment() {\n    return (\n      !!this.#comment && !this.#comment.isEmpty() && !this.#comment.isDeleted()\n    );\n  }\n\n  async editComment(options) {\n    this.#comment ||= new Comment(this);\n    this.#comment.edit(options);\n  }\n\n  toggleComment(isSelected, visibility = undefined) {\n    if (this.hasComment) {\n      this._uiManager.toggleComment(this, isSelected, visibility);\n    }\n  }\n\n  setSelectedCommentButton(selected) {\n    this.#comment.setSelectedButton(selected);\n  }\n\n  addComment(serialized) {\n    if (this.hasEditedComment) {\n      const DEFAULT_POPUP_WIDTH = 180;\n      const DEFAULT_POPUP_HEIGHT = 100;\n      const [, , , trY] = serialized.rect;\n      const [pageWidth] = this.pageDimensions;\n      const [pageX] = this.pageTranslation;\n      const blX = pageX + pageWidth + 1;\n      const blY = trY - DEFAULT_POPUP_HEIGHT;\n      const trX = blX + DEFAULT_POPUP_WIDTH;\n      serialized.popup = {\n        contents: this.comment.text,\n        deleted: this.comment.deleted,\n        rect: [blX, blY, trX, trY],\n      };\n    }\n  }\n\n  updateFromAnnotationLayer({ popup: { contents, deleted } }) {\n    this.#comment.data = deleted ? null : contents;\n  }\n\n  get parentBoundingClientRect() {\n    return this.parent.boundingClientRect;\n  }\n\n  /**\n   * Render this editor in a div.\n   * @returns {HTMLDivElement | null}\n   */\n  render() {\n    const div = (this.div = document.createElement(\"div\"));\n    div.setAttribute(\"data-editor-rotation\", (360 - this.rotation) % 360);\n    div.className = this.name;\n    div.setAttribute(\"id\", this.id);\n    div.tabIndex = this.#disabled ? -1 : 0;\n    div.setAttribute(\"role\", \"application\");\n    if (this.defaultL10nId) {\n      div.setAttribute(\"data-l10n-id\", this.defaultL10nId);\n    }\n    if (!this._isVisible) {\n      div.classList.add(\"hidden\");\n    }\n\n    this.setInForeground();\n    this.#addFocusListeners();\n\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    if (this.parentRotation % 180 !== 0) {\n      div.style.maxWidth = `${((100 * parentHeight) / parentWidth).toFixed(\n        2\n      )}%`;\n      div.style.maxHeight = `${((100 * parentWidth) / parentHeight).toFixed(\n        2\n      )}%`;\n    }\n\n    const [tx, ty] = this.getInitialTranslation();\n    this.translate(tx, ty);\n\n    bindEvents(this, div, [\"keydown\", \"pointerdown\", \"dblclick\"]);\n\n    if (this.isResizable && this._uiManager._supportsPinchToZoom) {\n      this.#touchManager ||= new TouchManager({\n        container: div,\n        isPinchingDisabled: () => !this.isSelected,\n        onPinchStart: this.#touchPinchStartCallback.bind(this),\n        onPinching: this.#touchPinchCallback.bind(this),\n        onPinchEnd: this.#touchPinchEndCallback.bind(this),\n        signal: this._uiManager._signal,\n      });\n    }\n\n    this.addStandaloneCommentButton();\n    this._uiManager._editorUndoBar?.hide();\n\n    return div;\n  }\n\n  #touchPinchStartCallback() {\n    this.#savedDimensions = {\n      savedX: this.x,\n      savedY: this.y,\n      savedWidth: this.width,\n      savedHeight: this.height,\n    };\n    this.#altText?.toggle(false);\n    this.parent.togglePointerEvents(false);\n  }\n\n  #touchPinchCallback(_origin, prevDistance, distance) {\n    // Slightly slow down the zooming because the editor could be small and the\n    // user could have difficulties to rescale it as they want.\n    const slowDownFactor = 0.7;\n    let factor =\n      slowDownFactor * (distance / prevDistance) + 1 - slowDownFactor;\n    if (factor === 1) {\n      return;\n    }\n\n    const rotationMatrix = this.#getRotationMatrix(this.rotation);\n    const transf = (x, y) => [\n      rotationMatrix[0] * x + rotationMatrix[2] * y,\n      rotationMatrix[1] * x + rotationMatrix[3] * y,\n    ];\n\n    // The center of the editor is the fixed point.\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const savedX = this.x;\n    const savedY = this.y;\n    const savedWidth = this.width;\n    const savedHeight = this.height;\n\n    const minWidth = AnnotationEditor.MIN_SIZE / parentWidth;\n    const minHeight = AnnotationEditor.MIN_SIZE / parentHeight;\n    factor = Math.max(\n      Math.min(factor, 1 / savedWidth, 1 / savedHeight),\n      minWidth / savedWidth,\n      minHeight / savedHeight\n    );\n    const newWidth = AnnotationEditor._round(savedWidth * factor);\n    const newHeight = AnnotationEditor._round(savedHeight * factor);\n    if (newWidth === savedWidth && newHeight === savedHeight) {\n      return;\n    }\n\n    this.#initialRect ||= [savedX, savedY, savedWidth, savedHeight];\n    const transfCenterPoint = transf(savedWidth / 2, savedHeight / 2);\n    const centerX = AnnotationEditor._round(savedX + transfCenterPoint[0]);\n    const centerY = AnnotationEditor._round(savedY + transfCenterPoint[1]);\n    const newTransfCenterPoint = transf(newWidth / 2, newHeight / 2);\n\n    this.x = centerX - newTransfCenterPoint[0];\n    this.y = centerY - newTransfCenterPoint[1];\n    this.width = newWidth;\n    this.height = newHeight;\n\n    this.setDims();\n    this.fixAndSetPosition();\n\n    this._onResizing();\n  }\n\n  #touchPinchEndCallback() {\n    this.#altText?.toggle(true);\n    this.parent.togglePointerEvents(true);\n    this.#addResizeToUndoStack();\n  }\n\n  /**\n   * Onpointerdown callback.\n   * @param {PointerEvent} event\n   */\n  pointerdown(event) {\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      // Avoid to focus this editor because of a non-left click.\n      event.preventDefault();\n      return;\n    }\n    this.#hasBeenClicked = true;\n\n    if (this._isDraggable) {\n      this.#setUpDragSession(event);\n      return;\n    }\n\n    this.#selectOnPointerEvent(event);\n  }\n\n  #selectOnPointerEvent(event) {\n    const { isMac } = FeatureTest.platform;\n    if (\n      (event.ctrlKey && !isMac) ||\n      event.shiftKey ||\n      (event.metaKey && isMac)\n    ) {\n      this.parent.toggleSelected(this);\n    } else {\n      this.parent.setSelected(this);\n    }\n  }\n\n  #setUpDragSession(event) {\n    const { isSelected } = this;\n    this._uiManager.setUpDragSession();\n    let hasDraggingStarted = false;\n\n    const ac = new AbortController();\n    const signal = this._uiManager.combinedSignal(ac);\n    const opts = { capture: true, passive: false, signal };\n    const cancelDrag = e => {\n      ac.abort();\n\n      this.#dragPointerId = null;\n      this.#hasBeenClicked = false;\n      if (!this._uiManager.endDragSession()) {\n        this.#selectOnPointerEvent(e);\n      }\n      if (hasDraggingStarted) {\n        this._onStopDragging();\n      }\n    };\n\n    if (isSelected) {\n      this.#prevDragX = event.clientX;\n      this.#prevDragY = event.clientY;\n      this.#dragPointerId = event.pointerId;\n      this.#dragPointerType = event.pointerType;\n      window.addEventListener(\n        \"pointermove\",\n        e => {\n          if (!hasDraggingStarted) {\n            hasDraggingStarted = true;\n            this._uiManager.toggleComment(\n              this,\n              /* isSelected = */ true,\n              /* visibility = */ false\n            );\n            this._onStartDragging();\n          }\n          const { clientX: x, clientY: y, pointerId } = e;\n          if (pointerId !== this.#dragPointerId) {\n            stopEvent(e);\n            return;\n          }\n          const [tx, ty] = this.screenToPageTranslation(\n            x - this.#prevDragX,\n            y - this.#prevDragY\n          );\n          this.#prevDragX = x;\n          this.#prevDragY = y;\n          this._uiManager.dragSelectedEditors(tx, ty);\n        },\n        opts\n      );\n      window.addEventListener(\n        \"touchmove\",\n        stopEvent /* Prevent the page from scrolling */,\n        opts\n      );\n      window.addEventListener(\n        \"pointerdown\",\n        // If the user drags with one finger and then clicks with another.\n        e => {\n          if (e.pointerType === this.#dragPointerType) {\n            // We've a pinch to zoom session.\n            // We cannot have two primaries at the same time.\n            // It's possible to be in this state with Firefox and Gnome when\n            // trying to drag with three fingers (see bug 1933716).\n            if (this.#touchManager || e.isPrimary) {\n              cancelDrag(e);\n            }\n          }\n          stopEvent(e);\n        },\n        opts\n      );\n    }\n\n    const pointerUpCallback = e => {\n      if (!this.#dragPointerId || this.#dragPointerId === e.pointerId) {\n        cancelDrag(e);\n        return;\n      }\n      stopEvent(e);\n    };\n    window.addEventListener(\"pointerup\", pointerUpCallback, { signal });\n    // If the user is using alt+tab during the dragging session, the pointerup\n    // event could be not fired, but a blur event is fired so we can use it in\n    // order to interrupt the dragging session.\n    window.addEventListener(\"blur\", pointerUpCallback, { signal });\n  }\n\n  _onStartDragging() {}\n\n  _onStopDragging() {}\n\n  moveInDOM() {\n    // Moving the editor in the DOM can be expensive, so we wait a bit before.\n    // It's important to not block the UI (for example when changing the font\n    // size in a FreeText).\n    if (this.#moveInDOMTimeout) {\n      clearTimeout(this.#moveInDOMTimeout);\n    }\n    this.#moveInDOMTimeout = setTimeout(() => {\n      this.#moveInDOMTimeout = null;\n      this.parent?.moveEditorInDOM(this);\n      if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n        this._uiManager._eventBus.dispatch(\"editormovedindom\", {\n          source: this,\n        });\n      }\n    }, 0);\n  }\n\n  _setParentAndPosition(parent, x, y) {\n    parent.changeParent(this);\n    this.x = x;\n    this.y = y;\n    this.fixAndSetPosition();\n    this._onTranslated();\n  }\n\n  /**\n   * Convert the current rect into a page one.\n   * @param {number} tx - x-translation in screen coordinates.\n   * @param {number} ty - y-translation in screen coordinates.\n   * @param {number} [rotation] - the rotation of the page.\n   */\n  getRect(tx, ty, rotation = this.rotation) {\n    const scale = this.parentScale;\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const [pageX, pageY] = this.pageTranslation;\n    const shiftX = tx / scale;\n    const shiftY = ty / scale;\n    const x = this.x * pageWidth;\n    const y = this.y * pageHeight;\n    const width = this.width * pageWidth;\n    const height = this.height * pageHeight;\n\n    switch (rotation) {\n      case 0:\n        return [\n          x + shiftX + pageX,\n          pageHeight - y - shiftY - height + pageY,\n          x + shiftX + width + pageX,\n          pageHeight - y - shiftY + pageY,\n        ];\n      case 90:\n        return [\n          x + shiftY + pageX,\n          pageHeight - y + shiftX + pageY,\n          x + shiftY + height + pageX,\n          pageHeight - y + shiftX + width + pageY,\n        ];\n      case 180:\n        return [\n          x - shiftX - width + pageX,\n          pageHeight - y + shiftY + pageY,\n          x - shiftX + pageX,\n          pageHeight - y + shiftY + height + pageY,\n        ];\n      case 270:\n        return [\n          x - shiftY - height + pageX,\n          pageHeight - y - shiftX - width + pageY,\n          x - shiftY + pageX,\n          pageHeight - y - shiftX + pageY,\n        ];\n      default:\n        throw new Error(\"Invalid rotation\");\n    }\n  }\n\n  getRectInCurrentCoords(rect, pageHeight) {\n    const [x1, y1, x2, y2] = rect;\n\n    const width = x2 - x1;\n    const height = y2 - y1;\n\n    switch (this.rotation) {\n      case 0:\n        return [x1, pageHeight - y2, width, height];\n      case 90:\n        return [x1, pageHeight - y1, height, width];\n      case 180:\n        return [x2, pageHeight - y1, width, height];\n      case 270:\n        return [x2, pageHeight - y2, height, width];\n      default:\n        throw new Error(\"Invalid rotation\");\n    }\n  }\n\n  /**\n   * Get the rect in page coordinates without any translation.\n   * It's used when serializing the editor.\n   * @returns {Array<number>}\n   */\n  getPDFRect() {\n    return this.getRect(0, 0);\n  }\n\n  getNonHCMColor() {\n    return (\n      this.color &&\n      AnnotationEditor._colorManager.convert(\n        this._uiManager.getNonHCMColor(this.color)\n      )\n    );\n  }\n\n  /**\n   * The color has been changed.\n   */\n  onUpdatedColor() {\n    this.#comment?.onUpdatedColor();\n  }\n\n  getData() {\n    const {\n      comment: { text: str, color, date, opacity, deleted, richText },\n      uid: id,\n      pageIndex,\n      creationDate,\n      modificationDate,\n    } = this;\n    return {\n      id,\n      pageIndex,\n      rect: this.getPDFRect(),\n      richText,\n      contentsObj: { str },\n      creationDate,\n      modificationDate: date || modificationDate,\n      popupRef: !deleted,\n      color,\n      opacity,\n    };\n  }\n\n  /**\n   * Executed once this editor has been rendered.\n   * @param {boolean} focus - true if the editor should be focused.\n   */\n  onceAdded(focus) {}\n\n  /**\n   * Check if the editor contains something.\n   * @returns {boolean}\n   */\n  isEmpty() {\n    return false;\n  }\n\n  /**\n   * Enable edit mode.\n   * @returns {boolean} - true if the edit mode has been enabled.\n   */\n  enableEditMode() {\n    if (this.isInEditMode()) {\n      return false;\n    }\n    this.parent.setEditingState(false);\n    this.#isInEditMode = true;\n\n    return true;\n  }\n\n  /**\n   * Disable edit mode.\n   * @returns {boolean} - true if the edit mode has been disabled.\n   */\n  disableEditMode() {\n    if (!this.isInEditMode()) {\n      return false;\n    }\n    this.parent.setEditingState(true);\n    this.#isInEditMode = false;\n\n    return true;\n  }\n\n  /**\n   * Check if the editor is edited.\n   * @returns {boolean}\n   */\n  isInEditMode() {\n    return this.#isInEditMode;\n  }\n\n  /**\n   * If it returns true, then this editor handles the keyboard\n   * events itself.\n   * @returns {boolean}\n   */\n  shouldGetKeyboardEvents() {\n    return this.#isResizerEnabledForKeyboard;\n  }\n\n  /**\n   * Check if this editor needs to be rebuilt or not.\n   * @returns {boolean}\n   */\n  needsToBeRebuilt() {\n    return this.div && !this.isAttachedToDOM;\n  }\n\n  get isOnScreen() {\n    const { top, left, bottom, right } = this.getClientDimensions();\n    const { innerHeight, innerWidth } = window;\n    return left < innerWidth && right > 0 && top < innerHeight && bottom > 0;\n  }\n\n  #addFocusListeners() {\n    if (this.#focusAC || !this.div) {\n      return;\n    }\n    this.#focusAC = new AbortController();\n    const signal = this._uiManager.combinedSignal(this.#focusAC);\n\n    this.div.addEventListener(\"focusin\", this.focusin.bind(this), { signal });\n    this.div.addEventListener(\"focusout\", this.focusout.bind(this), { signal });\n  }\n\n  /**\n   * Rebuild the editor in case it has been removed on undo.\n   *\n   * To implement in subclasses.\n   */\n  rebuild() {\n    this.#addFocusListeners();\n  }\n\n  /**\n   * Rotate the editor when the page is rotated.\n   * @param {number} angle\n   */\n  rotate(_angle) {}\n\n  /**\n   * Resize the editor when the page is resized.\n   */\n  resize() {}\n\n  /**\n   * Serialize the editor when it has been deleted.\n   * @returns {Object}\n   */\n  serializeDeleted() {\n    return {\n      id: this.annotationElementId,\n      deleted: true,\n      pageIndex: this.pageIndex,\n      popupRef: this._initialData?.popupRef || \"\",\n    };\n  }\n\n  /**\n   * Serialize the editor.\n   * The result of the serialization will be used to construct a\n   * new annotation to add to the pdf document.\n   *\n   * To implement in subclasses.\n   * @param {boolean} [isForCopying]\n   * @param {Object | null} [context]\n   * @returns {Object | null}\n   */\n  serialize(isForCopying = false, context = null) {\n    return {\n      annotationType: this.mode,\n      pageIndex: this.pageIndex,\n      rect: this.getPDFRect(),\n      rotation: this.rotation,\n      structTreeParentId: this._structTreeParentId,\n      popupRef: this._initialData?.popupRef || \"\",\n    };\n  }\n\n  /**\n   * Deserialize the editor.\n   * The result of the deserialization is a new editor.\n   *\n   * @param {Object} data\n   * @param {AnnotationEditorLayer} parent\n   * @param {AnnotationEditorUIManager} uiManager\n   * @returns {Promise<AnnotationEditor | null>}\n   */\n  static async deserialize(data, parent, uiManager) {\n    const editor = new this.prototype.constructor({\n      parent,\n      id: parent.getNextId(),\n      uiManager,\n      annotationElementId: data.annotationElementId,\n      creationDate: data.creationDate,\n      modificationDate: data.modificationDate,\n    });\n    editor.rotation = data.rotation;\n    editor.#accessibilityData = data.accessibilityData;\n    editor._isCopy = data.isCopy || false;\n\n    const [pageWidth, pageHeight] = editor.pageDimensions;\n    const [x, y, width, height] = editor.getRectInCurrentCoords(\n      data.rect,\n      pageHeight\n    );\n\n    editor.x = x / pageWidth;\n    editor.y = y / pageHeight;\n    editor.width = width / pageWidth;\n    editor.height = height / pageHeight;\n\n    return editor;\n  }\n\n  /**\n   * Check if an existing annotation associated with this editor has been\n   * modified.\n   * @returns {boolean}\n   */\n  get hasBeenModified() {\n    return (\n      !!this.annotationElementId && (this.deleted || this.serialize() !== null)\n    );\n  }\n\n  /**\n   * Remove this editor.\n   * It's used on ctrl+backspace action.\n   */\n  remove() {\n    this.#focusAC?.abort();\n    this.#focusAC = null;\n\n    if (!this.isEmpty()) {\n      // The editor is removed but it can be back at some point thanks to\n      // undo/redo so we must commit it before.\n      this.commit();\n    }\n    if (this.parent) {\n      this.parent.remove(this);\n    } else {\n      this._uiManager.removeEditor(this);\n    }\n    this.hideCommentPopup();\n\n    if (this.#moveInDOMTimeout) {\n      clearTimeout(this.#moveInDOMTimeout);\n      this.#moveInDOMTimeout = null;\n    }\n    this.#stopResizing();\n    this.removeEditToolbar();\n    if (this.#telemetryTimeouts) {\n      for (const timeout of this.#telemetryTimeouts.values()) {\n        clearTimeout(timeout);\n      }\n      this.#telemetryTimeouts = null;\n    }\n    this.parent = null;\n    this.#touchManager?.destroy();\n    this.#touchManager = null;\n    this.#fakeAnnotation?.remove();\n    this.#fakeAnnotation = null;\n  }\n\n  /**\n   * @returns {boolean} true if this editor can be resized.\n   */\n  get isResizable() {\n    return false;\n  }\n\n  /**\n   * Add the resizers to this editor.\n   */\n  makeResizable() {\n    if (this.isResizable) {\n      this.#createResizers();\n      this.#resizersDiv.classList.remove(\"hidden\");\n    }\n  }\n\n  get toolbarPosition() {\n    return null;\n  }\n\n  /**\n   * Get the position of the comment button.\n   * @returns {Array<number>|null}\n   */\n  get commentButtonPosition() {\n    return this._uiManager.direction === \"ltr\" ? [1, 0] : [0, 0];\n  }\n\n  get commentButtonPositionInPage() {\n    const {\n      commentButtonPosition: [posX, posY],\n    } = this;\n    const [blX, blY, trX, trY] = this.getPDFRect();\n    return [\n      AnnotationEditor._round(blX + (trX - blX) * posX),\n      AnnotationEditor._round(blY + (trY - blY) * (1 - posY)),\n    ];\n  }\n\n  get commentButtonColor() {\n    return this._uiManager.makeCommentColor(\n      this.getNonHCMColor(),\n      this.opacity\n    );\n  }\n\n  get commentPopupPosition() {\n    return this.#comment.commentPopupPositionInLayer;\n  }\n\n  set commentPopupPosition(pos) {\n    this.#comment.commentPopupPositionInLayer = pos;\n  }\n\n  hasDefaultPopupPosition() {\n    return this.#comment.hasDefaultPopupPosition();\n  }\n\n  get commentButtonWidth() {\n    return this.#comment.commentButtonWidth;\n  }\n\n  get elementBeforePopup() {\n    return this.div;\n  }\n\n  setCommentButtonStates(options) {\n    this.#comment?.setCommentButtonStates(options);\n  }\n\n  /**\n   * onkeydown callback.\n   * @param {KeyboardEvent} event\n   */\n  keydown(event) {\n    if (\n      !this.isResizable ||\n      event.target !== this.div ||\n      event.key !== \"Enter\"\n    ) {\n      return;\n    }\n    this._uiManager.setSelected(this);\n    this.#savedDimensions = {\n      savedX: this.x,\n      savedY: this.y,\n      savedWidth: this.width,\n      savedHeight: this.height,\n    };\n    const children = this.#resizersDiv.children;\n    if (!this.#allResizerDivs) {\n      this.#allResizerDivs = Array.from(children);\n      const boundResizerKeydown = this.#resizerKeydown.bind(this);\n      const boundResizerBlur = this.#resizerBlur.bind(this);\n      const signal = this._uiManager._signal;\n      for (const div of this.#allResizerDivs) {\n        const name = div.getAttribute(\"data-resizer-name\");\n        div.setAttribute(\"role\", \"spinbutton\");\n        div.addEventListener(\"keydown\", boundResizerKeydown, { signal });\n        div.addEventListener(\"blur\", boundResizerBlur, { signal });\n        div.addEventListener(\"focus\", this.#resizerFocus.bind(this, name), {\n          signal,\n        });\n        div.setAttribute(\"data-l10n-id\", AnnotationEditor._l10nResizer[name]);\n      }\n    }\n\n    // We want to have the resizers in the visual order, so we move the first\n    // (top-left) to the right place.\n    const first = this.#allResizerDivs[0];\n    let firstPosition = 0;\n    for (const div of children) {\n      if (div === first) {\n        break;\n      }\n      firstPosition++;\n    }\n    const nextFirstPosition =\n      (((360 - this.rotation + this.parentRotation) % 360) / 90) *\n      (this.#allResizerDivs.length / 4);\n\n    if (nextFirstPosition !== firstPosition) {\n      // We need to reorder the resizers in the DOM in order to have the focus\n      // on the top-left one.\n      if (nextFirstPosition < firstPosition) {\n        for (let i = 0; i < firstPosition - nextFirstPosition; i++) {\n          this.#resizersDiv.append(this.#resizersDiv.firstElementChild);\n        }\n      } else if (nextFirstPosition > firstPosition) {\n        for (let i = 0; i < nextFirstPosition - firstPosition; i++) {\n          this.#resizersDiv.firstElementChild.before(\n            this.#resizersDiv.lastElementChild\n          );\n        }\n      }\n\n      let i = 0;\n      for (const child of children) {\n        const div = this.#allResizerDivs[i++];\n        const name = div.getAttribute(\"data-resizer-name\");\n        child.setAttribute(\"data-l10n-id\", AnnotationEditor._l10nResizer[name]);\n      }\n    }\n\n    this.#setResizerTabIndex(0);\n    this.#isResizerEnabledForKeyboard = true;\n    this.#resizersDiv.firstElementChild.focus({ focusVisible: true });\n    event.preventDefault();\n    event.stopImmediatePropagation();\n  }\n\n  #resizerKeydown(event) {\n    AnnotationEditor._resizerKeyboardManager.exec(this, event);\n  }\n\n  #resizerBlur(event) {\n    if (\n      this.#isResizerEnabledForKeyboard &&\n      event.relatedTarget?.parentNode !== this.#resizersDiv\n    ) {\n      this.#stopResizing();\n    }\n  }\n\n  #resizerFocus(name) {\n    this.#focusedResizerName = this.#isResizerEnabledForKeyboard ? name : \"\";\n  }\n\n  #setResizerTabIndex(value) {\n    if (!this.#allResizerDivs) {\n      return;\n    }\n    for (const div of this.#allResizerDivs) {\n      div.tabIndex = value;\n    }\n  }\n\n  _resizeWithKeyboard(x, y) {\n    if (!this.#isResizerEnabledForKeyboard) {\n      return;\n    }\n    this.#resizerPointermove(this.#focusedResizerName, {\n      deltaX: x,\n      deltaY: y,\n      fromKeyboard: true,\n    });\n  }\n\n  #stopResizing() {\n    this.#isResizerEnabledForKeyboard = false;\n    this.#setResizerTabIndex(-1);\n    this.#addResizeToUndoStack();\n  }\n\n  _stopResizingWithKeyboard() {\n    this.#stopResizing();\n    this.div.focus();\n  }\n\n  /**\n   * Select this editor.\n   */\n  select() {\n    if (this.isSelected && this._editToolbar) {\n      this._editToolbar.show();\n      return;\n    }\n    this.isSelected = true;\n    this.makeResizable();\n    this.div?.classList.add(\"selectedEditor\");\n    if (!this._editToolbar) {\n      this.addEditToolbar().then(() => {\n        if (this.div?.classList.contains(\"selectedEditor\")) {\n          // The editor can have been unselected while we were waiting for the\n          // edit toolbar to be created, hence we want to be sure that this\n          // editor is still selected.\n          this._editToolbar?.show();\n        }\n      });\n      return;\n    }\n    this._editToolbar?.show();\n    this.#altText?.toggleAltTextBadge(false);\n  }\n\n  focus() {\n    if (this.div && !this.div.contains(document.activeElement)) {\n      setTimeout(() => this.div?.focus({ preventScroll: true }), 0);\n    }\n  }\n\n  /**\n   * Unselect this editor.\n   */\n  unselect() {\n    if (!this.isSelected) {\n      return;\n    }\n    this.isSelected = false;\n    this.#resizersDiv?.classList.add(\"hidden\");\n    this.div?.classList.remove(\"selectedEditor\");\n    if (this.div?.contains(document.activeElement)) {\n      // Don't use this.div.blur() because we don't know where the focus will\n      // go.\n      this._uiManager.currentLayer.div.focus({\n        preventScroll: true,\n      });\n    }\n    this._editToolbar?.hide();\n    this.#altText?.toggleAltTextBadge(true);\n    this.hideCommentPopup();\n  }\n\n  hideCommentPopup() {\n    if (this.hasComment) {\n      this._uiManager.toggleComment(null);\n    }\n  }\n\n  /**\n   * Update some parameters which have been changed through the UI.\n   * @param {number} type\n   * @param {*} value\n   */\n  updateParams(type, value) {}\n\n  /**\n   * When the user disables the editing mode some editors can change some of\n   * their properties.\n   */\n  disableEditing() {}\n\n  /**\n   * When the user enables the editing mode some editors can change some of\n   * their properties.\n   */\n  enableEditing() {}\n\n  /**\n   * Check if the content of this editor can be changed.\n   * For example, a FreeText editor can be changed (the user can change the\n   * text), but a Stamp editor cannot.\n   * @returns {boolean}\n   */\n  get canChangeContent() {\n    return false;\n  }\n\n  /**\n   * The editor is about to be edited.\n   */\n  enterInEditMode() {\n    if (!this.canChangeContent) {\n      return;\n    }\n    this.enableEditMode();\n    this.div.focus();\n  }\n\n  /**\n   * ondblclick callback.\n   * @param {MouseEvent} event\n   */\n  dblclick(event) {\n    if (event.target.nodeName === \"BUTTON\") {\n      // Avoid entering in edit mode when clicking on the comment button.\n      return;\n    }\n    this.enterInEditMode();\n    this.parent.updateToolbar({\n      mode: this.constructor._editorType,\n      editId: this.uid,\n    });\n  }\n\n  /**\n   * @returns {HTMLElement | null} the element requiring an alt text.\n   */\n  getElementForAltText() {\n    return this.div;\n  }\n\n  /**\n   * Get the div which really contains the displayed content.\n   * @returns {HTMLDivElement | undefined}\n   */\n  get contentDiv() {\n    return this.div;\n  }\n\n  /**\n   * If true then the editor is currently edited.\n   * @type {boolean}\n   */\n  get isEditing() {\n    return this.#isEditing;\n  }\n\n  /**\n   * When set to true, it means that this editor is currently edited.\n   * @param {boolean} value\n   */\n  set isEditing(value) {\n    this.#isEditing = value;\n    if (!this.parent) {\n      return;\n    }\n    if (value) {\n      this.parent.setSelected(this);\n      this.parent.setActiveEditor(this);\n    } else {\n      this.parent.setActiveEditor(null);\n    }\n  }\n\n  static get MIN_SIZE() {\n    return 16;\n  }\n\n  static canCreateNewEmptyEditor() {\n    return true;\n  }\n\n  /**\n   * Get the data to report to the telemetry when the editor is added.\n   * @returns {Object}\n   */\n  get telemetryInitialData() {\n    return { action: \"added\" };\n  }\n\n  /**\n   * The telemetry data to use when saving/printing.\n   * @returns {Object|null}\n   */\n  get telemetryFinalData() {\n    return null;\n  }\n\n  _reportTelemetry(data, mustWait = false) {\n    if (mustWait) {\n      this.#telemetryTimeouts ||= new Map();\n      const { action } = data;\n      let timeout = this.#telemetryTimeouts.get(action);\n      if (timeout) {\n        clearTimeout(timeout);\n      }\n      timeout = setTimeout(() => {\n        this._reportTelemetry(data);\n        this.#telemetryTimeouts.delete(action);\n        if (this.#telemetryTimeouts.size === 0) {\n          this.#telemetryTimeouts = null;\n        }\n      }, AnnotationEditor._telemetryTimeout);\n      this.#telemetryTimeouts.set(action, timeout);\n      return;\n    }\n    data.type ||= this.editorType;\n    this._uiManager._eventBus.dispatch(\"reporttelemetry\", {\n      source: this,\n      details: {\n        type: \"editing\",\n        data,\n      },\n    });\n  }\n\n  /**\n   * Show or hide this editor.\n   * @param {boolean|undefined} visible\n   */\n  show(visible = this._isVisible) {\n    this.div.classList.toggle(\"hidden\", !visible);\n    this._isVisible = visible;\n  }\n\n  enable() {\n    if (this.div) {\n      this.div.tabIndex = 0;\n    }\n    this.#disabled = false;\n  }\n\n  disable() {\n    if (this.div) {\n      this.div.tabIndex = -1;\n    }\n    this.#disabled = true;\n  }\n\n  updateFakeAnnotationElement(annotationLayer) {\n    if (!this.#fakeAnnotation && !this.deleted) {\n      this.#fakeAnnotation = annotationLayer.addFakeAnnotation(this);\n      return;\n    }\n    if (this.deleted) {\n      this.#fakeAnnotation.remove();\n      this.#fakeAnnotation = null;\n      return;\n    }\n    if (this.hasEditedComment || this._hasBeenMoved || this._hasBeenResized) {\n      this.#fakeAnnotation.updateEdited({\n        rect: this.getPDFRect(),\n        popup: this.comment,\n      });\n    }\n  }\n\n  /**\n   * Render an annotation in the annotation layer.\n   * @param {Object} annotation\n   * @returns {HTMLElement|null}\n   */\n  renderAnnotationElement(annotation) {\n    if (this.deleted) {\n      annotation.hide();\n      return null;\n    }\n    let content = annotation.container.querySelector(\".annotationContent\");\n    if (!content) {\n      content = document.createElement(\"div\");\n      content.classList.add(\"annotationContent\", this.editorType);\n      annotation.container.prepend(content);\n    } else if (content.nodeName === \"CANVAS\") {\n      const canvas = content;\n      content = document.createElement(\"div\");\n      content.classList.add(\"annotationContent\", this.editorType);\n      canvas.before(content);\n    }\n\n    return content;\n  }\n\n  resetAnnotationElement(annotation) {\n    const { firstElementChild } = annotation.container;\n    if (\n      firstElementChild?.nodeName === \"DIV\" &&\n      firstElementChild.classList.contains(\"annotationContent\")\n    ) {\n      firstElementChild.remove();\n    }\n  }\n}\n\n// This class is used to fake an editor which has been deleted.\nclass FakeEditor extends AnnotationEditor {\n  constructor(params) {\n    super(params);\n    this.annotationElementId = params.annotationElementId;\n    this.deleted = true;\n  }\n\n  serialize() {\n    return this.serializeDeleted();\n  }\n}\n\nexport { AnnotationEditor };\n","/* Copyright 2014 Opera Software ASA\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n *\n * Based on https://code.google.com/p/smhasher/wiki/MurmurHash3.\n * Hashes roughly 100 KB per millisecond on i7 3.4 GHz.\n */\n\nconst SEED = 0xc3d2e1f0;\n// Workaround for missing math precision in JS.\nconst MASK_HIGH = 0xffff0000;\nconst MASK_LOW = 0xffff;\n\nclass MurmurHash3_64 {\n  constructor(seed) {\n    this.h1 = seed ? seed & 0xffffffff : SEED;\n    this.h2 = seed ? seed & 0xffffffff : SEED;\n  }\n\n  update(input) {\n    let data, length;\n    if (typeof input === \"string\") {\n      data = new Uint8Array(input.length * 2);\n      length = 0;\n      for (let i = 0, ii = input.length; i < ii; i++) {\n        const code = input.charCodeAt(i);\n        if (code <= 0xff) {\n          data[length++] = code;\n        } else {\n          data[length++] = code >>> 8;\n          data[length++] = code & 0xff;\n        }\n      }\n    } else if (ArrayBuffer.isView(input)) {\n      data = input.slice();\n      length = data.byteLength;\n    } else {\n      throw new Error(\"Invalid data format, must be a string or TypedArray.\");\n    }\n\n    const blockCounts = length >> 2;\n    const tailLength = length - blockCounts * 4;\n    // We don't care about endianness here.\n    const dataUint32 = new Uint32Array(data.buffer, 0, blockCounts);\n    let k1 = 0,\n      k2 = 0;\n    let h1 = this.h1,\n      h2 = this.h2;\n    const C1 = 0xcc9e2d51,\n      C2 = 0x1b873593;\n    const C1_LOW = C1 & MASK_LOW,\n      C2_LOW = C2 & MASK_LOW;\n\n    for (let i = 0; i < blockCounts; i++) {\n      if (i & 1) {\n        k1 = dataUint32[i];\n        k1 = ((k1 * C1) & MASK_HIGH) | ((k1 * C1_LOW) & MASK_LOW);\n        k1 = (k1 << 15) | (k1 >>> 17);\n        k1 = ((k1 * C2) & MASK_HIGH) | ((k1 * C2_LOW) & MASK_LOW);\n        h1 ^= k1;\n        h1 = (h1 << 13) | (h1 >>> 19);\n        h1 = h1 * 5 + 0xe6546b64;\n      } else {\n        k2 = dataUint32[i];\n        k2 = ((k2 * C1) & MASK_HIGH) | ((k2 * C1_LOW) & MASK_LOW);\n        k2 = (k2 << 15) | (k2 >>> 17);\n        k2 = ((k2 * C2) & MASK_HIGH) | ((k2 * C2_LOW) & MASK_LOW);\n        h2 ^= k2;\n        h2 = (h2 << 13) | (h2 >>> 19);\n        h2 = h2 * 5 + 0xe6546b64;\n      }\n    }\n\n    k1 = 0;\n\n    switch (tailLength) {\n      case 3:\n        k1 ^= data[blockCounts * 4 + 2] << 16;\n      /* falls through */\n      case 2:\n        k1 ^= data[blockCounts * 4 + 1] << 8;\n      /* falls through */\n      case 1:\n        k1 ^= data[blockCounts * 4];\n        /* falls through */\n\n        k1 = ((k1 * C1) & MASK_HIGH) | ((k1 * C1_LOW) & MASK_LOW);\n        k1 = (k1 << 15) | (k1 >>> 17);\n        k1 = ((k1 * C2) & MASK_HIGH) | ((k1 * C2_LOW) & MASK_LOW);\n        if (blockCounts & 1) {\n          h1 ^= k1;\n        } else {\n          h2 ^= k1;\n        }\n    }\n\n    this.h1 = h1;\n    this.h2 = h2;\n  }\n\n  hexdigest() {\n    let h1 = this.h1,\n      h2 = this.h2;\n\n    h1 ^= h2 >>> 1;\n    h1 = ((h1 * 0xed558ccd) & MASK_HIGH) | ((h1 * 0x8ccd) & MASK_LOW);\n    h2 =\n      ((h2 * 0xff51afd7) & MASK_HIGH) |\n      (((((h2 << 16) | (h1 >>> 16)) * 0xafd7ed55) & MASK_HIGH) >>> 16);\n    h1 ^= h2 >>> 1;\n    h1 = ((h1 * 0x1a85ec53) & MASK_HIGH) | ((h1 * 0xec53) & MASK_LOW);\n    h2 =\n      ((h2 * 0xc4ceb9fe) & MASK_HIGH) |\n      (((((h2 << 16) | (h1 >>> 16)) * 0xb9fe1a85) & MASK_HIGH) >>> 16);\n    h1 ^= h2 >>> 1;\n\n    return (\n      (h1 >>> 0).toString(16).padStart(8, \"0\") +\n      (h2 >>> 0).toString(16).padStart(8, \"0\")\n    );\n  }\n}\n\nexport { MurmurHash3_64 };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { shadow, unreachable } from \"../shared/util.js\";\nimport { AnnotationEditor } from \"./editor/editor.js\";\nimport { MurmurHash3_64 } from \"../shared/murmurhash3.js\";\n\nconst SerializableEmpty = Object.freeze({\n  map: null,\n  hash: \"\",\n  transfer: undefined,\n});\n\n/**\n * Key/value storage for annotation data in forms.\n */\nclass AnnotationStorage {\n  #modified = false;\n\n  #modifiedIds = null;\n\n  #editorsMap = null;\n\n  #storage = new Map();\n\n  constructor() {\n    // Callbacks to signal when the modification state is set or reset.\n    // This is used by the viewer to only bind on `beforeunload` if forms\n    // are actually edited to prevent doing so unconditionally since that\n    // can have undesirable effects.\n    this.onSetModified = null;\n    this.onResetModified = null;\n    this.onAnnotationEditor = null;\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"_setValues\", {\n        value: obj => {\n          for (const [key, val] of Object.entries(obj)) {\n            this.setValue(key, val);\n          }\n        },\n      });\n    }\n  }\n\n  /**\n   * Get the value for a given key if it exists, or return the default value.\n   * @param {string} key\n   * @param {Object} defaultValue\n   * @returns {Object}\n   */\n  getValue(key, defaultValue) {\n    const value = this.#storage.get(key);\n    if (value === undefined) {\n      return defaultValue;\n    }\n\n    return Object.assign(defaultValue, value);\n  }\n\n  /**\n   * Get the value for a given key.\n   * @param {string} key\n   * @returns {Object}\n   */\n  getRawValue(key) {\n    return this.#storage.get(key);\n  }\n\n  /**\n   * Remove a value from the storage.\n   * @param {string} key\n   */\n  remove(key) {\n    const storedValue = this.#storage.get(key);\n    if (storedValue === undefined) {\n      return;\n    }\n    if (storedValue instanceof AnnotationEditor) {\n      this.#editorsMap.delete(storedValue.annotationElementId);\n    }\n    this.#storage.delete(key);\n\n    if (this.#storage.size === 0) {\n      this.resetModified();\n    }\n\n    if (typeof this.onAnnotationEditor === \"function\") {\n      for (const value of this.#storage.values()) {\n        if (value instanceof AnnotationEditor) {\n          return;\n        }\n      }\n      this.onAnnotationEditor(null);\n    }\n  }\n\n  /**\n   * Set the value for a given key\n   * @param {string} key\n   * @param {Object} value\n   */\n  setValue(key, value) {\n    const obj = this.#storage.get(key);\n    let modified = false;\n    if (obj !== undefined) {\n      for (const [entry, val] of Object.entries(value)) {\n        if (obj[entry] !== val) {\n          modified = true;\n          obj[entry] = val;\n        }\n      }\n    } else {\n      modified = true;\n      this.#storage.set(key, value);\n    }\n    if (modified) {\n      this.#setModified();\n    }\n\n    if (value instanceof AnnotationEditor) {\n      (this.#editorsMap ||= new Map()).set(value.annotationElementId, value);\n      if (typeof this.onAnnotationEditor === \"function\") {\n        this.onAnnotationEditor(value.constructor._type);\n      }\n    }\n  }\n\n  /**\n   * Check if the storage contains the given key.\n   * @param {string} key\n   * @returns {boolean}\n   */\n  has(key) {\n    return this.#storage.has(key);\n  }\n\n  get size() {\n    return this.#storage.size;\n  }\n\n  #setModified() {\n    if (!this.#modified) {\n      this.#modified = true;\n      if (typeof this.onSetModified === \"function\") {\n        this.onSetModified();\n      }\n    }\n  }\n\n  resetModified() {\n    if (this.#modified) {\n      this.#modified = false;\n      if (typeof this.onResetModified === \"function\") {\n        this.onResetModified();\n      }\n    }\n  }\n\n  /**\n   * @returns {PrintAnnotationStorage}\n   */\n  get print() {\n    return new PrintAnnotationStorage(this);\n  }\n\n  /**\n   * PLEASE NOTE: Only intended for usage within the API itself.\n   * @ignore\n   */\n  get serializable() {\n    if (this.#storage.size === 0) {\n      return SerializableEmpty;\n    }\n    const map = new Map(),\n      hash = new MurmurHash3_64(),\n      transfer = [];\n    const context = Object.create(null);\n    let hasBitmap = false;\n\n    for (const [key, val] of this.#storage) {\n      const serialized =\n        val instanceof AnnotationEditor\n          ? val.serialize(/* isForCopying = */ false, context)\n          : val;\n      if (serialized) {\n        map.set(key, serialized);\n\n        hash.update(`${key}:${JSON.stringify(serialized)}`);\n        hasBitmap ||= !!serialized.bitmap;\n      }\n    }\n\n    if (hasBitmap) {\n      // We must transfer the bitmap data separately, since it can be changed\n      // during serialization with SVG images.\n      for (const value of map.values()) {\n        if (value.bitmap) {\n          transfer.push(value.bitmap);\n        }\n      }\n    }\n\n    return map.size > 0\n      ? { map, hash: hash.hexdigest(), transfer }\n      : SerializableEmpty;\n  }\n\n  get editorStats() {\n    let stats = null;\n    const typeToEditor = new Map();\n    let numberOfEditedComments = 0;\n    let numberOfDeletedComments = 0;\n    for (const value of this.#storage.values()) {\n      if (!(value instanceof AnnotationEditor)) {\n        if (value.popup) {\n          if (value.popup.deleted) {\n            numberOfDeletedComments += 1;\n          } else {\n            numberOfEditedComments += 1;\n          }\n        }\n        continue;\n      }\n      if (value.isCommentDeleted) {\n        numberOfDeletedComments += 1;\n      } else if (value.hasEditedComment) {\n        numberOfEditedComments += 1;\n      }\n      const editorStats = value.telemetryFinalData;\n      if (!editorStats) {\n        continue;\n      }\n      const { type } = editorStats;\n      if (!typeToEditor.has(type)) {\n        typeToEditor.set(type, Object.getPrototypeOf(value).constructor);\n      }\n      stats ||= Object.create(null);\n      const map = (stats[type] ||= new Map());\n      for (const [key, val] of Object.entries(editorStats)) {\n        if (key === \"type\") {\n          continue;\n        }\n        let counters = map.get(key);\n        if (!counters) {\n          counters = new Map();\n          map.set(key, counters);\n        }\n        const count = counters.get(val) ?? 0;\n        counters.set(val, count + 1);\n      }\n    }\n    if (numberOfDeletedComments > 0 || numberOfEditedComments > 0) {\n      stats ||= Object.create(null);\n      stats.comments = {\n        deleted: numberOfDeletedComments,\n        edited: numberOfEditedComments,\n      };\n    }\n    if (!stats) {\n      return null;\n    }\n    for (const [type, editor] of typeToEditor) {\n      stats[type] = editor.computeTelemetryFinalData(stats[type]);\n    }\n    return stats;\n  }\n\n  resetModifiedIds() {\n    this.#modifiedIds = null;\n  }\n\n  updateEditor(annotationId, data) {\n    const value = this.#editorsMap?.get(annotationId);\n    if (value) {\n      value.updateFromAnnotationLayer(data);\n      return true;\n    }\n    return false;\n  }\n\n  getEditor(annotationId) {\n    return this.#editorsMap?.get(annotationId) || null;\n  }\n\n  /**\n   * @returns {{ids: Set<string>, hash: string}}\n   */\n  get modifiedIds() {\n    if (this.#modifiedIds) {\n      return this.#modifiedIds;\n    }\n    const ids = [];\n    if (this.#editorsMap) {\n      for (const value of this.#editorsMap.values()) {\n        if (!value.serialize()) {\n          continue;\n        }\n        ids.push(value.annotationElementId);\n      }\n    }\n    return (this.#modifiedIds = {\n      ids: new Set(ids),\n      hash: ids.join(\",\"),\n    });\n  }\n\n  [Symbol.iterator]() {\n    return this.#storage.entries();\n  }\n}\n\n/**\n * A special `AnnotationStorage` for use during printing, where the serializable\n * data is *frozen* upon initialization, to prevent scripting from modifying its\n * contents. (Necessary since printing is triggered synchronously in browsers.)\n */\nclass PrintAnnotationStorage extends AnnotationStorage {\n  #serializable;\n\n  constructor(parent) {\n    super();\n    const { map, hash, transfer } = parent.serializable;\n    // Create a *copy* of the data, since Objects are passed by reference in JS.\n    const clone = structuredClone(map, transfer ? { transfer } : null);\n\n    this.#serializable = { map: clone, hash, transfer };\n  }\n\n  /**\n   * @returns {PrintAnnotationStorage}\n   */\n  // eslint-disable-next-line getter-return\n  get print() {\n    unreachable(\"Should not call PrintAnnotationStorage.print\");\n  }\n\n  /**\n   * PLEASE NOTE: Only intended for usage within the API itself.\n   * @ignore\n   */\n  get serializable() {\n    return this.#serializable;\n  }\n\n  get modifiedIds() {\n    return shadow(this, \"modifiedIds\", {\n      ids: new Set(),\n      hash: \"\",\n    });\n  }\n}\n\nexport { AnnotationStorage, PrintAnnotationStorage, SerializableEmpty };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  assert,\n  FeatureTest,\n  isNodeJS,\n  shadow,\n  string32,\n  toBase64Util,\n  unreachable,\n  warn,\n} from \"../shared/util.js\";\nimport { makePathFromDrawOPS } from \"./display_utils.js\";\n\nclass FontLoader {\n  #systemFonts = new Set();\n\n  constructor({\n    ownerDocument = globalThis.document,\n    styleElement = null, // For testing only.\n  }) {\n    this._document = ownerDocument;\n\n    this.nativeFontFaces = new Set();\n    this.styleElement =\n      typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")\n        ? styleElement\n        : null;\n\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) {\n      this.loadingRequests = [];\n      this.loadTestFontId = 0;\n    }\n  }\n\n  addNativeFontFace(nativeFontFace) {\n    this.nativeFontFaces.add(nativeFontFace);\n    this._document.fonts.add(nativeFontFace);\n  }\n\n  removeNativeFontFace(nativeFontFace) {\n    this.nativeFontFaces.delete(nativeFontFace);\n    this._document.fonts.delete(nativeFontFace);\n  }\n\n  insertRule(rule) {\n    if (!this.styleElement) {\n      this.styleElement = this._document.createElement(\"style\");\n      this._document.documentElement\n        .getElementsByTagName(\"head\")[0]\n        .append(this.styleElement);\n    }\n    const styleSheet = this.styleElement.sheet;\n    styleSheet.insertRule(rule, styleSheet.cssRules.length);\n  }\n\n  clear() {\n    for (const nativeFontFace of this.nativeFontFaces) {\n      this._document.fonts.delete(nativeFontFace);\n    }\n    this.nativeFontFaces.clear();\n    this.#systemFonts.clear();\n\n    if (this.styleElement) {\n      // Note: ChildNode.remove doesn't throw if the parentNode is undefined.\n      this.styleElement.remove();\n      this.styleElement = null;\n    }\n  }\n\n  async loadSystemFont({\n    systemFontInfo: info,\n    disableFontFace,\n    _inspectFont,\n  }) {\n    if (!info || this.#systemFonts.has(info.loadedName)) {\n      return;\n    }\n    assert(\n      !disableFontFace,\n      \"loadSystemFont shouldn't be called when `disableFontFace` is set.\"\n    );\n\n    if (this.isFontLoadingAPISupported) {\n      const { loadedName, src, style } = info;\n      const fontFace = new FontFace(loadedName, src, style);\n      this.addNativeFontFace(fontFace);\n      try {\n        await fontFace.load();\n        this.#systemFonts.add(loadedName);\n        _inspectFont?.(info);\n      } catch {\n        warn(\n          `Cannot load system font: ${info.baseFontName}, installing it could help to improve PDF rendering.`\n        );\n\n        this.removeNativeFontFace(fontFace);\n      }\n      return;\n    }\n\n    unreachable(\n      \"Not implemented: loadSystemFont without the Font Loading API.\"\n    );\n  }\n\n  async bind(font) {\n    // Add the font to the DOM only once; skip if the font is already loaded.\n    if (font.attached || (font.missingFile && !font.systemFontInfo)) {\n      return;\n    }\n    font.attached = true;\n\n    if (font.systemFontInfo) {\n      await this.loadSystemFont(font);\n      return;\n    }\n\n    if (this.isFontLoadingAPISupported) {\n      const nativeFontFace = font.createNativeFontFace();\n      if (nativeFontFace) {\n        this.addNativeFontFace(nativeFontFace);\n        try {\n          await nativeFontFace.loaded;\n        } catch (ex) {\n          warn(`Failed to load font '${nativeFontFace.family}': '${ex}'.`);\n\n          // When font loading failed, fall back to the built-in font renderer.\n          font.disableFontFace = true;\n          throw ex;\n        }\n      }\n      return; // The font was, asynchronously, loaded.\n    }\n\n    // !this.isFontLoadingAPISupported\n    const rule = font.createFontFaceRule();\n    if (rule) {\n      this.insertRule(rule);\n\n      if (this.isSyncFontLoadingSupported) {\n        return; // The font was, synchronously, loaded.\n      }\n      if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n        throw new Error(\"Not implemented: async font loading\");\n      }\n      await new Promise(resolve => {\n        const request = this._queueLoadingCallback(resolve);\n        this._prepareFontLoadEvent(font, request);\n      });\n      // The font was, asynchronously, loaded.\n    }\n  }\n\n  get isFontLoadingAPISupported() {\n    const hasFonts = !!this._document?.fonts;\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      return shadow(\n        this,\n        \"isFontLoadingAPISupported\",\n        hasFonts && !this.styleElement\n      );\n    }\n    return shadow(this, \"isFontLoadingAPISupported\", hasFonts);\n  }\n\n  get isSyncFontLoadingSupported() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      return shadow(this, \"isSyncFontLoadingSupported\", true);\n    }\n\n    // Node.js - we can pretend that sync font loading is supported.\n    // Firefox, from version 14, supports synchronous font loading.\n    return shadow(\n      this,\n      \"isSyncFontLoadingSupported\",\n      (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"CHROME\")) &&\n        (isNodeJS || FeatureTest.platform.isFirefox)\n    );\n  }\n\n  _queueLoadingCallback(callback) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _queueLoadingCallback\");\n    }\n\n    function completeRequest() {\n      assert(!request.done, \"completeRequest() cannot be called twice.\");\n      request.done = true;\n\n      // Sending all completed requests in order of how they were queued.\n      while (loadingRequests.length > 0 && loadingRequests[0].done) {\n        const otherRequest = loadingRequests.shift();\n        setTimeout(otherRequest.callback, 0);\n      }\n    }\n\n    const { loadingRequests } = this;\n    const request = {\n      done: false,\n      complete: completeRequest,\n      callback,\n    };\n    loadingRequests.push(request);\n    return request;\n  }\n\n  get _loadTestFont() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _loadTestFont\");\n    }\n\n    // This is a CFF font with 1 glyph for '.' that fills its entire width\n    // and height.\n    const testFont = atob(\n      \"T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQA\" +\n        \"FQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAA\" +\n        \"ALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgA\" +\n        \"AAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1\" +\n        \"AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD\" +\n        \"6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACM\" +\n        \"AooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4D\" +\n        \"IP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAA\" +\n        \"AAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUA\" +\n        \"AQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgAB\" +\n        \"AAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABY\" +\n        \"AAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAA\" +\n        \"AC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAA\" +\n        \"AAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQAC\" +\n        \"AQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3\" +\n        \"Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTj\" +\n        \"FQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==\"\n    );\n    return shadow(this, \"_loadTestFont\", testFont);\n  }\n\n  _prepareFontLoadEvent(font, request) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _prepareFontLoadEvent\");\n    }\n\n    /** Hack begin */\n    // There's currently no event when a font has finished downloading so the\n    // following code is a dirty hack to 'guess' when a font is ready.\n    // It's assumed fonts are loaded in order, so add a known test font after\n    // the desired fonts and then test for the loading of that test font.\n\n    function int32(data, offset) {\n      return (\n        (data.charCodeAt(offset) << 24) |\n        (data.charCodeAt(offset + 1) << 16) |\n        (data.charCodeAt(offset + 2) << 8) |\n        (data.charCodeAt(offset + 3) & 0xff)\n      );\n    }\n    function spliceString(s, offset, remove, insert) {\n      const chunk1 = s.substring(0, offset);\n      const chunk2 = s.substring(offset + remove);\n      return chunk1 + insert + chunk2;\n    }\n    let i, ii;\n\n    // The temporary canvas is used to determine if fonts are loaded.\n    const canvas = this._document.createElement(\"canvas\");\n    canvas.width = 1;\n    canvas.height = 1;\n    const ctx = canvas.getContext(\"2d\");\n\n    let called = 0;\n    function isFontReady(name, callback) {\n      // With setTimeout clamping this gives the font ~100ms to load.\n      if (++called > 30) {\n        warn(\"Load test font never loaded.\");\n        callback();\n        return;\n      }\n      ctx.font = \"30px \" + name;\n      ctx.fillText(\".\", 0, 20);\n      const imageData = ctx.getImageData(0, 0, 1, 1);\n      if (imageData.data[3] > 0) {\n        callback();\n        return;\n      }\n      setTimeout(isFontReady.bind(null, name, callback));\n    }\n\n    const loadTestFontId = `lt${Date.now()}${this.loadTestFontId++}`;\n    // Chromium seems to cache fonts based on a hash of the actual font data,\n    // so the font must be modified for each load test else it will appear to\n    // be loaded already.\n    // TODO: This could maybe be made faster by avoiding the btoa of the full\n    // font by splitting it in chunks before hand and padding the font id.\n    let data = this._loadTestFont;\n    const COMMENT_OFFSET = 976; // has to be on 4 byte boundary (for checksum)\n    data = spliceString(\n      data,\n      COMMENT_OFFSET,\n      loadTestFontId.length,\n      loadTestFontId\n    );\n    // CFF checksum is important for IE, adjusting it\n    const CFF_CHECKSUM_OFFSET = 16;\n    const XXXX_VALUE = 0x58585858; // the \"comment\" filled with 'X'\n    let checksum = int32(data, CFF_CHECKSUM_OFFSET);\n    for (i = 0, ii = loadTestFontId.length - 3; i < ii; i += 4) {\n      checksum = (checksum - XXXX_VALUE + int32(loadTestFontId, i)) | 0;\n    }\n    if (i < loadTestFontId.length) {\n      // align to 4 bytes boundary\n      checksum = (checksum - XXXX_VALUE + int32(loadTestFontId + \"XXX\", i)) | 0;\n    }\n    data = spliceString(data, CFF_CHECKSUM_OFFSET, 4, string32(checksum));\n\n    const url = `url(data:font/opentype;base64,${btoa(data)});`;\n    const rule = `@font-face {font-family:\"${loadTestFontId}\";src:${url}}`;\n    this.insertRule(rule);\n\n    const div = this._document.createElement(\"div\");\n    div.style.visibility = \"hidden\";\n    div.style.width = div.style.height = \"10px\";\n    div.style.position = \"absolute\";\n    div.style.top = div.style.left = \"0px\";\n\n    for (const name of [font.loadedName, loadTestFontId]) {\n      const span = this._document.createElement(\"span\");\n      span.textContent = \"Hi\";\n      span.style.fontFamily = name;\n      div.append(span);\n    }\n    this._document.body.append(div);\n\n    isFontReady(loadTestFontId, () => {\n      div.remove();\n      request.complete();\n    });\n    /** Hack end */\n  }\n}\n\nclass FontFaceObject {\n  #fontData;\n\n  constructor(translatedData, inspectFont = null, extra, charProcOperatorList) {\n    this.compiledGlyphs = Object.create(null);\n    this.#fontData = translatedData;\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      if (typeof this.disableFontFace !== \"boolean\") {\n        unreachable(\"disableFontFace must be available.\");\n      }\n      if (typeof this.fontExtraProperties !== \"boolean\") {\n        unreachable(\"fontExtraProperties must be available.\");\n      }\n    }\n    this._inspectFont = inspectFont;\n    if (extra) {\n      Object.assign(this, extra);\n    }\n    if (charProcOperatorList) {\n      this.charProcOperatorList = charProcOperatorList;\n    }\n  }\n\n  createNativeFontFace() {\n    if (!this.data || this.disableFontFace) {\n      return null;\n    }\n    let nativeFontFace;\n    if (!this.cssFontInfo) {\n      nativeFontFace = new FontFace(this.loadedName, this.data, {});\n    } else {\n      const css = {\n        weight: this.cssFontInfo.fontWeight,\n      };\n      if (this.cssFontInfo.italicAngle) {\n        css.style = `oblique ${this.cssFontInfo.italicAngle}deg`;\n      }\n      nativeFontFace = new FontFace(\n        this.cssFontInfo.fontFamily,\n        this.data,\n        css\n      );\n    }\n\n    this._inspectFont?.(this);\n    return nativeFontFace;\n  }\n\n  createFontFaceRule() {\n    if (!this.data || this.disableFontFace) {\n      return null;\n    }\n    // Add the @font-face rule to the document.\n    const url = `url(data:${this.mimetype};base64,${toBase64Util(this.data)});`;\n    let rule;\n    if (!this.cssFontInfo) {\n      rule = `@font-face {font-family:\"${this.loadedName}\";src:${url}}`;\n    } else {\n      let css = `font-weight: ${this.cssFontInfo.fontWeight};`;\n      if (this.cssFontInfo.italicAngle) {\n        css += `font-style: oblique ${this.cssFontInfo.italicAngle}deg;`;\n      }\n      rule = `@font-face {font-family:\"${this.cssFontInfo.fontFamily}\";${css}src:${url}}`;\n    }\n\n    this._inspectFont?.(this, url);\n    return rule;\n  }\n\n  getPathGenerator(objs, character) {\n    if (this.compiledGlyphs[character] !== undefined) {\n      return this.compiledGlyphs[character];\n    }\n\n    const objId = this.loadedName + \"_path_\" + character;\n    let cmds;\n    try {\n      cmds = objs.get(objId);\n    } catch (ex) {\n      warn(`getPathGenerator - ignoring character: \"${ex}\".`);\n    }\n    const path = makePathFromDrawOPS(cmds?.path);\n\n    if (!this.fontExtraProperties) {\n      // Remove the raw path-string, since we don't need it anymore.\n      objs.delete(objId);\n    }\n    return (this.compiledGlyphs[character] = path);\n  }\n\n  get black() {\n    return this.#fontData.black;\n  }\n\n  get bold() {\n    return this.#fontData.bold;\n  }\n\n  get disableFontFace() {\n    return this.#fontData.disableFontFace ?? false;\n  }\n\n  set disableFontFace(value) {\n    shadow(this, \"disableFontFace\", !!value);\n  }\n\n  get fontExtraProperties() {\n    return this.#fontData.fontExtraProperties ?? false;\n  }\n\n  get isInvalidPDFjsFont() {\n    return this.#fontData.isInvalidPDFjsFont;\n  }\n\n  get isType3Font() {\n    return this.#fontData.isType3Font;\n  }\n\n  get italic() {\n    return this.#fontData.italic;\n  }\n\n  get missingFile() {\n    return this.#fontData.missingFile;\n  }\n\n  get remeasure() {\n    return this.#fontData.remeasure;\n  }\n\n  get vertical() {\n    return this.#fontData.vertical;\n  }\n\n  get ascent() {\n    return this.#fontData.ascent;\n  }\n\n  get defaultWidth() {\n    return this.#fontData.defaultWidth;\n  }\n\n  get descent() {\n    return this.#fontData.descent;\n  }\n\n  get bbox() {\n    return this.#fontData.bbox;\n  }\n\n  set bbox(bbox) {\n    shadow(this, \"bbox\", bbox);\n  }\n\n  get fontMatrix() {\n    return this.#fontData.fontMatrix;\n  }\n\n  get fallbackName() {\n    return this.#fontData.fallbackName;\n  }\n\n  get loadedName() {\n    return this.#fontData.loadedName;\n  }\n\n  get mimetype() {\n    return this.#fontData.mimetype;\n  }\n\n  get name() {\n    return this.#fontData.name;\n  }\n\n  get data() {\n    return this.#fontData.data;\n  }\n\n  clearData() {\n    this.#fontData.clearData();\n  }\n\n  get cssFontInfo() {\n    return this.#fontData.cssFontInfo;\n  }\n\n  get systemFontInfo() {\n    return this.#fontData.systemFontInfo;\n  }\n\n  get defaultVMetrics() {\n    return this.#fontData.defaultVMetrics;\n  }\n}\n\nexport { FontFaceObject, FontLoader };\n","/* Copyright 2025 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert, FeatureTest, MeshFigureType } from \"./util.js\";\n\nclass CssFontInfo {\n  #buffer;\n\n  #view;\n\n  #decoder;\n\n  static strings = [\"fontFamily\", \"fontWeight\", \"italicAngle\"];\n\n  static write(info) {\n    const encoder = new TextEncoder();\n    const encodedStrings = {};\n    let stringsLength = 0;\n    for (const prop of CssFontInfo.strings) {\n      const encoded = encoder.encode(info[prop]);\n      encodedStrings[prop] = encoded;\n      stringsLength += 4 + encoded.length;\n    }\n\n    const buffer = new ArrayBuffer(stringsLength);\n    const data = new Uint8Array(buffer);\n    const view = new DataView(buffer);\n    let offset = 0;\n\n    for (const prop of CssFontInfo.strings) {\n      const encoded = encodedStrings[prop];\n      const length = encoded.length;\n      view.setUint32(offset, length);\n      data.set(encoded, offset + 4);\n      offset += 4 + length;\n    }\n    assert(offset === buffer.byteLength, \"CssFontInfo.write: Buffer overflow\");\n    return buffer;\n  }\n\n  constructor(buffer) {\n    this.#buffer = buffer;\n    this.#view = new DataView(this.#buffer);\n    this.#decoder = new TextDecoder();\n  }\n\n  #readString(index) {\n    assert(index < CssFontInfo.strings.length, \"Invalid string index\");\n    let offset = 0;\n    for (let i = 0; i < index; i++) {\n      offset += this.#view.getUint32(offset) + 4;\n    }\n    const length = this.#view.getUint32(offset);\n    return this.#decoder.decode(\n      new Uint8Array(this.#buffer, offset + 4, length)\n    );\n  }\n\n  get fontFamily() {\n    return this.#readString(0);\n  }\n\n  get fontWeight() {\n    return this.#readString(1);\n  }\n\n  get italicAngle() {\n    return this.#readString(2);\n  }\n}\n\nclass SystemFontInfo {\n  #buffer;\n\n  #view;\n\n  #decoder;\n\n  static strings = [\"css\", \"loadedName\", \"baseFontName\", \"src\"];\n\n  static write(info) {\n    const encoder = new TextEncoder();\n    const encodedStrings = {};\n    let stringsLength = 0;\n    for (const prop of SystemFontInfo.strings) {\n      const encoded = encoder.encode(info[prop]);\n      encodedStrings[prop] = encoded;\n      stringsLength += 4 + encoded.length;\n    }\n    stringsLength += 4;\n    let encodedStyleStyle,\n      encodedStyleWeight,\n      lengthEstimate = 1 + stringsLength;\n    if (info.style) {\n      encodedStyleStyle = encoder.encode(info.style.style);\n      encodedStyleWeight = encoder.encode(info.style.weight);\n      lengthEstimate +=\n        4 + encodedStyleStyle.length + 4 + encodedStyleWeight.length;\n    }\n\n    const buffer = new ArrayBuffer(lengthEstimate);\n    const data = new Uint8Array(buffer);\n    const view = new DataView(buffer);\n    let offset = 0;\n\n    view.setUint8(offset++, info.guessFallback ? 1 : 0);\n    view.setUint32(offset, 0);\n    offset += 4;\n    stringsLength = 0;\n    for (const prop of SystemFontInfo.strings) {\n      const encoded = encodedStrings[prop];\n      const length = encoded.length;\n      stringsLength += 4 + length;\n      view.setUint32(offset, length);\n      data.set(encoded, offset + 4);\n      offset += 4 + length;\n    }\n    view.setUint32(offset - stringsLength - 4, stringsLength);\n\n    if (info.style) {\n      view.setUint32(offset, encodedStyleStyle.length);\n      data.set(encodedStyleStyle, offset + 4);\n      offset += 4 + encodedStyleStyle.length;\n      view.setUint32(offset, encodedStyleWeight.length);\n      data.set(encodedStyleWeight, offset + 4);\n      offset += 4 + encodedStyleWeight.length;\n    }\n    assert(\n      offset <= buffer.byteLength,\n      \"SubstitionInfo.write: Buffer overflow\"\n    );\n    return buffer.transferToFixedLength(offset);\n  }\n\n  constructor(buffer) {\n    this.#buffer = buffer;\n    this.#view = new DataView(this.#buffer);\n    this.#decoder = new TextDecoder();\n  }\n\n  get guessFallback() {\n    return this.#view.getUint8(0) !== 0;\n  }\n\n  #readString(index) {\n    assert(index < SystemFontInfo.strings.length, \"Invalid string index\");\n    let offset = 5;\n    for (let i = 0; i < index; i++) {\n      offset += this.#view.getUint32(offset) + 4;\n    }\n    const length = this.#view.getUint32(offset);\n    return this.#decoder.decode(\n      new Uint8Array(this.#buffer, offset + 4, length)\n    );\n  }\n\n  get css() {\n    return this.#readString(0);\n  }\n\n  get loadedName() {\n    return this.#readString(1);\n  }\n\n  get baseFontName() {\n    return this.#readString(2);\n  }\n\n  get src() {\n    return this.#readString(3);\n  }\n\n  get style() {\n    let offset = 1;\n    offset += 4 + this.#view.getUint32(offset);\n    const styleLength = this.#view.getUint32(offset);\n    const style = this.#decoder.decode(\n      new Uint8Array(this.#buffer, offset + 4, styleLength)\n    );\n    offset += 4 + styleLength;\n    const weightLength = this.#view.getUint32(offset);\n    const weight = this.#decoder.decode(\n      new Uint8Array(this.#buffer, offset + 4, weightLength)\n    );\n    return { style, weight };\n  }\n}\n\nclass FontInfo {\n  static bools = [\n    \"black\",\n    \"bold\",\n    \"disableFontFace\",\n    \"fontExtraProperties\",\n    \"isInvalidPDFjsFont\",\n    \"isType3Font\",\n    \"italic\",\n    \"missingFile\",\n    \"remeasure\",\n    \"vertical\",\n  ];\n\n  static numbers = [\"ascent\", \"defaultWidth\", \"descent\"];\n\n  static strings = [\"fallbackName\", \"loadedName\", \"mimetype\", \"name\"];\n\n  static #OFFSET_NUMBERS = Math.ceil((this.bools.length * 2) / 8);\n\n  static #OFFSET_BBOX = this.#OFFSET_NUMBERS + this.numbers.length * 8;\n\n  static #OFFSET_FONT_MATRIX = this.#OFFSET_BBOX + 1 + 2 * 4;\n\n  static #OFFSET_DEFAULT_VMETRICS = this.#OFFSET_FONT_MATRIX + 1 + 8 * 6;\n\n  static #OFFSET_STRINGS = this.#OFFSET_DEFAULT_VMETRICS + 1 + 2 * 3;\n\n  #buffer;\n\n  #decoder;\n\n  #view;\n\n  constructor({ data, extra }) {\n    this.#buffer = data;\n    this.#decoder = new TextDecoder();\n    this.#view = new DataView(this.#buffer);\n    if (extra) {\n      Object.assign(this, extra);\n    }\n  }\n\n  #readBoolean(index) {\n    assert(index < FontInfo.bools.length, \"Invalid boolean index\");\n    const byteOffset = Math.floor(index / 4);\n    const bitOffset = (index * 2) % 8;\n    const value = (this.#view.getUint8(byteOffset) >> bitOffset) & 0x03;\n    return value === 0x00 ? undefined : value === 0x02;\n  }\n\n  get black() {\n    return this.#readBoolean(0);\n  }\n\n  get bold() {\n    return this.#readBoolean(1);\n  }\n\n  get disableFontFace() {\n    return this.#readBoolean(2);\n  }\n\n  get fontExtraProperties() {\n    return this.#readBoolean(3);\n  }\n\n  get isInvalidPDFjsFont() {\n    return this.#readBoolean(4);\n  }\n\n  get isType3Font() {\n    return this.#readBoolean(5);\n  }\n\n  get italic() {\n    return this.#readBoolean(6);\n  }\n\n  get missingFile() {\n    return this.#readBoolean(7);\n  }\n\n  get remeasure() {\n    return this.#readBoolean(8);\n  }\n\n  get vertical() {\n    return this.#readBoolean(9);\n  }\n\n  #readNumber(index) {\n    assert(index < FontInfo.numbers.length, \"Invalid number index\");\n    return this.#view.getFloat64(FontInfo.#OFFSET_NUMBERS + index * 8);\n  }\n\n  get ascent() {\n    return this.#readNumber(0);\n  }\n\n  get defaultWidth() {\n    return this.#readNumber(1);\n  }\n\n  get descent() {\n    return this.#readNumber(2);\n  }\n\n  get bbox() {\n    let offset = FontInfo.#OFFSET_BBOX;\n    const numCoords = this.#view.getUint8(offset);\n    if (numCoords === 0) {\n      return undefined;\n    }\n    offset += 1;\n    const bbox = [];\n    for (let i = 0; i < 4; i++) {\n      bbox.push(this.#view.getInt16(offset, true));\n      offset += 2;\n    }\n    return bbox;\n  }\n\n  get fontMatrix() {\n    let offset = FontInfo.#OFFSET_FONT_MATRIX;\n    const numPoints = this.#view.getUint8(offset);\n    if (numPoints === 0) {\n      return undefined;\n    }\n    offset += 1;\n    const fontMatrix = [];\n    for (let i = 0; i < 6; i++) {\n      fontMatrix.push(this.#view.getFloat64(offset, true));\n      offset += 8;\n    }\n    return fontMatrix;\n  }\n\n  get defaultVMetrics() {\n    let offset = FontInfo.#OFFSET_DEFAULT_VMETRICS;\n    const numMetrics = this.#view.getUint8(offset);\n    if (numMetrics === 0) {\n      return undefined;\n    }\n    offset += 1;\n    const defaultVMetrics = [];\n    for (let i = 0; i < 3; i++) {\n      defaultVMetrics.push(this.#view.getInt16(offset, true));\n      offset += 2;\n    }\n    return defaultVMetrics;\n  }\n\n  #readString(index) {\n    assert(index < FontInfo.strings.length, \"Invalid string index\");\n    let offset = FontInfo.#OFFSET_STRINGS + 4;\n    for (let i = 0; i < index; i++) {\n      offset += this.#view.getUint32(offset) + 4;\n    }\n    const length = this.#view.getUint32(offset);\n    const stringData = new Uint8Array(length);\n    stringData.set(new Uint8Array(this.#buffer, offset + 4, length));\n    return this.#decoder.decode(stringData);\n  }\n\n  get fallbackName() {\n    return this.#readString(0);\n  }\n\n  get loadedName() {\n    return this.#readString(1);\n  }\n\n  get mimetype() {\n    return this.#readString(2);\n  }\n\n  get name() {\n    return this.#readString(3);\n  }\n\n  get data() {\n    let offset = FontInfo.#OFFSET_STRINGS;\n    const stringsLength = this.#view.getUint32(offset);\n    offset += 4 + stringsLength;\n    const systemFontInfoLength = this.#view.getUint32(offset);\n    offset += 4 + systemFontInfoLength;\n    const cssFontInfoLength = this.#view.getUint32(offset);\n    offset += 4 + cssFontInfoLength;\n    const length = this.#view.getUint32(offset);\n    if (length === 0) {\n      return undefined;\n    }\n    return new Uint8Array(this.#buffer, offset + 4, length);\n  }\n\n  clearData() {\n    let offset = FontInfo.#OFFSET_STRINGS;\n    const stringsLength = this.#view.getUint32(offset);\n    offset += 4 + stringsLength;\n    const systemFontInfoLength = this.#view.getUint32(offset);\n    offset += 4 + systemFontInfoLength;\n    const cssFontInfoLength = this.#view.getUint32(offset);\n    offset += 4 + cssFontInfoLength;\n    const length = this.#view.getUint32(offset);\n    const data = new Uint8Array(this.#buffer, offset + 4, length);\n    data.fill(0);\n    this.#view.setUint32(offset, 0);\n    // this.#buffer.resize(offset);\n  }\n\n  get cssFontInfo() {\n    let offset = FontInfo.#OFFSET_STRINGS;\n    const stringsLength = this.#view.getUint32(offset);\n    offset += 4 + stringsLength;\n    const systemFontInfoLength = this.#view.getUint32(offset);\n    offset += 4 + systemFontInfoLength;\n    const cssFontInfoLength = this.#view.getUint32(offset);\n    if (cssFontInfoLength === 0) {\n      return null;\n    }\n    const cssFontInfoData = new Uint8Array(cssFontInfoLength);\n    cssFontInfoData.set(\n      new Uint8Array(this.#buffer, offset + 4, cssFontInfoLength)\n    );\n    return new CssFontInfo(cssFontInfoData.buffer);\n  }\n\n  get systemFontInfo() {\n    let offset = FontInfo.#OFFSET_STRINGS;\n    const stringsLength = this.#view.getUint32(offset);\n    offset += 4 + stringsLength;\n    const systemFontInfoLength = this.#view.getUint32(offset);\n    if (systemFontInfoLength === 0) {\n      return null;\n    }\n    const systemFontInfoData = new Uint8Array(systemFontInfoLength);\n    systemFontInfoData.set(\n      new Uint8Array(this.#buffer, offset + 4, systemFontInfoLength)\n    );\n    return new SystemFontInfo(systemFontInfoData.buffer);\n  }\n\n  static write(font) {\n    const systemFontInfoBuffer = font.systemFontInfo\n      ? SystemFontInfo.write(font.systemFontInfo)\n      : null;\n    const cssFontInfoBuffer = font.cssFontInfo\n      ? CssFontInfo.write(font.cssFontInfo)\n      : null;\n\n    const encoder = new TextEncoder();\n    const encodedStrings = {};\n    let stringsLength = 0;\n    for (const prop of FontInfo.strings) {\n      encodedStrings[prop] = encoder.encode(font[prop]);\n      stringsLength += 4 + encodedStrings[prop].length;\n    }\n\n    const lengthEstimate =\n      FontInfo.#OFFSET_STRINGS +\n      4 +\n      stringsLength +\n      4 +\n      (systemFontInfoBuffer ? systemFontInfoBuffer.byteLength : 0) +\n      4 +\n      (cssFontInfoBuffer ? cssFontInfoBuffer.byteLength : 0) +\n      4 +\n      (font.data ? font.data.length : 0);\n\n    const buffer = new ArrayBuffer(lengthEstimate);\n    const data = new Uint8Array(buffer);\n    const view = new DataView(buffer);\n    let offset = 0;\n\n    const numBools = FontInfo.bools.length;\n    let boolByte = 0,\n      boolBit = 0;\n    for (let i = 0; i < numBools; i++) {\n      const value = font[FontInfo.bools[i]];\n      // eslint-disable-next-line no-nested-ternary\n      const bits = value === undefined ? 0x00 : value ? 0x02 : 0x01;\n      boolByte |= bits << boolBit;\n      boolBit += 2;\n      if (boolBit === 8 || i === numBools - 1) {\n        view.setUint8(offset++, boolByte);\n        boolByte = 0;\n        boolBit = 0;\n      }\n    }\n    assert(\n      offset === FontInfo.#OFFSET_NUMBERS,\n      \"FontInfo.write: Boolean properties offset mismatch\"\n    );\n\n    for (const prop of FontInfo.numbers) {\n      view.setFloat64(offset, font[prop]);\n      offset += 8;\n    }\n    assert(\n      offset === FontInfo.#OFFSET_BBOX,\n      \"FontInfo.write: Number properties offset mismatch\"\n    );\n\n    if (font.bbox) {\n      view.setUint8(offset++, 4);\n      for (const coord of font.bbox) {\n        view.setInt16(offset, coord, true);\n        offset += 2;\n      }\n    } else {\n      view.setUint8(offset++, 0);\n      offset += 2 * 4; // TODO: optimize this padding away\n    }\n\n    assert(\n      offset === FontInfo.#OFFSET_FONT_MATRIX,\n      \"FontInfo.write: BBox properties offset mismatch\"\n    );\n\n    if (font.fontMatrix) {\n      view.setUint8(offset++, 6);\n      for (const point of font.fontMatrix) {\n        view.setFloat64(offset, point, true);\n        offset += 8;\n      }\n    } else {\n      view.setUint8(offset++, 0);\n      offset += 8 * 6; // TODO: optimize this padding away\n    }\n\n    assert(\n      offset === FontInfo.#OFFSET_DEFAULT_VMETRICS,\n      \"FontInfo.write: FontMatrix properties offset mismatch\"\n    );\n\n    if (font.defaultVMetrics) {\n      view.setUint8(offset++, 1);\n      for (const metric of font.defaultVMetrics) {\n        view.setInt16(offset, metric, true);\n        offset += 2;\n      }\n    } else {\n      view.setUint8(offset++, 0);\n      offset += 3 * 2; // TODO: optimize this padding away\n    }\n\n    assert(\n      offset === FontInfo.#OFFSET_STRINGS,\n      \"FontInfo.write: DefaultVMetrics properties offset mismatch\"\n    );\n\n    view.setUint32(FontInfo.#OFFSET_STRINGS, 0);\n    offset += 4;\n    for (const prop of FontInfo.strings) {\n      const encoded = encodedStrings[prop];\n      const length = encoded.length;\n      view.setUint32(offset, length);\n      data.set(encoded, offset + 4);\n      offset += 4 + length;\n    }\n    view.setUint32(\n      FontInfo.#OFFSET_STRINGS,\n      offset - FontInfo.#OFFSET_STRINGS - 4\n    );\n\n    if (!systemFontInfoBuffer) {\n      view.setUint32(offset, 0);\n      offset += 4;\n    } else {\n      const length = systemFontInfoBuffer.byteLength;\n      view.setUint32(offset, length);\n      assert(\n        offset + 4 + length <= buffer.byteLength,\n        \"FontInfo.write: Buffer overflow at systemFontInfo\"\n      );\n      data.set(new Uint8Array(systemFontInfoBuffer), offset + 4);\n      offset += 4 + length;\n    }\n\n    if (!cssFontInfoBuffer) {\n      view.setUint32(offset, 0);\n      offset += 4;\n    } else {\n      const length = cssFontInfoBuffer.byteLength;\n      view.setUint32(offset, length);\n      assert(\n        offset + 4 + length <= buffer.byteLength,\n        \"FontInfo.write: Buffer overflow at cssFontInfo\"\n      );\n      data.set(new Uint8Array(cssFontInfoBuffer), offset + 4);\n      offset += 4 + length;\n    }\n\n    if (font.data === undefined) {\n      view.setUint32(offset, 0);\n      offset += 4;\n    } else {\n      view.setUint32(offset, font.data.length);\n      data.set(font.data, offset + 4);\n      offset += 4 + font.data.length;\n    }\n\n    assert(offset <= buffer.byteLength, \"FontInfo.write: Buffer overflow\");\n    return buffer.transferToFixedLength(offset);\n  }\n}\n\nclass PatternInfo {\n  static #KIND = 0; // 1=axial, 2=radial, 3=mesh\n\n  static #HAS_BBOX = 1; // 0/1\n\n  static #HAS_BACKGROUND = 2; // 0/1 (background for mesh patterns)\n\n  static #SHADING_TYPE = 3; // shadingType (only for mesh patterns)\n\n  static #N_COORD = 4; // number of coordinate pairs\n\n  static #N_COLOR = 8; // number of rgb triplets\n\n  static #N_STOP = 12; // number of gradient stops\n\n  static #N_FIGURES = 16; // number of figures\n\n  constructor(buffer) {\n    this.buffer = buffer;\n    this.view = new DataView(buffer);\n    this.data = new Uint8Array(buffer);\n  }\n\n  static write(ir) {\n    let kind,\n      bbox = null,\n      coords = [],\n      colors = [],\n      colorStops = [],\n      figures = [],\n      shadingType = null, // only needed for mesh patterns\n      background = null; // background for mesh patterns\n\n    switch (ir[0]) {\n      case \"RadialAxial\":\n        kind = ir[1] === \"axial\" ? 1 : 2;\n        bbox = ir[2];\n        colorStops = ir[3];\n        if (kind === 1) {\n          coords.push(...ir[4], ...ir[5]);\n        } else {\n          coords.push(ir[4][0], ir[4][1], ir[6], ir[5][0], ir[5][1], ir[7]);\n        }\n        break;\n      case \"Mesh\":\n        kind = 3;\n        shadingType = ir[1];\n        coords = ir[2];\n        colors = ir[3];\n        figures = ir[4] || [];\n        bbox = ir[6];\n        background = ir[7];\n        break;\n      default:\n        throw new Error(`Unsupported pattern type: ${ir[0]}`);\n    }\n\n    const nCoord = Math.floor(coords.length / 2);\n    const nColor = Math.floor(colors.length / 3);\n    const nStop = colorStops.length;\n    const nFigures = figures.length;\n\n    let figuresSize = 0;\n    for (const figure of figures) {\n      figuresSize += 1;\n      figuresSize = Math.ceil(figuresSize / 4) * 4; // Ensure 4-byte alignment\n      figuresSize += 4 + figure.coords.length * 4;\n      figuresSize += 4 + figure.colors.length * 4;\n      if (figure.verticesPerRow !== undefined) {\n        figuresSize += 4;\n      }\n    }\n\n    const byteLen =\n      20 +\n      nCoord * 8 +\n      nColor * 3 +\n      nStop * 8 +\n      (bbox ? 16 : 0) +\n      (background ? 3 : 0) +\n      figuresSize;\n    const buffer = new ArrayBuffer(byteLen);\n    const dataView = new DataView(buffer);\n    const u8data = new Uint8Array(buffer);\n\n    dataView.setUint8(PatternInfo.#KIND, kind);\n    dataView.setUint8(PatternInfo.#HAS_BBOX, bbox ? 1 : 0);\n    dataView.setUint8(PatternInfo.#HAS_BACKGROUND, background ? 1 : 0);\n    dataView.setUint8(PatternInfo.#SHADING_TYPE, shadingType); // Only for mesh pattern, null otherwise\n    dataView.setUint32(PatternInfo.#N_COORD, nCoord, true);\n    dataView.setUint32(PatternInfo.#N_COLOR, nColor, true);\n    dataView.setUint32(PatternInfo.#N_STOP, nStop, true);\n    dataView.setUint32(PatternInfo.#N_FIGURES, nFigures, true);\n\n    let offset = 20;\n    const coordsView = new Float32Array(buffer, offset, nCoord * 2);\n    coordsView.set(coords);\n    offset += nCoord * 8;\n\n    u8data.set(colors, offset);\n    offset += nColor * 3;\n\n    for (const [pos, hex] of colorStops) {\n      dataView.setFloat32(offset, pos, true);\n      offset += 4;\n      dataView.setUint32(offset, parseInt(hex.slice(1), 16), true);\n      offset += 4;\n    }\n    if (bbox) {\n      for (const v of bbox) {\n        dataView.setFloat32(offset, v, true);\n        offset += 4;\n      }\n    }\n\n    if (background) {\n      u8data.set(background, offset);\n      offset += 3;\n    }\n\n    for (let i = 0; i < figures.length; i++) {\n      const figure = figures[i];\n      dataView.setUint8(offset, figure.type);\n      offset += 1;\n      // Ensure 4-byte alignment\n      offset = Math.ceil(offset / 4) * 4;\n      dataView.setUint32(offset, figure.coords.length, true);\n      offset += 4;\n      const figureCoordsView = new Int32Array(\n        buffer,\n        offset,\n        figure.coords.length\n      );\n      figureCoordsView.set(figure.coords);\n      offset += figure.coords.length * 4;\n      dataView.setUint32(offset, figure.colors.length, true);\n      offset += 4;\n      const colorsView = new Int32Array(buffer, offset, figure.colors.length);\n      colorsView.set(figure.colors);\n      offset += figure.colors.length * 4;\n\n      if (figure.verticesPerRow !== undefined) {\n        dataView.setUint32(offset, figure.verticesPerRow, true);\n        offset += 4;\n      }\n    }\n    return buffer;\n  }\n\n  getIR() {\n    const dataView = this.view;\n    const kind = this.data[PatternInfo.#KIND];\n    const hasBBox = !!this.data[PatternInfo.#HAS_BBOX];\n    const hasBackground = !!this.data[PatternInfo.#HAS_BACKGROUND];\n    const nCoord = dataView.getUint32(PatternInfo.#N_COORD, true);\n    const nColor = dataView.getUint32(PatternInfo.#N_COLOR, true);\n    const nStop = dataView.getUint32(PatternInfo.#N_STOP, true);\n    const nFigures = dataView.getUint32(PatternInfo.#N_FIGURES, true);\n\n    let offset = 20;\n    const coords = new Float32Array(this.buffer, offset, nCoord * 2);\n    offset += nCoord * 8;\n    const colors = new Uint8Array(this.buffer, offset, nColor * 3);\n    offset += nColor * 3;\n    const stops = [];\n    for (let i = 0; i < nStop; ++i) {\n      const p = dataView.getFloat32(offset, true);\n      offset += 4;\n      const rgb = dataView.getUint32(offset, true);\n      offset += 4;\n      stops.push([p, `#${rgb.toString(16).padStart(6, \"0\")}`]);\n    }\n    let bbox = null;\n    if (hasBBox) {\n      bbox = [];\n      for (let i = 0; i < 4; ++i) {\n        bbox.push(dataView.getFloat32(offset, true));\n        offset += 4;\n      }\n    }\n\n    let background = null;\n    if (hasBackground) {\n      background = new Uint8Array(this.buffer, offset, 3);\n      offset += 3;\n    }\n\n    const figures = [];\n    for (let i = 0; i < nFigures; ++i) {\n      const type = dataView.getUint8(offset);\n      offset += 1;\n      // Ensure 4-byte alignment\n      offset = Math.ceil(offset / 4) * 4;\n\n      const coordsLength = dataView.getUint32(offset, true);\n      offset += 4;\n      const figureCoords = new Int32Array(this.buffer, offset, coordsLength);\n      offset += coordsLength * 4;\n\n      const colorsLength = dataView.getUint32(offset, true);\n      offset += 4;\n      const figureColors = new Int32Array(this.buffer, offset, colorsLength);\n      offset += colorsLength * 4;\n\n      const figure = {\n        type,\n        coords: figureCoords,\n        colors: figureColors,\n      };\n\n      if (type === MeshFigureType.LATTICE) {\n        figure.verticesPerRow = dataView.getUint32(offset, true);\n        offset += 4;\n      }\n\n      figures.push(figure);\n    }\n\n    if (kind === 1) {\n      // axial\n      return [\n        \"RadialAxial\",\n        \"axial\",\n        bbox,\n        stops,\n        Array.from(coords.slice(0, 2)),\n        Array.from(coords.slice(2, 4)),\n        null,\n        null,\n      ];\n    }\n    if (kind === 2) {\n      return [\n        \"RadialAxial\",\n        \"radial\",\n        bbox,\n        stops,\n        [coords[0], coords[1]],\n        [coords[3], coords[4]],\n        coords[2],\n        coords[5],\n      ];\n    }\n    if (kind === 3) {\n      const shadingType = this.data[PatternInfo.#SHADING_TYPE];\n      let bounds = null;\n      if (coords.length > 0) {\n        let minX = coords[0],\n          maxX = coords[0];\n        let minY = coords[1],\n          maxY = coords[1];\n        for (let i = 0; i < coords.length; i += 2) {\n          const x = coords[i],\n            y = coords[i + 1];\n          minX = minX > x ? x : minX;\n          minY = minY > y ? y : minY;\n          maxX = maxX < x ? x : maxX;\n          maxY = maxY < y ? y : maxY;\n        }\n        bounds = [minX, minY, maxX, maxY];\n      }\n      return [\n        \"Mesh\",\n        shadingType,\n        coords,\n        colors,\n        figures,\n        bounds,\n        bbox,\n        background,\n      ];\n    }\n    throw new Error(`Unsupported pattern kind: ${kind}`);\n  }\n}\n\nclass FontPathInfo {\n  static write(path) {\n    let data;\n    let buffer;\n    if (\n      (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n      FeatureTest.isFloat16ArraySupported\n    ) {\n      buffer = new ArrayBuffer(path.length * 2);\n      data = new Float16Array(buffer);\n    } else {\n      buffer = new ArrayBuffer(path.length * 4);\n      data = new Float32Array(buffer);\n    }\n    data.set(path);\n    return buffer;\n  }\n\n  #buffer;\n\n  constructor(buffer) {\n    this.#buffer = buffer;\n  }\n\n  get path() {\n    if (\n      (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n      FeatureTest.isFloat16ArraySupported\n    ) {\n      return new Float16Array(this.#buffer);\n    }\n    return new Float32Array(this.#buffer);\n  }\n}\n\nexport { CssFontInfo, FontInfo, FontPathInfo, PatternInfo, SystemFontInfo };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  _isValidExplicitDest,\n  isNodeJS,\n  stringToBytes,\n  warn,\n} from \"../shared/util.js\";\n\nfunction getUrlProp(val) {\n  if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n    return null; // The 'url' is unused with `PDFDataRangeTransport`.\n  }\n  if (val instanceof URL) {\n    return val.href;\n  }\n  if (typeof val === \"string\") {\n    if (\n      typeof PDFJSDev !== \"undefined\" &&\n      PDFJSDev.test(\"GENERIC\") &&\n      isNodeJS\n    ) {\n      return val; // Use the url as-is in Node.js environments.\n    }\n\n    // The full path is required in the 'url' field.\n    const url = URL.parse(val, window.location);\n    if (url) {\n      return url.href;\n    }\n  }\n  throw new Error(\n    \"Invalid PDF url data: \" +\n      \"either string or URL-object is expected in the url property.\"\n  );\n}\n\nfunction getDataProp(val) {\n  // Converting string or array-like data to Uint8Array.\n  if (\n    typeof PDFJSDev !== \"undefined\" &&\n    PDFJSDev.test(\"GENERIC\") &&\n    isNodeJS &&\n    typeof Buffer !== \"undefined\" && // eslint-disable-line no-undef\n    val instanceof Buffer // eslint-disable-line no-undef\n  ) {\n    throw new Error(\n      \"Please provide binary data as `Uint8Array`, rather than `Buffer`.\"\n    );\n  }\n  if (val instanceof Uint8Array && val.byteLength === val.buffer.byteLength) {\n    // Use the data as-is when it's already a Uint8Array that completely\n    // \"utilizes\" its underlying ArrayBuffer, to prevent any possible\n    // issues when transferring it to the worker-thread.\n    return val;\n  }\n  if (typeof val === \"string\") {\n    return stringToBytes(val);\n  }\n  if (\n    val instanceof ArrayBuffer ||\n    ArrayBuffer.isView(val) ||\n    (typeof val === \"object\" && !isNaN(val?.length))\n  ) {\n    return new Uint8Array(val);\n  }\n  throw new Error(\n    \"Invalid PDF binary data: either TypedArray, \" +\n      \"string, or array-like object is expected in the data property.\"\n  );\n}\n\nfunction getFactoryUrlProp(val) {\n  if (typeof val !== \"string\") {\n    return null;\n  }\n  if (val.endsWith(\"/\")) {\n    return val;\n  }\n  throw new Error(`Invalid factory url: \"${val}\" must include trailing slash.`);\n}\n\nconst isRefProxy = v =>\n  typeof v === \"object\" &&\n  Number.isInteger(v?.num) &&\n  v.num >= 0 &&\n  Number.isInteger(v?.gen) &&\n  v.gen >= 0;\n\nconst isNameProxy = v => typeof v === \"object\" && typeof v?.name === \"string\";\n\nconst isValidExplicitDest = _isValidExplicitDest.bind(\n  null,\n  /* validRef = */ isRefProxy,\n  /* validName = */ isNameProxy\n);\n\nclass LoopbackPort {\n  #listeners = new Map();\n\n  #deferred = Promise.resolve();\n\n  postMessage(obj, transfer) {\n    const event = {\n      data: structuredClone(obj, transfer ? { transfer } : null),\n    };\n\n    this.#deferred.then(() => {\n      for (const [listener] of this.#listeners) {\n        listener.call(this, event);\n      }\n    });\n  }\n\n  addEventListener(name, listener, options = null) {\n    let rmAbort = null;\n    if (options?.signal instanceof AbortSignal) {\n      const { signal } = options;\n      if (signal.aborted) {\n        warn(\"LoopbackPort - cannot use an `aborted` signal.\");\n        return;\n      }\n      const onAbort = () => this.removeEventListener(name, listener);\n      rmAbort = () => signal.removeEventListener(\"abort\", onAbort);\n\n      signal.addEventListener(\"abort\", onAbort);\n    }\n    this.#listeners.set(listener, rmAbort);\n  }\n\n  removeEventListener(name, listener) {\n    const rmAbort = this.#listeners.get(listener);\n    rmAbort?.();\n\n    this.#listeners.delete(listener);\n  }\n\n  terminate() {\n    for (const [, rmAbort] of this.#listeners) {\n      rmAbort?.();\n    }\n    this.#listeners.clear();\n  }\n}\n\nexport {\n  getDataProp,\n  getFactoryUrlProp,\n  getUrlProp,\n  isNameProxy,\n  isRefProxy,\n  isValidExplicitDest,\n  LoopbackPort,\n};\n","/* Copyright 2018 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AbortException,\n  assert,\n  InvalidPDFException,\n  PasswordException,\n  ResponseException,\n  UnknownErrorException,\n  unreachable,\n} from \"./util.js\";\n\nconst CallbackKind = {\n  DATA: 1,\n  ERROR: 2,\n};\n\nconst StreamKind = {\n  CANCEL: 1,\n  CANCEL_COMPLETE: 2,\n  CLOSE: 3,\n  ENQUEUE: 4,\n  ERROR: 5,\n  PULL: 6,\n  PULL_COMPLETE: 7,\n  START_COMPLETE: 8,\n};\n\nfunction onFn() {}\n\nfunction wrapReason(ex) {\n  if (\n    ex instanceof AbortException ||\n    ex instanceof InvalidPDFException ||\n    ex instanceof PasswordException ||\n    ex instanceof ResponseException ||\n    ex instanceof UnknownErrorException\n  ) {\n    // Avoid re-creating the exception when its type is already correct.\n    return ex;\n  }\n\n  if (!(ex instanceof Error || (typeof ex === \"object\" && ex !== null))) {\n    unreachable(\n      'wrapReason: Expected \"reason\" to be a (possibly cloned) Error.'\n    );\n  }\n  switch (ex.name) {\n    case \"AbortException\":\n      return new AbortException(ex.message);\n    case \"InvalidPDFException\":\n      return new InvalidPDFException(ex.message);\n    case \"PasswordException\":\n      return new PasswordException(ex.message, ex.code);\n    case \"ResponseException\":\n      return new ResponseException(ex.message, ex.status, ex.missing);\n    case \"UnknownErrorException\":\n      return new UnknownErrorException(ex.message, ex.details);\n  }\n  return new UnknownErrorException(ex.message, ex.toString());\n}\n\nclass MessageHandler {\n  #messageAC = new AbortController();\n\n  constructor(sourceName, targetName, comObj) {\n    this.sourceName = sourceName;\n    this.targetName = targetName;\n    this.comObj = comObj;\n    this.callbackId = 1;\n    this.streamId = 1;\n    this.streamSinks = Object.create(null);\n    this.streamControllers = Object.create(null);\n    this.callbackCapabilities = Object.create(null);\n    this.actionHandler = Object.create(null);\n\n    comObj.addEventListener(\"message\", this.#onMessage.bind(this), {\n      signal: this.#messageAC.signal,\n    });\n  }\n\n  #onMessage({ data }) {\n    if (data.targetName !== this.sourceName) {\n      return;\n    }\n    if (data.stream) {\n      this.#processStreamMessage(data);\n      return;\n    }\n    if (data.callback) {\n      const callbackId = data.callbackId;\n      const capability = this.callbackCapabilities[callbackId];\n      if (!capability) {\n        throw new Error(`Cannot resolve callback ${callbackId}`);\n      }\n      delete this.callbackCapabilities[callbackId];\n\n      if (data.callback === CallbackKind.DATA) {\n        capability.resolve(data.data);\n      } else if (data.callback === CallbackKind.ERROR) {\n        capability.reject(wrapReason(data.reason));\n      } else {\n        throw new Error(\"Unexpected callback case\");\n      }\n      return;\n    }\n    const action = this.actionHandler[data.action];\n    if (!action) {\n      throw new Error(`Unknown action from worker: ${data.action}`);\n    }\n    if (data.callbackId) {\n      const sourceName = this.sourceName,\n        targetName = data.sourceName,\n        comObj = this.comObj;\n\n      Promise.try(action, data.data).then(\n        function (result) {\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            callback: CallbackKind.DATA,\n            callbackId: data.callbackId,\n            data: result,\n          });\n        },\n        function (reason) {\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            callback: CallbackKind.ERROR,\n            callbackId: data.callbackId,\n            reason: wrapReason(reason),\n          });\n        }\n      );\n      return;\n    }\n    if (data.streamId) {\n      this.#createStreamSink(data);\n      return;\n    }\n    action(data.data);\n  }\n\n  on(actionName, handler) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        typeof handler === \"function\",\n        'MessageHandler.on: Expected \"handler\" to be a function.'\n      );\n    }\n    const ah = this.actionHandler;\n    if (ah[actionName]) {\n      throw new Error(`There is already an actionName called \"${actionName}\"`);\n    }\n    ah[actionName] = handler;\n  }\n\n  /**\n   * Sends a message to the comObj to invoke the action with the supplied data.\n   * @param {string} actionName - Action to call.\n   * @param {JSON} data - JSON data to send.\n   * @param {Array} [transfers] - List of transfers/ArrayBuffers.\n   */\n  send(actionName, data, transfers) {\n    this.comObj.postMessage(\n      {\n        sourceName: this.sourceName,\n        targetName: this.targetName,\n        action: actionName,\n        data,\n      },\n      transfers\n    );\n  }\n\n  /**\n   * Sends a message to the comObj to invoke the action with the supplied data.\n   * Expects that the other side will callback with the response.\n   * @param {string} actionName - Action to call.\n   * @param {JSON} data - JSON data to send.\n   * @param {Array} [transfers] - List of transfers/ArrayBuffers.\n   * @returns {Promise} Promise to be resolved with response data.\n   */\n  sendWithPromise(actionName, data, transfers) {\n    const callbackId = this.callbackId++;\n    const capability = Promise.withResolvers();\n    this.callbackCapabilities[callbackId] = capability;\n    try {\n      this.comObj.postMessage(\n        {\n          sourceName: this.sourceName,\n          targetName: this.targetName,\n          action: actionName,\n          callbackId,\n          data,\n        },\n        transfers\n      );\n    } catch (ex) {\n      capability.reject(ex);\n    }\n    return capability.promise;\n  }\n\n  /**\n   * Sends a message to the comObj to invoke the action with the supplied data.\n   * Expect that the other side will callback to signal 'start_complete'.\n   * @param {string} actionName - Action to call.\n   * @param {JSON} data - JSON data to send.\n   * @param {Object} queueingStrategy - Strategy to signal backpressure based on\n   *                 internal queue.\n   * @param {Array} [transfers] - List of transfers/ArrayBuffers.\n   * @returns {ReadableStream} ReadableStream to read data in chunks.\n   */\n  sendWithStream(actionName, data, queueingStrategy, transfers) {\n    const streamId = this.streamId++,\n      sourceName = this.sourceName,\n      targetName = this.targetName,\n      comObj = this.comObj;\n\n    return new ReadableStream(\n      {\n        start: controller => {\n          const startCapability = Promise.withResolvers();\n          this.streamControllers[streamId] = {\n            controller,\n            startCall: startCapability,\n            pullCall: null,\n            cancelCall: null,\n            isClosed: false,\n          };\n          comObj.postMessage(\n            {\n              sourceName,\n              targetName,\n              action: actionName,\n              streamId,\n              data,\n              desiredSize: controller.desiredSize,\n            },\n            transfers\n          );\n          // Return Promise for Async process, to signal success/failure.\n          return startCapability.promise;\n        },\n\n        pull: controller => {\n          const pullCapability = Promise.withResolvers();\n          this.streamControllers[streamId].pullCall = pullCapability;\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            stream: StreamKind.PULL,\n            streamId,\n            desiredSize: controller.desiredSize,\n          });\n          // Returning Promise will not call \"pull\"\n          // again until current pull is resolved.\n          return pullCapability.promise;\n        },\n\n        cancel: reason => {\n          assert(reason instanceof Error, \"cancel must have a valid reason\");\n          const cancelCapability = Promise.withResolvers();\n          this.streamControllers[streamId].cancelCall = cancelCapability;\n          this.streamControllers[streamId].isClosed = true;\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            stream: StreamKind.CANCEL,\n            streamId,\n            reason: wrapReason(reason),\n          });\n          // Return Promise to signal success or failure.\n          return cancelCapability.promise;\n        },\n      },\n      queueingStrategy\n    );\n  }\n\n  #createStreamSink(data) {\n    const streamId = data.streamId,\n      sourceName = this.sourceName,\n      targetName = data.sourceName,\n      comObj = this.comObj;\n    const self = this,\n      action = this.actionHandler[data.action];\n\n    const streamSink = {\n      enqueue(chunk, size = 1, transfers) {\n        if (this.isCancelled) {\n          return;\n        }\n        const lastDesiredSize = this.desiredSize;\n        this.desiredSize -= size;\n        // Enqueue decreases the desiredSize property of sink,\n        // so when it changes from positive to negative,\n        // set ready as unresolved promise.\n        if (lastDesiredSize > 0 && this.desiredSize <= 0) {\n          this.sinkCapability = Promise.withResolvers();\n          this.ready = this.sinkCapability.promise;\n        }\n        comObj.postMessage(\n          {\n            sourceName,\n            targetName,\n            stream: StreamKind.ENQUEUE,\n            streamId,\n            chunk,\n          },\n          transfers\n        );\n      },\n\n      close() {\n        if (this.isCancelled) {\n          return;\n        }\n        this.isCancelled = true;\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.CLOSE,\n          streamId,\n        });\n        delete self.streamSinks[streamId];\n      },\n\n      error(reason) {\n        assert(reason instanceof Error, \"error must have a valid reason\");\n        if (this.isCancelled) {\n          return;\n        }\n        this.isCancelled = true;\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.ERROR,\n          streamId,\n          reason: wrapReason(reason),\n        });\n      },\n\n      sinkCapability: Promise.withResolvers(),\n      onPull: null,\n      onCancel: null,\n      isCancelled: false,\n      desiredSize: data.desiredSize,\n      ready: null,\n    };\n\n    streamSink.sinkCapability.resolve();\n    streamSink.ready = streamSink.sinkCapability.promise;\n    this.streamSinks[streamId] = streamSink;\n\n    Promise.try(action, data.data, streamSink).then(\n      function () {\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.START_COMPLETE,\n          streamId,\n          success: true,\n        });\n      },\n      function (reason) {\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.START_COMPLETE,\n          streamId,\n          reason: wrapReason(reason),\n        });\n      }\n    );\n  }\n\n  #processStreamMessage(data) {\n    const streamId = data.streamId,\n      sourceName = this.sourceName,\n      targetName = data.sourceName,\n      comObj = this.comObj;\n    const streamController = this.streamControllers[streamId],\n      streamSink = this.streamSinks[streamId];\n\n    switch (data.stream) {\n      case StreamKind.START_COMPLETE:\n        if (data.success) {\n          streamController.startCall.resolve();\n        } else {\n          streamController.startCall.reject(wrapReason(data.reason));\n        }\n        break;\n      case StreamKind.PULL_COMPLETE:\n        if (data.success) {\n          streamController.pullCall.resolve();\n        } else {\n          streamController.pullCall.reject(wrapReason(data.reason));\n        }\n        break;\n      case StreamKind.PULL:\n        // Ignore any pull after close is called.\n        if (!streamSink) {\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            stream: StreamKind.PULL_COMPLETE,\n            streamId,\n            success: true,\n          });\n          break;\n        }\n        // Pull increases the desiredSize property of sink, so when it changes\n        // from negative to positive, set ready property as resolved promise.\n        if (streamSink.desiredSize <= 0 && data.desiredSize > 0) {\n          streamSink.sinkCapability.resolve();\n        }\n        // Reset desiredSize property of sink on every pull.\n        streamSink.desiredSize = data.desiredSize;\n\n        Promise.try(streamSink.onPull || onFn).then(\n          function () {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.PULL_COMPLETE,\n              streamId,\n              success: true,\n            });\n          },\n          function (reason) {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.PULL_COMPLETE,\n              streamId,\n              reason: wrapReason(reason),\n            });\n          }\n        );\n        break;\n      case StreamKind.ENQUEUE:\n        assert(streamController, \"enqueue should have stream controller\");\n        if (streamController.isClosed) {\n          break;\n        }\n        streamController.controller.enqueue(data.chunk);\n        break;\n      case StreamKind.CLOSE:\n        assert(streamController, \"close should have stream controller\");\n        if (streamController.isClosed) {\n          break;\n        }\n        streamController.isClosed = true;\n        streamController.controller.close();\n        this.#deleteStreamController(streamController, streamId);\n        break;\n      case StreamKind.ERROR:\n        assert(streamController, \"error should have stream controller\");\n        streamController.controller.error(wrapReason(data.reason));\n        this.#deleteStreamController(streamController, streamId);\n        break;\n      case StreamKind.CANCEL_COMPLETE:\n        if (data.success) {\n          streamController.cancelCall.resolve();\n        } else {\n          streamController.cancelCall.reject(wrapReason(data.reason));\n        }\n        this.#deleteStreamController(streamController, streamId);\n        break;\n      case StreamKind.CANCEL:\n        if (!streamSink) {\n          break;\n        }\n        const dataReason = wrapReason(data.reason);\n\n        Promise.try(streamSink.onCancel || onFn, dataReason).then(\n          function () {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.CANCEL_COMPLETE,\n              streamId,\n              success: true,\n            });\n          },\n          function (reason) {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.CANCEL_COMPLETE,\n              streamId,\n              reason: wrapReason(reason),\n            });\n          }\n        );\n        streamSink.sinkCapability.reject(dataReason);\n        streamSink.isCancelled = true;\n        delete this.streamSinks[streamId];\n        break;\n      default:\n        throw new Error(\"Unexpected stream case\");\n    }\n  }\n\n  async #deleteStreamController(streamController, streamId) {\n    // Delete the `streamController` only when the start, pull, and cancel\n    // capabilities have settled, to prevent `TypeError`s.\n    await Promise.allSettled([\n      streamController.startCall?.promise,\n      streamController.pullCall?.promise,\n      streamController.cancelCall?.promise,\n    ]);\n    delete this.streamControllers[streamId];\n  }\n\n  destroy() {\n    this.#messageAC?.abort();\n    this.#messageAC = null;\n  }\n}\n\nexport { MessageHandler, wrapReason };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { unreachable } from \"../shared/util.js\";\n\nclass BaseCanvasFactory {\n  #enableHWA = false;\n\n  constructor({ enableHWA = false }) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseCanvasFactory\n    ) {\n      unreachable(\"Cannot initialize BaseCanvasFactory.\");\n    }\n    this.#enableHWA = enableHWA;\n  }\n\n  create(width, height) {\n    if (width <= 0 || height <= 0) {\n      throw new Error(\"Invalid canvas size\");\n    }\n    const canvas = this._createCanvas(width, height);\n    return {\n      canvas,\n      context: canvas.getContext(\"2d\", {\n        willReadFrequently: !this.#enableHWA,\n      }),\n    };\n  }\n\n  reset(canvasAndContext, width, height) {\n    if (!canvasAndContext.canvas) {\n      throw new Error(\"Canvas is not specified\");\n    }\n    if (width <= 0 || height <= 0) {\n      throw new Error(\"Invalid canvas size\");\n    }\n    canvasAndContext.canvas.width = width;\n    canvasAndContext.canvas.height = height;\n  }\n\n  destroy(canvasAndContext) {\n    if (!canvasAndContext.canvas) {\n      throw new Error(\"Canvas is not specified\");\n    }\n    // Zeroing the width and height cause Firefox to release graphics\n    // resources immediately, which can greatly reduce memory consumption.\n    canvasAndContext.canvas.width = 0;\n    canvasAndContext.canvas.height = 0;\n    canvasAndContext.canvas = null;\n    canvasAndContext.context = null;\n  }\n\n  /**\n   * @ignore\n   */\n  _createCanvas(width, height) {\n    unreachable(\"Abstract method `_createCanvas` called.\");\n  }\n}\n\nclass DOMCanvasFactory extends BaseCanvasFactory {\n  constructor({ ownerDocument = globalThis.document, enableHWA = false }) {\n    super({ enableHWA });\n    this._document = ownerDocument;\n  }\n\n  /**\n   * @ignore\n   */\n  _createCanvas(width, height) {\n    const canvas = this._document.createElement(\"canvas\");\n    canvas.width = width;\n    canvas.height = height;\n    return canvas;\n  }\n}\n\nexport { BaseCanvasFactory, DOMCanvasFactory };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { stringToBytes, unreachable } from \"../shared/util.js\";\nimport { fetchData } from \"./display_utils.js\";\n\nclass BaseCMapReaderFactory {\n  constructor({ baseUrl = null, isCompressed = true }) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseCMapReaderFactory\n    ) {\n      unreachable(\"Cannot initialize BaseCMapReaderFactory.\");\n    }\n    this.baseUrl = baseUrl;\n    this.isCompressed = isCompressed;\n  }\n\n  async fetch({ name }) {\n    if (!this.baseUrl) {\n      throw new Error(\n        \"Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.\"\n      );\n    }\n    if (!name) {\n      throw new Error(\"CMap name must be specified.\");\n    }\n    const url = this.baseUrl + name + (this.isCompressed ? \".bcmap\" : \"\");\n\n    return this._fetch(url)\n      .then(cMapData => ({ cMapData, isCompressed: this.isCompressed }))\n      .catch(reason => {\n        throw new Error(\n          `Unable to load ${this.isCompressed ? \"binary \" : \"\"}CMap at: ${url}`\n        );\n      });\n  }\n\n  /**\n   * @ignore\n   * @returns {Promise<Uint8Array>}\n   */\n  async _fetch(url) {\n    unreachable(\"Abstract method `_fetch` called.\");\n  }\n}\n\nclass DOMCMapReaderFactory extends BaseCMapReaderFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    const data = await fetchData(\n      url,\n      /* type = */ this.isCompressed ? \"arraybuffer\" : \"text\"\n    );\n    return data instanceof ArrayBuffer\n      ? new Uint8Array(data)\n      : stringToBytes(data);\n  }\n}\n\nexport { BaseCMapReaderFactory, DOMCMapReaderFactory };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getRGB, isDataScheme, SVG_NS } from \"./display_utils.js\";\nimport { unreachable, updateUrlHash, Util, warn } from \"../shared/util.js\";\n\nclass BaseFilterFactory {\n  constructor() {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseFilterFactory\n    ) {\n      unreachable(\"Cannot initialize BaseFilterFactory.\");\n    }\n  }\n\n  addFilter(maps) {\n    return \"none\";\n  }\n\n  addHCMFilter(fgColor, bgColor) {\n    return \"none\";\n  }\n\n  addAlphaFilter(map) {\n    return \"none\";\n  }\n\n  addLuminosityFilter(map) {\n    return \"none\";\n  }\n\n  addHighlightHCMFilter(filterName, fgColor, bgColor, newFgColor, newBgColor) {\n    return \"none\";\n  }\n\n  destroy(keepHCM = false) {}\n}\n\n/**\n * FilterFactory aims to create some SVG filters we can use when drawing an\n * image (or whatever) on a canvas.\n * Filters aren't applied with ctx.putImageData because it just overwrites the\n * underlying pixels.\n * With these filters, it's possible for example to apply some transfer maps on\n * an image without the need to apply them on the pixel arrays: the renderer\n * does the magic for us.\n */\nclass DOMFilterFactory extends BaseFilterFactory {\n  #baseUrl;\n\n  #_cache;\n\n  #_defs;\n\n  #docId;\n\n  #document;\n\n  #_hcmCache;\n\n  #id = 0;\n\n  constructor({ docId, ownerDocument = globalThis.document }) {\n    super();\n    this.#docId = docId;\n    this.#document = ownerDocument;\n  }\n\n  get #cache() {\n    return (this.#_cache ||= new Map());\n  }\n\n  get #hcmCache() {\n    return (this.#_hcmCache ||= new Map());\n  }\n\n  get #defs() {\n    if (!this.#_defs) {\n      const div = this.#document.createElement(\"div\");\n      const { style } = div;\n      style.visibility = \"hidden\";\n      style.contain = \"strict\";\n      style.width = style.height = 0;\n      style.position = \"absolute\";\n      style.top = style.left = 0;\n      style.zIndex = -1;\n\n      const svg = this.#document.createElementNS(SVG_NS, \"svg\");\n      svg.setAttribute(\"width\", 0);\n      svg.setAttribute(\"height\", 0);\n      this.#_defs = this.#document.createElementNS(SVG_NS, \"defs\");\n      div.append(svg);\n      svg.append(this.#_defs);\n      this.#document.body.append(div);\n    }\n    return this.#_defs;\n  }\n\n  #createTables(maps) {\n    if (maps.length === 1) {\n      const mapR = maps[0];\n      const buffer = new Array(256);\n      for (let i = 0; i < 256; i++) {\n        buffer[i] = mapR[i] / 255;\n      }\n\n      const table = buffer.join(\",\");\n      return [table, table, table];\n    }\n\n    const [mapR, mapG, mapB] = maps;\n    const bufferR = new Array(256);\n    const bufferG = new Array(256);\n    const bufferB = new Array(256);\n    for (let i = 0; i < 256; i++) {\n      bufferR[i] = mapR[i] / 255;\n      bufferG[i] = mapG[i] / 255;\n      bufferB[i] = mapB[i] / 255;\n    }\n    return [bufferR.join(\",\"), bufferG.join(\",\"), bufferB.join(\",\")];\n  }\n\n  #createUrl(id) {\n    if (this.#baseUrl === undefined) {\n      // Unless a `<base>`-element is present a relative URL should work.\n      this.#baseUrl = \"\";\n\n      const url = this.#document.URL;\n      if (url !== this.#document.baseURI) {\n        if (isDataScheme(url)) {\n          warn('#createUrl: ignore \"data:\"-URL for performance reasons.');\n        } else {\n          this.#baseUrl = updateUrlHash(url, \"\");\n        }\n      }\n    }\n    return `url(${this.#baseUrl}#${id})`;\n  }\n\n  addFilter(maps) {\n    if (!maps) {\n      return \"none\";\n    }\n\n    // When a page is zoomed the page is re-drawn but the maps are likely\n    // the same.\n    let value = this.#cache.get(maps);\n    if (value) {\n      return value;\n    }\n\n    const [tableR, tableG, tableB] = this.#createTables(maps);\n    const key = maps.length === 1 ? tableR : `${tableR}${tableG}${tableB}`;\n\n    value = this.#cache.get(key);\n    if (value) {\n      this.#cache.set(maps, value);\n      return value;\n    }\n\n    // We create a SVG filter: feComponentTransferElement\n    //  https://www.w3.org/TR/SVG11/filters.html#feComponentTransferElement\n\n    const id = `g_${this.#docId}_transfer_map_${this.#id++}`;\n    const url = this.#createUrl(id);\n    this.#cache.set(maps, url);\n    this.#cache.set(key, url);\n\n    const filter = this.#createFilter(id);\n    this.#addTransferMapConversion(tableR, tableG, tableB, filter);\n\n    return url;\n  }\n\n  addHCMFilter(fgColor, bgColor) {\n    const key = `${fgColor}-${bgColor}`;\n    const filterName = \"base\";\n    let info = this.#hcmCache.get(filterName);\n    if (info?.key === key) {\n      return info.url;\n    }\n\n    if (info) {\n      info.filter?.remove();\n      info.key = key;\n      info.url = \"none\";\n      info.filter = null;\n    } else {\n      info = {\n        key,\n        url: \"none\",\n        filter: null,\n      };\n      this.#hcmCache.set(filterName, info);\n    }\n\n    if (!fgColor || !bgColor) {\n      return info.url;\n    }\n\n    const fgRGB = this.#getRGB(fgColor);\n    fgColor = Util.makeHexColor(...fgRGB);\n    const bgRGB = this.#getRGB(bgColor);\n    bgColor = Util.makeHexColor(...bgRGB);\n    this.#defs.style.color = \"\";\n\n    if (\n      (fgColor === \"#000000\" && bgColor === \"#ffffff\") ||\n      fgColor === bgColor\n    ) {\n      return info.url;\n    }\n\n    // https://developer.mozilla.org/en-US/docs/Web/Accessibility/Understanding_Colors_and_Luminance\n    //\n    // Relative luminance:\n    // https://www.w3.org/TR/WCAG20/#relativeluminancedef\n    //\n    // We compute the rounded luminance of the default background color.\n    // Then for every color in the pdf, if its rounded luminance is the\n    // same as the background one then it's replaced by the new\n    // background color else by the foreground one.\n    const map = new Array(256);\n    for (let i = 0; i <= 255; i++) {\n      const x = i / 255;\n      map[i] = x <= 0.03928 ? x / 12.92 : ((x + 0.055) / 1.055) ** 2.4;\n    }\n    const table = map.join(\",\");\n\n    const id = `g_${this.#docId}_hcm_filter`;\n    const filter = (info.filter = this.#createFilter(id));\n    this.#addTransferMapConversion(table, table, table, filter);\n    this.#addGrayConversion(filter);\n\n    const getSteps = (c, n) => {\n      const start = fgRGB[c] / 255;\n      const end = bgRGB[c] / 255;\n      const arr = new Array(n + 1);\n      for (let i = 0; i <= n; i++) {\n        arr[i] = start + (i / n) * (end - start);\n      }\n      return arr.join(\",\");\n    };\n    this.#addTransferMapConversion(\n      getSteps(0, 5),\n      getSteps(1, 5),\n      getSteps(2, 5),\n      filter\n    );\n\n    info.url = this.#createUrl(id);\n    return info.url;\n  }\n\n  addAlphaFilter(map) {\n    // When a page is zoomed the page is re-drawn but the maps are likely\n    // the same.\n    let value = this.#cache.get(map);\n    if (value) {\n      return value;\n    }\n\n    const [tableA] = this.#createTables([map]);\n    const key = `alpha_${tableA}`;\n\n    value = this.#cache.get(key);\n    if (value) {\n      this.#cache.set(map, value);\n      return value;\n    }\n\n    const id = `g_${this.#docId}_alpha_map_${this.#id++}`;\n    const url = this.#createUrl(id);\n    this.#cache.set(map, url);\n    this.#cache.set(key, url);\n\n    const filter = this.#createFilter(id);\n    this.#addTransferMapAlphaConversion(tableA, filter);\n\n    return url;\n  }\n\n  addLuminosityFilter(map) {\n    // When a page is zoomed the page is re-drawn but the maps are likely\n    // the same.\n    let value = this.#cache.get(map || \"luminosity\");\n    if (value) {\n      return value;\n    }\n\n    let tableA, key;\n    if (map) {\n      [tableA] = this.#createTables([map]);\n      key = `luminosity_${tableA}`;\n    } else {\n      key = \"luminosity\";\n    }\n\n    value = this.#cache.get(key);\n    if (value) {\n      this.#cache.set(map, value);\n      return value;\n    }\n\n    const id = `g_${this.#docId}_luminosity_map_${this.#id++}`;\n    const url = this.#createUrl(id);\n    this.#cache.set(map, url);\n    this.#cache.set(key, url);\n\n    const filter = this.#createFilter(id);\n    this.#addLuminosityConversion(filter);\n    if (map) {\n      this.#addTransferMapAlphaConversion(tableA, filter);\n    }\n\n    return url;\n  }\n\n  addHighlightHCMFilter(filterName, fgColor, bgColor, newFgColor, newBgColor) {\n    const key = `${fgColor}-${bgColor}-${newFgColor}-${newBgColor}`;\n    let info = this.#hcmCache.get(filterName);\n    if (info?.key === key) {\n      return info.url;\n    }\n\n    if (info) {\n      info.filter?.remove();\n      info.key = key;\n      info.url = \"none\";\n      info.filter = null;\n    } else {\n      info = {\n        key,\n        url: \"none\",\n        filter: null,\n      };\n      this.#hcmCache.set(filterName, info);\n    }\n\n    if (!fgColor || !bgColor) {\n      return info.url;\n    }\n\n    const [fgRGB, bgRGB] = [fgColor, bgColor].map(this.#getRGB.bind(this));\n    let fgGray = Math.round(\n      0.2126 * fgRGB[0] + 0.7152 * fgRGB[1] + 0.0722 * fgRGB[2]\n    );\n    let bgGray = Math.round(\n      0.2126 * bgRGB[0] + 0.7152 * bgRGB[1] + 0.0722 * bgRGB[2]\n    );\n    let [newFgRGB, newBgRGB] = [newFgColor, newBgColor].map(\n      this.#getRGB.bind(this)\n    );\n    if (bgGray < fgGray) {\n      [fgGray, bgGray, newFgRGB, newBgRGB] = [\n        bgGray,\n        fgGray,\n        newBgRGB,\n        newFgRGB,\n      ];\n    }\n    this.#defs.style.color = \"\";\n\n    // Now we can create the filters to highlight some canvas parts.\n    // The colors in the pdf will almost be Canvas and CanvasText, hence we\n    // want to filter them to finally get Highlight and HighlightText.\n    // Since we're in HCM the background color and the foreground color should\n    // be really different when converted to grayscale (if they're not then it\n    // means that we've a poor contrast). Once the canvas colors are converted\n    // to grayscale we can easily map them on their new colors.\n    // The grayscale step is important because if we've something like:\n    //   fgColor = #FF....\n    //   bgColor = #FF....\n    //   then we are enable to map the red component on the new red components\n    //   which can be different.\n\n    const getSteps = (fg, bg, n) => {\n      const arr = new Array(256);\n      const step = (bgGray - fgGray) / n;\n      const newStart = fg / 255;\n      const newStep = (bg - fg) / (255 * n);\n      let prev = 0;\n      for (let i = 0; i <= n; i++) {\n        const k = Math.round(fgGray + i * step);\n        const value = newStart + i * newStep;\n        for (let j = prev; j <= k; j++) {\n          arr[j] = value;\n        }\n        prev = k + 1;\n      }\n      for (let i = prev; i < 256; i++) {\n        arr[i] = arr[prev - 1];\n      }\n      return arr.join(\",\");\n    };\n\n    const id = `g_${this.#docId}_hcm_${filterName}_filter`;\n    const filter = (info.filter = this.#createFilter(id));\n\n    this.#addGrayConversion(filter);\n    this.#addTransferMapConversion(\n      getSteps(newFgRGB[0], newBgRGB[0], 5),\n      getSteps(newFgRGB[1], newBgRGB[1], 5),\n      getSteps(newFgRGB[2], newBgRGB[2], 5),\n      filter\n    );\n\n    info.url = this.#createUrl(id);\n    return info.url;\n  }\n\n  destroy(keepHCM = false) {\n    if (keepHCM && this.#_hcmCache?.size) {\n      return;\n    }\n    this.#_defs?.parentNode.parentNode.remove();\n    this.#_defs = null;\n\n    this.#_cache?.clear();\n    this.#_cache = null;\n\n    this.#_hcmCache?.clear();\n    this.#_hcmCache = null;\n\n    this.#id = 0;\n  }\n\n  #addLuminosityConversion(filter) {\n    const feColorMatrix = this.#document.createElementNS(\n      SVG_NS,\n      \"feColorMatrix\"\n    );\n    feColorMatrix.setAttribute(\"type\", \"matrix\");\n    feColorMatrix.setAttribute(\n      \"values\",\n      \"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0\"\n    );\n    filter.append(feColorMatrix);\n  }\n\n  #addGrayConversion(filter) {\n    const feColorMatrix = this.#document.createElementNS(\n      SVG_NS,\n      \"feColorMatrix\"\n    );\n    feColorMatrix.setAttribute(\"type\", \"matrix\");\n    feColorMatrix.setAttribute(\n      \"values\",\n      \"0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0\"\n    );\n    filter.append(feColorMatrix);\n  }\n\n  #createFilter(id) {\n    const filter = this.#document.createElementNS(SVG_NS, \"filter\");\n    filter.setAttribute(\"color-interpolation-filters\", \"sRGB\");\n    filter.setAttribute(\"id\", id);\n    this.#defs.append(filter);\n\n    return filter;\n  }\n\n  #appendFeFunc(feComponentTransfer, func, table) {\n    const feFunc = this.#document.createElementNS(SVG_NS, func);\n    feFunc.setAttribute(\"type\", \"discrete\");\n    feFunc.setAttribute(\"tableValues\", table);\n    feComponentTransfer.append(feFunc);\n  }\n\n  #addTransferMapConversion(rTable, gTable, bTable, filter) {\n    const feComponentTransfer = this.#document.createElementNS(\n      SVG_NS,\n      \"feComponentTransfer\"\n    );\n    filter.append(feComponentTransfer);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncR\", rTable);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncG\", gTable);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncB\", bTable);\n  }\n\n  #addTransferMapAlphaConversion(aTable, filter) {\n    const feComponentTransfer = this.#document.createElementNS(\n      SVG_NS,\n      \"feComponentTransfer\"\n    );\n    filter.append(feComponentTransfer);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncA\", aTable);\n  }\n\n  #getRGB(color) {\n    this.#defs.style.color = color;\n    return getRGB(getComputedStyle(this.#defs).getPropertyValue(\"color\"));\n  }\n}\n\nexport { BaseFilterFactory, DOMFilterFactory };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { fetchData } from \"./display_utils.js\";\nimport { unreachable } from \"../shared/util.js\";\n\nclass BaseStandardFontDataFactory {\n  constructor({ baseUrl = null }) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseStandardFontDataFactory\n    ) {\n      unreachable(\"Cannot initialize BaseStandardFontDataFactory.\");\n    }\n    this.baseUrl = baseUrl;\n  }\n\n  async fetch({ filename }) {\n    if (!this.baseUrl) {\n      throw new Error(\n        \"Ensure that the `standardFontDataUrl` API parameter is provided.\"\n      );\n    }\n    if (!filename) {\n      throw new Error(\"Font filename must be specified.\");\n    }\n    const url = `${this.baseUrl}${filename}`;\n\n    return this._fetch(url).catch(reason => {\n      throw new Error(`Unable to load font data at: ${url}`);\n    });\n  }\n\n  /**\n   * @ignore\n   * @returns {Promise<Uint8Array>}\n   */\n  async _fetch(url) {\n    unreachable(\"Abstract method `_fetch` called.\");\n  }\n}\n\nclass DOMStandardFontDataFactory extends BaseStandardFontDataFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    const data = await fetchData(url, /* type = */ \"arraybuffer\");\n    return new Uint8Array(data);\n  }\n}\n\nexport { BaseStandardFontDataFactory, DOMStandardFontDataFactory };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { fetchData } from \"./display_utils.js\";\nimport { unreachable } from \"../shared/util.js\";\n\nclass BaseWasmFactory {\n  constructor({ baseUrl = null }) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseWasmFactory\n    ) {\n      unreachable(\"Cannot initialize BaseWasmFactory.\");\n    }\n    this.baseUrl = baseUrl;\n  }\n\n  async fetch({ filename }) {\n    if (!this.baseUrl) {\n      throw new Error(\"Ensure that the `wasmUrl` API parameter is provided.\");\n    }\n    if (!filename) {\n      throw new Error(\"Wasm filename must be specified.\");\n    }\n    const url = `${this.baseUrl}${filename}`;\n\n    return this._fetch(url).catch(reason => {\n      throw new Error(`Unable to load wasm data at: ${url}`);\n    });\n  }\n\n  /**\n   * @ignore\n   * @returns {Promise<Uint8Array>}\n   */\n  async _fetch(url) {\n    unreachable(\"Abstract method `_fetch` called.\");\n  }\n}\n\nclass DOMWasmFactory extends BaseWasmFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    const data = await fetchData(url, /* type = */ \"arraybuffer\");\n    return new Uint8Array(data);\n  }\n}\n\nexport { BaseWasmFactory, DOMWasmFactory };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* globals process */\n\nimport { isNodeJS, warn } from \"../shared/util.js\";\nimport { BaseCanvasFactory } from \"./canvas_factory.js\";\nimport { BaseCMapReaderFactory } from \"./cmap_reader_factory.js\";\nimport { BaseFilterFactory } from \"./filter_factory.js\";\nimport { BaseStandardFontDataFactory } from \"./standard_fontdata_factory.js\";\nimport { BaseWasmFactory } from \"./wasm_factory.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./node_utils.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nif (isNodeJS) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"SKIP_BABEL\")) {\n    warn(\"Please use the `legacy` build in Node.js environments.\");\n  } else {\n    let canvas;\n    try {\n      const require = process\n        .getBuiltinModule(\"module\")\n        .createRequire(import.meta.url);\n\n      try {\n        canvas = require(\"@napi-rs/canvas\");\n      } catch (ex) {\n        warn(`Cannot load \"@napi-rs/canvas\" package: \"${ex}\".`);\n      }\n    } catch (ex) {\n      warn(`Cannot access the \\`require\\` function: \"${ex}\".`);\n    }\n\n    if (!globalThis.DOMMatrix) {\n      if (canvas?.DOMMatrix) {\n        globalThis.DOMMatrix = canvas.DOMMatrix;\n      } else {\n        warn(\"Cannot polyfill `DOMMatrix`, rendering may be broken.\");\n      }\n    }\n    if (!globalThis.ImageData) {\n      if (canvas?.ImageData) {\n        globalThis.ImageData = canvas.ImageData;\n      } else {\n        warn(\"Cannot polyfill `ImageData`, rendering may be broken.\");\n      }\n    }\n    if (!globalThis.Path2D) {\n      if (canvas?.Path2D) {\n        globalThis.Path2D = canvas.Path2D;\n      } else {\n        warn(\"Cannot polyfill `Path2D`, rendering may be broken.\");\n      }\n    }\n    if (!globalThis.navigator?.language) {\n      globalThis.navigator = {\n        language: \"en-US\",\n        platform: \"\",\n        userAgent: \"\",\n      };\n    }\n  }\n}\n\nasync function fetchData(url) {\n  const fs = process.getBuiltinModule(\"fs\");\n  const data = await fs.promises.readFile(url);\n  return new Uint8Array(data);\n}\n\nclass NodeFilterFactory extends BaseFilterFactory {}\n\nclass NodeCanvasFactory extends BaseCanvasFactory {\n  /**\n   * @ignore\n   */\n  _createCanvas(width, height) {\n    const require = process\n      .getBuiltinModule(\"module\")\n      .createRequire(import.meta.url);\n    const canvas = require(\"@napi-rs/canvas\");\n    return canvas.createCanvas(width, height);\n  }\n}\n\nclass NodeCMapReaderFactory extends BaseCMapReaderFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    return fetchData(url);\n  }\n}\n\nclass NodeStandardFontDataFactory extends BaseStandardFontDataFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    return fetchData(url);\n  }\n}\n\nclass NodeWasmFactory extends BaseWasmFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    return fetchData(url);\n  }\n}\n\nexport {\n  fetchData,\n  NodeCanvasFactory,\n  NodeCMapReaderFactory,\n  NodeFilterFactory,\n  NodeStandardFontDataFactory,\n  NodeWasmFactory,\n};\n","import { Util } from \"../shared/util.js\";\n\nconst FORCED_DEPENDENCY_LABEL = \"__forcedDependency\";\n\nconst { floor, ceil } = Math;\n\nfunction expandBBox(array, index, minX, minY, maxX, maxY) {\n  array[index * 4 + 0] = Math.min(array[index * 4 + 0], minX);\n  array[index * 4 + 1] = Math.min(array[index * 4 + 1], minY);\n  array[index * 4 + 2] = Math.max(array[index * 4 + 2], maxX);\n  array[index * 4 + 3] = Math.max(array[index * 4 + 3], maxY);\n}\n\n// This is computed rathter than hard-coded to keep into\n// account the platform's endianess.\nconst EMPTY_BBOX = new Uint32Array(new Uint8Array([255, 255, 0, 0]).buffer)[0];\n\nclass BBoxReader {\n  #bboxes;\n\n  #coords;\n\n  constructor(bboxes, coords) {\n    this.#bboxes = bboxes;\n    this.#coords = coords;\n  }\n\n  get length() {\n    return this.#bboxes.length;\n  }\n\n  isEmpty(i) {\n    return this.#bboxes[i] === EMPTY_BBOX;\n  }\n\n  minX(i) {\n    return this.#coords[i * 4 + 0] / 256;\n  }\n\n  minY(i) {\n    return this.#coords[i * 4 + 1] / 256;\n  }\n\n  maxX(i) {\n    return (this.#coords[i * 4 + 2] + 1) / 256;\n  }\n\n  maxY(i) {\n    return (this.#coords[i * 4 + 3] + 1) / 256;\n  }\n}\n\nconst ensureDebugMetadata = (map, key) => {\n  if (!map) {\n    return undefined;\n  }\n  let value = map.get(key);\n  if (!value) {\n    value = { dependencies: new Set(), isRenderingOperation: false };\n    map.set(key, value);\n  }\n  return value;\n};\n\n/**\n * @typedef {\"lineWidth\" | \"lineCap\" | \"lineJoin\" | \"miterLimit\" | \"dash\" |\n * \"strokeAlpha\" | \"fillColor\" | \"fillAlpha\" | \"globalCompositeOperation\" |\n * \"path\" | \"filter\" | \"font\" | \"fontObj\"} SimpleDependency\n */\n\n/**\n * @typedef {\"transform\" | \"moveText\" | \"sameLineText\"} IncrementalDependency\n */\n\n/**\n * @typedef {IncrementalDependency |\n * typeof FORCED_DEPENDENCY_LABEL} InternalIncrementalDependency\n */\nclass CanvasDependencyTracker {\n  /** @type {Record<SimpleDependency, number>} */\n  #simple = { __proto__: null };\n\n  /** @type {Record<InternalIncrementalDependency , number[]>} */\n  #incremental = {\n    __proto__: null,\n    transform: [],\n    moveText: [],\n    sameLineText: [],\n    [FORCED_DEPENDENCY_LABEL]: [],\n  };\n\n  #namedDependencies = new Map();\n\n  #savesStack = [];\n\n  #markedContentStack = [];\n\n  #baseTransformStack = [[1, 0, 0, 1, 0, 0]];\n\n  #clipBox = [-Infinity, -Infinity, Infinity, Infinity];\n\n  // Float32Array<minX, minY, maxX, maxY>\n  #pendingBBox = new Float64Array([Infinity, Infinity, -Infinity, -Infinity]);\n\n  #pendingBBoxIdx = -1;\n\n  #pendingDependencies = new Set();\n\n  #operations = new Map();\n\n  #fontBBoxTrustworthy = new Map();\n\n  #canvasWidth;\n\n  #canvasHeight;\n\n  // Uint8ClampedArray<minX, minY, maxX, maxY>\n  #bboxesCoords;\n\n  #bboxes;\n\n  #debugMetadata;\n\n  constructor(canvas, operationsCount, recordDebugMetadata = false) {\n    this.#canvasWidth = canvas.width;\n    this.#canvasHeight = canvas.height;\n    this.#initializeBBoxes(operationsCount);\n    if (recordDebugMetadata) {\n      this.#debugMetadata = new Map();\n    }\n  }\n\n  growOperationsCount(operationsCount) {\n    if (operationsCount >= this.#bboxes.length) {\n      this.#initializeBBoxes(operationsCount, this.#bboxes);\n    }\n  }\n\n  #initializeBBoxes(operationsCount, oldBBoxes) {\n    const buffer = new ArrayBuffer(operationsCount * 4);\n    this.#bboxesCoords = new Uint8ClampedArray(buffer);\n    this.#bboxes = new Uint32Array(buffer);\n    if (oldBBoxes && oldBBoxes.length > 0) {\n      this.#bboxes.set(oldBBoxes);\n      this.#bboxes.fill(EMPTY_BBOX, oldBBoxes.length);\n    } else {\n      this.#bboxes.fill(EMPTY_BBOX);\n    }\n  }\n\n  save(opIdx) {\n    this.#simple = { __proto__: this.#simple };\n    this.#incremental = {\n      __proto__: this.#incremental,\n      transform: { __proto__: this.#incremental.transform },\n      moveText: { __proto__: this.#incremental.moveText },\n      sameLineText: { __proto__: this.#incremental.sameLineText },\n      [FORCED_DEPENDENCY_LABEL]: {\n        __proto__: this.#incremental[FORCED_DEPENDENCY_LABEL],\n      },\n    };\n    this.#clipBox = { __proto__: this.#clipBox };\n    this.#savesStack.push(opIdx);\n\n    return this;\n  }\n\n  restore(opIdx) {\n    const previous = Object.getPrototypeOf(this.#simple);\n    if (previous === null) {\n      // Sometimes we call more .restore() than .save(), for\n      // example when using CanvasGraphics' #restoreInitialState()\n      return this;\n    }\n    this.#simple = previous;\n    this.#incremental = Object.getPrototypeOf(this.#incremental);\n    this.#clipBox = Object.getPrototypeOf(this.#clipBox);\n\n    const lastSave = this.#savesStack.pop();\n    if (lastSave !== undefined) {\n      ensureDebugMetadata(this.#debugMetadata, opIdx)?.dependencies.add(\n        lastSave\n      );\n      this.#bboxes[opIdx] = this.#bboxes[lastSave];\n    }\n\n    return this;\n  }\n\n  /**\n   * @param {number} idx\n   */\n  recordOpenMarker(idx) {\n    this.#savesStack.push(idx);\n    return this;\n  }\n\n  getOpenMarker() {\n    if (this.#savesStack.length === 0) {\n      return null;\n    }\n    return this.#savesStack.at(-1);\n  }\n\n  recordCloseMarker(opIdx) {\n    const lastSave = this.#savesStack.pop();\n    if (lastSave !== undefined) {\n      ensureDebugMetadata(this.#debugMetadata, opIdx)?.dependencies.add(\n        lastSave\n      );\n      this.#bboxes[opIdx] = this.#bboxes[lastSave];\n    }\n    return this;\n  }\n\n  // Marked content needs a separate stack from save/restore, because they\n  // form two independent trees.\n  beginMarkedContent(opIdx) {\n    this.#markedContentStack.push(opIdx);\n    return this;\n  }\n\n  endMarkedContent(opIdx) {\n    const lastSave = this.#markedContentStack.pop();\n    if (lastSave !== undefined) {\n      ensureDebugMetadata(this.#debugMetadata, opIdx)?.dependencies.add(\n        lastSave\n      );\n      this.#bboxes[opIdx] = this.#bboxes[lastSave];\n    }\n    return this;\n  }\n\n  pushBaseTransform(ctx) {\n    this.#baseTransformStack.push(\n      Util.multiplyByDOMMatrix(\n        this.#baseTransformStack.at(-1),\n        ctx.getTransform()\n      )\n    );\n    return this;\n  }\n\n  popBaseTransform() {\n    if (this.#baseTransformStack.length > 1) {\n      this.#baseTransformStack.pop();\n    }\n    return this;\n  }\n\n  /**\n   * @param {SimpleDependency} name\n   * @param {number} idx\n   */\n  recordSimpleData(name, idx) {\n    this.#simple[name] = idx;\n    return this;\n  }\n\n  /**\n   * @param {IncrementalDependency} name\n   * @param {number} idx\n   */\n  recordIncrementalData(name, idx) {\n    this.#incremental[name].push(idx);\n    return this;\n  }\n\n  /**\n   * @param {IncrementalDependency} name\n   * @param {number} idx\n   */\n  resetIncrementalData(name, idx) {\n    this.#incremental[name].length = 0;\n    return this;\n  }\n\n  recordNamedData(name, idx) {\n    this.#namedDependencies.set(name, idx);\n    return this;\n  }\n\n  /**\n   * @param {SimpleDependency} name\n   * @param {string} depName\n   * @param {number} fallbackIdx\n   */\n  recordSimpleDataFromNamed(name, depName, fallbackIdx) {\n    this.#simple[name] = this.#namedDependencies.get(depName) ?? fallbackIdx;\n  }\n\n  // All next operations, until the next .restore(), will depend on this\n  recordFutureForcedDependency(name, idx) {\n    this.recordIncrementalData(FORCED_DEPENDENCY_LABEL, idx);\n    return this;\n  }\n\n  // All next operations, until the next .restore(), will depend on all\n  // the already recorded data with the given names.\n  inheritSimpleDataAsFutureForcedDependencies(names) {\n    for (const name of names) {\n      if (name in this.#simple) {\n        this.recordFutureForcedDependency(name, this.#simple[name]);\n      }\n    }\n    return this;\n  }\n\n  inheritPendingDependenciesAsFutureForcedDependencies() {\n    for (const dep of this.#pendingDependencies) {\n      this.recordFutureForcedDependency(FORCED_DEPENDENCY_LABEL, dep);\n    }\n    return this;\n  }\n\n  resetBBox(idx) {\n    if (this.#pendingBBoxIdx !== idx) {\n      this.#pendingBBoxIdx = idx;\n      this.#pendingBBox[0] = Infinity;\n      this.#pendingBBox[1] = Infinity;\n      this.#pendingBBox[2] = -Infinity;\n      this.#pendingBBox[3] = -Infinity;\n    }\n    return this;\n  }\n\n  recordClipBox(idx, ctx, minX, maxX, minY, maxY) {\n    const transform = Util.multiplyByDOMMatrix(\n      this.#baseTransformStack.at(-1),\n      ctx.getTransform()\n    );\n    const clipBox = [Infinity, Infinity, -Infinity, -Infinity];\n    Util.axialAlignedBoundingBox([minX, minY, maxX, maxY], transform, clipBox);\n    const intersection = Util.intersect(this.#clipBox, clipBox);\n    if (intersection) {\n      this.#clipBox[0] = intersection[0];\n      this.#clipBox[1] = intersection[1];\n      this.#clipBox[2] = intersection[2];\n      this.#clipBox[3] = intersection[3];\n    } else {\n      this.#clipBox[0] = this.#clipBox[1] = Infinity;\n      this.#clipBox[2] = this.#clipBox[3] = -Infinity;\n    }\n    return this;\n  }\n\n  recordBBox(idx, ctx, minX, maxX, minY, maxY) {\n    const clipBox = this.#clipBox;\n    if (clipBox[0] === Infinity) {\n      return this;\n    }\n\n    const transform = Util.multiplyByDOMMatrix(\n      this.#baseTransformStack.at(-1),\n      ctx.getTransform()\n    );\n    if (clipBox[0] === -Infinity) {\n      Util.axialAlignedBoundingBox(\n        [minX, minY, maxX, maxY],\n        transform,\n        this.#pendingBBox\n      );\n      return this;\n    }\n\n    const bbox = [Infinity, Infinity, -Infinity, -Infinity];\n    Util.axialAlignedBoundingBox([minX, minY, maxX, maxY], transform, bbox);\n    this.#pendingBBox[0] = Math.min(\n      this.#pendingBBox[0],\n      Math.max(bbox[0], clipBox[0])\n    );\n    this.#pendingBBox[1] = Math.min(\n      this.#pendingBBox[1],\n      Math.max(bbox[1], clipBox[1])\n    );\n    this.#pendingBBox[2] = Math.max(\n      this.#pendingBBox[2],\n      Math.min(bbox[2], clipBox[2])\n    );\n    this.#pendingBBox[3] = Math.max(\n      this.#pendingBBox[3],\n      Math.min(bbox[3], clipBox[3])\n    );\n    return this;\n  }\n\n  recordCharacterBBox(idx, ctx, font, scale = 1, x = 0, y = 0, getMeasure) {\n    const fontBBox = font.bbox;\n    let isBBoxTrustworthy;\n    let computedBBox;\n\n    if (fontBBox) {\n      isBBoxTrustworthy =\n        // Only use the bounding box defined by the font if it\n        // has a non-empty area.\n        fontBBox[2] !== fontBBox[0] &&\n        fontBBox[3] !== fontBBox[1] &&\n        this.#fontBBoxTrustworthy.get(font);\n\n      if (isBBoxTrustworthy !== false) {\n        computedBBox = [0, 0, 0, 0];\n        Util.axialAlignedBoundingBox(fontBBox, font.fontMatrix, computedBBox);\n        if (scale !== 1 || x !== 0 || y !== 0) {\n          Util.scaleMinMax([scale, 0, 0, -scale, x, y], computedBBox);\n        }\n\n        if (isBBoxTrustworthy) {\n          return this.recordBBox(\n            idx,\n            ctx,\n            computedBBox[0],\n            computedBBox[2],\n            computedBBox[1],\n            computedBBox[3]\n          );\n        }\n      }\n    }\n\n    if (!getMeasure) {\n      // We have no way of telling how big this character actually is, record\n      // a full page bounding box.\n      return this.recordFullPageBBox(idx);\n    }\n\n    const measure = getMeasure();\n\n    if (fontBBox && computedBBox && isBBoxTrustworthy === undefined) {\n      // If it's the first time we can compare the font bbox with the actual\n      // bbox measured when drawing it, check if the one recorded in the font\n      // is large enough to cover the actual bbox. If it is, we assume that the\n      // font is well-formed and we can use the declared bbox without having to\n      // measure it again for every character.\n      isBBoxTrustworthy =\n        computedBBox[0] <= x - measure.actualBoundingBoxLeft &&\n        computedBBox[2] >= x + measure.actualBoundingBoxRight &&\n        computedBBox[1] <= y - measure.actualBoundingBoxAscent &&\n        computedBBox[3] >= y + measure.actualBoundingBoxDescent;\n      this.#fontBBoxTrustworthy.set(font, isBBoxTrustworthy);\n      if (isBBoxTrustworthy) {\n        return this.recordBBox(\n          idx,\n          ctx,\n          computedBBox[0],\n          computedBBox[2],\n          computedBBox[1],\n          computedBBox[3]\n        );\n      }\n    }\n\n    // The font has no bbox or it is not trustworthy, so we need to\n    // return the bounding box based on .measureText().\n    return this.recordBBox(\n      idx,\n      ctx,\n      x - measure.actualBoundingBoxLeft,\n      x + measure.actualBoundingBoxRight,\n      y - measure.actualBoundingBoxAscent,\n      y + measure.actualBoundingBoxDescent\n    );\n  }\n\n  recordFullPageBBox(idx) {\n    this.#pendingBBox[0] = Math.max(0, this.#clipBox[0]);\n    this.#pendingBBox[1] = Math.max(0, this.#clipBox[1]);\n    this.#pendingBBox[2] = Math.min(this.#canvasWidth, this.#clipBox[2]);\n    this.#pendingBBox[3] = Math.min(this.#canvasHeight, this.#clipBox[3]);\n\n    return this;\n  }\n\n  getSimpleIndex(dependencyName) {\n    return this.#simple[dependencyName];\n  }\n\n  recordDependencies(idx, dependencyNames) {\n    const pendingDependencies = this.#pendingDependencies;\n    const simple = this.#simple;\n    const incremental = this.#incremental;\n    for (const name of dependencyNames) {\n      if (name in this.#simple) {\n        pendingDependencies.add(simple[name]);\n      } else if (name in incremental) {\n        incremental[name].forEach(pendingDependencies.add, pendingDependencies);\n      }\n    }\n\n    return this;\n  }\n\n  recordNamedDependency(idx, name) {\n    if (this.#namedDependencies.has(name)) {\n      this.#pendingDependencies.add(this.#namedDependencies.get(name));\n    }\n\n    return this;\n  }\n\n  /**\n   * @param {number} idx\n   */\n  recordOperation(idx, preserve = false) {\n    this.recordDependencies(idx, [FORCED_DEPENDENCY_LABEL]);\n\n    if (this.#debugMetadata) {\n      const metadata = ensureDebugMetadata(this.#debugMetadata, idx);\n      const { dependencies } = metadata;\n      this.#pendingDependencies.forEach(dependencies.add, dependencies);\n      this.#savesStack.forEach(dependencies.add, dependencies);\n      this.#markedContentStack.forEach(dependencies.add, dependencies);\n      dependencies.delete(idx);\n      metadata.isRenderingOperation = true;\n    }\n\n    if (this.#pendingBBoxIdx === idx) {\n      const minX = floor((this.#pendingBBox[0] * 256) / this.#canvasWidth);\n      const minY = floor((this.#pendingBBox[1] * 256) / this.#canvasHeight);\n      const maxX = ceil((this.#pendingBBox[2] * 256) / this.#canvasWidth);\n      const maxY = ceil((this.#pendingBBox[3] * 256) / this.#canvasHeight);\n\n      expandBBox(this.#bboxesCoords, idx, minX, minY, maxX, maxY);\n      for (const depIdx of this.#pendingDependencies) {\n        if (depIdx !== idx) {\n          expandBBox(this.#bboxesCoords, depIdx, minX, minY, maxX, maxY);\n        }\n      }\n      for (const saveIdx of this.#savesStack) {\n        if (saveIdx !== idx) {\n          expandBBox(this.#bboxesCoords, saveIdx, minX, minY, maxX, maxY);\n        }\n      }\n      for (const saveIdx of this.#markedContentStack) {\n        if (saveIdx !== idx) {\n          expandBBox(this.#bboxesCoords, saveIdx, minX, minY, maxX, maxY);\n        }\n      }\n\n      if (!preserve) {\n        this.#pendingDependencies.clear();\n        this.#pendingBBoxIdx = -1;\n      }\n    }\n\n    return this;\n  }\n\n  recordShowTextOperation(idx, preserve = false) {\n    const deps = Array.from(this.#pendingDependencies);\n    this.recordOperation(idx, preserve);\n    this.recordIncrementalData(\"sameLineText\", idx);\n    for (const dep of deps) {\n      this.recordIncrementalData(\"sameLineText\", dep);\n    }\n    return this;\n  }\n\n  bboxToClipBoxDropOperation(idx, preserve = false) {\n    if (this.#pendingBBoxIdx === idx) {\n      this.#pendingBBoxIdx = -1;\n\n      this.#clipBox[0] = Math.max(this.#clipBox[0], this.#pendingBBox[0]);\n      this.#clipBox[1] = Math.max(this.#clipBox[1], this.#pendingBBox[1]);\n      this.#clipBox[2] = Math.min(this.#clipBox[2], this.#pendingBBox[2]);\n      this.#clipBox[3] = Math.min(this.#clipBox[3], this.#pendingBBox[3]);\n\n      if (!preserve) {\n        this.#pendingDependencies.clear();\n      }\n    }\n    return this;\n  }\n\n  _takePendingDependencies() {\n    const pendingDependencies = this.#pendingDependencies;\n    this.#pendingDependencies = new Set();\n    return pendingDependencies;\n  }\n\n  _extractOperation(idx) {\n    const operation = this.#operations.get(idx);\n    this.#operations.delete(idx);\n    return operation;\n  }\n\n  _pushPendingDependencies(dependencies) {\n    for (const dep of dependencies) {\n      this.#pendingDependencies.add(dep);\n    }\n  }\n\n  take() {\n    this.#fontBBoxTrustworthy.clear();\n    return new BBoxReader(this.#bboxes, this.#bboxesCoords);\n  }\n\n  takeDebugMetadata() {\n    return this.#debugMetadata;\n  }\n}\n\n/**\n * Used to track dependencies of nested operations list, that\n * should actually all map to the index of the operation that\n * contains the nested list.\n *\n * @implements {CanvasDependencyTracker}\n */\nclass CanvasNestedDependencyTracker {\n  /** @type {CanvasDependencyTracker} */\n  #dependencyTracker;\n\n  /** @type {number} */\n  #opIdx;\n\n  #ignoreBBoxes;\n\n  #nestingLevel = 0;\n\n  #savesLevel = 0;\n\n  constructor(dependencyTracker, opIdx, ignoreBBoxes) {\n    if (\n      dependencyTracker instanceof CanvasNestedDependencyTracker &&\n      dependencyTracker.#ignoreBBoxes === !!ignoreBBoxes\n    ) {\n      // The goal of CanvasNestedDependencyTracker is to collapse all operations\n      // into a single one. If we are already in a\n      // CanvasNestedDependencyTracker, that is already happening.\n      return dependencyTracker;\n    }\n\n    this.#dependencyTracker = dependencyTracker;\n    this.#opIdx = opIdx;\n    this.#ignoreBBoxes = !!ignoreBBoxes;\n  }\n\n  growOperationsCount() {\n    throw new Error(\"Unreachable\");\n  }\n\n  save(opIdx) {\n    this.#savesLevel++;\n    this.#dependencyTracker.save(this.#opIdx);\n    return this;\n  }\n\n  restore(opIdx) {\n    if (this.#savesLevel > 0) {\n      this.#dependencyTracker.restore(this.#opIdx);\n      this.#savesLevel--;\n    }\n    return this;\n  }\n\n  recordOpenMarker(idx) {\n    this.#nestingLevel++;\n    return this;\n  }\n\n  getOpenMarker() {\n    return this.#nestingLevel > 0\n      ? this.#opIdx\n      : this.#dependencyTracker.getOpenMarker();\n  }\n\n  recordCloseMarker(idx) {\n    this.#nestingLevel--;\n    return this;\n  }\n\n  beginMarkedContent(opIdx) {\n    return this;\n  }\n\n  endMarkedContent(opIdx) {\n    return this;\n  }\n\n  pushBaseTransform(ctx) {\n    this.#dependencyTracker.pushBaseTransform(ctx);\n    return this;\n  }\n\n  popBaseTransform() {\n    this.#dependencyTracker.popBaseTransform();\n    return this;\n  }\n\n  /**\n   * @param {SimpleDependency} name\n   * @param {number} idx\n   */\n  recordSimpleData(name, idx) {\n    this.#dependencyTracker.recordSimpleData(name, this.#opIdx);\n    return this;\n  }\n\n  /**\n   * @param {IncrementalDependency} name\n   * @param {number} idx\n   */\n  recordIncrementalData(name, idx) {\n    this.#dependencyTracker.recordIncrementalData(name, this.#opIdx);\n    return this;\n  }\n\n  /**\n   * @param {IncrementalDependency} name\n   * @param {number} idx\n   */\n  resetIncrementalData(name, idx) {\n    this.#dependencyTracker.resetIncrementalData(name, this.#opIdx);\n    return this;\n  }\n\n  recordNamedData(name, idx) {\n    // Nested dependencies are not visible to the outside.\n    return this;\n  }\n\n  /**\n   * @param {SimpleDependency} name\n   * @param {string} depName\n   * @param {number} fallbackIdx\n   */\n  recordSimpleDataFromNamed(name, depName, fallbackIdx) {\n    this.#dependencyTracker.recordSimpleDataFromNamed(\n      name,\n      depName,\n      this.#opIdx\n    );\n    return this;\n  }\n\n  // All next operations, until the next .restore(), will depend on this\n  recordFutureForcedDependency(name, idx) {\n    this.#dependencyTracker.recordFutureForcedDependency(name, this.#opIdx);\n    return this;\n  }\n\n  // All next operations, until the next .restore(), will depend on all\n  // the already recorded data with the given names.\n  inheritSimpleDataAsFutureForcedDependencies(names) {\n    this.#dependencyTracker.inheritSimpleDataAsFutureForcedDependencies(names);\n    return this;\n  }\n\n  inheritPendingDependenciesAsFutureForcedDependencies() {\n    this.#dependencyTracker.inheritPendingDependenciesAsFutureForcedDependencies();\n    return this;\n  }\n\n  resetBBox(idx) {\n    if (!this.#ignoreBBoxes) {\n      this.#dependencyTracker.resetBBox(this.#opIdx);\n    }\n    return this;\n  }\n\n  recordClipBox(idx, ctx, minX, maxX, minY, maxY) {\n    if (!this.#ignoreBBoxes) {\n      this.#dependencyTracker.recordClipBox(\n        this.#opIdx,\n        ctx,\n        minX,\n        maxX,\n        minY,\n        maxY\n      );\n    }\n    return this;\n  }\n\n  recordBBox(idx, ctx, minX, maxX, minY, maxY) {\n    if (!this.#ignoreBBoxes) {\n      this.#dependencyTracker.recordBBox(\n        this.#opIdx,\n        ctx,\n        minX,\n        maxX,\n        minY,\n        maxY\n      );\n    }\n    return this;\n  }\n\n  recordCharacterBBox(idx, ctx, font, scale, x, y, getMeasure) {\n    if (!this.#ignoreBBoxes) {\n      this.#dependencyTracker.recordCharacterBBox(\n        this.#opIdx,\n        ctx,\n        font,\n        scale,\n        x,\n        y,\n        getMeasure\n      );\n    }\n    return this;\n  }\n\n  recordFullPageBBox(idx) {\n    if (!this.#ignoreBBoxes) {\n      this.#dependencyTracker.recordFullPageBBox(this.#opIdx);\n    }\n    return this;\n  }\n\n  getSimpleIndex(dependencyName) {\n    return this.#dependencyTracker.getSimpleIndex(dependencyName);\n  }\n\n  recordDependencies(idx, dependencyNames) {\n    this.#dependencyTracker.recordDependencies(this.#opIdx, dependencyNames);\n    return this;\n  }\n\n  recordNamedDependency(idx, name) {\n    this.#dependencyTracker.recordNamedDependency(this.#opIdx, name);\n    return this;\n  }\n\n  /**\n   * @param {number} idx\n   * @param {SimpleDependency[]} dependencyNames\n   */\n  recordOperation(idx) {\n    this.#dependencyTracker.recordOperation(this.#opIdx, true);\n    return this;\n  }\n\n  recordShowTextOperation(idx) {\n    this.#dependencyTracker.recordShowTextOperation(this.#opIdx, true);\n    return this;\n  }\n\n  bboxToClipBoxDropOperation(idx) {\n    if (!this.#ignoreBBoxes) {\n      this.#dependencyTracker.bboxToClipBoxDropOperation(this.#opIdx, true);\n    }\n    return this;\n  }\n\n  take() {\n    throw new Error(\"Unreachable\");\n  }\n\n  takeDebugMetadata() {\n    throw new Error(\"Unreachable\");\n  }\n}\n\n/** @satisfies {Record<string, SimpleDependency | IncrementalDependency>} */\nconst Dependencies = {\n  stroke: [\n    \"path\",\n    \"transform\",\n    \"filter\",\n    \"strokeColor\",\n    \"strokeAlpha\",\n    \"lineWidth\",\n    \"lineCap\",\n    \"lineJoin\",\n    \"miterLimit\",\n    \"dash\",\n  ],\n  fill: [\n    \"path\",\n    \"transform\",\n    \"filter\",\n    \"fillColor\",\n    \"fillAlpha\",\n    \"globalCompositeOperation\",\n    \"SMask\",\n  ],\n  imageXObject: [\n    \"transform\",\n    \"SMask\",\n    \"filter\",\n    \"fillAlpha\",\n    \"strokeAlpha\",\n    \"globalCompositeOperation\",\n  ],\n  rawFillPath: [\"filter\", \"fillColor\", \"fillAlpha\"],\n  showText: [\n    \"transform\",\n    \"leading\",\n    \"charSpacing\",\n    \"wordSpacing\",\n    \"hScale\",\n    \"textRise\",\n    \"moveText\",\n    \"textMatrix\",\n    \"font\",\n    \"fontObj\",\n    \"filter\",\n    \"fillColor\",\n    \"textRenderingMode\",\n    \"SMask\",\n    \"fillAlpha\",\n    \"strokeAlpha\",\n    \"globalCompositeOperation\",\n\n    \"sameLineText\",\n  ],\n  transform: [\"transform\"],\n  transformAndFill: [\"transform\", \"fillColor\"],\n};\n\nexport { CanvasDependencyTracker, CanvasNestedDependencyTracker, Dependencies };\n","/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FormatError,\n  info,\n  MeshFigureType,\n  unreachable,\n  Util,\n} from \"../shared/util.js\";\nimport { getCurrentTransform } from \"./display_utils.js\";\n\nconst PathType = {\n  FILL: \"Fill\",\n  STROKE: \"Stroke\",\n  SHADING: \"Shading\",\n};\n\nfunction applyBoundingBox(ctx, bbox) {\n  if (!bbox) {\n    return;\n  }\n  const width = bbox[2] - bbox[0];\n  const height = bbox[3] - bbox[1];\n  const region = new Path2D();\n  region.rect(bbox[0], bbox[1], width, height);\n  ctx.clip(region);\n}\n\nclass BaseShadingPattern {\n  constructor() {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseShadingPattern\n    ) {\n      unreachable(\"Cannot initialize BaseShadingPattern.\");\n    }\n  }\n\n  isModifyingCurrentTransform() {\n    return false;\n  }\n\n  getPattern() {\n    unreachable(\"Abstract method `getPattern` called.\");\n  }\n}\n\nclass RadialAxialShadingPattern extends BaseShadingPattern {\n  constructor(IR) {\n    super();\n    this._type = IR[1];\n    this._bbox = IR[2];\n    this._colorStops = IR[3];\n    this._p0 = IR[4];\n    this._p1 = IR[5];\n    this._r0 = IR[6];\n    this._r1 = IR[7];\n    this.matrix = null;\n  }\n\n  isOriginBased() {\n    return (\n      this._p0[0] === 0 &&\n      this._p0[1] === 0 &&\n      (!this.isRadial() || (this._p1[0] === 0 && this._p1[1] === 0))\n    );\n  }\n\n  isRadial() {\n    return this._type === \"radial\";\n  }\n\n  _createGradient(ctx, transform = null) {\n    let grad;\n    let firstPoint = this._p0;\n    let secondPoint = this._p1;\n    if (transform) {\n      firstPoint = firstPoint.slice();\n      secondPoint = secondPoint.slice();\n      Util.applyTransform(firstPoint, transform);\n      Util.applyTransform(secondPoint, transform);\n    }\n    if (this._type === \"axial\") {\n      grad = ctx.createLinearGradient(\n        firstPoint[0],\n        firstPoint[1],\n        secondPoint[0],\n        secondPoint[1]\n      );\n    } else if (this._type === \"radial\") {\n      let r0 = this._r0;\n      let r1 = this._r1;\n      if (transform) {\n        const scale = new Float32Array(2);\n        Util.singularValueDecompose2dScale(transform, scale);\n        r0 *= scale[0];\n        r1 *= scale[0];\n      }\n      grad = ctx.createRadialGradient(\n        firstPoint[0],\n        firstPoint[1],\n        r0,\n        secondPoint[0],\n        secondPoint[1],\n        r1\n      );\n    }\n\n    for (const colorStop of this._colorStops) {\n      grad.addColorStop(colorStop[0], colorStop[1]);\n    }\n    return grad;\n  }\n\n  getPattern(ctx, owner, inverse, pathType) {\n    let pattern;\n    if (pathType === PathType.STROKE || pathType === PathType.FILL) {\n      if (this.isOriginBased()) {\n        let transf = Util.transform(inverse, owner.baseTransform);\n        if (this.matrix) {\n          transf = Util.transform(transf, this.matrix);\n        }\n        const precision = 1e-3;\n        const n1 = Math.hypot(transf[0], transf[1]);\n        const n2 = Math.hypot(transf[2], transf[3]);\n        const ps = (transf[0] * transf[2] + transf[1] * transf[3]) / (n1 * n2);\n        if (Math.abs(ps) < precision) {\n          // The images of the basis vectors are orthogonal.\n          if (this.isRadial()) {\n            // If the images of the basis vectors are a square then the\n            // circles are transformed to circles and we can use a gradient\n            // directly.\n            if (Math.abs(n1 - n2) < precision) {\n              return this._createGradient(ctx, transf);\n            }\n          } else {\n            // The rectangles are transformed to rectangles and we can use a\n            // gradient directly.\n            return this._createGradient(ctx, transf);\n          }\n        }\n      }\n\n      const ownerBBox = owner.current.getClippedPathBoundingBox(\n        pathType,\n        getCurrentTransform(ctx)\n      ) || [0, 0, 0, 0];\n      // Create a canvas that is only as big as the current path. This doesn't\n      // allow us to cache the pattern, but it generally creates much smaller\n      // canvases and saves memory use. See bug 1722807 for an example.\n      const width = Math.ceil(ownerBBox[2] - ownerBBox[0]) || 1;\n      const height = Math.ceil(ownerBBox[3] - ownerBBox[1]) || 1;\n\n      const tmpCanvas = owner.cachedCanvases.getCanvas(\n        \"pattern\",\n        width,\n        height\n      );\n\n      const tmpCtx = tmpCanvas.context;\n      tmpCtx.clearRect(0, 0, tmpCtx.canvas.width, tmpCtx.canvas.height);\n      tmpCtx.beginPath();\n      tmpCtx.rect(0, 0, tmpCtx.canvas.width, tmpCtx.canvas.height);\n      // Non shading fill patterns are positioned relative to the base transform\n      // (usually the page's initial transform), but we may have created a\n      // smaller canvas based on the path, so we must account for the shift.\n      tmpCtx.translate(-ownerBBox[0], -ownerBBox[1]);\n      inverse = Util.transform(inverse, [\n        1,\n        0,\n        0,\n        1,\n        ownerBBox[0],\n        ownerBBox[1],\n      ]);\n\n      tmpCtx.transform(...owner.baseTransform);\n      if (this.matrix) {\n        tmpCtx.transform(...this.matrix);\n      }\n      applyBoundingBox(tmpCtx, this._bbox);\n\n      tmpCtx.fillStyle = this._createGradient(tmpCtx);\n      tmpCtx.fill();\n\n      pattern = ctx.createPattern(tmpCanvas.canvas, \"no-repeat\");\n      const domMatrix = new DOMMatrix(inverse);\n      pattern.setTransform(domMatrix);\n    } else {\n      // Shading fills are applied relative to the current matrix which is also\n      // how canvas gradients work, so there's no need to do anything special\n      // here.\n      applyBoundingBox(ctx, this._bbox);\n      pattern = this._createGradient(ctx);\n    }\n    return pattern;\n  }\n}\n\nfunction drawTriangle(data, context, p1, p2, p3, c1, c2, c3) {\n  // Very basic Gouraud-shaded triangle rasterization algorithm.\n  const coords = context.coords,\n    colors = context.colors;\n  const bytes = data.data,\n    rowSize = data.width * 4;\n  let tmp;\n  if (coords[p1 + 1] > coords[p2 + 1]) {\n    tmp = p1;\n    p1 = p2;\n    p2 = tmp;\n    tmp = c1;\n    c1 = c2;\n    c2 = tmp;\n  }\n  if (coords[p2 + 1] > coords[p3 + 1]) {\n    tmp = p2;\n    p2 = p3;\n    p3 = tmp;\n    tmp = c2;\n    c2 = c3;\n    c3 = tmp;\n  }\n  if (coords[p1 + 1] > coords[p2 + 1]) {\n    tmp = p1;\n    p1 = p2;\n    p2 = tmp;\n    tmp = c1;\n    c1 = c2;\n    c2 = tmp;\n  }\n  const x1 = (coords[p1] + context.offsetX) * context.scaleX;\n  const y1 = (coords[p1 + 1] + context.offsetY) * context.scaleY;\n  const x2 = (coords[p2] + context.offsetX) * context.scaleX;\n  const y2 = (coords[p2 + 1] + context.offsetY) * context.scaleY;\n  const x3 = (coords[p3] + context.offsetX) * context.scaleX;\n  const y3 = (coords[p3 + 1] + context.offsetY) * context.scaleY;\n  if (y1 >= y3) {\n    return;\n  }\n  const c1r = colors[c1],\n    c1g = colors[c1 + 1],\n    c1b = colors[c1 + 2];\n  const c2r = colors[c2],\n    c2g = colors[c2 + 1],\n    c2b = colors[c2 + 2];\n  const c3r = colors[c3],\n    c3g = colors[c3 + 1],\n    c3b = colors[c3 + 2];\n\n  const minY = Math.round(y1),\n    maxY = Math.round(y3);\n  let xa, car, cag, cab;\n  let xb, cbr, cbg, cbb;\n  for (let y = minY; y <= maxY; y++) {\n    if (y < y2) {\n      const k = y < y1 ? 0 : (y1 - y) / (y1 - y2);\n      xa = x1 - (x1 - x2) * k;\n      car = c1r - (c1r - c2r) * k;\n      cag = c1g - (c1g - c2g) * k;\n      cab = c1b - (c1b - c2b) * k;\n    } else {\n      let k;\n      if (y > y3) {\n        k = 1;\n      } else if (y2 === y3) {\n        k = 0;\n      } else {\n        k = (y2 - y) / (y2 - y3);\n      }\n      xa = x2 - (x2 - x3) * k;\n      car = c2r - (c2r - c3r) * k;\n      cag = c2g - (c2g - c3g) * k;\n      cab = c2b - (c2b - c3b) * k;\n    }\n\n    let k;\n    if (y < y1) {\n      k = 0;\n    } else if (y > y3) {\n      k = 1;\n    } else {\n      k = (y1 - y) / (y1 - y3);\n    }\n    xb = x1 - (x1 - x3) * k;\n    cbr = c1r - (c1r - c3r) * k;\n    cbg = c1g - (c1g - c3g) * k;\n    cbb = c1b - (c1b - c3b) * k;\n    const x1_ = Math.round(Math.min(xa, xb));\n    const x2_ = Math.round(Math.max(xa, xb));\n    let j = rowSize * y + x1_ * 4;\n    for (let x = x1_; x <= x2_; x++) {\n      k = (xa - x) / (xa - xb);\n      if (k < 0) {\n        k = 0;\n      } else if (k > 1) {\n        k = 1;\n      }\n      bytes[j++] = (car - (car - cbr) * k) | 0;\n      bytes[j++] = (cag - (cag - cbg) * k) | 0;\n      bytes[j++] = (cab - (cab - cbb) * k) | 0;\n      bytes[j++] = 255;\n    }\n  }\n}\n\nfunction drawFigure(data, figure, context) {\n  const ps = figure.coords;\n  const cs = figure.colors;\n  let i, ii;\n  switch (figure.type) {\n    case MeshFigureType.LATTICE:\n      const verticesPerRow = figure.verticesPerRow;\n      const rows = Math.floor(ps.length / verticesPerRow) - 1;\n      const cols = verticesPerRow - 1;\n      for (i = 0; i < rows; i++) {\n        let q = i * verticesPerRow;\n        for (let j = 0; j < cols; j++, q++) {\n          drawTriangle(\n            data,\n            context,\n            ps[q],\n            ps[q + 1],\n            ps[q + verticesPerRow],\n            cs[q],\n            cs[q + 1],\n            cs[q + verticesPerRow]\n          );\n          drawTriangle(\n            data,\n            context,\n            ps[q + verticesPerRow + 1],\n            ps[q + 1],\n            ps[q + verticesPerRow],\n            cs[q + verticesPerRow + 1],\n            cs[q + 1],\n            cs[q + verticesPerRow]\n          );\n        }\n      }\n      break;\n    case MeshFigureType.TRIANGLES:\n      for (i = 0, ii = ps.length; i < ii; i += 3) {\n        drawTriangle(\n          data,\n          context,\n          ps[i],\n          ps[i + 1],\n          ps[i + 2],\n          cs[i],\n          cs[i + 1],\n          cs[i + 2]\n        );\n      }\n      break;\n    default:\n      throw new Error(\"illegal figure\");\n  }\n}\n\nclass MeshShadingPattern extends BaseShadingPattern {\n  constructor(IR) {\n    super();\n    this._coords = IR[2];\n    this._colors = IR[3];\n    this._figures = IR[4];\n    this._bounds = IR[5];\n    this._bbox = IR[6];\n    this._background = IR[7];\n    this.matrix = null;\n  }\n\n  _createMeshCanvas(combinedScale, backgroundColor, cachedCanvases) {\n    // we will increase scale on some weird factor to let antialiasing take\n    // care of \"rough\" edges\n    const EXPECTED_SCALE = 1.1;\n    // MAX_PATTERN_SIZE is used to avoid OOM situation.\n    const MAX_PATTERN_SIZE = 3000; // 10in @ 300dpi shall be enough\n    // We need to keep transparent border around our pattern for fill():\n    // createPattern with 'no-repeat' will bleed edges across entire area.\n    const BORDER_SIZE = 2;\n\n    const offsetX = Math.floor(this._bounds[0]);\n    const offsetY = Math.floor(this._bounds[1]);\n    const boundsWidth = Math.ceil(this._bounds[2]) - offsetX;\n    const boundsHeight = Math.ceil(this._bounds[3]) - offsetY;\n\n    const width = Math.min(\n      Math.ceil(Math.abs(boundsWidth * combinedScale[0] * EXPECTED_SCALE)),\n      MAX_PATTERN_SIZE\n    );\n    const height = Math.min(\n      Math.ceil(Math.abs(boundsHeight * combinedScale[1] * EXPECTED_SCALE)),\n      MAX_PATTERN_SIZE\n    );\n    const scaleX = boundsWidth / width;\n    const scaleY = boundsHeight / height;\n\n    const context = {\n      coords: this._coords,\n      colors: this._colors,\n      offsetX: -offsetX,\n      offsetY: -offsetY,\n      scaleX: 1 / scaleX,\n      scaleY: 1 / scaleY,\n    };\n\n    const paddedWidth = width + BORDER_SIZE * 2;\n    const paddedHeight = height + BORDER_SIZE * 2;\n\n    const tmpCanvas = cachedCanvases.getCanvas(\n      \"mesh\",\n      paddedWidth,\n      paddedHeight\n    );\n    const tmpCtx = tmpCanvas.context;\n\n    const data = tmpCtx.createImageData(width, height);\n    if (backgroundColor) {\n      const bytes = data.data;\n      for (let i = 0, ii = bytes.length; i < ii; i += 4) {\n        bytes[i] = backgroundColor[0];\n        bytes[i + 1] = backgroundColor[1];\n        bytes[i + 2] = backgroundColor[2];\n        bytes[i + 3] = 255;\n      }\n    }\n    for (const figure of this._figures) {\n      drawFigure(data, figure, context);\n    }\n    tmpCtx.putImageData(data, BORDER_SIZE, BORDER_SIZE);\n    const canvas = tmpCanvas.canvas;\n\n    return {\n      canvas,\n      offsetX: offsetX - BORDER_SIZE * scaleX,\n      offsetY: offsetY - BORDER_SIZE * scaleY,\n      scaleX,\n      scaleY,\n    };\n  }\n\n  isModifyingCurrentTransform() {\n    return true;\n  }\n\n  getPattern(ctx, owner, inverse, pathType) {\n    applyBoundingBox(ctx, this._bbox);\n    const scale = new Float32Array(2);\n    if (pathType === PathType.SHADING) {\n      Util.singularValueDecompose2dScale(getCurrentTransform(ctx), scale);\n    } else if (this.matrix) {\n      // Obtain scale from matrix and current transformation matrix.\n      Util.singularValueDecompose2dScale(this.matrix, scale);\n      const [matrixScaleX, matrixScaleY] = scale;\n      Util.singularValueDecompose2dScale(owner.baseTransform, scale);\n      scale[0] *= matrixScaleX;\n      scale[1] *= matrixScaleY;\n    } else {\n      Util.singularValueDecompose2dScale(owner.baseTransform, scale);\n    }\n\n    // Rasterizing on the main thread since sending/queue large canvases\n    // might cause OOM.\n    const temporaryPatternCanvas = this._createMeshCanvas(\n      scale,\n      pathType === PathType.SHADING ? null : this._background,\n      owner.cachedCanvases\n    );\n\n    if (pathType !== PathType.SHADING) {\n      ctx.setTransform(...owner.baseTransform);\n      if (this.matrix) {\n        ctx.transform(...this.matrix);\n      }\n    }\n\n    ctx.translate(\n      temporaryPatternCanvas.offsetX,\n      temporaryPatternCanvas.offsetY\n    );\n    ctx.scale(temporaryPatternCanvas.scaleX, temporaryPatternCanvas.scaleY);\n\n    return ctx.createPattern(temporaryPatternCanvas.canvas, \"no-repeat\");\n  }\n}\n\nclass DummyShadingPattern extends BaseShadingPattern {\n  getPattern() {\n    return \"hotpink\";\n  }\n}\n\nfunction getShadingPattern(IR) {\n  switch (IR[0]) {\n    case \"RadialAxial\":\n      return new RadialAxialShadingPattern(IR);\n    case \"Mesh\":\n      return new MeshShadingPattern(IR);\n    case \"Dummy\":\n      return new DummyShadingPattern();\n  }\n  throw new Error(`Unknown IR type: ${IR[0]}`);\n}\n\nconst PaintType = {\n  COLORED: 1,\n  UNCOLORED: 2,\n};\n\nclass TilingPattern {\n  // 10in @ 300dpi shall be enough.\n  static MAX_PATTERN_SIZE = 3000;\n\n  constructor(IR, ctx, canvasGraphicsFactory, baseTransform) {\n    this.color = IR[1];\n    this.operatorList = IR[2];\n    this.matrix = IR[3];\n    this.bbox = IR[4];\n    this.xstep = IR[5];\n    this.ystep = IR[6];\n    this.paintType = IR[7];\n    this.tilingType = IR[8];\n    this.ctx = ctx;\n    this.canvasGraphicsFactory = canvasGraphicsFactory;\n    this.baseTransform = baseTransform;\n  }\n\n  createPatternCanvas(owner, opIdx) {\n    const {\n      bbox,\n      operatorList,\n      paintType,\n      tilingType,\n      color,\n      canvasGraphicsFactory,\n    } = this;\n    let { xstep, ystep } = this;\n    xstep = Math.abs(xstep);\n    ystep = Math.abs(ystep);\n\n    info(\"TilingType: \" + tilingType);\n\n    // A tiling pattern as defined by PDF spec 8.7.2 is a cell whose size is\n    // described by bbox, and may repeat regularly by shifting the cell by\n    // xstep and ystep.\n    // Because the HTML5 canvas API does not support pattern repetition with\n    // gaps in between, we use the xstep/ystep instead of the bbox's size.\n    //\n    // This has the following consequences (similarly for ystep):\n    //\n    // - If xstep is the same as bbox, then there is no observable difference.\n    //\n    // - If xstep is larger than bbox, then the pattern canvas is partially\n    //   empty: the area bounded by bbox is painted, the outside area is void.\n    //\n    // - If xstep is smaller than bbox, then the pixels between xstep and the\n    //   bbox boundary will be missing. This is INCORRECT behavior.\n    //   \"Figures on adjacent tiles should not overlap\" (PDF spec 8.7.3.1),\n    //   but overlapping cells without common pixels are still valid.\n\n    const x0 = bbox[0],\n      y0 = bbox[1],\n      x1 = bbox[2],\n      y1 = bbox[3];\n    const width = x1 - x0;\n    const height = y1 - y0;\n\n    // Obtain scale from matrix and current transformation matrix.\n    const scale = new Float32Array(2);\n    Util.singularValueDecompose2dScale(this.matrix, scale);\n    const [matrixScaleX, matrixScaleY] = scale;\n    Util.singularValueDecompose2dScale(this.baseTransform, scale);\n    const combinedScaleX = matrixScaleX * scale[0];\n    const combinedScaleY = matrixScaleY * scale[1];\n\n    let canvasWidth = width,\n      canvasHeight = height,\n      redrawHorizontally = false,\n      redrawVertically = false;\n\n    const xScaledStep = Math.ceil(xstep * combinedScaleX);\n    const yScaledStep = Math.ceil(ystep * combinedScaleY);\n    const xScaledWidth = Math.ceil(width * combinedScaleX);\n    const yScaledHeight = Math.ceil(height * combinedScaleY);\n\n    if (xScaledStep >= xScaledWidth) {\n      canvasWidth = xstep;\n    } else {\n      redrawHorizontally = true;\n    }\n    if (yScaledStep >= yScaledHeight) {\n      canvasHeight = ystep;\n    } else {\n      redrawVertically = true;\n    }\n\n    // Use width and height values that are as close as possible to the end\n    // result when the pattern is used. Too low value makes the pattern look\n    // blurry. Too large value makes it look too crispy.\n    const dimx = this.getSizeAndScale(\n      canvasWidth,\n      this.ctx.canvas.width,\n      combinedScaleX\n    );\n    const dimy = this.getSizeAndScale(\n      canvasHeight,\n      this.ctx.canvas.height,\n      combinedScaleY\n    );\n\n    const tmpCanvas = owner.cachedCanvases.getCanvas(\n      \"pattern\",\n      dimx.size,\n      dimy.size\n    );\n    const tmpCtx = tmpCanvas.context;\n    const graphics = canvasGraphicsFactory.createCanvasGraphics(tmpCtx, opIdx);\n    graphics.groupLevel = owner.groupLevel;\n\n    this.setFillAndStrokeStyleToContext(graphics, paintType, color);\n\n    tmpCtx.translate(-dimx.scale * x0, -dimy.scale * y0);\n    graphics.transform(\n      // We pass 0 as the 'opIdx' argument, but the value is irrelevant.\n      // We know that we are in a 'CanvasNestedDependencyTracker' that captures\n      // all the sub-operations needed to create this pattern canvas and uses\n      // the top-level operation index as their index.\n      0,\n      dimx.scale,\n      0,\n      0,\n      dimy.scale,\n      0,\n      0\n    );\n\n    // To match CanvasGraphics beginDrawing we must save the context here or\n    // else we end up with unbalanced save/restores.\n    tmpCtx.save();\n    graphics.dependencyTracker?.save();\n\n    this.clipBbox(graphics, x0, y0, x1, y1);\n\n    graphics.baseTransform = getCurrentTransform(graphics.ctx);\n\n    graphics.executeOperatorList(operatorList);\n\n    graphics.endDrawing();\n\n    graphics.dependencyTracker?.restore();\n    tmpCtx.restore();\n\n    if (redrawHorizontally || redrawVertically) {\n      // The tile is overlapping itself, so we create a new tile with\n      // dimensions xstep * ystep.\n      // Then we draw the overlapping parts of the original tile on the new\n      // tile.\n      // Just as a side note, the code here works correctly even if we don't\n      // have to redraw the tile horizontally or vertically. In that case, the\n      // original tile is drawn on the new tile only once, but it's useless.\n      const image = tmpCanvas.canvas;\n      if (redrawHorizontally) {\n        canvasWidth = xstep;\n      }\n      if (redrawVertically) {\n        canvasHeight = ystep;\n      }\n\n      const dimx2 = this.getSizeAndScale(\n        canvasWidth,\n        this.ctx.canvas.width,\n        combinedScaleX\n      );\n      const dimy2 = this.getSizeAndScale(\n        canvasHeight,\n        this.ctx.canvas.height,\n        combinedScaleY\n      );\n\n      const xSize = dimx2.size;\n      const ySize = dimy2.size;\n      const tmpCanvas2 = owner.cachedCanvases.getCanvas(\n        \"pattern-workaround\",\n        xSize,\n        ySize\n      );\n      const tmpCtx2 = tmpCanvas2.context;\n      const ii = redrawHorizontally ? Math.floor(width / xstep) : 0;\n      const jj = redrawVertically ? Math.floor(height / ystep) : 0;\n\n      // Draw the overlapping parts of the original tile on the new tile.\n      for (let i = 0; i <= ii; i++) {\n        for (let j = 0; j <= jj; j++) {\n          tmpCtx2.drawImage(\n            image,\n            xSize * i,\n            ySize * j,\n            xSize,\n            ySize,\n            0,\n            0,\n            xSize,\n            ySize\n          );\n        }\n      }\n      return {\n        canvas: tmpCanvas2.canvas,\n        scaleX: dimx2.scale,\n        scaleY: dimy2.scale,\n        offsetX: x0,\n        offsetY: y0,\n      };\n    }\n\n    return {\n      canvas: tmpCanvas.canvas,\n      scaleX: dimx.scale,\n      scaleY: dimy.scale,\n      offsetX: x0,\n      offsetY: y0,\n    };\n  }\n\n  getSizeAndScale(step, realOutputSize, scale) {\n    // MAX_PATTERN_SIZE is used to avoid OOM situation.\n    // Use the destination canvas's size if it is bigger than the hard-coded\n    // limit of MAX_PATTERN_SIZE to avoid clipping patterns that cover the\n    // whole canvas.\n    const maxSize = Math.max(TilingPattern.MAX_PATTERN_SIZE, realOutputSize);\n    let size = Math.ceil(step * scale);\n    if (size >= maxSize) {\n      size = maxSize;\n    } else {\n      scale = size / step;\n    }\n    return { scale, size };\n  }\n\n  clipBbox(graphics, x0, y0, x1, y1) {\n    const bboxWidth = x1 - x0;\n    const bboxHeight = y1 - y0;\n    graphics.ctx.rect(x0, y0, bboxWidth, bboxHeight);\n    Util.axialAlignedBoundingBox(\n      [x0, y0, x1, y1],\n      getCurrentTransform(graphics.ctx),\n      graphics.current.minMax\n    );\n    graphics.clip();\n    graphics.endPath();\n  }\n\n  setFillAndStrokeStyleToContext(graphics, paintType, color) {\n    const context = graphics.ctx,\n      current = graphics.current;\n    switch (paintType) {\n      case PaintType.COLORED:\n        const { fillStyle, strokeStyle } = this.ctx;\n        context.fillStyle = current.fillColor = fillStyle;\n        context.strokeStyle = current.strokeColor = strokeStyle;\n        break;\n      case PaintType.UNCOLORED:\n        context.fillStyle = context.strokeStyle = color;\n        // Set color needed by image masks (fixes issues 3226 and 8741).\n        current.fillColor = current.strokeColor = color;\n        break;\n      default:\n        throw new FormatError(`Unsupported paint type: ${paintType}`);\n    }\n  }\n\n  isModifyingCurrentTransform() {\n    return false;\n  }\n\n  getPattern(ctx, owner, inverse, pathType, opIdx) {\n    // PDF spec 8.7.2 NOTE 1: pattern's matrix is relative to initial matrix.\n    let matrix = inverse;\n    if (pathType !== PathType.SHADING) {\n      matrix = Util.transform(matrix, owner.baseTransform);\n      if (this.matrix) {\n        matrix = Util.transform(matrix, this.matrix);\n      }\n    }\n\n    const temporaryPatternCanvas = this.createPatternCanvas(owner, opIdx);\n\n    let domMatrix = new DOMMatrix(matrix);\n    // Rescale and so that the ctx.createPattern call generates a pattern with\n    // the desired size.\n    domMatrix = domMatrix.translate(\n      temporaryPatternCanvas.offsetX,\n      temporaryPatternCanvas.offsetY\n    );\n    domMatrix = domMatrix.scale(\n      1 / temporaryPatternCanvas.scaleX,\n      1 / temporaryPatternCanvas.scaleY\n    );\n\n    const pattern = ctx.createPattern(temporaryPatternCanvas.canvas, \"repeat\");\n    pattern.setTransform(domMatrix);\n\n    return pattern;\n  }\n}\n\nexport { getShadingPattern, PathType, TilingPattern };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FeatureTest, ImageKind } from \"./util.js\";\n\nfunction convertToRGBA(params) {\n  switch (params.kind) {\n    case ImageKind.GRAYSCALE_1BPP:\n      return convertBlackAndWhiteToRGBA(params);\n    case ImageKind.RGB_24BPP:\n      return convertRGBToRGBA(params);\n  }\n\n  return null;\n}\n\nfunction convertBlackAndWhiteToRGBA({\n  src,\n  srcPos = 0,\n  dest,\n  width,\n  height,\n  nonBlackColor = 0xffffffff,\n  inverseDecode = false,\n}) {\n  const black = FeatureTest.isLittleEndian ? 0xff000000 : 0x000000ff;\n  const [zeroMapping, oneMapping] = inverseDecode\n    ? [nonBlackColor, black]\n    : [black, nonBlackColor];\n  const widthInSource = width >> 3;\n  const widthRemainder = width & 7;\n  const srcLength = src.length;\n  dest = new Uint32Array(dest.buffer);\n  let destPos = 0;\n\n  for (let i = 0; i < height; i++) {\n    for (const max = srcPos + widthInSource; srcPos < max; srcPos++) {\n      const elem = srcPos < srcLength ? src[srcPos] : 255;\n      dest[destPos++] = elem & 0b10000000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b1000000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b100000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b10000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b1000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b100 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b10 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b1 ? oneMapping : zeroMapping;\n    }\n    if (widthRemainder === 0) {\n      continue;\n    }\n    const elem = srcPos < srcLength ? src[srcPos++] : 255;\n    for (let j = 0; j < widthRemainder; j++) {\n      dest[destPos++] = elem & (1 << (7 - j)) ? oneMapping : zeroMapping;\n    }\n  }\n  return { srcPos, destPos };\n}\n\nfunction convertRGBToRGBA({\n  src,\n  srcPos = 0,\n  dest,\n  destPos = 0,\n  width,\n  height,\n}) {\n  let i = 0;\n  const len = width * height * 3;\n  const len32 = len >> 2;\n  const src32 = new Uint32Array(src.buffer, srcPos, len32);\n\n  if (FeatureTest.isLittleEndian) {\n    // It's a way faster to do the shuffle manually instead of working\n    // component by component with some Uint8 arrays.\n    for (; i < len32 - 2; i += 3, destPos += 4) {\n      const s1 = src32[i]; // R2B1G1R1\n      const s2 = src32[i + 1]; // G3R3B2G2\n      const s3 = src32[i + 2]; // B4G4R4B3\n\n      dest[destPos] = s1 | 0xff000000;\n      dest[destPos + 1] = (s1 >>> 24) | (s2 << 8) | 0xff000000;\n      dest[destPos + 2] = (s2 >>> 16) | (s3 << 16) | 0xff000000;\n      dest[destPos + 3] = (s3 >>> 8) | 0xff000000;\n    }\n\n    for (let j = i * 4, jj = srcPos + len; j < jj; j += 3) {\n      dest[destPos++] =\n        src[j] | (src[j + 1] << 8) | (src[j + 2] << 16) | 0xff000000;\n    }\n  } else {\n    for (; i < len32 - 2; i += 3, destPos += 4) {\n      const s1 = src32[i]; // R1G1B1R2\n      const s2 = src32[i + 1]; // G2B2R3G3\n      const s3 = src32[i + 2]; // B3R4G4B4\n\n      dest[destPos] = s1 | 0xff;\n      dest[destPos + 1] = (s1 << 24) | (s2 >>> 8) | 0xff;\n      dest[destPos + 2] = (s2 << 16) | (s3 >>> 16) | 0xff;\n      dest[destPos + 3] = (s3 << 8) | 0xff;\n    }\n\n    for (let j = i * 4, jj = srcPos + len; j < jj; j += 3) {\n      dest[destPos++] =\n        (src[j] << 24) | (src[j + 1] << 16) | (src[j + 2] << 8) | 0xff;\n    }\n  }\n\n  return { srcPos: srcPos + len, destPos };\n}\n\nfunction grayToRGBA(src, dest) {\n  if (FeatureTest.isLittleEndian) {\n    for (let i = 0, ii = src.length; i < ii; i++) {\n      dest[i] = (src[i] * 0x10101) | 0xff000000;\n    }\n  } else {\n    for (let i = 0, ii = src.length; i < ii; i++) {\n      dest[i] = (src[i] * 0x1010100) | 0x000000ff;\n    }\n  }\n}\n\nexport { convertBlackAndWhiteToRGBA, convertToRGBA, grayToRGBA };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  CanvasNestedDependencyTracker,\n  Dependencies,\n} from \"./canvas_dependency_tracker.js\";\nimport {\n  FeatureTest,\n  FONT_IDENTITY_MATRIX,\n  ImageKind,\n  info,\n  OPS,\n  shadow,\n  TextRenderingMode,\n  unreachable,\n  Util,\n  warn,\n} from \"../shared/util.js\";\nimport {\n  getCurrentTransform,\n  getCurrentTransformInverse,\n  makePathFromDrawOPS,\n  OutputScale,\n  PixelsPerInch,\n} from \"./display_utils.js\";\nimport {\n  getShadingPattern,\n  PathType,\n  TilingPattern,\n} from \"./pattern_helper.js\";\nimport { convertBlackAndWhiteToRGBA } from \"../shared/image_utils.js\";\n\n// <canvas> contexts store most of the state we need natively.\n// However, PDF needs a bit more state, which we store here.\n// Minimal font size that would be used during canvas fillText operations.\nconst MIN_FONT_SIZE = 16;\n// Maximum font size that would be used during canvas fillText operations.\nconst MAX_FONT_SIZE = 100;\n\n// Defines the time the `executeOperatorList`-method is going to be executing\n// before it stops and schedules a continue of execution.\nconst EXECUTION_TIME = 15; // ms\n// Defines the number of steps before checking the execution time.\nconst EXECUTION_STEPS = 10;\n\nconst FULL_CHUNK_HEIGHT = 16;\n\n// Only used in rescaleAndStroke. The goal is to avoid\n// creating a new DOMMatrix object each time we need it.\nconst SCALE_MATRIX = new DOMMatrix();\n\n// Used to get some coordinates.\nconst XY = new Float32Array(2);\n\n// Initial rectangle values for the minMax array.\nconst MIN_MAX_INIT = new Float32Array([\n  Infinity,\n  Infinity,\n  -Infinity,\n  -Infinity,\n]);\n\n/**\n * Overrides certain methods on a 2d ctx so that when they are called they\n * will also call the same method on the destCtx. The methods that are\n * overridden are all the transformation state modifiers, path creation, and\n * save/restore. We only forward these specific methods because they are the\n * only state modifiers that we cannot copy over when we switch contexts.\n *\n * To remove mirroring call `ctx._removeMirroring()`.\n *\n * @param {Object} ctx - The 2d canvas context that will duplicate its calls on\n *   the destCtx.\n * @param {Object} destCtx - The 2d canvas context that will receive the\n *   forwarded calls.\n */\nfunction mirrorContextOperations(ctx, destCtx) {\n  if (ctx._removeMirroring) {\n    throw new Error(\"Context is already forwarding operations.\");\n  }\n  ctx.__originalSave = ctx.save;\n  ctx.__originalRestore = ctx.restore;\n  ctx.__originalRotate = ctx.rotate;\n  ctx.__originalScale = ctx.scale;\n  ctx.__originalTranslate = ctx.translate;\n  ctx.__originalTransform = ctx.transform;\n  ctx.__originalSetTransform = ctx.setTransform;\n  ctx.__originalResetTransform = ctx.resetTransform;\n  ctx.__originalClip = ctx.clip;\n  ctx.__originalMoveTo = ctx.moveTo;\n  ctx.__originalLineTo = ctx.lineTo;\n  ctx.__originalBezierCurveTo = ctx.bezierCurveTo;\n  ctx.__originalRect = ctx.rect;\n  ctx.__originalClosePath = ctx.closePath;\n  ctx.__originalBeginPath = ctx.beginPath;\n\n  ctx._removeMirroring = () => {\n    ctx.save = ctx.__originalSave;\n    ctx.restore = ctx.__originalRestore;\n    ctx.rotate = ctx.__originalRotate;\n    ctx.scale = ctx.__originalScale;\n    ctx.translate = ctx.__originalTranslate;\n    ctx.transform = ctx.__originalTransform;\n    ctx.setTransform = ctx.__originalSetTransform;\n    ctx.resetTransform = ctx.__originalResetTransform;\n\n    ctx.clip = ctx.__originalClip;\n    ctx.moveTo = ctx.__originalMoveTo;\n    ctx.lineTo = ctx.__originalLineTo;\n    ctx.bezierCurveTo = ctx.__originalBezierCurveTo;\n    ctx.rect = ctx.__originalRect;\n    ctx.closePath = ctx.__originalClosePath;\n    ctx.beginPath = ctx.__originalBeginPath;\n    delete ctx._removeMirroring;\n  };\n\n  ctx.save = function () {\n    destCtx.save();\n    this.__originalSave();\n  };\n\n  ctx.restore = function () {\n    destCtx.restore();\n    this.__originalRestore();\n  };\n\n  ctx.translate = function (x, y) {\n    destCtx.translate(x, y);\n    this.__originalTranslate(x, y);\n  };\n\n  ctx.scale = function (x, y) {\n    destCtx.scale(x, y);\n    this.__originalScale(x, y);\n  };\n\n  ctx.transform = function (a, b, c, d, e, f) {\n    destCtx.transform(a, b, c, d, e, f);\n    this.__originalTransform(a, b, c, d, e, f);\n  };\n\n  ctx.setTransform = function (a, b, c, d, e, f) {\n    destCtx.setTransform(a, b, c, d, e, f);\n    this.__originalSetTransform(a, b, c, d, e, f);\n  };\n\n  ctx.resetTransform = function () {\n    destCtx.resetTransform();\n    this.__originalResetTransform();\n  };\n\n  ctx.rotate = function (angle) {\n    destCtx.rotate(angle);\n    this.__originalRotate(angle);\n  };\n\n  ctx.clip = function (rule) {\n    destCtx.clip(rule);\n    this.__originalClip(rule);\n  };\n\n  ctx.moveTo = function (x, y) {\n    destCtx.moveTo(x, y);\n    this.__originalMoveTo(x, y);\n  };\n\n  ctx.lineTo = function (x, y) {\n    destCtx.lineTo(x, y);\n    this.__originalLineTo(x, y);\n  };\n\n  ctx.bezierCurveTo = function (cp1x, cp1y, cp2x, cp2y, x, y) {\n    destCtx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n    this.__originalBezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n  };\n\n  ctx.rect = function (x, y, width, height) {\n    destCtx.rect(x, y, width, height);\n    this.__originalRect(x, y, width, height);\n  };\n\n  ctx.closePath = function () {\n    destCtx.closePath();\n    this.__originalClosePath();\n  };\n\n  ctx.beginPath = function () {\n    destCtx.beginPath();\n    this.__originalBeginPath();\n  };\n}\n\nclass CachedCanvases {\n  constructor(canvasFactory) {\n    this.canvasFactory = canvasFactory;\n    this.cache = Object.create(null);\n  }\n\n  getCanvas(id, width, height) {\n    let canvasEntry;\n    if (this.cache[id] !== undefined) {\n      canvasEntry = this.cache[id];\n      this.canvasFactory.reset(canvasEntry, width, height);\n    } else {\n      canvasEntry = this.canvasFactory.create(width, height);\n      this.cache[id] = canvasEntry;\n    }\n    return canvasEntry;\n  }\n\n  delete(id) {\n    delete this.cache[id];\n  }\n\n  clear() {\n    for (const id in this.cache) {\n      const canvasEntry = this.cache[id];\n      this.canvasFactory.destroy(canvasEntry);\n      delete this.cache[id];\n    }\n  }\n}\n\nfunction drawImageAtIntegerCoords(\n  ctx,\n  srcImg,\n  srcX,\n  srcY,\n  srcW,\n  srcH,\n  destX,\n  destY,\n  destW,\n  destH\n) {\n  const [a, b, c, d, tx, ty] = getCurrentTransform(ctx);\n  if (b === 0 && c === 0) {\n    // top-left corner is at (X, Y) and\n    // bottom-right one is at (X + width, Y + height).\n\n    // If leftX is 4.321 then it's rounded to 4.\n    // If width is 10.432 then it's rounded to 11 because\n    // rightX = leftX + width = 14.753 which is rounded to 15\n    // so after rounding the total width is 11 (15 - 4).\n    // It's why we can't just floor/ceil uniformly, it just depends\n    // on the values we've.\n\n    const tlX = destX * a + tx;\n    const rTlX = Math.round(tlX);\n    const tlY = destY * d + ty;\n    const rTlY = Math.round(tlY);\n    const brX = (destX + destW) * a + tx;\n\n    // Some pdf contains images with 1x1 images so in case of 0-width after\n    // scaling we must fallback on 1 to be sure there is something.\n    const rWidth = Math.abs(Math.round(brX) - rTlX) || 1;\n    const brY = (destY + destH) * d + ty;\n    const rHeight = Math.abs(Math.round(brY) - rTlY) || 1;\n\n    // We must apply a transformation in order to apply it on the image itself.\n    // For example if a == 1 && d == -1, it means that the image itself is\n    // mirrored w.r.t. the x-axis.\n    ctx.setTransform(Math.sign(a), 0, 0, Math.sign(d), rTlX, rTlY);\n    ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, 0, 0, rWidth, rHeight);\n    ctx.setTransform(a, b, c, d, tx, ty);\n\n    return [rWidth, rHeight];\n  }\n\n  if (a === 0 && d === 0) {\n    // This path is taken in issue9462.pdf (page 3).\n    const tlX = destY * c + tx;\n    const rTlX = Math.round(tlX);\n    const tlY = destX * b + ty;\n    const rTlY = Math.round(tlY);\n    const brX = (destY + destH) * c + tx;\n    const rWidth = Math.abs(Math.round(brX) - rTlX) || 1;\n    const brY = (destX + destW) * b + ty;\n    const rHeight = Math.abs(Math.round(brY) - rTlY) || 1;\n\n    ctx.setTransform(0, Math.sign(b), Math.sign(c), 0, rTlX, rTlY);\n    ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, 0, 0, rHeight, rWidth);\n    ctx.setTransform(a, b, c, d, tx, ty);\n\n    return [rHeight, rWidth];\n  }\n\n  // Not a scale matrix so let the render handle the case without rounding.\n  ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, destX, destY, destW, destH);\n\n  const scaleX = Math.hypot(a, b);\n  const scaleY = Math.hypot(c, d);\n  return [scaleX * destW, scaleY * destH];\n}\n\nclass CanvasExtraState {\n  // Are soft masks and alpha values shapes or opacities?\n  alphaIsShape = false;\n\n  fontSize = 0;\n\n  fontSizeScale = 1;\n\n  textMatrix = null;\n\n  textMatrixScale = 1;\n\n  fontMatrix = FONT_IDENTITY_MATRIX;\n\n  leading = 0;\n\n  // Current point (in user coordinates)\n  x = 0;\n\n  y = 0;\n\n  // Start of text line (in text coordinates)\n  lineX = 0;\n\n  lineY = 0;\n\n  // Character and word spacing\n  charSpacing = 0;\n\n  wordSpacing = 0;\n\n  textHScale = 1;\n\n  textRenderingMode = TextRenderingMode.FILL;\n\n  textRise = 0;\n\n  // Default fore and background colors\n  fillColor = \"#000000\";\n\n  strokeColor = \"#000000\";\n\n  patternFill = false;\n\n  patternStroke = false;\n\n  // Note: fill alpha applies to all non-stroking operations\n  fillAlpha = 1;\n\n  strokeAlpha = 1;\n\n  lineWidth = 1;\n\n  activeSMask = null;\n\n  transferMaps = \"none\";\n\n  constructor(width, height, preInit) {\n    preInit?.(this);\n\n    this.clipBox = new Float32Array([0, 0, width, height]);\n    this.minMax = MIN_MAX_INIT.slice();\n  }\n\n  clone() {\n    const clone = Object.create(this);\n    clone.clipBox = this.clipBox.slice();\n    clone.minMax = this.minMax.slice();\n    return clone;\n  }\n\n  getPathBoundingBox(pathType = PathType.FILL, transform = null) {\n    const box = this.minMax.slice();\n    if (pathType === PathType.STROKE) {\n      if (!transform) {\n        unreachable(\"Stroke bounding box must include transform.\");\n      }\n      // Stroked paths can be outside of the path bounding box by 1/2 the line\n      // width.\n      Util.singularValueDecompose2dScale(transform, XY);\n      const xStrokePad = (XY[0] * this.lineWidth) / 2;\n      const yStrokePad = (XY[1] * this.lineWidth) / 2;\n      box[0] -= xStrokePad;\n      box[1] -= yStrokePad;\n      box[2] += xStrokePad;\n      box[3] += yStrokePad;\n    }\n    return box;\n  }\n\n  updateClipFromPath() {\n    const intersect = Util.intersect(this.clipBox, this.getPathBoundingBox());\n    this.startNewPathAndClipBox(intersect || [0, 0, 0, 0]);\n  }\n\n  isEmptyClip() {\n    return this.minMax[0] === Infinity;\n  }\n\n  startNewPathAndClipBox(box) {\n    this.clipBox.set(box, 0);\n    this.minMax.set(MIN_MAX_INIT, 0);\n  }\n\n  getClippedPathBoundingBox(pathType = PathType.FILL, transform = null) {\n    return Util.intersect(\n      this.clipBox,\n      this.getPathBoundingBox(pathType, transform)\n    );\n  }\n}\n\nfunction putBinaryImageData(ctx, imgData) {\n  if (imgData instanceof ImageData) {\n    ctx.putImageData(imgData, 0, 0);\n    return;\n  }\n\n  // Put the image data to the canvas in chunks, rather than putting the\n  // whole image at once.  This saves JS memory, because the ImageData object\n  // is smaller. It also possibly saves C++ memory within the implementation\n  // of putImageData(). (E.g. in Firefox we make two short-lived copies of\n  // the data passed to putImageData()). |n| shouldn't be too small, however,\n  // because too many putImageData() calls will slow things down.\n  //\n  // Note: as written, if the last chunk is partial, the putImageData() call\n  // will (conceptually) put pixels past the bounds of the canvas.  But\n  // that's ok; any such pixels are ignored.\n\n  const height = imgData.height,\n    width = imgData.width;\n  const partialChunkHeight = height % FULL_CHUNK_HEIGHT;\n  const fullChunks = (height - partialChunkHeight) / FULL_CHUNK_HEIGHT;\n  const totalChunks = partialChunkHeight === 0 ? fullChunks : fullChunks + 1;\n\n  const chunkImgData = ctx.createImageData(width, FULL_CHUNK_HEIGHT);\n  let srcPos = 0,\n    destPos;\n  const src = imgData.data;\n  const dest = chunkImgData.data;\n  let i, j, thisChunkHeight, elemsInThisChunk;\n\n  // There are multiple forms in which the pixel data can be passed, and\n  // imgData.kind tells us which one this is.\n  if (imgData.kind === ImageKind.GRAYSCALE_1BPP) {\n    // Grayscale, 1 bit per pixel (i.e. black-and-white).\n    const srcLength = src.byteLength;\n    const dest32 = new Uint32Array(dest.buffer, 0, dest.byteLength >> 2);\n    const dest32DataLength = dest32.length;\n    const fullSrcDiff = (width + 7) >> 3;\n    const white = 0xffffffff;\n    const black = FeatureTest.isLittleEndian ? 0xff000000 : 0x000000ff;\n\n    for (i = 0; i < totalChunks; i++) {\n      thisChunkHeight = i < fullChunks ? FULL_CHUNK_HEIGHT : partialChunkHeight;\n      destPos = 0;\n      for (j = 0; j < thisChunkHeight; j++) {\n        const srcDiff = srcLength - srcPos;\n        let k = 0;\n        const kEnd = srcDiff > fullSrcDiff ? width : srcDiff * 8 - 7;\n        const kEndUnrolled = kEnd & ~7;\n        let mask = 0;\n        let srcByte = 0;\n        for (; k < kEndUnrolled; k += 8) {\n          srcByte = src[srcPos++];\n          dest32[destPos++] = srcByte & 128 ? white : black;\n          dest32[destPos++] = srcByte & 64 ? white : black;\n          dest32[destPos++] = srcByte & 32 ? white : black;\n          dest32[destPos++] = srcByte & 16 ? white : black;\n          dest32[destPos++] = srcByte & 8 ? white : black;\n          dest32[destPos++] = srcByte & 4 ? white : black;\n          dest32[destPos++] = srcByte & 2 ? white : black;\n          dest32[destPos++] = srcByte & 1 ? white : black;\n        }\n        for (; k < kEnd; k++) {\n          if (mask === 0) {\n            srcByte = src[srcPos++];\n            mask = 128;\n          }\n\n          dest32[destPos++] = srcByte & mask ? white : black;\n          mask >>= 1;\n        }\n      }\n      // We ran out of input. Make all remaining pixels transparent.\n      while (destPos < dest32DataLength) {\n        dest32[destPos++] = 0;\n      }\n\n      ctx.putImageData(chunkImgData, 0, i * FULL_CHUNK_HEIGHT);\n    }\n  } else if (imgData.kind === ImageKind.RGBA_32BPP) {\n    // RGBA, 32-bits per pixel.\n    j = 0;\n    elemsInThisChunk = width * FULL_CHUNK_HEIGHT * 4;\n    for (i = 0; i < fullChunks; i++) {\n      dest.set(src.subarray(srcPos, srcPos + elemsInThisChunk));\n      srcPos += elemsInThisChunk;\n\n      ctx.putImageData(chunkImgData, 0, j);\n      j += FULL_CHUNK_HEIGHT;\n    }\n    if (i < totalChunks) {\n      elemsInThisChunk = width * partialChunkHeight * 4;\n      dest.set(src.subarray(srcPos, srcPos + elemsInThisChunk));\n\n      ctx.putImageData(chunkImgData, 0, j);\n    }\n  } else if (imgData.kind === ImageKind.RGB_24BPP) {\n    // RGB, 24-bits per pixel.\n    thisChunkHeight = FULL_CHUNK_HEIGHT;\n    elemsInThisChunk = width * thisChunkHeight;\n    for (i = 0; i < totalChunks; i++) {\n      if (i >= fullChunks) {\n        thisChunkHeight = partialChunkHeight;\n        elemsInThisChunk = width * thisChunkHeight;\n      }\n\n      destPos = 0;\n      for (j = elemsInThisChunk; j--; ) {\n        dest[destPos++] = src[srcPos++];\n        dest[destPos++] = src[srcPos++];\n        dest[destPos++] = src[srcPos++];\n        dest[destPos++] = 255;\n      }\n\n      ctx.putImageData(chunkImgData, 0, i * FULL_CHUNK_HEIGHT);\n    }\n  } else {\n    throw new Error(`bad image kind: ${imgData.kind}`);\n  }\n}\n\nfunction putBinaryImageMask(ctx, imgData) {\n  if (imgData.bitmap) {\n    // The bitmap has been created in the worker.\n    ctx.drawImage(imgData.bitmap, 0, 0);\n    return;\n  }\n\n  // Slow path: OffscreenCanvas isn't available in the worker.\n  const height = imgData.height,\n    width = imgData.width;\n  const partialChunkHeight = height % FULL_CHUNK_HEIGHT;\n  const fullChunks = (height - partialChunkHeight) / FULL_CHUNK_HEIGHT;\n  const totalChunks = partialChunkHeight === 0 ? fullChunks : fullChunks + 1;\n\n  const chunkImgData = ctx.createImageData(width, FULL_CHUNK_HEIGHT);\n  let srcPos = 0;\n  const src = imgData.data;\n  const dest = chunkImgData.data;\n\n  for (let i = 0; i < totalChunks; i++) {\n    const thisChunkHeight =\n      i < fullChunks ? FULL_CHUNK_HEIGHT : partialChunkHeight;\n\n    // Expand the mask so it can be used by the canvas.  Any required\n    // inversion has already been handled.\n\n    ({ srcPos } = convertBlackAndWhiteToRGBA({\n      src,\n      srcPos,\n      dest,\n      width,\n      height: thisChunkHeight,\n      nonBlackColor: 0,\n    }));\n\n    ctx.putImageData(chunkImgData, 0, i * FULL_CHUNK_HEIGHT);\n  }\n}\n\nfunction copyCtxState(sourceCtx, destCtx) {\n  const properties = [\n    \"strokeStyle\",\n    \"fillStyle\",\n    \"fillRule\",\n    \"globalAlpha\",\n    \"lineWidth\",\n    \"lineCap\",\n    \"lineJoin\",\n    \"miterLimit\",\n    \"globalCompositeOperation\",\n    \"font\",\n    \"filter\",\n  ];\n  for (const property of properties) {\n    if (sourceCtx[property] !== undefined) {\n      destCtx[property] = sourceCtx[property];\n    }\n  }\n  if (sourceCtx.setLineDash !== undefined) {\n    destCtx.setLineDash(sourceCtx.getLineDash());\n    destCtx.lineDashOffset = sourceCtx.lineDashOffset;\n  }\n}\n\nfunction resetCtxToDefault(ctx) {\n  ctx.strokeStyle = ctx.fillStyle = \"#000000\";\n  ctx.fillRule = \"nonzero\";\n  ctx.globalAlpha = 1;\n  ctx.lineWidth = 1;\n  ctx.lineCap = \"butt\";\n  ctx.lineJoin = \"miter\";\n  ctx.miterLimit = 10;\n  ctx.globalCompositeOperation = \"source-over\";\n  ctx.font = \"10px sans-serif\";\n  if (ctx.setLineDash !== undefined) {\n    ctx.setLineDash([]);\n    ctx.lineDashOffset = 0;\n  }\n  const { filter } = ctx;\n  if (filter !== \"none\" && filter !== \"\") {\n    ctx.filter = \"none\";\n  }\n}\n\nfunction getImageSmoothingEnabled(transform, interpolate) {\n  // In section 8.9.5.3 of the PDF spec, it's mentioned that the interpolate\n  // flag should be used when the image is upscaled.\n  // In Firefox, smoothing is always used when downscaling images (bug 1360415).\n\n  if (interpolate) {\n    return true;\n  }\n\n  Util.singularValueDecompose2dScale(transform, XY);\n  // Round to a 32bit float so that `<=` check below will pass for numbers that\n  // are very close, but not exactly the same 64bit floats.\n  const actualScale = Math.fround(\n    OutputScale.pixelRatio * PixelsPerInch.PDF_TO_CSS_UNITS\n  );\n  // `XY` is a Float32Array.\n  return XY[0] <= actualScale && XY[1] <= actualScale;\n}\n\nconst LINE_CAP_STYLES = [\"butt\", \"round\", \"square\"];\nconst LINE_JOIN_STYLES = [\"miter\", \"round\", \"bevel\"];\nconst NORMAL_CLIP = {};\nconst EO_CLIP = {};\n\nclass CanvasGraphics {\n  constructor(\n    canvasCtx,\n    commonObjs,\n    objs,\n    canvasFactory,\n    filterFactory,\n    { optionalContentConfig, markedContentStack = null },\n    annotationCanvasMap,\n    pageColors,\n    dependencyTracker\n  ) {\n    this.ctx = canvasCtx;\n    this.current = new CanvasExtraState(\n      this.ctx.canvas.width,\n      this.ctx.canvas.height\n    );\n    this.stateStack = [];\n    this.pendingClip = null;\n    this.pendingEOFill = false;\n    this.res = null;\n    this.xobjs = null;\n    this.commonObjs = commonObjs;\n    this.objs = objs;\n    this.canvasFactory = canvasFactory;\n    this.filterFactory = filterFactory;\n    this.groupStack = [];\n    // Patterns are painted relative to the initial page/form transform, see\n    // PDF spec 8.7.2 NOTE 1.\n    this.baseTransform = null;\n    this.baseTransformStack = [];\n    this.groupLevel = 0;\n    this.smaskStack = [];\n    this.smaskCounter = 0;\n    this.tempSMask = null;\n    this.suspendedCtx = null;\n    this.contentVisible = true;\n    this.markedContentStack = markedContentStack || [];\n    this.optionalContentConfig = optionalContentConfig;\n    this.cachedCanvases = new CachedCanvases(this.canvasFactory);\n    this.cachedPatterns = new Map();\n    this.annotationCanvasMap = annotationCanvasMap;\n    this.viewportScale = 1;\n    this.outputScaleX = 1;\n    this.outputScaleY = 1;\n    this.pageColors = pageColors;\n\n    this._cachedScaleForStroking = [-1, 0];\n    this._cachedGetSinglePixelWidth = null;\n    this._cachedBitmapsMap = new Map();\n\n    this.dependencyTracker = dependencyTracker ?? null;\n  }\n\n  getObject(opIdx, data, fallback = null) {\n    if (typeof data === \"string\") {\n      this.dependencyTracker?.recordNamedDependency(opIdx, data);\n      return data.startsWith(\"g_\")\n        ? this.commonObjs.get(data)\n        : this.objs.get(data);\n    }\n    return fallback;\n  }\n\n  beginDrawing({\n    transform,\n    viewport,\n    transparency = false,\n    background = null,\n  }) {\n    // For pdfs that use blend modes we have to clear the canvas else certain\n    // blend modes can look wrong since we'd be blending with a white\n    // backdrop. The problem with a transparent backdrop though is we then\n    // don't get sub pixel anti aliasing on text, creating temporary\n    // transparent canvas when we have blend modes.\n    const width = this.ctx.canvas.width;\n    const height = this.ctx.canvas.height;\n\n    const savedFillStyle = this.ctx.fillStyle;\n    this.ctx.fillStyle = background || \"#ffffff\";\n    this.ctx.fillRect(0, 0, width, height);\n    this.ctx.fillStyle = savedFillStyle;\n\n    if (transparency) {\n      const transparentCanvas = this.cachedCanvases.getCanvas(\n        \"transparent\",\n        width,\n        height\n      );\n      this.compositeCtx = this.ctx;\n      this.transparentCanvas = transparentCanvas.canvas;\n      this.ctx = transparentCanvas.context;\n      this.ctx.save();\n      // The transform can be applied before rendering, transferring it to\n      // the new canvas.\n      this.ctx.transform(...getCurrentTransform(this.compositeCtx));\n    }\n\n    this.ctx.save();\n    resetCtxToDefault(this.ctx);\n    if (transform) {\n      this.ctx.transform(...transform);\n      this.outputScaleX = transform[0];\n      this.outputScaleY = transform[0];\n    }\n    this.ctx.transform(...viewport.transform);\n    this.viewportScale = viewport.scale;\n\n    this.baseTransform = getCurrentTransform(this.ctx);\n  }\n\n  executeOperatorList(\n    operatorList,\n    executionStartIdx,\n    continueCallback,\n    stepper,\n    operationsFilter\n  ) {\n    const argsArray = operatorList.argsArray;\n    const fnArray = operatorList.fnArray;\n    let i = executionStartIdx || 0;\n    const argsArrayLen = argsArray.length;\n\n    // Sometimes the OperatorList to execute is empty.\n    if (argsArrayLen === i) {\n      return i;\n    }\n\n    const chunkOperations =\n      argsArrayLen - i > EXECUTION_STEPS &&\n      typeof continueCallback === \"function\";\n    const endTime = chunkOperations ? Date.now() + EXECUTION_TIME : 0;\n    let steps = 0;\n\n    const commonObjs = this.commonObjs;\n    const objs = this.objs;\n    let fnId, fnArgs;\n\n    while (true) {\n      if (stepper !== undefined && i === stepper.nextBreakPoint) {\n        stepper.breakIt(i, continueCallback);\n        return i;\n      }\n\n      if (!operationsFilter || operationsFilter(i)) {\n        fnId = fnArray[i];\n        // TODO: There is a `undefined` coming from somewhere.\n        fnArgs = argsArray[i] ?? null;\n\n        if (fnId !== OPS.dependency) {\n          if (fnArgs === null) {\n            this[fnId](i);\n          } else {\n            this[fnId](i, ...fnArgs);\n          }\n        } else {\n          for (const depObjId of fnArgs) {\n            this.dependencyTracker?.recordNamedData(depObjId, i);\n            const objsPool = depObjId.startsWith(\"g_\") ? commonObjs : objs;\n\n            // If the promise isn't resolved yet, add the continueCallback\n            // to the promise and bail out.\n            if (!objsPool.has(depObjId)) {\n              objsPool.get(depObjId, continueCallback);\n              return i;\n            }\n          }\n        }\n      }\n\n      i++;\n\n      // If the entire operatorList was executed, stop as were done.\n      if (i === argsArrayLen) {\n        return i;\n      }\n\n      // If the execution took longer then a certain amount of time and\n      // `continueCallback` is specified, interrupt the execution.\n      if (chunkOperations && ++steps > EXECUTION_STEPS) {\n        if (Date.now() > endTime) {\n          continueCallback();\n          return i;\n        }\n        steps = 0;\n      }\n\n      // If the operatorList isn't executed completely yet OR the execution\n      // time was short enough, do another execution round.\n    }\n  }\n\n  #restoreInitialState() {\n    // Finishing all opened operations such as SMask group painting.\n    while (this.stateStack.length || this.inSMaskMode) {\n      this.restore();\n    }\n\n    this.current.activeSMask = null;\n    this.ctx.restore();\n\n    if (this.transparentCanvas) {\n      this.ctx = this.compositeCtx;\n      this.ctx.save();\n      this.ctx.setTransform(1, 0, 0, 1, 0, 0); // Avoid apply transform twice\n      this.ctx.drawImage(this.transparentCanvas, 0, 0);\n      this.ctx.restore();\n      this.transparentCanvas = null;\n    }\n  }\n\n  endDrawing() {\n    this.#restoreInitialState();\n\n    this.cachedCanvases.clear();\n    this.cachedPatterns.clear();\n\n    for (const cache of this._cachedBitmapsMap.values()) {\n      for (const canvas of cache.values()) {\n        if (\n          typeof HTMLCanvasElement !== \"undefined\" &&\n          canvas instanceof HTMLCanvasElement\n        ) {\n          canvas.width = canvas.height = 0;\n        }\n      }\n      cache.clear();\n    }\n    this._cachedBitmapsMap.clear();\n    this.#drawFilter();\n  }\n\n  #drawFilter() {\n    if (this.pageColors) {\n      const hcmFilterId = this.filterFactory.addHCMFilter(\n        this.pageColors.foreground,\n        this.pageColors.background\n      );\n      if (hcmFilterId !== \"none\") {\n        const savedFilter = this.ctx.filter;\n        this.ctx.filter = hcmFilterId;\n        this.ctx.drawImage(this.ctx.canvas, 0, 0);\n        this.ctx.filter = savedFilter;\n      }\n    }\n  }\n\n  _scaleImage(img, inverseTransform) {\n    // Vertical or horizontal scaling shall not be more than 2 to not lose the\n    // pixels during drawImage operation, painting on the temporary canvas(es)\n    // that are twice smaller in size.\n\n    // displayWidth and displayHeight are used for VideoFrame.\n    const width = img.width ?? img.displayWidth;\n    const height = img.height ?? img.displayHeight;\n    let widthScale = Math.max(\n      Math.hypot(inverseTransform[0], inverseTransform[1]),\n      1\n    );\n    let heightScale = Math.max(\n      Math.hypot(inverseTransform[2], inverseTransform[3]),\n      1\n    );\n\n    let paintWidth = width,\n      paintHeight = height;\n    let tmpCanvasId = \"prescale1\";\n    let tmpCanvas, tmpCtx;\n    while (\n      (widthScale > 2 && paintWidth > 1) ||\n      (heightScale > 2 && paintHeight > 1)\n    ) {\n      let newWidth = paintWidth,\n        newHeight = paintHeight;\n      if (widthScale > 2 && paintWidth > 1) {\n        // See bug 1820511 (Windows specific bug).\n        // TODO: once the above bug is fixed we could revert to:\n        // newWidth = Math.ceil(paintWidth / 2);\n        newWidth =\n          paintWidth >= 16384\n            ? Math.floor(paintWidth / 2) - 1 || 1\n            : Math.ceil(paintWidth / 2);\n        widthScale /= paintWidth / newWidth;\n      }\n      if (heightScale > 2 && paintHeight > 1) {\n        // TODO: see the comment above.\n        newHeight =\n          paintHeight >= 16384\n            ? Math.floor(paintHeight / 2) - 1 || 1\n            : Math.ceil(paintHeight) / 2;\n        heightScale /= paintHeight / newHeight;\n      }\n      tmpCanvas = this.cachedCanvases.getCanvas(\n        tmpCanvasId,\n        newWidth,\n        newHeight\n      );\n      tmpCtx = tmpCanvas.context;\n      tmpCtx.clearRect(0, 0, newWidth, newHeight);\n      tmpCtx.drawImage(\n        img,\n        0,\n        0,\n        paintWidth,\n        paintHeight,\n        0,\n        0,\n        newWidth,\n        newHeight\n      );\n      img = tmpCanvas.canvas;\n      paintWidth = newWidth;\n      paintHeight = newHeight;\n      tmpCanvasId = tmpCanvasId === \"prescale1\" ? \"prescale2\" : \"prescale1\";\n    }\n    return {\n      img,\n      paintWidth,\n      paintHeight,\n    };\n  }\n\n  _createMaskCanvas(opIdx, img) {\n    const ctx = this.ctx;\n    const { width, height } = img;\n    const fillColor = this.current.fillColor;\n    const isPatternFill = this.current.patternFill;\n    const currentTransform = getCurrentTransform(ctx);\n\n    let cache, cacheKey, scaled, maskCanvas;\n    if ((img.bitmap || img.data) && img.count > 1) {\n      const mainKey = img.bitmap || img.data.buffer;\n      // We're reusing the same image several times, so we can cache it.\n      // In case we've a pattern fill we just keep the scaled version of\n      // the image.\n      // Only the scaling part matters, the translation part is just used\n      // to compute offsets (but not when filling patterns see #15573).\n      // TODO: handle the case of a pattern fill if it's possible.\n      cacheKey = JSON.stringify(\n        isPatternFill\n          ? currentTransform\n          : [currentTransform.slice(0, 4), fillColor]\n      );\n\n      cache = this._cachedBitmapsMap.get(mainKey);\n      if (!cache) {\n        cache = new Map();\n        this._cachedBitmapsMap.set(mainKey, cache);\n      }\n      const cachedImage = cache.get(cacheKey);\n      if (cachedImage && !isPatternFill) {\n        const offsetX = Math.round(\n          Math.min(currentTransform[0], currentTransform[2]) +\n            currentTransform[4]\n        );\n        const offsetY = Math.round(\n          Math.min(currentTransform[1], currentTransform[3]) +\n            currentTransform[5]\n        );\n\n        this.dependencyTracker?.recordDependencies(\n          opIdx,\n          Dependencies.transformAndFill\n        );\n        return {\n          canvas: cachedImage,\n          offsetX,\n          offsetY,\n        };\n      }\n      scaled = cachedImage;\n    }\n\n    if (!scaled) {\n      maskCanvas = this.cachedCanvases.getCanvas(\"maskCanvas\", width, height);\n      putBinaryImageMask(maskCanvas.context, img);\n    }\n\n    // Create the mask canvas at the size it will be drawn at and also set\n    // its transform to match the current transform so if there are any\n    // patterns applied they will be applied relative to the correct\n    // transform.\n\n    let maskToCanvas = Util.transform(currentTransform, [\n      1 / width,\n      0,\n      0,\n      -1 / height,\n      0,\n      0,\n    ]);\n    maskToCanvas = Util.transform(maskToCanvas, [1, 0, 0, 1, 0, -height]);\n    const minMax = MIN_MAX_INIT.slice();\n    Util.axialAlignedBoundingBox([0, 0, width, height], maskToCanvas, minMax);\n    const [minX, minY, maxX, maxY] = minMax;\n    const drawnWidth = Math.round(maxX - minX) || 1;\n    const drawnHeight = Math.round(maxY - minY) || 1;\n    const fillCanvas = this.cachedCanvases.getCanvas(\n      \"fillCanvas\",\n      drawnWidth,\n      drawnHeight\n    );\n    const fillCtx = fillCanvas.context;\n\n    // The offset will be the top-left coordinate mask.\n    // If objToCanvas is [a,b,c,d,e,f] then:\n    //   - offsetX = min(a, c) + e\n    //   - offsetY = min(b, d) + f\n    const offsetX = minX;\n    const offsetY = minY;\n    fillCtx.translate(-offsetX, -offsetY);\n    fillCtx.transform(...maskToCanvas);\n\n    if (!scaled) {\n      // Pre-scale if needed to improve image smoothing.\n      scaled = this._scaleImage(\n        maskCanvas.canvas,\n        getCurrentTransformInverse(fillCtx)\n      );\n      scaled = scaled.img;\n      if (cache && isPatternFill) {\n        cache.set(cacheKey, scaled);\n      }\n    }\n\n    fillCtx.imageSmoothingEnabled = getImageSmoothingEnabled(\n      getCurrentTransform(fillCtx),\n      img.interpolate\n    );\n\n    drawImageAtIntegerCoords(\n      fillCtx,\n      scaled,\n      0,\n      0,\n      scaled.width,\n      scaled.height,\n      0,\n      0,\n      width,\n      height\n    );\n    fillCtx.globalCompositeOperation = \"source-in\";\n\n    const inverse = Util.transform(getCurrentTransformInverse(fillCtx), [\n      1,\n      0,\n      0,\n      1,\n      -offsetX,\n      -offsetY,\n    ]);\n    fillCtx.fillStyle = isPatternFill\n      ? fillColor.getPattern(ctx, this, inverse, PathType.FILL, opIdx)\n      : fillColor;\n\n    fillCtx.fillRect(0, 0, width, height);\n\n    if (cache && !isPatternFill) {\n      // The fill canvas is put in the cache associated to the mask image\n      // so we must remove from the cached canvas: it mustn't be used again.\n      this.cachedCanvases.delete(\"fillCanvas\");\n      cache.set(cacheKey, fillCanvas.canvas);\n    }\n\n    this.dependencyTracker?.recordDependencies(\n      opIdx,\n      Dependencies.transformAndFill\n    );\n\n    // Round the offsets to avoid drawing fractional pixels.\n    return {\n      canvas: fillCanvas.canvas,\n      offsetX: Math.round(offsetX),\n      offsetY: Math.round(offsetY),\n    };\n  }\n\n  // Graphics state\n  setLineWidth(opIdx, width) {\n    this.dependencyTracker?.recordSimpleData(\"lineWidth\", opIdx);\n    if (width !== this.current.lineWidth) {\n      this._cachedScaleForStroking[0] = -1;\n    }\n    this.current.lineWidth = width;\n    this.ctx.lineWidth = width;\n  }\n\n  setLineCap(opIdx, style) {\n    this.dependencyTracker?.recordSimpleData(\"lineCap\", opIdx);\n    this.ctx.lineCap = LINE_CAP_STYLES[style];\n  }\n\n  setLineJoin(opIdx, style) {\n    this.dependencyTracker?.recordSimpleData(\"lineJoin\", opIdx);\n    this.ctx.lineJoin = LINE_JOIN_STYLES[style];\n  }\n\n  setMiterLimit(opIdx, limit) {\n    this.dependencyTracker?.recordSimpleData(\"miterLimit\", opIdx);\n    this.ctx.miterLimit = limit;\n  }\n\n  setDash(opIdx, dashArray, dashPhase) {\n    this.dependencyTracker?.recordSimpleData(\"dash\", opIdx);\n    const ctx = this.ctx;\n    if (ctx.setLineDash !== undefined) {\n      ctx.setLineDash(dashArray);\n      ctx.lineDashOffset = dashPhase;\n    }\n  }\n\n  setRenderingIntent(opIdx, intent) {\n    // This operation is ignored since we haven't found a use case for it yet.\n  }\n\n  setFlatness(opIdx, flatness) {\n    // This operation is ignored since we haven't found a use case for it yet.\n  }\n\n  setGState(opIdx, states) {\n    for (const [key, value] of states) {\n      switch (key) {\n        case \"LW\":\n          this.setLineWidth(opIdx, value);\n          break;\n        case \"LC\":\n          this.setLineCap(opIdx, value);\n          break;\n        case \"LJ\":\n          this.setLineJoin(opIdx, value);\n          break;\n        case \"ML\":\n          this.setMiterLimit(opIdx, value);\n          break;\n        case \"D\":\n          this.setDash(opIdx, value[0], value[1]);\n          break;\n        case \"RI\":\n          this.setRenderingIntent(opIdx, value);\n          break;\n        case \"FL\":\n          this.setFlatness(opIdx, value);\n          break;\n        case \"Font\":\n          this.setFont(opIdx, value[0], value[1]);\n          break;\n        case \"CA\":\n          this.dependencyTracker?.recordSimpleData(\"strokeAlpha\", opIdx);\n          this.current.strokeAlpha = value;\n          break;\n        case \"ca\":\n          this.dependencyTracker?.recordSimpleData(\"fillAlpha\", opIdx);\n          this.ctx.globalAlpha = this.current.fillAlpha = value;\n          break;\n        case \"BM\":\n          this.dependencyTracker?.recordSimpleData(\n            \"globalCompositeOperation\",\n            opIdx\n          );\n          this.ctx.globalCompositeOperation = value;\n          break;\n        case \"SMask\":\n          this.dependencyTracker?.recordSimpleData(\"SMask\", opIdx);\n          this.current.activeSMask = value ? this.tempSMask : null;\n          this.tempSMask = null;\n          this.checkSMaskState();\n          break;\n        case \"TR\":\n          this.dependencyTracker?.recordSimpleData(\"filter\", opIdx);\n          this.ctx.filter = this.current.transferMaps =\n            this.filterFactory.addFilter(value);\n          break;\n      }\n    }\n  }\n\n  get inSMaskMode() {\n    return !!this.suspendedCtx;\n  }\n\n  checkSMaskState() {\n    const inSMaskMode = this.inSMaskMode;\n    if (this.current.activeSMask && !inSMaskMode) {\n      this.beginSMaskMode();\n    } else if (!this.current.activeSMask && inSMaskMode) {\n      this.endSMaskMode();\n    }\n    // Else, the state is okay and nothing needs to be done.\n  }\n\n  /**\n   * Soft mask mode takes the current main drawing canvas and replaces it with\n   * a temporary canvas. Any drawing operations that happen on the temporary\n   * canvas need to be composed with the main canvas that was suspended (see\n   * `compose()`). The temporary canvas also duplicates many of its operations\n   * on the suspended canvas to keep them in sync, so that when the soft mask\n   * mode ends any clipping paths or transformations will still be active and in\n   * the right order on the canvas' graphics state stack.\n   */\n  beginSMaskMode(opIdx) {\n    if (this.inSMaskMode) {\n      throw new Error(\"beginSMaskMode called while already in smask mode\");\n    }\n    const drawnWidth = this.ctx.canvas.width;\n    const drawnHeight = this.ctx.canvas.height;\n    const cacheId = \"smaskGroupAt\" + this.groupLevel;\n    const scratchCanvas = this.cachedCanvases.getCanvas(\n      cacheId,\n      drawnWidth,\n      drawnHeight\n    );\n    this.suspendedCtx = this.ctx;\n    const ctx = (this.ctx = scratchCanvas.context);\n    ctx.setTransform(this.suspendedCtx.getTransform());\n    copyCtxState(this.suspendedCtx, ctx);\n    mirrorContextOperations(ctx, this.suspendedCtx);\n\n    this.setGState(opIdx, [[\"BM\", \"source-over\"]]);\n  }\n\n  endSMaskMode() {\n    if (!this.inSMaskMode) {\n      throw new Error(\"endSMaskMode called while not in smask mode\");\n    }\n    // The soft mask is done, now restore the suspended canvas as the main\n    // drawing canvas.\n    this.ctx._removeMirroring();\n    copyCtxState(this.ctx, this.suspendedCtx);\n    this.ctx = this.suspendedCtx;\n\n    this.suspendedCtx = null;\n  }\n\n  compose(dirtyBox) {\n    if (!this.current.activeSMask) {\n      return;\n    }\n\n    if (!dirtyBox) {\n      dirtyBox = [0, 0, this.ctx.canvas.width, this.ctx.canvas.height];\n    } else {\n      dirtyBox[0] = Math.floor(dirtyBox[0]);\n      dirtyBox[1] = Math.floor(dirtyBox[1]);\n      dirtyBox[2] = Math.ceil(dirtyBox[2]);\n      dirtyBox[3] = Math.ceil(dirtyBox[3]);\n    }\n    const smask = this.current.activeSMask;\n    const suspendedCtx = this.suspendedCtx;\n\n    this.composeSMask(suspendedCtx, smask, this.ctx, dirtyBox);\n    // Whatever was drawn has been moved to the suspended canvas, now clear it\n    // out of the current canvas.\n    this.ctx.save();\n    this.ctx.setTransform(1, 0, 0, 1, 0, 0);\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n    this.ctx.restore();\n  }\n\n  composeSMask(ctx, smask, layerCtx, layerBox) {\n    const layerOffsetX = layerBox[0];\n    const layerOffsetY = layerBox[1];\n    const layerWidth = layerBox[2] - layerOffsetX;\n    const layerHeight = layerBox[3] - layerOffsetY;\n    if (layerWidth === 0 || layerHeight === 0) {\n      return;\n    }\n    this.genericComposeSMask(\n      smask.context,\n      layerCtx,\n      layerWidth,\n      layerHeight,\n      smask.subtype,\n      smask.backdrop,\n      smask.transferMap,\n      layerOffsetX,\n      layerOffsetY,\n      smask.offsetX,\n      smask.offsetY\n    );\n    ctx.save();\n    ctx.globalAlpha = 1;\n    ctx.globalCompositeOperation = \"source-over\";\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.drawImage(layerCtx.canvas, 0, 0);\n    ctx.restore();\n  }\n\n  genericComposeSMask(\n    maskCtx,\n    layerCtx,\n    width,\n    height,\n    subtype,\n    backdrop,\n    transferMap,\n    layerOffsetX,\n    layerOffsetY,\n    maskOffsetX,\n    maskOffsetY\n  ) {\n    let maskCanvas = maskCtx.canvas;\n    let maskX = layerOffsetX - maskOffsetX;\n    let maskY = layerOffsetY - maskOffsetY;\n\n    if (backdrop) {\n      if (\n        maskX < 0 ||\n        maskY < 0 ||\n        maskX + width > maskCanvas.width ||\n        maskY + height > maskCanvas.height\n      ) {\n        const canvas = this.cachedCanvases.getCanvas(\n          \"maskExtension\",\n          width,\n          height\n        );\n        const ctx = canvas.context;\n        ctx.drawImage(maskCanvas, -maskX, -maskY);\n        ctx.globalCompositeOperation = \"destination-atop\";\n        ctx.fillStyle = backdrop;\n        ctx.fillRect(0, 0, width, height);\n        ctx.globalCompositeOperation = \"source-over\";\n\n        maskCanvas = canvas.canvas;\n        maskX = maskY = 0;\n      } else {\n        maskCtx.save();\n        maskCtx.globalAlpha = 1;\n        maskCtx.setTransform(1, 0, 0, 1, 0, 0);\n        const clip = new Path2D();\n        clip.rect(maskX, maskY, width, height);\n        maskCtx.clip(clip);\n        maskCtx.globalCompositeOperation = \"destination-atop\";\n        maskCtx.fillStyle = backdrop;\n        maskCtx.fillRect(maskX, maskY, width, height);\n        maskCtx.restore();\n      }\n    }\n\n    layerCtx.save();\n    layerCtx.globalAlpha = 1;\n    layerCtx.setTransform(1, 0, 0, 1, 0, 0);\n\n    if (subtype === \"Alpha\" && transferMap) {\n      layerCtx.filter = this.filterFactory.addAlphaFilter(transferMap);\n    } else if (subtype === \"Luminosity\") {\n      layerCtx.filter = this.filterFactory.addLuminosityFilter(transferMap);\n    }\n\n    const clip = new Path2D();\n    clip.rect(layerOffsetX, layerOffsetY, width, height);\n    layerCtx.clip(clip);\n    layerCtx.globalCompositeOperation = \"destination-in\";\n    layerCtx.drawImage(\n      maskCanvas,\n      maskX,\n      maskY,\n      width,\n      height,\n      layerOffsetX,\n      layerOffsetY,\n      width,\n      height\n    );\n    layerCtx.restore();\n  }\n\n  save(opIdx) {\n    if (this.inSMaskMode) {\n      // SMask mode may be turned on/off causing us to lose graphics state.\n      // Copy the temporary canvas state to the main(suspended) canvas to keep\n      // it in sync.\n      copyCtxState(this.ctx, this.suspendedCtx);\n    }\n    this.ctx.save();\n    const old = this.current;\n    this.stateStack.push(old);\n    this.current = old.clone();\n    this.dependencyTracker?.save(opIdx);\n  }\n\n  restore(opIdx) {\n    this.dependencyTracker?.restore(opIdx);\n\n    if (this.stateStack.length === 0) {\n      if (this.inSMaskMode) {\n        this.endSMaskMode();\n      }\n      return;\n    }\n\n    this.current = this.stateStack.pop();\n    this.ctx.restore();\n    if (this.inSMaskMode) {\n      // Graphics state is stored on the main(suspended) canvas. Restore its\n      // state then copy it over to the temporary canvas.\n      copyCtxState(this.suspendedCtx, this.ctx);\n    }\n    this.checkSMaskState();\n\n    // Ensure that the clipping path is reset (fixes issue6413.pdf).\n    this.pendingClip = null;\n\n    this._cachedScaleForStroking[0] = -1;\n    this._cachedGetSinglePixelWidth = null;\n  }\n\n  transform(opIdx, a, b, c, d, e, f) {\n    this.dependencyTracker?.recordIncrementalData(\"transform\", opIdx);\n    this.ctx.transform(a, b, c, d, e, f);\n\n    this._cachedScaleForStroking[0] = -1;\n    this._cachedGetSinglePixelWidth = null;\n  }\n\n  // Path\n  constructPath(opIdx, op, data, minMax) {\n    let [path] = data;\n    if (!minMax) {\n      // The path is empty, so no need to update the current minMax.\n      path ||= data[0] = new Path2D();\n      this[op](opIdx, path);\n      return;\n    }\n\n    if (this.dependencyTracker !== null) {\n      const outerExtraSize = op === OPS.stroke ? this.current.lineWidth / 2 : 0;\n      this.dependencyTracker\n        .resetBBox(opIdx)\n        .recordBBox(\n          opIdx,\n          this.ctx,\n          minMax[0] - outerExtraSize,\n          minMax[2] + outerExtraSize,\n          minMax[1] - outerExtraSize,\n          minMax[3] + outerExtraSize\n        )\n        .recordDependencies(opIdx, [\"transform\"]);\n    }\n\n    if (!(path instanceof Path2D)) {\n      path = data[0] = makePathFromDrawOPS(path);\n    }\n    Util.axialAlignedBoundingBox(\n      minMax,\n      getCurrentTransform(this.ctx),\n      this.current.minMax\n    );\n    this[op](opIdx, path);\n\n    this._pathStartIdx = opIdx;\n  }\n\n  closePath(opIdx) {\n    this.ctx.closePath();\n  }\n\n  stroke(opIdx, path, consumePath = true) {\n    const ctx = this.ctx;\n    const strokeColor = this.current.strokeColor;\n    // For stroke we want to temporarily change the global alpha to the\n    // stroking alpha.\n    ctx.globalAlpha = this.current.strokeAlpha;\n    if (this.contentVisible) {\n      if (typeof strokeColor === \"object\" && strokeColor?.getPattern) {\n        const baseTransform = strokeColor.isModifyingCurrentTransform()\n          ? ctx.getTransform()\n          : null;\n        ctx.save();\n        ctx.strokeStyle = strokeColor.getPattern(\n          ctx,\n          this,\n          getCurrentTransformInverse(ctx),\n          PathType.STROKE,\n          opIdx\n        );\n        if (baseTransform) {\n          const newPath = new Path2D();\n          newPath.addPath(\n            path,\n            ctx.getTransform().invertSelf().multiplySelf(baseTransform)\n          );\n          path = newPath;\n        }\n        this.rescaleAndStroke(path, /* saveRestore */ false);\n        ctx.restore();\n      } else {\n        this.rescaleAndStroke(path, /* saveRestore */ true);\n      }\n    }\n\n    this.dependencyTracker?.recordDependencies(opIdx, Dependencies.stroke);\n\n    if (consumePath) {\n      this.consumePath(\n        opIdx,\n        path,\n        this.current.getClippedPathBoundingBox(\n          PathType.STROKE,\n          getCurrentTransform(this.ctx)\n        )\n      );\n    }\n\n    // Restore the global alpha to the fill alpha\n    ctx.globalAlpha = this.current.fillAlpha;\n  }\n\n  closeStroke(opIdx, path) {\n    this.stroke(opIdx, path);\n  }\n\n  fill(opIdx, path, consumePath = true) {\n    const ctx = this.ctx;\n    const fillColor = this.current.fillColor;\n    const isPatternFill = this.current.patternFill;\n    let needRestore = false;\n\n    if (isPatternFill) {\n      const baseTransform = fillColor.isModifyingCurrentTransform()\n        ? ctx.getTransform()\n        : null;\n      this.dependencyTracker?.save(opIdx);\n      ctx.save();\n      ctx.fillStyle = fillColor.getPattern(\n        ctx,\n        this,\n        getCurrentTransformInverse(ctx),\n        PathType.FILL,\n        opIdx\n      );\n      if (baseTransform) {\n        const newPath = new Path2D();\n        newPath.addPath(\n          path,\n          ctx.getTransform().invertSelf().multiplySelf(baseTransform)\n        );\n        path = newPath;\n      }\n      needRestore = true;\n    }\n\n    const intersect = this.current.getClippedPathBoundingBox();\n    if (this.contentVisible && intersect !== null) {\n      if (this.pendingEOFill) {\n        ctx.fill(path, \"evenodd\");\n        this.pendingEOFill = false;\n      } else {\n        ctx.fill(path);\n      }\n    }\n\n    this.dependencyTracker?.recordDependencies(opIdx, Dependencies.fill);\n\n    if (needRestore) {\n      ctx.restore();\n      this.dependencyTracker?.restore(opIdx);\n    }\n    if (consumePath) {\n      this.consumePath(opIdx, path, intersect);\n    }\n  }\n\n  eoFill(opIdx, path) {\n    this.pendingEOFill = true;\n    this.fill(opIdx, path);\n  }\n\n  fillStroke(opIdx, path) {\n    this.fill(opIdx, path, false);\n    this.stroke(opIdx, path, false);\n\n    this.consumePath(opIdx, path);\n  }\n\n  eoFillStroke(opIdx, path) {\n    this.pendingEOFill = true;\n    this.fillStroke(opIdx, path);\n  }\n\n  closeFillStroke(opIdx, path) {\n    this.fillStroke(opIdx, path);\n  }\n\n  closeEOFillStroke(opIdx, path) {\n    this.pendingEOFill = true;\n    this.fillStroke(opIdx, path);\n  }\n\n  endPath(opIdx, path) {\n    this.consumePath(opIdx, path);\n  }\n\n  rawFillPath(opIdx, path) {\n    this.ctx.fill(path);\n    this.dependencyTracker\n      ?.recordDependencies(opIdx, Dependencies.rawFillPath)\n      .recordOperation(opIdx);\n  }\n\n  // Clipping\n  clip(opIdx) {\n    this.dependencyTracker?.recordFutureForcedDependency(\"clipMode\", opIdx);\n    this.pendingClip = NORMAL_CLIP;\n  }\n\n  eoClip(opIdx) {\n    this.dependencyTracker?.recordFutureForcedDependency(\"clipMode\", opIdx);\n    this.pendingClip = EO_CLIP;\n  }\n\n  // Text\n  beginText(opIdx) {\n    this.current.textMatrix = null;\n    this.current.textMatrixScale = 1;\n    this.current.x = this.current.lineX = 0;\n    this.current.y = this.current.lineY = 0;\n\n    this.dependencyTracker\n      ?.recordOpenMarker(opIdx)\n      .resetIncrementalData(\"sameLineText\")\n      .resetIncrementalData(\"moveText\", opIdx);\n  }\n\n  endText(opIdx) {\n    const paths = this.pendingTextPaths;\n    const ctx = this.ctx;\n\n    if (this.dependencyTracker) {\n      const { dependencyTracker } = this;\n      if (paths !== undefined) {\n        dependencyTracker\n          .recordFutureForcedDependency(\n            \"textClip\",\n            dependencyTracker.getOpenMarker()\n          )\n          .recordFutureForcedDependency(\"textClip\", opIdx);\n      }\n      dependencyTracker.recordCloseMarker(opIdx);\n    }\n\n    if (paths !== undefined) {\n      const newPath = new Path2D();\n      const invTransf = ctx.getTransform().invertSelf();\n      for (const { transform, x, y, fontSize, path } of paths) {\n        if (!path) {\n          continue; // Skip empty paths.\n        }\n        newPath.addPath(\n          path,\n          new DOMMatrix(transform)\n            .preMultiplySelf(invTransf)\n            .translate(x, y)\n            .scale(fontSize, -fontSize)\n        );\n      }\n\n      ctx.clip(newPath);\n    }\n    delete this.pendingTextPaths;\n  }\n\n  setCharSpacing(opIdx, spacing) {\n    this.dependencyTracker?.recordSimpleData(\"charSpacing\", opIdx);\n    this.current.charSpacing = spacing;\n  }\n\n  setWordSpacing(opIdx, spacing) {\n    this.dependencyTracker?.recordSimpleData(\"wordSpacing\", opIdx);\n    this.current.wordSpacing = spacing;\n  }\n\n  setHScale(opIdx, scale) {\n    this.dependencyTracker?.recordSimpleData(\"hScale\", opIdx);\n    this.current.textHScale = scale / 100;\n  }\n\n  setLeading(opIdx, leading) {\n    this.dependencyTracker?.recordSimpleData(\"leading\", opIdx);\n    this.current.leading = -leading;\n  }\n\n  setFont(opIdx, fontRefName, size) {\n    this.dependencyTracker\n      ?.recordSimpleData(\"font\", opIdx)\n      .recordSimpleDataFromNamed(\"fontObj\", fontRefName, opIdx);\n    const fontObj = this.commonObjs.get(fontRefName);\n    const current = this.current;\n\n    if (!fontObj) {\n      throw new Error(`Can't find font for ${fontRefName}`);\n    }\n    current.fontMatrix = fontObj.fontMatrix || FONT_IDENTITY_MATRIX;\n\n    // A valid matrix needs all main diagonal elements to be non-zero\n    // This also ensures we bypass FF bugzilla bug #719844.\n    if (current.fontMatrix[0] === 0 || current.fontMatrix[3] === 0) {\n      warn(\"Invalid font matrix for font \" + fontRefName);\n    }\n\n    // The spec for Tf (setFont) says that 'size' specifies the font 'scale',\n    // and in some docs this can be negative (inverted x-y axes).\n    if (size < 0) {\n      size = -size;\n      current.fontDirection = -1;\n    } else {\n      current.fontDirection = 1;\n    }\n\n    this.current.font = fontObj;\n    this.current.fontSize = size;\n\n    if (fontObj.isType3Font) {\n      return; // we don't need ctx.font for Type3 fonts\n    }\n\n    const name = fontObj.loadedName || \"sans-serif\";\n    const typeface =\n      fontObj.systemFontInfo?.css || `\"${name}\", ${fontObj.fallbackName}`;\n\n    let bold = \"normal\";\n    if (fontObj.black) {\n      bold = \"900\";\n    } else if (fontObj.bold) {\n      bold = \"bold\";\n    }\n    const italic = fontObj.italic ? \"italic\" : \"normal\";\n\n    // Some font backends cannot handle fonts below certain size.\n    // Keeping the font at minimal size and using the fontSizeScale to change\n    // the current transformation matrix before the fillText/strokeText.\n    // See https://bugzilla.mozilla.org/show_bug.cgi?id=726227\n    let browserFontSize = size;\n    if (size < MIN_FONT_SIZE) {\n      browserFontSize = MIN_FONT_SIZE;\n    } else if (size > MAX_FONT_SIZE) {\n      browserFontSize = MAX_FONT_SIZE;\n    }\n    this.current.fontSizeScale = size / browserFontSize;\n\n    this.ctx.font = `${italic} ${bold} ${browserFontSize}px ${typeface}`;\n  }\n\n  setTextRenderingMode(opIdx, mode) {\n    this.dependencyTracker?.recordSimpleData(\"textRenderingMode\", opIdx);\n    this.current.textRenderingMode = mode;\n  }\n\n  setTextRise(opIdx, rise) {\n    this.dependencyTracker?.recordSimpleData(\"textRise\", opIdx);\n    this.current.textRise = rise;\n  }\n\n  moveText(opIdx, x, y) {\n    this.dependencyTracker\n      ?.resetIncrementalData(\"sameLineText\")\n      .recordIncrementalData(\"moveText\", opIdx);\n    this.current.x = this.current.lineX += x;\n    this.current.y = this.current.lineY += y;\n  }\n\n  setLeadingMoveText(opIdx, x, y) {\n    this.setLeading(opIdx, -y);\n    this.moveText(opIdx, x, y);\n  }\n\n  setTextMatrix(opIdx, matrix) {\n    this.dependencyTracker\n      ?.resetIncrementalData(\"sameLineText\")\n      .recordSimpleData(\"textMatrix\", opIdx);\n    const { current } = this;\n    current.textMatrix = matrix;\n    current.textMatrixScale = Math.hypot(matrix[0], matrix[1]);\n\n    current.x = current.lineX = 0;\n    current.y = current.lineY = 0;\n  }\n\n  nextLine(opIdx) {\n    this.moveText(opIdx, 0, this.current.leading);\n\n    this.dependencyTracker?.recordIncrementalData(\n      \"moveText\",\n      // 'leading' affects 'nextLine' operations. Rather than dealing\n      // with transitive dependencies, just mark everything that depends on\n      // the 'moveText' operation as depending on the 'leading' value.\n      this.dependencyTracker.getSimpleIndex(\"leading\") ?? opIdx\n    );\n  }\n\n  #getScaledPath(path, currentTransform, transform) {\n    const newPath = new Path2D();\n    newPath.addPath(\n      path,\n      new DOMMatrix(transform).invertSelf().multiplySelf(currentTransform)\n    );\n    return newPath;\n  }\n\n  paintChar(\n    opIdx,\n    character,\n    x,\n    y,\n    patternFillTransform,\n    patternStrokeTransform\n  ) {\n    const ctx = this.ctx;\n    const current = this.current;\n    const font = current.font;\n    const textRenderingMode = current.textRenderingMode;\n    const fontSize = current.fontSize / current.fontSizeScale;\n    const fillStrokeMode =\n      textRenderingMode & TextRenderingMode.FILL_STROKE_MASK;\n    const isAddToPathSet = !!(\n      textRenderingMode & TextRenderingMode.ADD_TO_PATH_FLAG\n    );\n    const patternFill = current.patternFill && !font.missingFile;\n    const patternStroke = current.patternStroke && !font.missingFile;\n\n    let path;\n    if (\n      (font.disableFontFace ||\n        isAddToPathSet ||\n        patternFill ||\n        patternStroke) &&\n      !font.missingFile\n    ) {\n      path = font.getPathGenerator(this.commonObjs, character);\n    }\n\n    if (path && (font.disableFontFace || patternFill || patternStroke)) {\n      ctx.save();\n      ctx.translate(x, y);\n      ctx.scale(fontSize, -fontSize);\n\n      this.dependencyTracker?.recordCharacterBBox(opIdx, ctx, font);\n\n      let currentTransform;\n      if (\n        fillStrokeMode === TextRenderingMode.FILL ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        if (patternFillTransform) {\n          currentTransform = ctx.getTransform();\n          ctx.setTransform(...patternFillTransform);\n          const scaledPath = this.#getScaledPath(\n            path,\n            currentTransform,\n            patternFillTransform\n          );\n          ctx.fill(scaledPath);\n        } else {\n          ctx.fill(path);\n        }\n      }\n      if (\n        fillStrokeMode === TextRenderingMode.STROKE ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        if (patternStrokeTransform) {\n          currentTransform ||= ctx.getTransform();\n          ctx.setTransform(...patternStrokeTransform);\n          const { a, b, c, d } = currentTransform;\n          const invPatternTransform = Util.inverseTransform(\n            patternStrokeTransform\n          );\n          const transf = Util.transform(\n            [a, b, c, d, 0, 0],\n            invPatternTransform\n          );\n          Util.singularValueDecompose2dScale(transf, XY);\n\n          // Cancel the pattern scaling of the line width.\n          // If sx and sy are different, unfortunately we can't do anything and\n          // we'll have a rendering bug.\n          ctx.lineWidth *= Math.max(XY[0], XY[1]) / fontSize;\n          ctx.stroke(\n            this.#getScaledPath(path, currentTransform, patternStrokeTransform)\n          );\n        } else {\n          ctx.lineWidth /= fontSize;\n          ctx.stroke(path);\n        }\n      }\n      ctx.restore();\n    } else {\n      if (\n        fillStrokeMode === TextRenderingMode.FILL ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        ctx.fillText(character, x, y);\n        this.dependencyTracker?.recordCharacterBBox(\n          opIdx,\n          ctx,\n          font,\n          fontSize,\n          x,\n          y,\n          () => ctx.measureText(character)\n        );\n      }\n      if (\n        fillStrokeMode === TextRenderingMode.STROKE ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        if (this.dependencyTracker) {\n          this.dependencyTracker\n            ?.recordCharacterBBox(opIdx, ctx, font, fontSize, x, y, () =>\n              ctx.measureText(character)\n            )\n            .recordDependencies(opIdx, Dependencies.stroke);\n        }\n        ctx.strokeText(character, x, y);\n      }\n    }\n\n    if (isAddToPathSet) {\n      const paths = (this.pendingTextPaths ||= []);\n      paths.push({\n        transform: getCurrentTransform(ctx),\n        x,\n        y,\n        fontSize,\n        path,\n      });\n      this.dependencyTracker?.recordCharacterBBox(\n        opIdx,\n        ctx,\n        font,\n        fontSize,\n        x,\n        y\n      );\n    }\n  }\n\n  get isFontSubpixelAAEnabled() {\n    // Checks if anti-aliasing is enabled when scaled text is painted.\n    // On Windows GDI scaled fonts looks bad.\n    const { context: ctx } = this.cachedCanvases.getCanvas(\n      \"isFontSubpixelAAEnabled\",\n      10,\n      10\n    );\n    ctx.scale(1.5, 1);\n    ctx.fillText(\"I\", 0, 10);\n    const data = ctx.getImageData(0, 0, 10, 10).data;\n    let enabled = false;\n    for (let i = 3; i < data.length; i += 4) {\n      if (data[i] > 0 && data[i] < 255) {\n        enabled = true;\n        break;\n      }\n    }\n    return shadow(this, \"isFontSubpixelAAEnabled\", enabled);\n  }\n\n  showText(opIdx, glyphs) {\n    if (this.dependencyTracker) {\n      this.dependencyTracker\n        .recordDependencies(opIdx, Dependencies.showText)\n        .resetBBox(opIdx);\n      if (this.current.textRenderingMode & TextRenderingMode.ADD_TO_PATH_FLAG) {\n        this.dependencyTracker\n          .recordFutureForcedDependency(\"textClip\", opIdx)\n          .inheritPendingDependenciesAsFutureForcedDependencies();\n      }\n    }\n\n    const current = this.current;\n    const font = current.font;\n    if (font.isType3Font) {\n      this.showType3Text(opIdx, glyphs);\n      this.dependencyTracker?.recordShowTextOperation(opIdx);\n      return undefined;\n    }\n\n    const fontSize = current.fontSize;\n    if (fontSize === 0) {\n      this.dependencyTracker?.recordOperation(opIdx);\n      return undefined;\n    }\n\n    const ctx = this.ctx;\n    const fontSizeScale = current.fontSizeScale;\n    const charSpacing = current.charSpacing;\n    const wordSpacing = current.wordSpacing;\n    const fontDirection = current.fontDirection;\n    const textHScale = current.textHScale * fontDirection;\n    const glyphsLength = glyphs.length;\n    const vertical = font.vertical;\n    const spacingDir = vertical ? 1 : -1;\n    const defaultVMetrics = font.defaultVMetrics;\n    const widthAdvanceScale = fontSize * current.fontMatrix[0];\n\n    const simpleFillText =\n      current.textRenderingMode === TextRenderingMode.FILL &&\n      !font.disableFontFace &&\n      !current.patternFill;\n\n    ctx.save();\n    if (current.textMatrix) {\n      ctx.transform(...current.textMatrix);\n    }\n    ctx.translate(current.x, current.y + current.textRise);\n\n    if (fontDirection > 0) {\n      ctx.scale(textHScale, -1);\n    } else {\n      ctx.scale(textHScale, 1);\n    }\n\n    let patternFillTransform, patternStrokeTransform;\n\n    // Only compute pattern transforms if the text rendering mode actually\n    // uses fill/stroke. This avoids expensive pattern calculations each call\n    // when a patternFill/patternStroke is set, but unused.\n    const fillStrokeMode =\n      current.textRenderingMode & TextRenderingMode.FILL_STROKE_MASK;\n    const needsFill =\n      fillStrokeMode === TextRenderingMode.FILL ||\n      fillStrokeMode === TextRenderingMode.FILL_STROKE;\n    const needsStroke =\n      fillStrokeMode === TextRenderingMode.STROKE ||\n      fillStrokeMode === TextRenderingMode.FILL_STROKE;\n\n    if (needsFill && current.patternFill) {\n      ctx.save();\n      const pattern = current.fillColor.getPattern(\n        ctx,\n        this,\n        getCurrentTransformInverse(ctx),\n        PathType.FILL,\n        opIdx\n      );\n      patternFillTransform = getCurrentTransform(ctx);\n      ctx.restore();\n      ctx.fillStyle = pattern;\n    }\n\n    if (needsStroke && current.patternStroke) {\n      ctx.save();\n      const pattern = current.strokeColor.getPattern(\n        ctx,\n        this,\n        getCurrentTransformInverse(ctx),\n        PathType.STROKE,\n        opIdx\n      );\n      patternStrokeTransform = getCurrentTransform(ctx);\n      ctx.restore();\n      ctx.strokeStyle = pattern;\n    }\n\n    let lineWidth = current.lineWidth;\n    const scale = current.textMatrixScale;\n    if (scale === 0 || lineWidth === 0) {\n      if (needsStroke) {\n        lineWidth = this.getSinglePixelWidth();\n      }\n    } else {\n      lineWidth /= scale;\n    }\n\n    if (fontSizeScale !== 1.0) {\n      ctx.scale(fontSizeScale, fontSizeScale);\n      lineWidth /= fontSizeScale;\n    }\n\n    ctx.lineWidth = lineWidth;\n\n    if (font.isInvalidPDFjsFont) {\n      const chars = [];\n      let width = 0;\n      for (const glyph of glyphs) {\n        chars.push(glyph.unicode);\n        width += glyph.width;\n      }\n      const joinedChars = chars.join(\"\");\n      ctx.fillText(joinedChars, 0, 0);\n      if (this.dependencyTracker !== null) {\n        const measure = ctx.measureText(joinedChars);\n        this.dependencyTracker\n          .recordBBox(\n            opIdx,\n            this.ctx,\n            -measure.actualBoundingBoxLeft,\n            measure.actualBoundingBoxRight,\n            -measure.actualBoundingBoxAscent,\n            measure.actualBoundingBoxDescent\n          )\n          .recordShowTextOperation(opIdx);\n      }\n      current.x += width * widthAdvanceScale * textHScale;\n      ctx.restore();\n      this.compose();\n      return undefined;\n    }\n\n    let x = 0,\n      i;\n    for (i = 0; i < glyphsLength; ++i) {\n      const glyph = glyphs[i];\n      if (typeof glyph === \"number\") {\n        x += (spacingDir * glyph * fontSize) / 1000;\n        continue;\n      }\n\n      let restoreNeeded = false;\n      const spacing = (glyph.isSpace ? wordSpacing : 0) + charSpacing;\n      const character = glyph.fontChar;\n      const accent = glyph.accent;\n      let scaledX, scaledY;\n      let width = glyph.width;\n      if (vertical) {\n        const vmetric = glyph.vmetric || defaultVMetrics;\n        const vx =\n          -(glyph.vmetric ? vmetric[1] : width * 0.5) * widthAdvanceScale;\n        const vy = vmetric[2] * widthAdvanceScale;\n\n        width = vmetric ? -vmetric[0] : width;\n        scaledX = vx / fontSizeScale;\n        scaledY = (x + vy) / fontSizeScale;\n      } else {\n        scaledX = x / fontSizeScale;\n        scaledY = 0;\n      }\n\n      let measure;\n\n      if (font.remeasure && width > 0) {\n        measure = ctx.measureText(character);\n\n        // Some standard fonts may not have the exact width: rescale per\n        // character if measured width is greater than expected glyph width\n        // and subpixel-aa is enabled, otherwise just center the glyph.\n        const measuredWidth =\n          ((measure.width * 1000) / fontSize) * fontSizeScale;\n        if (width < measuredWidth && this.isFontSubpixelAAEnabled) {\n          const characterScaleX = width / measuredWidth;\n          restoreNeeded = true;\n          ctx.save();\n          ctx.scale(characterScaleX, 1);\n          scaledX /= characterScaleX;\n        } else if (width !== measuredWidth) {\n          scaledX +=\n            (((width - measuredWidth) / 2000) * fontSize) / fontSizeScale;\n        }\n      }\n\n      // Only attempt to draw the glyph if it is actually in the embedded font\n      // file or if there isn't a font file so the fallback font is shown.\n      if (this.contentVisible && (glyph.isInFont || font.missingFile)) {\n        if (simpleFillText && !accent) {\n          // common case\n          ctx.fillText(character, scaledX, scaledY);\n\n          this.dependencyTracker?.recordCharacterBBox(\n            opIdx,\n            ctx,\n            // If we already measured the character, force usage of that\n            measure ? { bbox: null } : font,\n            fontSize / fontSizeScale,\n            scaledX,\n            scaledY,\n            () => measure ?? ctx.measureText(character)\n          );\n        } else {\n          this.paintChar(\n            opIdx,\n            character,\n            scaledX,\n            scaledY,\n            patternFillTransform,\n            patternStrokeTransform\n          );\n          if (accent) {\n            const scaledAccentX =\n              scaledX + (fontSize * accent.offset.x) / fontSizeScale;\n            const scaledAccentY =\n              scaledY - (fontSize * accent.offset.y) / fontSizeScale;\n            this.paintChar(\n              opIdx,\n              accent.fontChar,\n              scaledAccentX,\n              scaledAccentY,\n              patternFillTransform,\n              patternStrokeTransform\n            );\n          }\n        }\n      }\n\n      const charWidth = vertical\n        ? width * widthAdvanceScale - spacing * fontDirection\n        : width * widthAdvanceScale + spacing * fontDirection;\n      x += charWidth;\n\n      if (restoreNeeded) {\n        ctx.restore();\n      }\n    }\n    if (vertical) {\n      current.y -= x;\n    } else {\n      current.x += x * textHScale;\n    }\n    ctx.restore();\n    this.compose();\n\n    this.dependencyTracker?.recordShowTextOperation(opIdx);\n    return undefined;\n  }\n\n  showType3Text(opIdx, glyphs) {\n    // Type3 fonts - each glyph is a \"mini-PDF\"\n    const ctx = this.ctx;\n    const current = this.current;\n    const font = current.font;\n    const fontSize = current.fontSize;\n    const fontDirection = current.fontDirection;\n    const spacingDir = font.vertical ? 1 : -1;\n    const charSpacing = current.charSpacing;\n    const wordSpacing = current.wordSpacing;\n    const textHScale = current.textHScale * fontDirection;\n    const fontMatrix = current.fontMatrix || FONT_IDENTITY_MATRIX;\n    const glyphsLength = glyphs.length;\n    const isTextInvisible =\n      current.textRenderingMode === TextRenderingMode.INVISIBLE;\n    let i, glyph, width, spacingLength;\n\n    if (isTextInvisible || fontSize === 0) {\n      return;\n    }\n    this._cachedScaleForStroking[0] = -1;\n    this._cachedGetSinglePixelWidth = null;\n\n    ctx.save();\n    if (current.textMatrix) {\n      ctx.transform(...current.textMatrix);\n    }\n    ctx.translate(current.x, current.y + current.textRise);\n\n    ctx.scale(textHScale, fontDirection);\n\n    // Type3 fonts have their own operator list. Avoid mixing it up with the\n    // dependency tracker of the main operator list.\n    const dependencyTracker = this.dependencyTracker;\n    this.dependencyTracker = dependencyTracker\n      ? new CanvasNestedDependencyTracker(dependencyTracker, opIdx)\n      : null;\n\n    for (i = 0; i < glyphsLength; ++i) {\n      glyph = glyphs[i];\n      if (typeof glyph === \"number\") {\n        spacingLength = (spacingDir * glyph * fontSize) / 1000;\n        this.ctx.translate(spacingLength, 0);\n        current.x += spacingLength * textHScale;\n        continue;\n      }\n\n      const spacing = (glyph.isSpace ? wordSpacing : 0) + charSpacing;\n      const operatorList = font.charProcOperatorList[glyph.operatorListId];\n      if (!operatorList) {\n        warn(`Type3 character \"${glyph.operatorListId}\" is not available.`);\n      } else if (this.contentVisible) {\n        this.save();\n        ctx.scale(fontSize, fontSize);\n        ctx.transform(...fontMatrix);\n        this.executeOperatorList(operatorList);\n        this.restore();\n      }\n\n      const p = [glyph.width, 0];\n      Util.applyTransform(p, fontMatrix);\n      width = p[0] * fontSize + spacing;\n\n      ctx.translate(width, 0);\n      current.x += width * textHScale;\n    }\n    ctx.restore();\n    if (dependencyTracker) {\n      this.dependencyTracker = dependencyTracker;\n    }\n  }\n\n  // Type3 fonts\n  setCharWidth(opIdx, xWidth, yWidth) {\n    // We can safely ignore this since the width should be the same\n    // as the width in the Widths array.\n  }\n\n  setCharWidthAndBounds(opIdx, xWidth, yWidth, llx, lly, urx, ury) {\n    const clip = new Path2D();\n    clip.rect(llx, lly, urx - llx, ury - lly);\n    this.ctx.clip(clip);\n    this.dependencyTracker\n      ?.recordBBox(opIdx, this.ctx, llx, urx, lly, ury)\n      .recordClipBox(opIdx, this.ctx, llx, urx, lly, ury);\n    this.endPath(opIdx);\n  }\n\n  // Color\n  getColorN_Pattern(opIdx, IR) {\n    let pattern;\n    if (IR[0] === \"TilingPattern\") {\n      const baseTransform = this.baseTransform || getCurrentTransform(this.ctx);\n      const canvasGraphicsFactory = {\n        createCanvasGraphics: (ctx, renderingOpIdx) =>\n          new CanvasGraphics(\n            ctx,\n            this.commonObjs,\n            this.objs,\n            this.canvasFactory,\n            this.filterFactory,\n            {\n              optionalContentConfig: this.optionalContentConfig,\n              markedContentStack: this.markedContentStack,\n            },\n            undefined,\n            undefined,\n            this.dependencyTracker\n              ? new CanvasNestedDependencyTracker(\n                  this.dependencyTracker,\n                  renderingOpIdx,\n                  /* ignoreBBoxes */ true\n                )\n              : null\n          ),\n      };\n      pattern = new TilingPattern(\n        IR,\n        this.ctx,\n        canvasGraphicsFactory,\n        baseTransform\n      );\n    } else {\n      pattern = this._getPattern(opIdx, IR[1], IR[2]);\n    }\n    return pattern;\n  }\n\n  setStrokeColorN(opIdx, ...args) {\n    this.dependencyTracker?.recordSimpleData(\"strokeColor\", opIdx);\n    this.current.strokeColor = this.getColorN_Pattern(opIdx, args);\n    this.current.patternStroke = true;\n  }\n\n  setFillColorN(opIdx, ...args) {\n    this.dependencyTracker?.recordSimpleData(\"fillColor\", opIdx);\n    this.current.fillColor = this.getColorN_Pattern(opIdx, args);\n    this.current.patternFill = true;\n  }\n\n  setStrokeRGBColor(opIdx, color) {\n    this.dependencyTracker?.recordSimpleData(\"strokeColor\", opIdx);\n    this.ctx.strokeStyle = this.current.strokeColor = color;\n    this.current.patternStroke = false;\n  }\n\n  setStrokeTransparent(opIdx) {\n    this.dependencyTracker?.recordSimpleData(\"strokeColor\", opIdx);\n    this.ctx.strokeStyle = this.current.strokeColor = \"transparent\";\n    this.current.patternStroke = false;\n  }\n\n  setFillRGBColor(opIdx, color) {\n    this.dependencyTracker?.recordSimpleData(\"fillColor\", opIdx);\n    this.ctx.fillStyle = this.current.fillColor = color;\n    this.current.patternFill = false;\n  }\n\n  setFillTransparent(opIdx) {\n    this.dependencyTracker?.recordSimpleData(\"fillColor\", opIdx);\n    this.ctx.fillStyle = this.current.fillColor = \"transparent\";\n    this.current.patternFill = false;\n  }\n\n  _getPattern(opIdx, objId, matrix = null) {\n    let pattern;\n    if (this.cachedPatterns.has(objId)) {\n      pattern = this.cachedPatterns.get(objId);\n    } else {\n      pattern = getShadingPattern(this.getObject(opIdx, objId));\n      this.cachedPatterns.set(objId, pattern);\n    }\n    if (matrix) {\n      pattern.matrix = matrix;\n    }\n    return pattern;\n  }\n\n  shadingFill(opIdx, objId) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const ctx = this.ctx;\n\n    this.save(opIdx);\n    const pattern = this._getPattern(opIdx, objId);\n    ctx.fillStyle = pattern.getPattern(\n      ctx,\n      this,\n      getCurrentTransformInverse(ctx),\n      PathType.SHADING,\n      opIdx\n    );\n\n    const inv = getCurrentTransformInverse(ctx);\n    if (inv) {\n      const { width, height } = ctx.canvas;\n      const minMax = MIN_MAX_INIT.slice();\n      Util.axialAlignedBoundingBox([0, 0, width, height], inv, minMax);\n      const [x0, y0, x1, y1] = minMax;\n\n      this.ctx.fillRect(x0, y0, x1 - x0, y1 - y0);\n    } else {\n      // HACK to draw the gradient onto an infinite rectangle.\n      // PDF gradients are drawn across the entire image while\n      // Canvas only allows gradients to be drawn in a rectangle\n      // The following bug should allow us to remove this.\n      // https://bugzilla.mozilla.org/show_bug.cgi?id=664884\n\n      this.ctx.fillRect(-1e10, -1e10, 2e10, 2e10);\n    }\n\n    this.dependencyTracker\n      ?.resetBBox(opIdx)\n      // TODO: Track proper bbox\n      .recordFullPageBBox(opIdx)\n      .recordDependencies(opIdx, Dependencies.transform)\n      .recordDependencies(opIdx, Dependencies.fill)\n      .recordOperation(opIdx);\n\n    this.compose(this.current.getClippedPathBoundingBox());\n    this.restore(opIdx);\n  }\n\n  // Images\n  beginInlineImage() {\n    unreachable(\"Should not call beginInlineImage\");\n  }\n\n  beginImageData() {\n    unreachable(\"Should not call beginImageData\");\n  }\n\n  paintFormXObjectBegin(opIdx, matrix, bbox) {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.save(opIdx);\n    this.baseTransformStack.push(this.baseTransform);\n\n    if (matrix) {\n      this.transform(opIdx, ...matrix);\n    }\n    this.baseTransform = getCurrentTransform(this.ctx);\n\n    if (bbox) {\n      Util.axialAlignedBoundingBox(\n        bbox,\n        this.baseTransform,\n        this.current.minMax\n      );\n      const [x0, y0, x1, y1] = bbox;\n      const clip = new Path2D();\n      clip.rect(x0, y0, x1 - x0, y1 - y0);\n      this.ctx.clip(clip);\n      this.dependencyTracker?.recordClipBox(opIdx, this.ctx, x0, x1, y0, y1);\n      this.endPath(opIdx);\n    }\n  }\n\n  paintFormXObjectEnd(opIdx) {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.restore(opIdx);\n    this.baseTransform = this.baseTransformStack.pop();\n  }\n\n  beginGroup(opIdx, group) {\n    if (!this.contentVisible) {\n      return;\n    }\n\n    this.save(opIdx);\n    // If there's an active soft mask we don't want it enabled for the group, so\n    // clear it out. The mask and suspended canvas will be restored in endGroup.\n    if (this.inSMaskMode) {\n      this.endSMaskMode();\n      this.current.activeSMask = null;\n    }\n\n    const currentCtx = this.ctx;\n    // TODO non-isolated groups - according to Rik at adobe non-isolated\n    // group results aren't usually that different and they even have tools\n    // that ignore this setting. Notes from Rik on implementing:\n    // - When you encounter an transparency group, create a new canvas with\n    // the dimensions of the bbox\n    // - copy the content from the previous canvas to the new canvas\n    // - draw as usual\n    // - remove the backdrop alpha:\n    // alphaNew = 1 - (1 - alpha)/(1 - alphaBackdrop) with 'alpha' the alpha\n    // value of your transparency group and 'alphaBackdrop' the alpha of the\n    // backdrop\n    // - remove background color:\n    // colorNew = color - alphaNew *colorBackdrop /(1 - alphaNew)\n    if (!group.isolated) {\n      info(\"TODO: Support non-isolated groups.\");\n    }\n\n    // TODO knockout - supposedly possible with the clever use of compositing\n    // modes.\n    if (group.knockout) {\n      warn(\"Knockout groups not supported.\");\n    }\n\n    const currentTransform = getCurrentTransform(currentCtx);\n    if (group.matrix) {\n      currentCtx.transform(...group.matrix);\n    }\n    if (!group.bbox) {\n      throw new Error(\"Bounding box is required.\");\n    }\n\n    // Based on the current transform figure out how big the bounding box\n    // will actually be.\n    let bounds = MIN_MAX_INIT.slice();\n    Util.axialAlignedBoundingBox(\n      group.bbox,\n      getCurrentTransform(currentCtx),\n      bounds\n    );\n\n    // Clip the bounding box to the current canvas.\n    const canvasBounds = [\n      0,\n      0,\n      currentCtx.canvas.width,\n      currentCtx.canvas.height,\n    ];\n    bounds = Util.intersect(bounds, canvasBounds) || [0, 0, 0, 0];\n    // Use ceil in case we're between sizes so we don't create canvas that is\n    // too small and make the canvas at least 1x1 pixels.\n    const offsetX = Math.floor(bounds[0]);\n    const offsetY = Math.floor(bounds[1]);\n    const drawnWidth = Math.max(Math.ceil(bounds[2]) - offsetX, 1);\n    const drawnHeight = Math.max(Math.ceil(bounds[3]) - offsetY, 1);\n\n    this.current.startNewPathAndClipBox([0, 0, drawnWidth, drawnHeight]);\n\n    let cacheId = \"groupAt\" + this.groupLevel;\n    if (group.smask) {\n      // Using two cache entries is case if masks are used one after another.\n      cacheId += \"_smask_\" + (this.smaskCounter++ % 2);\n    }\n    const scratchCanvas = this.cachedCanvases.getCanvas(\n      cacheId,\n      drawnWidth,\n      drawnHeight\n    );\n    const groupCtx = scratchCanvas.context;\n\n    // Since we created a new canvas that is just the size of the bounding box\n    // we have to translate the group ctx.\n    groupCtx.translate(-offsetX, -offsetY);\n    groupCtx.transform(...currentTransform);\n\n    // Apply the bbox to the group context.\n    let clip = new Path2D();\n    const [x0, y0, x1, y1] = group.bbox;\n    clip.rect(x0, y0, x1 - x0, y1 - y0);\n    if (group.matrix) {\n      const path = new Path2D();\n      path.addPath(clip, new DOMMatrix(group.matrix));\n      clip = path;\n    }\n    groupCtx.clip(clip);\n\n    if (group.smask) {\n      // Saving state and cached mask to be used in setGState.\n      this.smaskStack.push({\n        canvas: scratchCanvas.canvas,\n        context: groupCtx,\n        offsetX,\n        offsetY,\n        subtype: group.smask.subtype,\n        backdrop: group.smask.backdrop,\n        transferMap: group.smask.transferMap || null,\n        startTransformInverse: null, // used during suspend operation\n      });\n    }\n    if (\n      !group.smask ||\n      // When this is not an SMask group, we only need to update the current\n      // transform if recording operations bboxes, so they the bboxes have the\n      // correct transform applied.\n      this.dependencyTracker\n    ) {\n      // Setup the current ctx so when the group is popped we draw it at the\n      // right location.\n      currentCtx.setTransform(1, 0, 0, 1, 0, 0);\n      currentCtx.translate(offsetX, offsetY);\n      currentCtx.save();\n    }\n    // The transparency group inherits all off the current graphics state\n    // except the blend mode, soft mask, and alpha constants.\n    copyCtxState(currentCtx, groupCtx);\n    this.ctx = groupCtx;\n    this.dependencyTracker\n      ?.inheritSimpleDataAsFutureForcedDependencies([\n        \"fillAlpha\",\n        \"strokeAlpha\",\n        \"globalCompositeOperation\",\n      ])\n      .pushBaseTransform(currentCtx);\n    this.setGState(opIdx, [\n      [\"BM\", \"source-over\"],\n      [\"ca\", 1],\n      [\"CA\", 1],\n    ]);\n    this.groupStack.push(currentCtx);\n    this.groupLevel++;\n  }\n\n  endGroup(opIdx, group) {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.groupLevel--;\n    const groupCtx = this.ctx;\n    const ctx = this.groupStack.pop();\n    this.ctx = ctx;\n    // Turn off image smoothing to avoid sub pixel interpolation which can\n    // look kind of blurry for some pdfs.\n    this.ctx.imageSmoothingEnabled = false;\n\n    this.dependencyTracker?.popBaseTransform();\n\n    if (group.smask) {\n      this.tempSMask = this.smaskStack.pop();\n      this.restore(opIdx);\n      if (this.dependencyTracker) {\n        this.ctx.restore();\n      }\n    } else {\n      this.ctx.restore();\n      const currentMtx = getCurrentTransform(this.ctx);\n      this.restore(opIdx);\n      this.ctx.save();\n      this.ctx.setTransform(...currentMtx);\n      const dirtyBox = MIN_MAX_INIT.slice();\n      Util.axialAlignedBoundingBox(\n        [0, 0, groupCtx.canvas.width, groupCtx.canvas.height],\n        currentMtx,\n        dirtyBox\n      );\n      this.ctx.drawImage(groupCtx.canvas, 0, 0);\n      this.ctx.restore();\n      this.compose(dirtyBox);\n    }\n  }\n\n  beginAnnotation(opIdx, id, rect, transform, matrix, hasOwnCanvas) {\n    // The annotations are drawn just after the page content.\n    // The page content drawing can potentially have set a transform,\n    // a clipping path, whatever...\n    // So in order to have something clean, we restore the initial state.\n    this.#restoreInitialState();\n    resetCtxToDefault(this.ctx);\n\n    this.ctx.save();\n    this.save(opIdx);\n\n    if (this.baseTransform) {\n      this.ctx.setTransform(...this.baseTransform);\n    }\n\n    if (rect) {\n      const width = rect[2] - rect[0];\n      const height = rect[3] - rect[1];\n\n      if (hasOwnCanvas && this.annotationCanvasMap) {\n        transform = transform.slice();\n        transform[4] -= rect[0];\n        transform[5] -= rect[1];\n\n        rect = rect.slice();\n        rect[0] = rect[1] = 0;\n        rect[2] = width;\n        rect[3] = height;\n\n        Util.singularValueDecompose2dScale(getCurrentTransform(this.ctx), XY);\n        const { viewportScale } = this;\n        const canvasWidth = Math.ceil(\n          width * this.outputScaleX * viewportScale\n        );\n        const canvasHeight = Math.ceil(\n          height * this.outputScaleY * viewportScale\n        );\n\n        this.annotationCanvas = this.canvasFactory.create(\n          canvasWidth,\n          canvasHeight\n        );\n        const { canvas, context } = this.annotationCanvas;\n        this.annotationCanvasMap.set(id, canvas);\n        this.annotationCanvas.savedCtx = this.ctx;\n        this.ctx = context;\n        this.ctx.save();\n        this.ctx.setTransform(XY[0], 0, 0, -XY[1], 0, height * XY[1]);\n\n        resetCtxToDefault(this.ctx);\n      } else {\n        resetCtxToDefault(this.ctx);\n\n        // Consume a potential path before clipping.\n        this.endPath(opIdx);\n\n        const clip = new Path2D();\n        clip.rect(rect[0], rect[1], width, height);\n        this.ctx.clip(clip);\n      }\n    }\n\n    this.current = new CanvasExtraState(\n      this.ctx.canvas.width,\n      this.ctx.canvas.height\n    );\n\n    this.transform(opIdx, ...transform);\n    this.transform(opIdx, ...matrix);\n  }\n\n  endAnnotation(opIdx) {\n    if (this.annotationCanvas) {\n      this.ctx.restore();\n      this.#drawFilter();\n\n      this.ctx = this.annotationCanvas.savedCtx;\n      delete this.annotationCanvas.savedCtx;\n      delete this.annotationCanvas;\n    }\n  }\n\n  paintImageMaskXObject(opIdx, img) {\n    if (!this.contentVisible) {\n      return;\n    }\n\n    const count = img.count;\n    img = this.getObject(opIdx, img.data, img);\n    img.count = count;\n\n    const ctx = this.ctx;\n    const mask = this._createMaskCanvas(opIdx, img);\n    const maskCanvas = mask.canvas;\n\n    ctx.save();\n    // The mask is drawn with the transform applied. Reset the current\n    // transform to draw to the identity.\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.drawImage(maskCanvas, mask.offsetX, mask.offsetY);\n    this.dependencyTracker\n      ?.resetBBox(opIdx)\n      .recordBBox(\n        opIdx,\n        this.ctx,\n        mask.offsetX,\n        mask.offsetX + maskCanvas.width,\n        mask.offsetY,\n        mask.offsetY + maskCanvas.height\n      )\n      .recordOperation(opIdx);\n    ctx.restore();\n    this.compose();\n  }\n\n  paintImageMaskXObjectRepeat(\n    opIdx,\n    img,\n    scaleX,\n    skewX = 0,\n    skewY = 0,\n    scaleY,\n    positions\n  ) {\n    if (!this.contentVisible) {\n      return;\n    }\n\n    img = this.getObject(opIdx, img.data, img);\n\n    const ctx = this.ctx;\n    ctx.save();\n    const currentTransform = getCurrentTransform(ctx);\n    ctx.transform(scaleX, skewX, skewY, scaleY, 0, 0);\n    const mask = this._createMaskCanvas(opIdx, img);\n\n    ctx.setTransform(\n      1,\n      0,\n      0,\n      1,\n      mask.offsetX - currentTransform[4],\n      mask.offsetY - currentTransform[5]\n    );\n    this.dependencyTracker?.resetBBox(opIdx);\n    for (let i = 0, ii = positions.length; i < ii; i += 2) {\n      const trans = Util.transform(currentTransform, [\n        scaleX,\n        skewX,\n        skewY,\n        scaleY,\n        positions[i],\n        positions[i + 1],\n      ]);\n\n      // Here we want to apply the transform at the origin,\n      // hence no additional computation is necessary.\n      ctx.drawImage(mask.canvas, trans[4], trans[5]);\n      this.dependencyTracker?.recordBBox(\n        opIdx,\n        this.ctx,\n        trans[4],\n        trans[4] + mask.canvas.width,\n        trans[5],\n        trans[5] + mask.canvas.height\n      );\n    }\n    ctx.restore();\n    this.compose();\n\n    this.dependencyTracker?.recordOperation(opIdx);\n  }\n\n  paintImageMaskXObjectGroup(opIdx, images) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const ctx = this.ctx;\n\n    const fillColor = this.current.fillColor;\n    const isPatternFill = this.current.patternFill;\n\n    this.dependencyTracker\n      ?.resetBBox(opIdx)\n      .recordDependencies(opIdx, Dependencies.transformAndFill);\n\n    for (const image of images) {\n      const { data, width, height, transform } = image;\n\n      const maskCanvas = this.cachedCanvases.getCanvas(\n        \"maskCanvas\",\n        width,\n        height\n      );\n      const maskCtx = maskCanvas.context;\n      maskCtx.save();\n\n      const img = this.getObject(opIdx, data, image);\n      putBinaryImageMask(maskCtx, img);\n\n      maskCtx.globalCompositeOperation = \"source-in\";\n\n      maskCtx.fillStyle = isPatternFill\n        ? fillColor.getPattern(\n            maskCtx,\n            this,\n            getCurrentTransformInverse(ctx),\n            PathType.FILL,\n            opIdx\n          )\n        : fillColor;\n      maskCtx.fillRect(0, 0, width, height);\n\n      maskCtx.restore();\n\n      ctx.save();\n      ctx.transform(...transform);\n      ctx.scale(1, -1);\n      drawImageAtIntegerCoords(\n        ctx,\n        maskCanvas.canvas,\n        0,\n        0,\n        width,\n        height,\n        0,\n        -1,\n        1,\n        1\n      );\n\n      this.dependencyTracker?.recordBBox(opIdx, ctx, 0, width, 0, height);\n      ctx.restore();\n    }\n    this.compose();\n    this.dependencyTracker?.recordOperation(opIdx);\n  }\n\n  paintImageXObject(opIdx, objId) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const imgData = this.getObject(opIdx, objId);\n    if (!imgData) {\n      warn(\"Dependent image isn't ready yet\");\n      return;\n    }\n\n    this.paintInlineImageXObject(opIdx, imgData);\n  }\n\n  paintImageXObjectRepeat(opIdx, objId, scaleX, scaleY, positions) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const imgData = this.getObject(opIdx, objId);\n    if (!imgData) {\n      warn(\"Dependent image isn't ready yet\");\n      return;\n    }\n\n    const width = imgData.width;\n    const height = imgData.height;\n    const map = [];\n    for (let i = 0, ii = positions.length; i < ii; i += 2) {\n      map.push({\n        transform: [scaleX, 0, 0, scaleY, positions[i], positions[i + 1]],\n        x: 0,\n        y: 0,\n        w: width,\n        h: height,\n      });\n    }\n    this.paintInlineImageXObjectGroup(opIdx, imgData, map);\n  }\n\n  applyTransferMapsToCanvas(ctx) {\n    if (this.current.transferMaps !== \"none\") {\n      ctx.filter = this.current.transferMaps;\n      ctx.drawImage(ctx.canvas, 0, 0);\n      ctx.filter = \"none\";\n    }\n    return ctx.canvas;\n  }\n\n  applyTransferMapsToBitmap(imgData) {\n    if (this.current.transferMaps === \"none\") {\n      return imgData.bitmap;\n    }\n    const { bitmap, width, height } = imgData;\n    const tmpCanvas = this.cachedCanvases.getCanvas(\n      \"inlineImage\",\n      width,\n      height\n    );\n    const tmpCtx = tmpCanvas.context;\n    tmpCtx.filter = this.current.transferMaps;\n    tmpCtx.drawImage(bitmap, 0, 0);\n    tmpCtx.filter = \"none\";\n\n    return tmpCanvas.canvas;\n  }\n\n  paintInlineImageXObject(opIdx, imgData) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const width = imgData.width;\n    const height = imgData.height;\n    const ctx = this.ctx;\n\n    this.save(opIdx);\n\n    // The filter, if any, will be applied in applyTransferMapsToBitmap.\n    // It must be applied to the image before rescaling else some artifacts\n    // could appear.\n    // The final restore will reset it to its value.\n    const { filter } = ctx;\n    if (filter !== \"none\" && filter !== \"\") {\n      ctx.filter = \"none\";\n    }\n\n    // scale the image to the unit square\n    ctx.scale(1 / width, -1 / height);\n\n    let imgToPaint;\n    if (imgData.bitmap) {\n      imgToPaint = this.applyTransferMapsToBitmap(imgData);\n    } else if (\n      (typeof HTMLElement === \"function\" && imgData instanceof HTMLElement) ||\n      !imgData.data\n    ) {\n      // typeof check is needed due to node.js support, see issue #8489\n      imgToPaint = imgData;\n    } else {\n      const tmpCanvas = this.cachedCanvases.getCanvas(\n        \"inlineImage\",\n        width,\n        height\n      );\n      const tmpCtx = tmpCanvas.context;\n      putBinaryImageData(tmpCtx, imgData);\n      imgToPaint = this.applyTransferMapsToCanvas(tmpCtx);\n    }\n\n    const scaled = this._scaleImage(\n      imgToPaint,\n      getCurrentTransformInverse(ctx)\n    );\n    ctx.imageSmoothingEnabled = getImageSmoothingEnabled(\n      getCurrentTransform(ctx),\n      imgData.interpolate\n    );\n\n    this.dependencyTracker\n      ?.resetBBox(opIdx)\n      .recordBBox(opIdx, ctx, 0, width, -height, 0)\n      .recordDependencies(opIdx, Dependencies.imageXObject)\n      .recordOperation(opIdx);\n\n    drawImageAtIntegerCoords(\n      ctx,\n      scaled.img,\n      0,\n      0,\n      scaled.paintWidth,\n      scaled.paintHeight,\n      0,\n      -height,\n      width,\n      height\n    );\n    this.compose();\n    this.restore(opIdx);\n  }\n\n  paintInlineImageXObjectGroup(opIdx, imgData, map) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const ctx = this.ctx;\n    let imgToPaint;\n    if (imgData.bitmap) {\n      imgToPaint = imgData.bitmap;\n    } else {\n      const w = imgData.width;\n      const h = imgData.height;\n\n      const tmpCanvas = this.cachedCanvases.getCanvas(\"inlineImage\", w, h);\n      const tmpCtx = tmpCanvas.context;\n      putBinaryImageData(tmpCtx, imgData);\n      imgToPaint = this.applyTransferMapsToCanvas(tmpCtx);\n    }\n\n    this.dependencyTracker?.resetBBox(opIdx);\n\n    for (const entry of map) {\n      ctx.save();\n      ctx.transform(...entry.transform);\n      ctx.scale(1, -1);\n      drawImageAtIntegerCoords(\n        ctx,\n        imgToPaint,\n        entry.x,\n        entry.y,\n        entry.w,\n        entry.h,\n        0,\n        -1,\n        1,\n        1\n      );\n      this.dependencyTracker?.recordBBox(opIdx, ctx, 0, 1, -1, 0);\n      ctx.restore();\n    }\n    this.dependencyTracker?.recordOperation(opIdx);\n    this.compose();\n  }\n\n  paintSolidColorImageMask(opIdx) {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.dependencyTracker\n      ?.resetBBox(opIdx)\n      .recordBBox(opIdx, this.ctx, 0, 1, 0, 1)\n      .recordDependencies(opIdx, Dependencies.fill)\n      .recordOperation(opIdx);\n    this.ctx.fillRect(0, 0, 1, 1);\n    this.compose();\n  }\n\n  // Marked content\n\n  markPoint(opIdx, tag) {\n    // TODO Marked content.\n  }\n\n  markPointProps(opIdx, tag, properties) {\n    // TODO Marked content.\n  }\n\n  beginMarkedContent(opIdx, tag) {\n    this.dependencyTracker?.beginMarkedContent(opIdx);\n    this.markedContentStack.push({\n      visible: true,\n    });\n  }\n\n  beginMarkedContentProps(opIdx, tag, properties) {\n    this.dependencyTracker?.beginMarkedContent(opIdx);\n    if (tag === \"OC\") {\n      this.markedContentStack.push({\n        visible: this.optionalContentConfig.isVisible(properties),\n      });\n    } else {\n      this.markedContentStack.push({\n        visible: true,\n      });\n    }\n    this.contentVisible = this.isContentVisible();\n  }\n\n  endMarkedContent(opIdx) {\n    this.dependencyTracker?.endMarkedContent(opIdx);\n    this.markedContentStack.pop();\n    this.contentVisible = this.isContentVisible();\n  }\n\n  // Compatibility\n\n  beginCompat(opIdx) {\n    // TODO ignore undefined operators (should we do that anyway?)\n  }\n\n  endCompat(opIdx) {\n    // TODO stop ignoring undefined operators\n  }\n\n  // Helper functions\n\n  consumePath(opIdx, path, clipBox) {\n    const isEmpty = this.current.isEmptyClip();\n    if (this.pendingClip) {\n      this.current.updateClipFromPath();\n    }\n    if (!this.pendingClip) {\n      this.compose(clipBox);\n    }\n    const ctx = this.ctx;\n    if (this.pendingClip) {\n      if (!isEmpty) {\n        if (this.pendingClip === EO_CLIP) {\n          ctx.clip(path, \"evenodd\");\n        } else {\n          ctx.clip(path);\n        }\n      }\n      this.pendingClip = null;\n      this.dependencyTracker\n        ?.bboxToClipBoxDropOperation(opIdx)\n        .recordFutureForcedDependency(\"clipPath\", opIdx);\n    } else {\n      this.dependencyTracker?.recordOperation(opIdx);\n    }\n\n    this.current.startNewPathAndClipBox(this.current.clipBox);\n  }\n\n  getSinglePixelWidth() {\n    if (!this._cachedGetSinglePixelWidth) {\n      const m = getCurrentTransform(this.ctx);\n      if (m[1] === 0 && m[2] === 0) {\n        // Fast path\n        this._cachedGetSinglePixelWidth =\n          1 / Math.min(Math.abs(m[0]), Math.abs(m[3]));\n      } else {\n        const absDet = Math.abs(m[0] * m[3] - m[2] * m[1]);\n        const normX = Math.hypot(m[0], m[2]);\n        const normY = Math.hypot(m[1], m[3]);\n        this._cachedGetSinglePixelWidth = Math.max(normX, normY) / absDet;\n      }\n    }\n    return this._cachedGetSinglePixelWidth;\n  }\n\n  getScaleForStroking() {\n    // A pixel has thicknessX = thicknessY = 1;\n    // A transformed pixel is a parallelogram and the thicknesses\n    // corresponds to the heights.\n    // The goal of this function is to rescale before setting the\n    // lineWidth in order to have both thicknesses greater or equal\n    // to 1 after transform.\n    if (this._cachedScaleForStroking[0] === -1) {\n      const { lineWidth } = this.current;\n      const { a, b, c, d } = this.ctx.getTransform();\n      let scaleX, scaleY;\n\n      if (b === 0 && c === 0) {\n        // Fast path\n        const normX = Math.abs(a);\n        const normY = Math.abs(d);\n        if (normX === normY) {\n          if (lineWidth === 0) {\n            scaleX = scaleY = 1 / normX;\n          } else {\n            const scaledLineWidth = normX * lineWidth;\n            scaleX = scaleY = scaledLineWidth < 1 ? 1 / scaledLineWidth : 1;\n          }\n        } else if (lineWidth === 0) {\n          scaleX = 1 / normX;\n          scaleY = 1 / normY;\n        } else {\n          const scaledXLineWidth = normX * lineWidth;\n          const scaledYLineWidth = normY * lineWidth;\n          scaleX = scaledXLineWidth < 1 ? 1 / scaledXLineWidth : 1;\n          scaleY = scaledYLineWidth < 1 ? 1 / scaledYLineWidth : 1;\n        }\n      } else {\n        // A pixel (base (x, y)) is transformed by M into a parallelogram:\n        //  - its area is |det(M)|;\n        //  - heightY (orthogonal to Mx) has a length: |det(M)| / norm(Mx);\n        //  - heightX (orthogonal to My) has a length: |det(M)| / norm(My).\n        // heightX and heightY are the thicknesses of the transformed pixel\n        // and they must be both greater or equal to 1.\n        const absDet = Math.abs(a * d - b * c);\n        const normX = Math.hypot(a, b);\n        const normY = Math.hypot(c, d);\n        if (lineWidth === 0) {\n          scaleX = normY / absDet;\n          scaleY = normX / absDet;\n        } else {\n          const baseArea = lineWidth * absDet;\n          scaleX = normY > baseArea ? normY / baseArea : 1;\n          scaleY = normX > baseArea ? normX / baseArea : 1;\n        }\n      }\n      this._cachedScaleForStroking[0] = scaleX;\n      this._cachedScaleForStroking[1] = scaleY;\n    }\n    return this._cachedScaleForStroking;\n  }\n\n  // Rescale before stroking in order to have a final lineWidth\n  // with both thicknesses greater or equal to 1.\n  rescaleAndStroke(path, saveRestore) {\n    const {\n      ctx,\n      current: { lineWidth },\n    } = this;\n    const [scaleX, scaleY] = this.getScaleForStroking();\n\n    if (scaleX === scaleY) {\n      ctx.lineWidth = (lineWidth || 1) * scaleX;\n      ctx.stroke(path);\n      return;\n    }\n\n    const dashes = ctx.getLineDash();\n    if (saveRestore) {\n      ctx.save();\n    }\n\n    ctx.scale(scaleX, scaleY);\n    SCALE_MATRIX.a = 1 / scaleX;\n    SCALE_MATRIX.d = 1 / scaleY;\n    const newPath = new Path2D();\n    newPath.addPath(path, SCALE_MATRIX);\n\n    // How the dashed line is rendered depends on the current transform...\n    // so we added a rescale to handle too thin lines and consequently\n    // the way the line is dashed will be modified.\n    // If scaleX === scaleY, the dashed lines will be rendered correctly\n    // else we'll have some bugs (but only with too thin lines).\n    // Here we take the max... why not taking the min... or something else.\n    // Anyway, as said it's buggy when scaleX !== scaleY.\n    if (dashes.length > 0) {\n      const scale = Math.max(scaleX, scaleY);\n      ctx.setLineDash(dashes.map(x => x / scale));\n      ctx.lineDashOffset /= scale;\n    }\n\n    ctx.lineWidth = lineWidth || 1;\n    ctx.stroke(newPath);\n\n    if (saveRestore) {\n      ctx.restore();\n    }\n  }\n\n  isContentVisible() {\n    for (let i = this.markedContentStack.length - 1; i >= 0; i--) {\n      if (!this.markedContentStack[i].visible) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\n\nfor (const op in OPS) {\n  if (CanvasGraphics.prototype[op] !== undefined) {\n    CanvasGraphics.prototype[OPS[op]] = CanvasGraphics.prototype[op];\n  }\n}\n\nexport { CanvasGraphics };\n","/* Copyright 2018 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nclass GlobalWorkerOptions {\n  static #port = null;\n\n  static #src = \"\";\n\n  /**\n   * @type {Worker | null}\n   */\n  static get workerPort() {\n    return this.#port;\n  }\n\n  /**\n   * @param {Worker | null} workerPort - Defines global port for worker process.\n   *   Overrides the `workerSrc` option.\n   */\n  static set workerPort(val) {\n    if (\n      !(typeof Worker !== \"undefined\" && val instanceof Worker) &&\n      val !== null\n    ) {\n      throw new Error(\"Invalid `workerPort` type.\");\n    }\n    this.#port = val;\n  }\n\n  /**\n   * @type {string}\n   */\n  static get workerSrc() {\n    return this.#src;\n  }\n\n  /**\n   * @param {string} workerSrc - A string containing the path and filename of\n   *   the worker file.\n   *\n   *   NOTE: The `workerSrc` option should always be set, in order to prevent\n   *         any issues when using the PDF.js library.\n   */\n  static set workerSrc(val) {\n    if (typeof val !== \"string\") {\n      throw new Error(\"Invalid `workerSrc` type.\");\n    }\n    this.#src = val;\n  }\n}\n\nexport { GlobalWorkerOptions };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nclass Metadata {\n  #map;\n\n  #data;\n\n  constructor({ parsedData, rawData }) {\n    this.#map = parsedData;\n    this.#data = rawData;\n  }\n\n  getRaw() {\n    return this.#data;\n  }\n\n  get(name) {\n    return this.#map.get(name) ?? null;\n  }\n\n  [Symbol.iterator]() {\n    return this.#map.entries();\n  }\n}\n\nexport { Metadata };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  info,\n  RenderingIntentFlag,\n  unreachable,\n  warn,\n} from \"../shared/util.js\";\nimport { MurmurHash3_64 } from \"../shared/murmurhash3.js\";\n\nconst INTERNAL = Symbol(\"INTERNAL\");\n\nclass OptionalContentGroup {\n  #isDisplay = false;\n\n  #isPrint = false;\n\n  #userSet = false;\n\n  #visible = true;\n\n  constructor(renderingIntent, { name, intent, usage, rbGroups }) {\n    this.#isDisplay = !!(renderingIntent & RenderingIntentFlag.DISPLAY);\n    this.#isPrint = !!(renderingIntent & RenderingIntentFlag.PRINT);\n\n    this.name = name;\n    this.intent = intent;\n    this.usage = usage;\n    this.rbGroups = rbGroups;\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get visible() {\n    if (this.#userSet) {\n      return this.#visible;\n    }\n    if (!this.#visible) {\n      return false;\n    }\n    const { print, view } = this.usage;\n\n    if (this.#isDisplay) {\n      return view?.viewState !== \"OFF\";\n    } else if (this.#isPrint) {\n      return print?.printState !== \"OFF\";\n    }\n    return true;\n  }\n\n  /**\n   * @ignore\n   */\n  _setVisible(internal, visible, userSet = false) {\n    if (internal !== INTERNAL) {\n      unreachable(\"Internal method `_setVisible` called.\");\n    }\n    this.#userSet = userSet;\n    this.#visible = visible;\n  }\n}\n\nclass OptionalContentConfig {\n  #cachedGetHash = null;\n\n  #groups = new Map();\n\n  #initialHash = null;\n\n  #order = null;\n\n  constructor(data, renderingIntent = RenderingIntentFlag.DISPLAY) {\n    this.renderingIntent = renderingIntent;\n\n    this.name = null;\n    this.creator = null;\n\n    if (data === null) {\n      return;\n    }\n    this.name = data.name;\n    this.creator = data.creator;\n    this.#order = data.order;\n    for (const group of data.groups) {\n      this.#groups.set(\n        group.id,\n        new OptionalContentGroup(renderingIntent, group)\n      );\n    }\n\n    if (data.baseState === \"OFF\") {\n      for (const group of this.#groups.values()) {\n        group._setVisible(INTERNAL, false);\n      }\n    }\n\n    for (const on of data.on) {\n      this.#groups.get(on)._setVisible(INTERNAL, true);\n    }\n\n    for (const off of data.off) {\n      this.#groups.get(off)._setVisible(INTERNAL, false);\n    }\n\n    // The following code must always run *last* in the constructor.\n    this.#initialHash = this.getHash();\n  }\n\n  #evaluateVisibilityExpression(array) {\n    const length = array.length;\n    if (length < 2) {\n      return true;\n    }\n    const operator = array[0];\n    for (let i = 1; i < length; i++) {\n      const element = array[i];\n      let state;\n      if (Array.isArray(element)) {\n        state = this.#evaluateVisibilityExpression(element);\n      } else if (this.#groups.has(element)) {\n        state = this.#groups.get(element).visible;\n      } else {\n        warn(`Optional content group not found: ${element}`);\n        return true;\n      }\n      switch (operator) {\n        case \"And\":\n          if (!state) {\n            return false;\n          }\n          break;\n        case \"Or\":\n          if (state) {\n            return true;\n          }\n          break;\n        case \"Not\":\n          return !state;\n        default:\n          return true;\n      }\n    }\n    return operator === \"And\";\n  }\n\n  isVisible(group) {\n    if (this.#groups.size === 0) {\n      return true;\n    }\n    if (!group) {\n      info(\"Optional content group not defined.\");\n      return true;\n    }\n    if (group.type === \"OCG\") {\n      if (!this.#groups.has(group.id)) {\n        warn(`Optional content group not found: ${group.id}`);\n        return true;\n      }\n      return this.#groups.get(group.id).visible;\n    } else if (group.type === \"OCMD\") {\n      // Per the spec, the expression should be preferred if available.\n      if (group.expression) {\n        return this.#evaluateVisibilityExpression(group.expression);\n      }\n      if (!group.policy || group.policy === \"AnyOn\") {\n        // Default\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (this.#groups.get(id).visible) {\n            return true;\n          }\n        }\n        return false;\n      } else if (group.policy === \"AllOn\") {\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (!this.#groups.get(id).visible) {\n            return false;\n          }\n        }\n        return true;\n      } else if (group.policy === \"AnyOff\") {\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (!this.#groups.get(id).visible) {\n            return true;\n          }\n        }\n        return false;\n      } else if (group.policy === \"AllOff\") {\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (this.#groups.get(id).visible) {\n            return false;\n          }\n        }\n        return true;\n      }\n      warn(`Unknown optional content policy ${group.policy}.`);\n      return true;\n    }\n    warn(`Unknown group type ${group.type}.`);\n    return true;\n  }\n\n  setVisibility(id, visible = true, preserveRB = true) {\n    const group = this.#groups.get(id);\n    if (!group) {\n      warn(`Optional content group not found: ${id}`);\n      return;\n    }\n\n    // If the visibility is about to be set to `true` and the group belongs to\n    // any radiobutton groups, hide all other OCGs in these radiobutton groups,\n    // provided that radiobutton state relationships are to be preserved.\n    if (preserveRB && visible && group.rbGroups.length) {\n      for (const rbGroup of group.rbGroups) {\n        for (const otherId of rbGroup) {\n          if (otherId !== id) {\n            this.#groups.get(otherId)?._setVisible(INTERNAL, false, true);\n          }\n        }\n      }\n    }\n\n    group._setVisible(INTERNAL, !!visible, /* userSet = */ true);\n\n    this.#cachedGetHash = null;\n  }\n\n  setOCGState({ state, preserveRB }) {\n    let operator;\n\n    for (const elem of state) {\n      switch (elem) {\n        case \"ON\":\n        case \"OFF\":\n        case \"Toggle\":\n          operator = elem;\n          continue;\n      }\n\n      const group = this.#groups.get(elem);\n      if (!group) {\n        continue;\n      }\n      switch (operator) {\n        case \"ON\":\n          this.setVisibility(elem, true, preserveRB);\n          break;\n        case \"OFF\":\n          this.setVisibility(elem, false, preserveRB);\n          break;\n        case \"Toggle\":\n          this.setVisibility(elem, !group.visible, preserveRB);\n          break;\n      }\n    }\n\n    this.#cachedGetHash = null;\n  }\n\n  get hasInitialVisibility() {\n    return this.#initialHash === null || this.getHash() === this.#initialHash;\n  }\n\n  getOrder() {\n    if (!this.#groups.size) {\n      return null;\n    }\n    if (this.#order) {\n      return this.#order.slice();\n    }\n    return [...this.#groups.keys()];\n  }\n\n  getGroup(id) {\n    return this.#groups.get(id) || null;\n  }\n\n  getHash() {\n    if (this.#cachedGetHash !== null) {\n      return this.#cachedGetHash;\n    }\n    const hash = new MurmurHash3_64();\n\n    for (const [id, group] of this.#groups) {\n      hash.update(`${id}:${group.visible}`);\n    }\n    return (this.#cachedGetHash = hash.hexdigest());\n  }\n\n  [Symbol.iterator]() {\n    return this.#groups.entries();\n  }\n}\n\nexport { OptionalContentConfig };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"../interfaces\").IPDFStream} IPDFStream */\n/** @typedef {import(\"../interfaces\").IPDFStreamReader} IPDFStreamReader */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../interfaces\").IPDFStreamRangeReader} IPDFStreamRangeReader */\n\nimport { assert } from \"../shared/util.js\";\nimport { isPdfFile } from \"./display_utils.js\";\n\n/** @implements {IPDFStream} */\nclass PDFDataTransportStream {\n  constructor(\n    pdfDataRangeTransport,\n    { disableRange = false, disableStream = false }\n  ) {\n    assert(\n      pdfDataRangeTransport,\n      'PDFDataTransportStream - missing required \"pdfDataRangeTransport\" argument.'\n    );\n    const { length, initialData, progressiveDone, contentDispositionFilename } =\n      pdfDataRangeTransport;\n\n    this._queuedChunks = [];\n    this._progressiveDone = progressiveDone;\n    this._contentDispositionFilename = contentDispositionFilename;\n\n    if (initialData?.length > 0) {\n      // Prevent any possible issues by only transferring a Uint8Array that\n      // completely \"utilizes\" its underlying ArrayBuffer.\n      const buffer =\n        initialData instanceof Uint8Array &&\n        initialData.byteLength === initialData.buffer.byteLength\n          ? initialData.buffer\n          : new Uint8Array(initialData).buffer;\n      this._queuedChunks.push(buffer);\n    }\n\n    this._pdfDataRangeTransport = pdfDataRangeTransport;\n    this._isStreamingSupported = !disableStream;\n    this._isRangeSupported = !disableRange;\n    this._contentLength = length;\n\n    this._fullRequestReader = null;\n    this._rangeReaders = [];\n\n    pdfDataRangeTransport.addRangeListener((begin, chunk) => {\n      this._onReceiveData({ begin, chunk });\n    });\n\n    pdfDataRangeTransport.addProgressListener((loaded, total) => {\n      this._onProgress({ loaded, total });\n    });\n\n    pdfDataRangeTransport.addProgressiveReadListener(chunk => {\n      this._onReceiveData({ chunk });\n    });\n\n    pdfDataRangeTransport.addProgressiveDoneListener(() => {\n      this._onProgressiveDone();\n    });\n\n    pdfDataRangeTransport.transportReady();\n  }\n\n  _onReceiveData({ begin, chunk }) {\n    // Prevent any possible issues by only transferring a Uint8Array that\n    // completely \"utilizes\" its underlying ArrayBuffer.\n    const buffer =\n      chunk instanceof Uint8Array &&\n      chunk.byteLength === chunk.buffer.byteLength\n        ? chunk.buffer\n        : new Uint8Array(chunk).buffer;\n\n    if (begin === undefined) {\n      if (this._fullRequestReader) {\n        this._fullRequestReader._enqueue(buffer);\n      } else {\n        this._queuedChunks.push(buffer);\n      }\n    } else {\n      const found = this._rangeReaders.some(function (rangeReader) {\n        if (rangeReader._begin !== begin) {\n          return false;\n        }\n        rangeReader._enqueue(buffer);\n        return true;\n      });\n      assert(\n        found,\n        \"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.\"\n      );\n    }\n  }\n\n  get _progressiveDataLength() {\n    return this._fullRequestReader?._loaded ?? 0;\n  }\n\n  _onProgress(evt) {\n    if (evt.total === undefined) {\n      // Reporting to first range reader, if it exists.\n      this._rangeReaders[0]?.onProgress?.({ loaded: evt.loaded });\n    } else {\n      this._fullRequestReader?.onProgress?.({\n        loaded: evt.loaded,\n        total: evt.total,\n      });\n    }\n  }\n\n  _onProgressiveDone() {\n    this._fullRequestReader?.progressiveDone();\n    this._progressiveDone = true;\n  }\n\n  _removeRangeReader(reader) {\n    const i = this._rangeReaders.indexOf(reader);\n    if (i >= 0) {\n      this._rangeReaders.splice(i, 1);\n    }\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFDataTransportStream.getFullReader can only be called once.\"\n    );\n    const queuedChunks = this._queuedChunks;\n    this._queuedChunks = null;\n    return new PDFDataTransportStreamReader(\n      this,\n      queuedChunks,\n      this._progressiveDone,\n      this._contentDispositionFilename\n    );\n  }\n\n  getRangeReader(begin, end) {\n    if (end <= this._progressiveDataLength) {\n      return null;\n    }\n    const reader = new PDFDataTransportStreamRangeReader(this, begin, end);\n    this._pdfDataRangeTransport.requestDataRange(begin, end);\n    this._rangeReaders.push(reader);\n    return reader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n    this._pdfDataRangeTransport.abort();\n  }\n}\n\n/** @implements {IPDFStreamReader} */\nclass PDFDataTransportStreamReader {\n  constructor(\n    stream,\n    queuedChunks,\n    progressiveDone = false,\n    contentDispositionFilename = null\n  ) {\n    this._stream = stream;\n    this._done = progressiveDone || false;\n    this._filename = isPdfFile(contentDispositionFilename)\n      ? contentDispositionFilename\n      : null;\n    this._queuedChunks = queuedChunks || [];\n    this._loaded = 0;\n    for (const chunk of this._queuedChunks) {\n      this._loaded += chunk.byteLength;\n    }\n    this._requests = [];\n    this._headersReady = Promise.resolve();\n    stream._fullRequestReader = this;\n\n    this.onProgress = null;\n  }\n\n  _enqueue(chunk) {\n    if (this._done) {\n      return; // Ignore new data.\n    }\n    if (this._requests.length > 0) {\n      const requestCapability = this._requests.shift();\n      requestCapability.resolve({ value: chunk, done: false });\n    } else {\n      this._queuedChunks.push(chunk);\n    }\n    this._loaded += chunk.byteLength;\n  }\n\n  get headersReady() {\n    return this._headersReady;\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get isRangeSupported() {\n    return this._stream._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._stream._isStreamingSupported;\n  }\n\n  get contentLength() {\n    return this._stream._contentLength;\n  }\n\n  async read() {\n    if (this._queuedChunks.length > 0) {\n      const chunk = this._queuedChunks.shift();\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n  }\n\n  progressiveDone() {\n    if (this._done) {\n      return;\n    }\n    this._done = true;\n  }\n}\n\n/** @implements {IPDFStreamRangeReader} */\nclass PDFDataTransportStreamRangeReader {\n  constructor(stream, begin, end) {\n    this._stream = stream;\n    this._begin = begin;\n    this._end = end;\n    this._queuedChunk = null;\n    this._requests = [];\n    this._done = false;\n\n    this.onProgress = null;\n  }\n\n  _enqueue(chunk) {\n    if (this._done) {\n      return; // ignore new data\n    }\n    if (this._requests.length === 0) {\n      this._queuedChunk = chunk;\n    } else {\n      const requestsCapability = this._requests.shift();\n      requestsCapability.resolve({ value: chunk, done: false });\n      for (const requestCapability of this._requests) {\n        requestCapability.resolve({ value: undefined, done: true });\n      }\n      this._requests.length = 0;\n    }\n    this._done = true;\n    this._stream._removeRangeReader(this);\n  }\n\n  get isStreamingSupported() {\n    return false;\n  }\n\n  async read() {\n    if (this._queuedChunk) {\n      const chunk = this._queuedChunk;\n      this._queuedChunk = null;\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    this._stream._removeRangeReader(this);\n  }\n}\n\nexport { PDFDataTransportStream };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert, ResponseException } from \"../shared/util.js\";\nimport { getFilenameFromContentDispositionHeader } from \"./content_disposition.js\";\nimport { isPdfFile } from \"./display_utils.js\";\n\nfunction createHeaders(isHttp, httpHeaders) {\n  const headers = new Headers();\n\n  if (!isHttp || !httpHeaders || typeof httpHeaders !== \"object\") {\n    return headers;\n  }\n  for (const key in httpHeaders) {\n    const val = httpHeaders[key];\n    if (val !== undefined) {\n      headers.append(key, val);\n    }\n  }\n  return headers;\n}\n\nfunction getResponseOrigin(url) {\n  // Notably, null is distinct from \"null\" string (e.g. from file:-URLs).\n  return URL.parse(url)?.origin ?? null;\n}\n\nfunction validateRangeRequestCapabilities({\n  responseHeaders,\n  isHttp,\n  rangeChunkSize,\n  disableRange,\n}) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    assert(\n      Number.isInteger(rangeChunkSize) && rangeChunkSize > 0,\n      \"rangeChunkSize must be an integer larger than zero.\"\n    );\n  }\n  const returnValues = {\n    allowRangeRequests: false,\n    suggestedLength: undefined,\n  };\n\n  const length = parseInt(responseHeaders.get(\"Content-Length\"), 10);\n  if (!Number.isInteger(length)) {\n    return returnValues;\n  }\n\n  returnValues.suggestedLength = length;\n\n  if (length <= 2 * rangeChunkSize) {\n    // The file size is smaller than the size of two chunks, so it does not\n    // make any sense to abort the request and retry with a range request.\n    return returnValues;\n  }\n\n  if (disableRange || !isHttp) {\n    return returnValues;\n  }\n  if (responseHeaders.get(\"Accept-Ranges\") !== \"bytes\") {\n    return returnValues;\n  }\n\n  const contentEncoding = responseHeaders.get(\"Content-Encoding\") || \"identity\";\n  if (contentEncoding !== \"identity\") {\n    return returnValues;\n  }\n\n  returnValues.allowRangeRequests = true;\n  return returnValues;\n}\n\nfunction extractFilenameFromHeader(responseHeaders) {\n  const contentDisposition = responseHeaders.get(\"Content-Disposition\");\n  if (contentDisposition) {\n    let filename = getFilenameFromContentDispositionHeader(contentDisposition);\n    if (filename.includes(\"%\")) {\n      try {\n        filename = decodeURIComponent(filename);\n      } catch {}\n    }\n    if (isPdfFile(filename)) {\n      return filename;\n    }\n  }\n  return null;\n}\n\nfunction createResponseError(status, url) {\n  return new ResponseException(\n    `Unexpected server response (${status}) while retrieving PDF \"${url}\".`,\n    status,\n    /* missing = */ status === 404 || (status === 0 && url.startsWith(\"file:\"))\n  );\n}\n\nfunction validateResponseStatus(status) {\n  return status === 200 || status === 206;\n}\n\nexport {\n  createHeaders,\n  createResponseError,\n  extractFilenameFromHeader,\n  getResponseOrigin,\n  validateRangeRequestCapabilities,\n  validateResponseStatus,\n};\n","/* Copyright 2017 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { stringToBytes } from \"../shared/util.js\";\n\n// This getFilenameFromContentDispositionHeader function is adapted from\n// https://github.com/Rob--W/open-in-browser/blob/7e2e35a38b8b4e981b11da7b2f01df0149049e92/extension/content-disposition.js\n// with the following changes:\n// - Modified to conform to PDF.js's coding style.\n// - Move return to the end of the function to prevent Babel from dropping the\n//   function declarations.\n\n/**\n * Extract file name from the Content-Disposition HTTP response header.\n *\n * @param {string} contentDisposition\n * @returns {string} Filename, if found in the Content-Disposition header.\n */\nfunction getFilenameFromContentDispositionHeader(contentDisposition) {\n  let needsEncodingFixup = true;\n\n  // filename*=ext-value (\"ext-value\" from RFC 5987, referenced by RFC 6266).\n  let tmp = toParamRegExp(\"filename\\\\*\", \"i\").exec(contentDisposition);\n  if (tmp) {\n    tmp = tmp[1];\n    let filename = rfc2616unquote(tmp);\n    filename = unescape(filename);\n    filename = rfc5987decode(filename);\n    filename = rfc2047decode(filename);\n    return fixupEncoding(filename);\n  }\n\n  // Continuations (RFC 2231 section 3, referenced by RFC 5987 section 3.1).\n  // filename*n*=part\n  // filename*n=part\n  tmp = rfc2231getparam(contentDisposition);\n  if (tmp) {\n    // RFC 2047, section\n    const filename = rfc2047decode(tmp);\n    return fixupEncoding(filename);\n  }\n\n  // filename=value (RFC 5987, section 4.1).\n  tmp = toParamRegExp(\"filename\", \"i\").exec(contentDisposition);\n  if (tmp) {\n    tmp = tmp[1];\n    let filename = rfc2616unquote(tmp);\n    filename = rfc2047decode(filename);\n    return fixupEncoding(filename);\n  }\n\n  // After this line there are only function declarations. We cannot put\n  // \"return\" here for readability because babel would then drop the function\n  // declarations...\n  function toParamRegExp(attributePattern, flags) {\n    return new RegExp(\n      \"(?:^|;)\\\\s*\" +\n        attributePattern +\n        \"\\\\s*=\\\\s*\" +\n        // Captures: value = token | quoted-string\n        // (RFC 2616, section 3.6 and referenced by RFC 6266 4.1)\n        \"(\" +\n        '[^\";\\\\s][^;\\\\s]*' +\n        \"|\" +\n        '\"(?:[^\"\\\\\\\\]|\\\\\\\\\"?)+\"?' +\n        \")\",\n      flags\n    );\n  }\n  function textdecode(encoding, value) {\n    if (encoding) {\n      if (!/^[\\x00-\\xFF]+$/.test(value)) {\n        return value;\n      }\n      try {\n        const decoder = new TextDecoder(encoding, { fatal: true });\n        const buffer = stringToBytes(value);\n        value = decoder.decode(buffer);\n        needsEncodingFixup = false;\n      } catch {\n        // TextDecoder constructor threw - unrecognized encoding.\n      }\n    }\n    return value;\n  }\n  function fixupEncoding(value) {\n    if (needsEncodingFixup && /[\\x80-\\xff]/.test(value)) {\n      // Maybe multi-byte UTF-8.\n      value = textdecode(\"utf-8\", value);\n      if (needsEncodingFixup) {\n        // Try iso-8859-1 encoding.\n        value = textdecode(\"iso-8859-1\", value);\n      }\n    }\n    return value;\n  }\n  function rfc2231getparam(contentDispositionStr) {\n    const matches = [];\n    let match;\n    // Iterate over all filename*n= and filename*n*= with n being an integer\n    // of at least zero. Any non-zero number must not start with '0'.\n    const iter = toParamRegExp(\"filename\\\\*((?!0\\\\d)\\\\d+)(\\\\*?)\", \"ig\");\n    while ((match = iter.exec(contentDispositionStr)) !== null) {\n      let [, n, quot, part] = match; // eslint-disable-line prefer-const\n      n = parseInt(n, 10);\n      if (n in matches) {\n        // Ignore anything after the invalid second filename*0.\n        if (n === 0) {\n          break;\n        }\n        continue;\n      }\n      matches[n] = [quot, part];\n    }\n    const parts = [];\n    for (let n = 0; n < matches.length; ++n) {\n      if (!(n in matches)) {\n        // Numbers must be consecutive. Truncate when there is a hole.\n        break;\n      }\n      let [quot, part] = matches[n]; // eslint-disable-line prefer-const\n      part = rfc2616unquote(part);\n      if (quot) {\n        part = unescape(part);\n        if (n === 0) {\n          part = rfc5987decode(part);\n        }\n      }\n      parts.push(part);\n    }\n    return parts.join(\"\");\n  }\n  function rfc2616unquote(value) {\n    if (value.startsWith('\"')) {\n      const parts = value.slice(1).split('\\\\\"');\n      // Find the first unescaped \" and terminate there.\n      for (let i = 0; i < parts.length; ++i) {\n        const quotindex = parts[i].indexOf('\"');\n        if (quotindex !== -1) {\n          parts[i] = parts[i].slice(0, quotindex);\n          parts.length = i + 1; // Truncates and stop the iteration.\n        }\n        parts[i] = parts[i].replaceAll(/\\\\(.)/g, \"$1\");\n      }\n      value = parts.join('\"');\n    }\n    return value;\n  }\n  function rfc5987decode(extvalue) {\n    // Decodes \"ext-value\" from RFC 5987.\n    const encodingend = extvalue.indexOf(\"'\");\n    if (encodingend === -1) {\n      // Some servers send \"filename*=\" without encoding 'language' prefix,\n      // e.g. in https://github.com/Rob--W/open-in-browser/issues/26\n      // Let's accept the value like Firefox (57) (Chrome 62 rejects it).\n      return extvalue;\n    }\n    const encoding = extvalue.slice(0, encodingend);\n    const langvalue = extvalue.slice(encodingend + 1);\n    // Ignore language (RFC 5987 section 3.2.1, and RFC 6266 section 4.1 ).\n    const value = langvalue.replace(/^[^']*'/, \"\");\n    return textdecode(encoding, value);\n  }\n  function rfc2047decode(value) {\n    // RFC 2047-decode the result. Firefox tried to drop support for it, but\n    // backed out because some servers use it - https://bugzil.la/875615\n    // Firefox's condition for decoding is here: https://searchfox.org/mozilla-central/rev/4a590a5a15e35d88a3b23dd6ac3c471cf85b04a8/netwerk/mime/nsMIMEHeaderParamImpl.cpp#742-748\n\n    // We are more strict and only recognize RFC 2047-encoding if the value\n    // starts with \"=?\", since then it is likely that the full value is\n    // RFC 2047-encoded.\n\n    // Firefox also decodes words even where RFC 2047 section 5 states:\n    // \"An 'encoded-word' MUST NOT appear within a 'quoted-string'.\"\n    if (!value.startsWith(\"=?\") || /[\\x00-\\x19\\x80-\\xff]/.test(value)) {\n      return value;\n    }\n    // RFC 2047, section 2.4\n    // encoded-word = \"=?\" charset \"?\" encoding \"?\" encoded-text \"?=\"\n    // charset = token (but let's restrict to characters that denote a\n    //       possibly valid encoding).\n    // encoding = q or b\n    // encoded-text = any printable ASCII character other than ? or space.\n    //        ... but Firefox permits ? and space.\n    return value.replaceAll(\n      /=\\?([\\w-]*)\\?([QqBb])\\?((?:[^?]|\\?(?!=))*)\\?=/g,\n      function (matches, charset, encoding, text) {\n        if (encoding === \"q\" || encoding === \"Q\") {\n          // RFC 2047 section 4.2.\n          text = text.replaceAll(\"_\", \" \");\n          text = text.replaceAll(/=([0-9a-fA-F]{2})/g, function (match, hex) {\n            return String.fromCharCode(parseInt(hex, 16));\n          });\n          return textdecode(charset, text);\n        } // else encoding is b or B - base64 (RFC 2047 section 4.1)\n        try {\n          text = atob(text);\n        } catch {}\n        return textdecode(charset, text);\n      }\n    );\n  }\n\n  return \"\";\n}\n\nexport { getFilenameFromContentDispositionHeader };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AbortException, assert, warn } from \"../shared/util.js\";\nimport {\n  createHeaders,\n  createResponseError,\n  extractFilenameFromHeader,\n  getResponseOrigin,\n  validateRangeRequestCapabilities,\n  validateResponseStatus,\n} from \"./network_utils.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./fetch_stream.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nfunction createFetchOptions(headers, withCredentials, abortController) {\n  return {\n    method: \"GET\",\n    headers,\n    signal: abortController.signal,\n    mode: \"cors\",\n    credentials: withCredentials ? \"include\" : \"same-origin\",\n    redirect: \"follow\",\n  };\n}\n\nfunction getArrayBuffer(val) {\n  if (val instanceof Uint8Array) {\n    return val.buffer;\n  }\n  if (val instanceof ArrayBuffer) {\n    return val;\n  }\n  warn(`getArrayBuffer - unexpected data format: ${val}`);\n  return new Uint8Array(val).buffer;\n}\n\n/** @implements {IPDFStream} */\nclass PDFFetchStream {\n  _responseOrigin = null;\n\n  constructor(source) {\n    this.source = source;\n    this.isHttp = /^https?:/i.test(source.url);\n    this.headers = createHeaders(this.isHttp, source.httpHeaders);\n\n    this._fullRequestReader = null;\n    this._rangeRequestReaders = [];\n  }\n\n  get _progressiveDataLength() {\n    return this._fullRequestReader?._loaded ?? 0;\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFFetchStream.getFullReader can only be called once.\"\n    );\n    this._fullRequestReader = new PDFFetchStreamReader(this);\n    return this._fullRequestReader;\n  }\n\n  getRangeReader(begin, end) {\n    if (end <= this._progressiveDataLength) {\n      return null;\n    }\n    const reader = new PDFFetchStreamRangeReader(this, begin, end);\n    this._rangeRequestReaders.push(reader);\n    return reader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeRequestReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n  }\n}\n\n/** @implements {IPDFStreamReader} */\nclass PDFFetchStreamReader {\n  constructor(stream) {\n    this._stream = stream;\n    this._reader = null;\n    this._loaded = 0;\n    this._filename = null;\n    const source = stream.source;\n    this._withCredentials = source.withCredentials || false;\n    this._contentLength = source.length;\n    this._headersCapability = Promise.withResolvers();\n    this._disableRange = source.disableRange || false;\n    this._rangeChunkSize = source.rangeChunkSize;\n    if (!this._rangeChunkSize && !this._disableRange) {\n      this._disableRange = true;\n    }\n\n    this._abortController = new AbortController();\n    this._isStreamingSupported = !source.disableStream;\n    this._isRangeSupported = !source.disableRange;\n    // Always create a copy of the headers.\n    const headers = new Headers(stream.headers);\n\n    const url = source.url;\n    fetch(\n      url,\n      createFetchOptions(headers, this._withCredentials, this._abortController)\n    )\n      .then(response => {\n        stream._responseOrigin = getResponseOrigin(response.url);\n\n        if (!validateResponseStatus(response.status)) {\n          throw createResponseError(response.status, url);\n        }\n        this._reader = response.body.getReader();\n        this._headersCapability.resolve();\n\n        const responseHeaders = response.headers;\n\n        const { allowRangeRequests, suggestedLength } =\n          validateRangeRequestCapabilities({\n            responseHeaders,\n            isHttp: stream.isHttp,\n            rangeChunkSize: this._rangeChunkSize,\n            disableRange: this._disableRange,\n          });\n\n        this._isRangeSupported = allowRangeRequests;\n        // Setting right content length.\n        this._contentLength = suggestedLength || this._contentLength;\n\n        this._filename = extractFilenameFromHeader(responseHeaders);\n\n        // We need to stop reading when range is supported and streaming is\n        // disabled.\n        if (!this._isStreamingSupported && this._isRangeSupported) {\n          this.cancel(new AbortException(\"Streaming is disabled.\"));\n        }\n      })\n      .catch(this._headersCapability.reject);\n\n    this.onProgress = null;\n  }\n\n  get headersReady() {\n    return this._headersCapability.promise;\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get contentLength() {\n    return this._contentLength;\n  }\n\n  get isRangeSupported() {\n    return this._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._headersCapability.promise;\n    const { value, done } = await this._reader.read();\n    if (done) {\n      return { value, done };\n    }\n    this._loaded += value.byteLength;\n    this.onProgress?.({\n      loaded: this._loaded,\n      total: this._contentLength,\n    });\n\n    return { value: getArrayBuffer(value), done: false };\n  }\n\n  cancel(reason) {\n    this._reader?.cancel(reason);\n    this._abortController.abort();\n  }\n}\n\n/** @implements {IPDFStreamRangeReader} */\nclass PDFFetchStreamRangeReader {\n  constructor(stream, begin, end) {\n    this._stream = stream;\n    this._reader = null;\n    this._loaded = 0;\n    const source = stream.source;\n    this._withCredentials = source.withCredentials || false;\n    this._readCapability = Promise.withResolvers();\n    this._isStreamingSupported = !source.disableStream;\n\n    this._abortController = new AbortController();\n    // Always create a copy of the headers.\n    const headers = new Headers(stream.headers);\n    headers.append(\"Range\", `bytes=${begin}-${end - 1}`);\n\n    const url = source.url;\n    fetch(\n      url,\n      createFetchOptions(headers, this._withCredentials, this._abortController)\n    )\n      .then(response => {\n        const responseOrigin = getResponseOrigin(response.url);\n\n        if (responseOrigin !== stream._responseOrigin) {\n          throw new Error(\n            `Expected range response-origin \"${responseOrigin}\" to match \"${stream._responseOrigin}\".`\n          );\n        }\n        if (!validateResponseStatus(response.status)) {\n          throw createResponseError(response.status, url);\n        }\n        this._readCapability.resolve();\n        this._reader = response.body.getReader();\n      })\n      .catch(this._readCapability.reject);\n\n    this.onProgress = null;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._readCapability.promise;\n    const { value, done } = await this._reader.read();\n    if (done) {\n      return { value, done };\n    }\n    this._loaded += value.byteLength;\n    this.onProgress?.({ loaded: this._loaded });\n\n    return { value: getArrayBuffer(value), done: false };\n  }\n\n  cancel(reason) {\n    this._reader?.cancel(reason);\n    this._abortController.abort();\n  }\n}\n\nexport { PDFFetchStream };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert, stringToBytes, warn } from \"../shared/util.js\";\nimport {\n  createHeaders,\n  createResponseError,\n  extractFilenameFromHeader,\n  getResponseOrigin,\n  validateRangeRequestCapabilities,\n} from \"./network_utils.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./network.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nconst OK_RESPONSE = 200;\nconst PARTIAL_CONTENT_RESPONSE = 206;\n\nfunction getArrayBuffer(xhr) {\n  const data = xhr.response;\n  if (typeof data !== \"string\") {\n    return data;\n  }\n  return stringToBytes(data).buffer;\n}\n\nclass NetworkManager {\n  _responseOrigin = null;\n\n  constructor({ url, httpHeaders, withCredentials }) {\n    this.url = url;\n    this.isHttp = /^https?:/i.test(url);\n    this.headers = createHeaders(this.isHttp, httpHeaders);\n    this.withCredentials = withCredentials || false;\n\n    this.currXhrId = 0;\n    this.pendingRequests = Object.create(null);\n  }\n\n  request(args) {\n    const xhr = new XMLHttpRequest();\n    const xhrId = this.currXhrId++;\n    const pendingRequest = (this.pendingRequests[xhrId] = { xhr });\n\n    xhr.open(\"GET\", this.url);\n    xhr.withCredentials = this.withCredentials;\n    for (const [key, val] of this.headers) {\n      xhr.setRequestHeader(key, val);\n    }\n    if (this.isHttp && \"begin\" in args && \"end\" in args) {\n      xhr.setRequestHeader(\"Range\", `bytes=${args.begin}-${args.end - 1}`);\n      pendingRequest.expectedStatus = PARTIAL_CONTENT_RESPONSE;\n    } else {\n      pendingRequest.expectedStatus = OK_RESPONSE;\n    }\n    xhr.responseType = \"arraybuffer\";\n\n    assert(args.onError, \"Expected `onError` callback to be provided.\");\n    xhr.onerror = () => {\n      args.onError(xhr.status);\n    };\n    xhr.onreadystatechange = this.onStateChange.bind(this, xhrId);\n    xhr.onprogress = this.onProgress.bind(this, xhrId);\n\n    pendingRequest.onHeadersReceived = args.onHeadersReceived;\n    pendingRequest.onDone = args.onDone;\n    pendingRequest.onError = args.onError;\n    pendingRequest.onProgress = args.onProgress;\n\n    xhr.send(null);\n\n    return xhrId;\n  }\n\n  onProgress(xhrId, evt) {\n    const pendingRequest = this.pendingRequests[xhrId];\n    if (!pendingRequest) {\n      return; // Maybe abortRequest was called...\n    }\n    pendingRequest.onProgress?.(evt);\n  }\n\n  onStateChange(xhrId, evt) {\n    const pendingRequest = this.pendingRequests[xhrId];\n    if (!pendingRequest) {\n      return; // Maybe abortRequest was called...\n    }\n\n    const xhr = pendingRequest.xhr;\n    if (xhr.readyState >= 2 && pendingRequest.onHeadersReceived) {\n      pendingRequest.onHeadersReceived();\n      delete pendingRequest.onHeadersReceived;\n    }\n\n    if (xhr.readyState !== 4) {\n      return;\n    }\n\n    if (!(xhrId in this.pendingRequests)) {\n      // The XHR request might have been aborted in onHeadersReceived()\n      // callback, in which case we should abort request.\n      return;\n    }\n\n    delete this.pendingRequests[xhrId];\n\n    // Success status == 0 can be on ftp, file and other protocols.\n    if (xhr.status === 0 && this.isHttp) {\n      pendingRequest.onError(xhr.status);\n      return;\n    }\n    const xhrStatus = xhr.status || OK_RESPONSE;\n\n    // From http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.35.2:\n    // \"A server MAY ignore the Range header\". This means it's possible to\n    // get a 200 rather than a 206 response from a range request.\n    const ok_response_on_range_request =\n      xhrStatus === OK_RESPONSE &&\n      pendingRequest.expectedStatus === PARTIAL_CONTENT_RESPONSE;\n\n    if (\n      !ok_response_on_range_request &&\n      xhrStatus !== pendingRequest.expectedStatus\n    ) {\n      pendingRequest.onError(xhr.status);\n      return;\n    }\n\n    const chunk = getArrayBuffer(xhr);\n    if (xhrStatus === PARTIAL_CONTENT_RESPONSE) {\n      const rangeHeader = xhr.getResponseHeader(\"Content-Range\");\n      const matches = /bytes (\\d+)-(\\d+)\\/(\\d+)/.exec(rangeHeader);\n      if (matches) {\n        pendingRequest.onDone({\n          begin: parseInt(matches[1], 10),\n          chunk,\n        });\n      } else {\n        warn(`Missing or invalid \"Content-Range\" header.`);\n        pendingRequest.onError(0);\n      }\n    } else if (chunk) {\n      pendingRequest.onDone({\n        begin: 0,\n        chunk,\n      });\n    } else {\n      pendingRequest.onError(xhr.status);\n    }\n  }\n\n  getRequestXhr(xhrId) {\n    return this.pendingRequests[xhrId].xhr;\n  }\n\n  isPendingRequest(xhrId) {\n    return xhrId in this.pendingRequests;\n  }\n\n  abortRequest(xhrId) {\n    const xhr = this.pendingRequests[xhrId].xhr;\n    delete this.pendingRequests[xhrId];\n    xhr.abort();\n  }\n}\n\n/** @implements {IPDFStream} */\nclass PDFNetworkStream {\n  constructor(source) {\n    this._source = source;\n    this._manager = new NetworkManager(source);\n    this._rangeChunkSize = source.rangeChunkSize;\n    this._fullRequestReader = null;\n    this._rangeRequestReaders = [];\n  }\n\n  _onRangeRequestReaderClosed(reader) {\n    const i = this._rangeRequestReaders.indexOf(reader);\n    if (i >= 0) {\n      this._rangeRequestReaders.splice(i, 1);\n    }\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFNetworkStream.getFullReader can only be called once.\"\n    );\n    this._fullRequestReader = new PDFNetworkStreamFullRequestReader(\n      this._manager,\n      this._source\n    );\n    return this._fullRequestReader;\n  }\n\n  getRangeReader(begin, end) {\n    const reader = new PDFNetworkStreamRangeRequestReader(\n      this._manager,\n      begin,\n      end\n    );\n    reader.onClosed = this._onRangeRequestReaderClosed.bind(this);\n    this._rangeRequestReaders.push(reader);\n    return reader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeRequestReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n  }\n}\n\n/** @implements {IPDFStreamReader} */\nclass PDFNetworkStreamFullRequestReader {\n  constructor(manager, source) {\n    this._manager = manager;\n\n    this._url = source.url;\n    this._fullRequestId = manager.request({\n      onHeadersReceived: this._onHeadersReceived.bind(this),\n      onDone: this._onDone.bind(this),\n      onError: this._onError.bind(this),\n      onProgress: this._onProgress.bind(this),\n    });\n    this._headersCapability = Promise.withResolvers();\n    this._disableRange = source.disableRange || false;\n    this._contentLength = source.length; // Optional\n    this._rangeChunkSize = source.rangeChunkSize;\n    if (!this._rangeChunkSize && !this._disableRange) {\n      this._disableRange = true;\n    }\n\n    this._isStreamingSupported = false;\n    this._isRangeSupported = false;\n\n    this._cachedChunks = [];\n    this._requests = [];\n    this._done = false;\n    this._storedError = undefined;\n    this._filename = null;\n\n    this.onProgress = null;\n  }\n\n  _onHeadersReceived() {\n    const fullRequestXhrId = this._fullRequestId;\n    const fullRequestXhr = this._manager.getRequestXhr(fullRequestXhrId);\n\n    this._manager._responseOrigin = getResponseOrigin(\n      fullRequestXhr.responseURL\n    );\n\n    const rawResponseHeaders = fullRequestXhr.getAllResponseHeaders();\n    const responseHeaders = new Headers(\n      rawResponseHeaders\n        ? rawResponseHeaders\n            .trimStart()\n            .replace(/[^\\S ]+$/, \"\") // Not `trimEnd`, to keep regular spaces.\n            .split(/[\\r\\n]+/)\n            .map(x => {\n              const [key, ...val] = x.split(\": \");\n              return [key, val.join(\": \")];\n            })\n        : []\n    );\n\n    const { allowRangeRequests, suggestedLength } =\n      validateRangeRequestCapabilities({\n        responseHeaders,\n        isHttp: this._manager.isHttp,\n        rangeChunkSize: this._rangeChunkSize,\n        disableRange: this._disableRange,\n      });\n\n    if (allowRangeRequests) {\n      this._isRangeSupported = true;\n    }\n    // Setting right content length.\n    this._contentLength = suggestedLength || this._contentLength;\n\n    this._filename = extractFilenameFromHeader(responseHeaders);\n\n    if (this._isRangeSupported) {\n      // NOTE: by cancelling the full request, and then issuing range\n      // requests, there will be an issue for sites where you can only\n      // request the pdf once. However, if this is the case, then the\n      // server should not be returning that it can support range requests.\n      this._manager.abortRequest(fullRequestXhrId);\n    }\n\n    this._headersCapability.resolve();\n  }\n\n  _onDone(data) {\n    if (data) {\n      if (this._requests.length > 0) {\n        const requestCapability = this._requests.shift();\n        requestCapability.resolve({ value: data.chunk, done: false });\n      } else {\n        this._cachedChunks.push(data.chunk);\n      }\n    }\n    this._done = true;\n    if (this._cachedChunks.length > 0) {\n      return;\n    }\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n  }\n\n  _onError(status) {\n    this._storedError = createResponseError(status, this._url);\n    this._headersCapability.reject(this._storedError);\n    for (const requestCapability of this._requests) {\n      requestCapability.reject(this._storedError);\n    }\n    this._requests.length = 0;\n    this._cachedChunks.length = 0;\n  }\n\n  _onProgress(evt) {\n    this.onProgress?.({\n      loaded: evt.loaded,\n      total: evt.lengthComputable ? evt.total : this._contentLength,\n    });\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get isRangeSupported() {\n    return this._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  get contentLength() {\n    return this._contentLength;\n  }\n\n  get headersReady() {\n    return this._headersCapability.promise;\n  }\n\n  async read() {\n    await this._headersCapability.promise;\n\n    if (this._storedError) {\n      throw this._storedError;\n    }\n    if (this._cachedChunks.length > 0) {\n      const chunk = this._cachedChunks.shift();\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    this._headersCapability.reject(reason);\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    if (this._manager.isPendingRequest(this._fullRequestId)) {\n      this._manager.abortRequest(this._fullRequestId);\n    }\n    this._fullRequestReader = null;\n  }\n}\n\n/** @implements {IPDFStreamRangeReader} */\nclass PDFNetworkStreamRangeRequestReader {\n  constructor(manager, begin, end) {\n    this._manager = manager;\n\n    this._url = manager.url;\n    this._requestId = manager.request({\n      begin,\n      end,\n      onHeadersReceived: this._onHeadersReceived.bind(this),\n      onDone: this._onDone.bind(this),\n      onError: this._onError.bind(this),\n      onProgress: this._onProgress.bind(this),\n    });\n    this._requests = [];\n    this._queuedChunk = null;\n    this._done = false;\n    this._storedError = undefined;\n\n    this.onProgress = null;\n    this.onClosed = null;\n  }\n\n  _onHeadersReceived() {\n    const responseOrigin = getResponseOrigin(\n      this._manager.getRequestXhr(this._requestId)?.responseURL\n    );\n\n    if (responseOrigin !== this._manager._responseOrigin) {\n      this._storedError = new Error(\n        `Expected range response-origin \"${responseOrigin}\" to match \"${this._manager._responseOrigin}\".`\n      );\n      this._onError(0);\n    }\n  }\n\n  _close() {\n    this.onClosed?.(this);\n  }\n\n  _onDone(data) {\n    const chunk = data.chunk;\n    if (this._requests.length > 0) {\n      const requestCapability = this._requests.shift();\n      requestCapability.resolve({ value: chunk, done: false });\n    } else {\n      this._queuedChunk = chunk;\n    }\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    this._close();\n  }\n\n  _onError(status) {\n    this._storedError ??= createResponseError(status, this._url);\n    for (const requestCapability of this._requests) {\n      requestCapability.reject(this._storedError);\n    }\n    this._requests.length = 0;\n    this._queuedChunk = null;\n  }\n\n  _onProgress(evt) {\n    if (!this.isStreamingSupported) {\n      this.onProgress?.({ loaded: evt.loaded });\n    }\n  }\n\n  get isStreamingSupported() {\n    return false;\n  }\n\n  async read() {\n    if (this._storedError) {\n      throw this._storedError;\n    }\n    if (this._queuedChunk !== null) {\n      const chunk = this._queuedChunk;\n      this._queuedChunk = null;\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    if (this._manager.isPendingRequest(this._requestId)) {\n      this._manager.abortRequest(this._requestId);\n    }\n    this._close();\n  }\n}\n\nexport { PDFNetworkStream };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* globals process */\n\nimport { AbortException, assert } from \"../shared/util.js\";\nimport { createResponseError } from \"./network_utils.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./node_stream.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nconst urlRegex = /^[a-z][a-z0-9\\-+.]+:/i;\n\nfunction parseUrlOrPath(sourceUrl) {\n  if (urlRegex.test(sourceUrl)) {\n    return new URL(sourceUrl);\n  }\n  const url = process.getBuiltinModule(\"url\");\n  return new URL(url.pathToFileURL(sourceUrl));\n}\n\nclass PDFNodeStream {\n  constructor(source) {\n    this.source = source;\n    this.url = parseUrlOrPath(source.url);\n    assert(\n      this.url.protocol === \"file:\",\n      \"PDFNodeStream only supports file:// URLs.\"\n    );\n\n    this._fullRequestReader = null;\n    this._rangeRequestReaders = [];\n  }\n\n  get _progressiveDataLength() {\n    return this._fullRequestReader?._loaded ?? 0;\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFNodeStream.getFullReader can only be called once.\"\n    );\n    this._fullRequestReader = new PDFNodeStreamFsFullReader(this);\n    return this._fullRequestReader;\n  }\n\n  getRangeReader(start, end) {\n    if (end <= this._progressiveDataLength) {\n      return null;\n    }\n    const rangeReader = new PDFNodeStreamFsRangeReader(this, start, end);\n    this._rangeRequestReaders.push(rangeReader);\n    return rangeReader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeRequestReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n  }\n}\n\nclass PDFNodeStreamFsFullReader {\n  constructor(stream) {\n    this._url = stream.url;\n    this._done = false;\n    this._storedError = null;\n    this.onProgress = null;\n    const source = stream.source;\n    this._contentLength = source.length; // optional\n    this._loaded = 0;\n    this._filename = null;\n\n    this._disableRange = source.disableRange || false;\n    this._rangeChunkSize = source.rangeChunkSize;\n    if (!this._rangeChunkSize && !this._disableRange) {\n      this._disableRange = true;\n    }\n\n    this._isStreamingSupported = !source.disableStream;\n    this._isRangeSupported = !source.disableRange;\n\n    this._readableStream = null;\n    this._readCapability = Promise.withResolvers();\n    this._headersCapability = Promise.withResolvers();\n\n    const fs = process.getBuiltinModule(\"fs\");\n    fs.promises.lstat(this._url).then(\n      stat => {\n        // Setting right content length.\n        this._contentLength = stat.size;\n\n        this._setReadableStream(fs.createReadStream(this._url));\n        this._headersCapability.resolve();\n      },\n      error => {\n        if (error.code === \"ENOENT\") {\n          error = createResponseError(/* status = */ 0, this._url.href);\n        }\n        this._storedError = error;\n        this._headersCapability.reject(error);\n      }\n    );\n  }\n\n  get headersReady() {\n    return this._headersCapability.promise;\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get contentLength() {\n    return this._contentLength;\n  }\n\n  get isRangeSupported() {\n    return this._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._readCapability.promise;\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    if (this._storedError) {\n      throw this._storedError;\n    }\n\n    const chunk = this._readableStream.read();\n    if (chunk === null) {\n      this._readCapability = Promise.withResolvers();\n      return this.read();\n    }\n    this._loaded += chunk.length;\n    this.onProgress?.({\n      loaded: this._loaded,\n      total: this._contentLength,\n    });\n\n    // Ensure that `read()` method returns ArrayBuffer.\n    const buffer = new Uint8Array(chunk).buffer;\n    return { value: buffer, done: false };\n  }\n\n  cancel(reason) {\n    // Call `this._error()` method when cancel is called\n    // before _readableStream is set.\n    if (!this._readableStream) {\n      this._error(reason);\n      return;\n    }\n    this._readableStream.destroy(reason);\n  }\n\n  _error(reason) {\n    this._storedError = reason;\n    this._readCapability.resolve();\n  }\n\n  _setReadableStream(readableStream) {\n    this._readableStream = readableStream;\n    readableStream.on(\"readable\", () => {\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"end\", () => {\n      // Destroy readable to minimize resource usage.\n      readableStream.destroy();\n      this._done = true;\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"error\", reason => {\n      this._error(reason);\n    });\n\n    // We need to stop reading when range is supported and streaming is\n    // disabled.\n    if (!this._isStreamingSupported && this._isRangeSupported) {\n      this._error(new AbortException(\"streaming is disabled\"));\n    }\n\n    // Destroy ReadableStream if already in errored state.\n    if (this._storedError) {\n      this._readableStream.destroy(this._storedError);\n    }\n  }\n}\n\nclass PDFNodeStreamFsRangeReader {\n  constructor(stream, start, end) {\n    this._url = stream.url;\n    this._done = false;\n    this._storedError = null;\n    this.onProgress = null;\n    this._loaded = 0;\n    this._readableStream = null;\n    this._readCapability = Promise.withResolvers();\n    const source = stream.source;\n    this._isStreamingSupported = !source.disableStream;\n\n    const fs = process.getBuiltinModule(\"fs\");\n    this._setReadableStream(\n      fs.createReadStream(this._url, { start, end: end - 1 })\n    );\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._readCapability.promise;\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    if (this._storedError) {\n      throw this._storedError;\n    }\n\n    const chunk = this._readableStream.read();\n    if (chunk === null) {\n      this._readCapability = Promise.withResolvers();\n      return this.read();\n    }\n    this._loaded += chunk.length;\n    this.onProgress?.({ loaded: this._loaded });\n\n    // Ensure that `read()` method returns ArrayBuffer.\n    const buffer = new Uint8Array(chunk).buffer;\n    return { value: buffer, done: false };\n  }\n\n  cancel(reason) {\n    // Call `this._error()` method when cancel is called\n    // before _readableStream is set.\n    if (!this._readableStream) {\n      this._error(reason);\n      return;\n    }\n    this._readableStream.destroy(reason);\n  }\n\n  _error(reason) {\n    this._storedError = reason;\n    this._readCapability.resolve();\n  }\n\n  _setReadableStream(readableStream) {\n    this._readableStream = readableStream;\n    readableStream.on(\"readable\", () => {\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"end\", () => {\n      // Destroy readableStream to minimize resource usage.\n      readableStream.destroy();\n      this._done = true;\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"error\", reason => {\n      this._error(reason);\n    });\n\n    // Destroy readableStream if already in errored state.\n    if (this._storedError) {\n      this._readableStream.destroy(this._storedError);\n    }\n  }\n}\n\nexport { PDFNodeStream };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst INITIAL_DATA = Symbol(\"INITIAL_DATA\");\n\n/**\n * A PDF document and page is built of many objects. E.g. there are objects for\n * fonts, images, rendering code, etc. These objects may get processed inside of\n * a worker. This class implements some basic methods to manage these objects.\n */\nclass PDFObjects {\n  #objs = Object.create(null);\n\n  /**\n   * Ensures there is an object defined for `objId`.\n   *\n   * @param {string} objId\n   * @returns {Object}\n   */\n  #ensureObj(objId) {\n    return (this.#objs[objId] ||= {\n      ...Promise.withResolvers(),\n      data: INITIAL_DATA,\n    });\n  }\n\n  /**\n   * If called *without* callback, this returns the data of `objId` but the\n   * object needs to be resolved. If it isn't, this method throws.\n   *\n   * If called *with* a callback, the callback is called with the data of the\n   * object once the object is resolved. That means, if you call this method\n   * and the object is already resolved, the callback gets called right away.\n   *\n   * @param {string} objId\n   * @param {function} [callback]\n   * @returns {any}\n   */\n  get(objId, callback = null) {\n    // If there is a callback, then the get can be async and the object is\n    // not required to be resolved right now.\n    if (callback) {\n      const obj = this.#ensureObj(objId);\n      obj.promise.then(() => callback(obj.data));\n      return null;\n    }\n    // If there isn't a callback, the user expects to get the resolved data\n    // directly.\n    const obj = this.#objs[objId];\n    // If there isn't an object yet or the object isn't resolved, then the\n    // data isn't ready yet!\n    if (!obj || obj.data === INITIAL_DATA) {\n      throw new Error(`Requesting object that isn't resolved yet ${objId}.`);\n    }\n    return obj.data;\n  }\n\n  /**\n   * @param {string} objId\n   * @returns {boolean}\n   */\n  has(objId) {\n    const obj = this.#objs[objId];\n    return !!obj && obj.data !== INITIAL_DATA;\n  }\n\n  /**\n   * @param {string} objId\n   * @returns {boolean}\n   */\n  delete(objId) {\n    const obj = this.#objs[objId];\n    if (!obj || obj.data === INITIAL_DATA) {\n      // Only allow removing the object *after* it's been resolved.\n      return false;\n    }\n    delete this.#objs[objId];\n    return true;\n  }\n\n  /**\n   * Resolves the object `objId` with optional `data`.\n   *\n   * @param {string} objId\n   * @param {any} [data]\n   */\n  resolve(objId, data = null) {\n    const obj = this.#ensureObj(objId);\n    obj.data = data;\n    obj.resolve();\n  }\n\n  clear() {\n    for (const objId in this.#objs) {\n      const { data } = this.#objs[objId];\n      data?.bitmap?.close(); // Release any `ImageBitmap` data.\n    }\n    this.#objs = Object.create(null);\n  }\n\n  *[Symbol.iterator]() {\n    for (const objId in this.#objs) {\n      const { data } = this.#objs[objId];\n\n      if (data === INITIAL_DATA) {\n        continue;\n      }\n      yield [objId, data];\n    }\n  }\n}\n\nexport { PDFObjects };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./display_utils\").PageViewport} PageViewport */\n/** @typedef {import(\"./api\").TextContent} TextContent */\n\nimport {\n  AbortException,\n  FeatureTest,\n  shadow,\n  Util,\n  warn,\n} from \"../shared/util.js\";\nimport { OutputScale, setLayerDimensions } from \"./display_utils.js\";\n\n/**\n * @typedef {Object} TextLayerParameters\n * @property {ReadableStream | TextContent} textContentSource - Text content to\n *   render, i.e. the value returned by the page's `streamTextContent` or\n *   `getTextContent` method.\n * @property {HTMLElement} container - The DOM node that will contain the text\n *   runs.\n * @property {PageViewport} viewport - The target viewport to properly layout\n *   the text runs.\n */\n\n/**\n * @typedef {Object} TextLayerUpdateParameters\n * @property {PageViewport} viewport - The target viewport to properly layout\n *   the text runs.\n * @property {function} [onBefore] - Callback invoked before the textLayer is\n *   updated in the DOM.\n */\n\nconst MAX_TEXT_DIVS_TO_RENDER = 100000;\nconst DEFAULT_FONT_SIZE = 30;\n\nclass TextLayer {\n  #capability = Promise.withResolvers();\n\n  #container = null;\n\n  #disableProcessItems = false;\n\n  #fontInspectorEnabled = !!globalThis.FontInspector?.enabled;\n\n  #lang = null;\n\n  #layoutTextParams = null;\n\n  #pageHeight = 0;\n\n  #pageWidth = 0;\n\n  #reader = null;\n\n  #rootContainer = null;\n\n  #rotation = 0;\n\n  #scale = 0;\n\n  #styleCache = Object.create(null);\n\n  #textContentItemsStr = [];\n\n  #textContentSource = null;\n\n  #textDivs = [];\n\n  #textDivProperties = new WeakMap();\n\n  #transform = null;\n\n  static #ascentCache = new Map();\n\n  static #canvasContexts = new Map();\n\n  static #canvasCtxFonts = new WeakMap();\n\n  static #minFontSize = null;\n\n  static #pendingTextLayers = new Set();\n\n  /**\n   * @param {TextLayerParameters} options\n   */\n  constructor({ textContentSource, container, viewport }) {\n    if (textContentSource instanceof ReadableStream) {\n      this.#textContentSource = textContentSource;\n    } else if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n      typeof textContentSource === \"object\"\n    ) {\n      this.#textContentSource = new ReadableStream({\n        start(controller) {\n          controller.enqueue(textContentSource);\n          controller.close();\n        },\n      });\n    } else {\n      throw new Error('No \"textContentSource\" parameter specified.');\n    }\n    this.#container = this.#rootContainer = container;\n\n    this.#scale = viewport.scale * OutputScale.pixelRatio;\n    this.#rotation = viewport.rotation;\n    this.#layoutTextParams = {\n      div: null,\n      properties: null,\n      ctx: null,\n    };\n    const { pageWidth, pageHeight, pageX, pageY } = viewport.rawDims;\n    this.#transform = [1, 0, 0, -1, -pageX, pageY + pageHeight];\n    this.#pageWidth = pageWidth;\n    this.#pageHeight = pageHeight;\n\n    TextLayer.#ensureMinFontSizeComputed();\n    container.style.setProperty(\"--min-font-size\", TextLayer.#minFontSize);\n\n    setLayerDimensions(container, viewport);\n\n    // Always clean-up the temporary canvas once rendering is no longer pending.\n    this.#capability.promise\n      .finally(() => {\n        TextLayer.#pendingTextLayers.delete(this);\n        this.#layoutTextParams = null;\n        this.#styleCache = null;\n      })\n      .catch(() => {\n        // Avoid \"Uncaught promise\" messages in the console.\n      });\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"pageWidth\", {\n        get() {\n          return this.#pageWidth;\n        },\n      });\n      Object.defineProperty(this, \"pageHeight\", {\n        get() {\n          return this.#pageHeight;\n        },\n      });\n    }\n  }\n\n  static get fontFamilyMap() {\n    const { isWindows, isFirefox } = FeatureTest.platform;\n    return shadow(\n      this,\n      \"fontFamilyMap\",\n      new Map([\n        [\n          \"sans-serif\",\n          `${isWindows && isFirefox ? \"Calibri, \" : \"\"}sans-serif`,\n        ],\n        [\n          \"monospace\",\n          `${isWindows && isFirefox ? \"Lucida Console, \" : \"\"}monospace`,\n        ],\n      ])\n    );\n  }\n\n  /**\n   * Render the textLayer.\n   * @returns {Promise}\n   */\n  render() {\n    const pump = () => {\n      this.#reader.read().then(({ value, done }) => {\n        if (done) {\n          this.#capability.resolve();\n          return;\n        }\n        this.#lang ??= value.lang;\n        Object.assign(this.#styleCache, value.styles);\n        this.#processItems(value.items);\n        pump();\n      }, this.#capability.reject);\n    };\n    this.#reader = this.#textContentSource.getReader();\n    TextLayer.#pendingTextLayers.add(this);\n    pump();\n\n    return this.#capability.promise;\n  }\n\n  /**\n   * Update a previously rendered textLayer, if necessary.\n   * @param {TextLayerUpdateParameters} options\n   * @returns {undefined}\n   */\n  update({ viewport, onBefore = null }) {\n    const scale = viewport.scale * OutputScale.pixelRatio;\n    const rotation = viewport.rotation;\n\n    if (rotation !== this.#rotation) {\n      onBefore?.();\n      this.#rotation = rotation;\n      setLayerDimensions(this.#rootContainer, { rotation });\n    }\n\n    if (scale !== this.#scale) {\n      onBefore?.();\n      this.#scale = scale;\n      const params = {\n        div: null,\n        properties: null,\n        ctx: TextLayer.#getCtx(this.#lang),\n      };\n      for (const div of this.#textDivs) {\n        params.properties = this.#textDivProperties.get(div);\n        params.div = div;\n        this.#layout(params);\n      }\n    }\n  }\n\n  /**\n   * Cancel rendering of the textLayer.\n   * @returns {undefined}\n   */\n  cancel() {\n    const abortEx = new AbortException(\"TextLayer task cancelled.\");\n\n    this.#reader?.cancel(abortEx).catch(() => {\n      // Avoid \"Uncaught promise\" messages in the console.\n    });\n    this.#reader = null;\n\n    this.#capability.reject(abortEx);\n  }\n\n  /**\n   * @type {Array<HTMLElement>} HTML elements that correspond to the text items\n   *   of the textContent input.\n   *   This is output and will initially be set to an empty array.\n   */\n  get textDivs() {\n    return this.#textDivs;\n  }\n\n  /**\n   * @type {Array<string>} Strings that correspond to the `str` property of\n   *   the text items of the textContent input.\n   *   This is output and will initially be set to an empty array\n   */\n  get textContentItemsStr() {\n    return this.#textContentItemsStr;\n  }\n\n  #processItems(items) {\n    if (this.#disableProcessItems) {\n      return;\n    }\n    this.#layoutTextParams.ctx ??= TextLayer.#getCtx(this.#lang);\n\n    const textDivs = this.#textDivs,\n      textContentItemsStr = this.#textContentItemsStr;\n\n    for (const item of items) {\n      // No point in rendering many divs as it would make the browser\n      // unusable even after the divs are rendered.\n      if (textDivs.length > MAX_TEXT_DIVS_TO_RENDER) {\n        warn(\"Ignoring additional textDivs for performance reasons.\");\n\n        this.#disableProcessItems = true; // Avoid multiple warnings for one page.\n        return;\n      }\n\n      if (item.str === undefined) {\n        if (\n          item.type === \"beginMarkedContentProps\" ||\n          item.type === \"beginMarkedContent\"\n        ) {\n          const parent = this.#container;\n          this.#container = document.createElement(\"span\");\n          this.#container.classList.add(\"markedContent\");\n          if (item.id) {\n            this.#container.setAttribute(\"id\", `${item.id}`);\n          }\n          parent.append(this.#container);\n        } else if (item.type === \"endMarkedContent\") {\n          this.#container = this.#container.parentNode;\n        }\n        continue;\n      }\n      textContentItemsStr.push(item.str);\n      this.#appendText(item);\n    }\n  }\n\n  #appendText(geom) {\n    // Initialize all used properties to keep the caches monomorphic.\n    const textDiv = document.createElement(\"span\");\n    const textDivProperties = {\n      angle: 0,\n      canvasWidth: 0,\n      hasText: geom.str !== \"\",\n      hasEOL: geom.hasEOL,\n      fontSize: 0,\n    };\n    this.#textDivs.push(textDiv);\n\n    const tx = Util.transform(this.#transform, geom.transform);\n    let angle = Math.atan2(tx[1], tx[0]);\n    const style = this.#styleCache[geom.fontName];\n    if (style.vertical) {\n      angle += Math.PI / 2;\n    }\n\n    let fontFamily =\n      (this.#fontInspectorEnabled && style.fontSubstitution) ||\n      style.fontFamily;\n\n    // Workaround for bug 1922063.\n    fontFamily = TextLayer.fontFamilyMap.get(fontFamily) || fontFamily;\n    const fontHeight = Math.hypot(tx[2], tx[3]);\n    const fontAscent =\n      fontHeight * TextLayer.#getAscent(fontFamily, style, this.#lang);\n\n    let left, top;\n    if (angle === 0) {\n      left = tx[4];\n      top = tx[5] - fontAscent;\n    } else {\n      left = tx[4] + fontAscent * Math.sin(angle);\n      top = tx[5] - fontAscent * Math.cos(angle);\n    }\n\n    const divStyle = textDiv.style;\n    // Setting the style properties individually, rather than all at once,\n    // should be OK since the `textDiv` isn't appended to the document yet.\n    divStyle.left = `${((100 * left) / this.#pageWidth).toFixed(2)}%`;\n    divStyle.top = `${((100 * top) / this.#pageHeight).toFixed(2)}%`;\n    divStyle.setProperty(\"--font-height\", `${fontHeight.toFixed(2)}px`);\n    divStyle.fontFamily = fontFamily;\n\n    textDivProperties.fontSize = fontHeight;\n\n    // Keeps screen readers from pausing on every new text span.\n    textDiv.setAttribute(\"role\", \"presentation\");\n\n    textDiv.textContent = geom.str;\n    // geom.dir may be 'ttb' for vertical texts.\n    textDiv.dir = geom.dir;\n\n    // `fontName` is only used by the FontInspector, and we only use `dataset`\n    // here to make the font name available in the debugger.\n    if (this.#fontInspectorEnabled) {\n      textDiv.dataset.fontName =\n        style.fontSubstitutionLoadedName || geom.fontName;\n    }\n    if (angle !== 0) {\n      textDivProperties.angle = angle * (180 / Math.PI);\n    }\n    // We don't bother scaling single-char text divs, because it has very\n    // little effect on text highlighting. This makes scrolling on docs with\n    // lots of such divs a lot faster.\n    let shouldScaleText = false;\n    if (geom.str.length > 1) {\n      shouldScaleText = true;\n    } else if (geom.str !== \" \" && geom.transform[0] !== geom.transform[3]) {\n      const absScaleX = Math.abs(geom.transform[0]),\n        absScaleY = Math.abs(geom.transform[3]);\n      // When the horizontal/vertical scaling differs significantly, also scale\n      // even single-char text to improve highlighting (fixes issue11713.pdf).\n      if (\n        absScaleX !== absScaleY &&\n        Math.max(absScaleX, absScaleY) / Math.min(absScaleX, absScaleY) > 1.5\n      ) {\n        shouldScaleText = true;\n      }\n    }\n    if (shouldScaleText) {\n      textDivProperties.canvasWidth = style.vertical ? geom.height : geom.width;\n    }\n    this.#textDivProperties.set(textDiv, textDivProperties);\n\n    // Finally, layout and append the text to the DOM.\n    this.#layoutTextParams.div = textDiv;\n    this.#layoutTextParams.properties = textDivProperties;\n    this.#layout(this.#layoutTextParams);\n\n    if (textDivProperties.hasText) {\n      this.#container.append(textDiv);\n    }\n    if (textDivProperties.hasEOL) {\n      const br = document.createElement(\"br\");\n      br.setAttribute(\"role\", \"presentation\");\n      this.#container.append(br);\n    }\n  }\n\n  #layout(params) {\n    const { div, properties, ctx } = params;\n    const { style } = div;\n\n    if (properties.canvasWidth !== 0 && properties.hasText) {\n      const { fontFamily } = style;\n      const { canvasWidth, fontSize } = properties;\n\n      TextLayer.#ensureCtxFont(ctx, fontSize * this.#scale, fontFamily);\n      // Only measure the width for multi-char text divs, see `appendText`.\n      const { width } = ctx.measureText(div.textContent);\n\n      if (width > 0) {\n        style.setProperty(\"--scale-x\", (canvasWidth * this.#scale) / width);\n      }\n    }\n    if (properties.angle !== 0) {\n      style.setProperty(\"--rotate\", `${properties.angle}deg`);\n    }\n  }\n\n  /**\n   * Clean-up global textLayer data.\n   * @returns {undefined}\n   */\n  static cleanup() {\n    if (this.#pendingTextLayers.size > 0) {\n      return;\n    }\n    this.#ascentCache.clear();\n\n    for (const { canvas } of this.#canvasContexts.values()) {\n      canvas.remove();\n    }\n    this.#canvasContexts.clear();\n  }\n\n  static #getCtx(lang = null) {\n    let ctx = this.#canvasContexts.get((lang ||= \"\"));\n    if (!ctx) {\n      // We don't use an OffscreenCanvas here because we use serif/sans serif\n      // fonts with it and they depends on the locale.\n      // In Firefox, the <html> element get a lang attribute that depends on\n      // what Fluent returns for the locale and the OffscreenCanvas uses\n      // the OS locale.\n      // Those two locales can be different and consequently the used fonts will\n      // be different (see bug 1869001).\n      // Ideally, we should use in the text layer the fonts we've in the pdf (or\n      // their replacements when they aren't embedded) and then we can use an\n      // OffscreenCanvas.\n      const canvas = document.createElement(\"canvas\");\n      canvas.className = \"hiddenCanvasElement\";\n      canvas.lang = lang;\n      document.body.append(canvas);\n      ctx = canvas.getContext(\"2d\", {\n        alpha: false,\n        willReadFrequently: true,\n      });\n      this.#canvasContexts.set(lang, ctx);\n\n      // Also, initialize state for the `#ensureCtxFont` method.\n      this.#canvasCtxFonts.set(ctx, { size: 0, family: \"\" });\n    }\n    return ctx;\n  }\n\n  static #ensureCtxFont(ctx, size, family) {\n    const cached = this.#canvasCtxFonts.get(ctx);\n    if (size === cached.size && family === cached.family) {\n      return; // The font is already set.\n    }\n    ctx.font = `${size}px ${family}`;\n    cached.size = size;\n    cached.family = family;\n  }\n\n  /**\n   * Compute the minimum font size enforced by the browser.\n   */\n  static #ensureMinFontSizeComputed() {\n    if (this.#minFontSize !== null) {\n      return;\n    }\n    const div = document.createElement(\"div\");\n    div.style.opacity = 0;\n    div.style.lineHeight = 1;\n    div.style.fontSize = \"1px\";\n    div.style.position = \"absolute\";\n    div.textContent = \"X\";\n    document.body.append(div);\n    // In `display:block` elements contain a single line of text,\n    // the height matches the line height (which, when set to 1,\n    // matches the actual font size).\n    this.#minFontSize = div.getBoundingClientRect().height;\n    div.remove();\n  }\n\n  static #getAscent(fontFamily, style, lang) {\n    const cachedAscent = this.#ascentCache.get(fontFamily);\n    if (cachedAscent) {\n      return cachedAscent;\n    }\n    const ctx = this.#getCtx(lang);\n\n    ctx.canvas.width = ctx.canvas.height = DEFAULT_FONT_SIZE;\n    this.#ensureCtxFont(ctx, DEFAULT_FONT_SIZE, fontFamily);\n    const metrics = ctx.measureText(\"\");\n\n    const ascent = metrics.fontBoundingBoxAscent;\n    const descent = Math.abs(metrics.fontBoundingBoxDescent);\n\n    ctx.canvas.width = ctx.canvas.height = 0;\n    let ratio = 0.8; // DEFAULT_FONT_ASCENT\n\n    if (ascent) {\n      ratio = ascent / (ascent + descent);\n    } else {\n      if (\n        (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n        FeatureTest.platform.isFirefox\n      ) {\n        warn(\n          \"Enable the `dom.textMetrics.fontBoundingBox.enabled` preference \" +\n            \"in `about:config` to improve TextLayer rendering.\"\n        );\n      }\n      if (style.ascent) {\n        ratio = style.ascent;\n      } else if (style.descent) {\n        ratio = 1 + style.descent;\n      }\n    }\n\n    this.#ascentCache.set(fontFamily, ratio);\n    return ratio;\n  }\n}\n\nexport { TextLayer };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @module pdfjsLib\n */\n\nimport {\n  AbortException,\n  AnnotationMode,\n  assert,\n  FeatureTest,\n  getVerbosityLevel,\n  info,\n  isNodeJS,\n  RenderingIntentFlag,\n  setVerbosityLevel,\n  shadow,\n  unreachable,\n  warn,\n} from \"../shared/util.js\";\nimport {\n  AnnotationStorage,\n  PrintAnnotationStorage,\n  SerializableEmpty,\n} from \"./annotation_storage.js\";\nimport {\n  deprecated,\n  isDataScheme,\n  isValidFetchUrl,\n  PageViewport,\n  RenderingCancelledException,\n  StatTimer,\n} from \"./display_utils.js\";\nimport { FontFaceObject, FontLoader } from \"./font_loader.js\";\nimport {\n  FontInfo,\n  FontPathInfo,\n  PatternInfo,\n} from \"../shared/obj-bin-transform.js\";\nimport {\n  getDataProp,\n  getFactoryUrlProp,\n  getUrlProp,\n  isRefProxy,\n  LoopbackPort,\n} from \"./api_utils.js\";\nimport { MessageHandler, wrapReason } from \"../shared/message_handler.js\";\nimport {\n  NodeCanvasFactory,\n  NodeCMapReaderFactory,\n  NodeFilterFactory,\n  NodeStandardFontDataFactory,\n  NodeWasmFactory,\n} from \"display-node_utils\";\nimport { CanvasDependencyTracker } from \"./canvas_dependency_tracker.js\";\nimport { CanvasGraphics } from \"./canvas.js\";\nimport { DOMCanvasFactory } from \"./canvas_factory.js\";\nimport { DOMCMapReaderFactory } from \"display-cmap_reader_factory\";\nimport { DOMFilterFactory } from \"./filter_factory.js\";\nimport { DOMStandardFontDataFactory } from \"display-standard_fontdata_factory\";\nimport { DOMWasmFactory } from \"display-wasm_factory\";\nimport { GlobalWorkerOptions } from \"./worker_options.js\";\nimport { Metadata } from \"./metadata.js\";\nimport { OptionalContentConfig } from \"./optional_content_config.js\";\nimport { PDFDataTransportStream } from \"./transport_stream.js\";\nimport { PDFFetchStream } from \"display-fetch_stream\";\nimport { PDFNetworkStream } from \"display-network\";\nimport { PDFNodeStream } from \"display-node_stream\";\nimport { PDFObjects } from \"./pdf_objects.js\";\nimport { TextLayer } from \"./text_layer.js\";\nimport { XfaText } from \"./xfa_text.js\";\n\nconst RENDERING_CANCELLED_TIMEOUT = 100; // ms\n\n/**\n * @typedef { Int8Array | Uint8Array | Uint8ClampedArray |\n *            Int16Array | Uint16Array |\n *            Int32Array | Uint32Array | Float32Array |\n *            Float64Array\n * } TypedArray\n */\n\n/**\n * @typedef {Object} RefProxy\n * @property {number} num\n * @property {number} gen\n */\n\n/**\n * Document initialization / loading parameters object.\n *\n * @typedef {Object} DocumentInitParameters\n * @property {string | URL} [url] - The URL of the PDF.\n * @property {TypedArray | ArrayBuffer | Array<number> | string} [data] -\n *   Binary PDF data.\n *   Use TypedArrays (Uint8Array) to improve the memory usage. If PDF data is\n *   BASE64-encoded, use `atob()` to convert it to a binary string first.\n *\n *   NOTE: If TypedArrays are used they will generally be transferred to the\n *   worker-thread. This will help reduce main-thread memory usage, however\n *   it will take ownership of the TypedArrays.\n * @property {Object} [httpHeaders] - Basic authentication headers.\n * @property {boolean} [withCredentials] - Indicates whether or not\n *   cross-site Access-Control requests should be made using credentials such\n *   as cookies or authorization headers. The default is `false`.\n * @property {string} [password] - For decrypting password-protected PDFs.\n * @property {number} [length] - The PDF file length. It's used for progress\n *   reports and range requests operations.\n * @property {PDFDataRangeTransport} [range] - Allows for using a custom range\n *   transport implementation.\n * @property {number} [rangeChunkSize] - Specify maximum number of bytes fetched\n *   per range request. The default value is 65536 (= 2^16).\n * @property {PDFWorker} [worker] - The worker that will be used for loading and\n *   parsing the PDF data.\n * @property {number} [verbosity] - Controls the logging level; the constants\n *   from {@link VerbosityLevel} should be used.\n * @property {string} [docBaseUrl] - The base URL of the document, used when\n *   attempting to recover valid absolute URLs for annotations, and outline\n *   items, that (incorrectly) only specify relative URLs.\n * @property {string} [cMapUrl] - The URL where the predefined Adobe CMaps are\n *   located. Include the trailing slash.\n * @property {boolean} [cMapPacked] - Specifies if the Adobe CMaps are binary\n *   packed or not. The default value is `true`.\n * @property {Object} [CMapReaderFactory] - The factory that will be used when\n *   reading built-in CMap files.\n *   The default value is {DOMCMapReaderFactory}.\n * @property {string} [iccUrl] - The URL where the predefined ICC profiles are\n *   located. Include the trailing slash.\n * @property {boolean} [useSystemFonts] - When `true`, fonts that aren't\n *   embedded in the PDF document will fallback to a system font.\n *   The default value is `true` in web environments and `false` in Node.js;\n *   unless `disableFontFace === true` in which case this defaults to `false`\n *   regardless of the environment (to prevent completely broken fonts).\n * @property {string} [standardFontDataUrl] - The URL where the standard font\n *   files are located. Include the trailing slash.\n * @property {Object} [StandardFontDataFactory] - The factory that will be used\n *   when reading the standard font files.\n *   The default value is {DOMStandardFontDataFactory}.\n * @property {string} [wasmUrl] - The URL where the wasm files are located.\n *   Include the trailing slash.\n * @property {Object} [WasmFactory] - The factory that will be used\n *   when reading the wasm files.\n *   The default value is {DOMWasmFactory}.\n * @property {boolean} [useWorkerFetch] - Enable using the Fetch API in the\n *   worker-thread when reading CMap and standard font files. When `true`,\n *   the `CMapReaderFactory`, `StandardFontDataFactory`, and `WasmFactory`\n *   options are ignored.\n *   The default value is `true` in web environments and `false` in Node.js.\n * @property {boolean} [useWasm] - Attempt to use WebAssembly in order to\n *    improve e.g. image decoding performance.\n *    The default value is `true`.\n * @property {boolean} [stopAtErrors] - Reject certain promises, e.g.\n *   `getOperatorList`, `getTextContent`, and `RenderTask`, when the associated\n *   PDF data cannot be successfully parsed, instead of attempting to recover\n *   whatever possible of the data. The default value is `false`.\n * @property {number} [maxImageSize] - The maximum allowed image size in total\n *   pixels, i.e. width * height. Images above this value will not be rendered.\n *   Use -1 for no limit, which is also the default value.\n * @property {boolean} [isEvalSupported] - Determines if we can evaluate strings\n *   as JavaScript. Primarily used to improve performance of PDF functions.\n *   The default value is `true`.\n * @property {boolean} [isOffscreenCanvasSupported] - Determines if we can use\n *   `OffscreenCanvas` in the worker. Primarily used to improve performance of\n *   image conversion/rendering.\n *   The default value is `true` in web environments and `false` in Node.js.\n * @property {boolean} [isImageDecoderSupported] - Determines if we can use\n *   `ImageDecoder` in the worker. Primarily used to improve performance of\n *   image conversion/rendering.\n *   The default value is `true` in web environments and `false` in Node.js.\n *\n *   NOTE: Also temporarily disabled in Chromium browsers, until we no longer\n *   support the affected browser versions, because of various bugs:\n *\n *    - Crashes when using the BMP decoder with huge images, e.g. issue6741.pdf;\n *      see https://issues.chromium.org/issues/374807001\n *\n *    - Broken images when using the JPEG decoder with images that have custom\n *      colour profiles, e.g. GitHub discussion 19030;\n *      see https://issues.chromium.org/issues/378869810\n *\n * @property {number} [canvasMaxAreaInBytes] - The integer value is used to\n *   know when an image must be resized (uses `OffscreenCanvas` in the worker).\n *   If it's -1 then a possibly slow algorithm is used to guess the max value.\n * @property {boolean} [disableFontFace] - By default fonts are converted to\n *   OpenType fonts and loaded via the Font Loading API or `@font-face` rules.\n *   If disabled, fonts will be rendered using a built-in font renderer that\n *   constructs the glyphs with primitive path commands.\n *   The default value is `false` in web environments and `true` in Node.js.\n * @property {boolean} [fontExtraProperties] - Include additional properties,\n *   which are unused during rendering of PDF documents, when exporting the\n *   parsed font data from the worker-thread. This may be useful for debugging\n *   purposes (and backwards compatibility), but note that it will lead to\n *   increased memory usage. The default value is `false`.\n * @property {boolean} [enableXfa] - Render Xfa forms if any.\n *   The default value is `false`.\n * @property {HTMLDocument} [ownerDocument] - Specify an explicit document\n *   context to create elements with and to load resources, such as fonts,\n *   into. Defaults to the current document.\n * @property {boolean} [disableRange] - Disable range request loading of PDF\n *   files. When enabled, and if the server supports partial content requests,\n *   then the PDF will be fetched in chunks. The default value is `false`.\n * @property {boolean} [disableStream] - Disable streaming of PDF file data.\n *   By default PDF.js attempts to load PDF files in chunks. The default value\n *   is `false`.\n * @property {boolean} [disableAutoFetch] - Disable pre-fetching of PDF file\n *   data. When range requests are enabled PDF.js will automatically keep\n *   fetching more data even if it isn't needed to display the current page.\n *   The default value is `false`.\n *\n *   NOTE: It is also necessary to disable streaming, see above, in order for\n *   disabling of pre-fetching to work correctly.\n * @property {boolean} [pdfBug] - Enables special hooks for debugging PDF.js\n *   (see `web/debugger.js`). The default value is `false`.\n * @property {Object} [CanvasFactory] - The factory that will be used when\n *    creating canvases. The default value is {DOMCanvasFactory}.\n * @property {Object} [FilterFactory] - The factory that will be used to\n *    create SVG filters when rendering some images on the main canvas.\n *    The default value is {DOMFilterFactory}.\n * @property {boolean} [enableHWA] - Enables hardware acceleration for\n *   rendering. The default value is `false`.\n */\n\n/**\n * This is the main entry point for loading a PDF and interacting with it.\n *\n * NOTE: If a URL is used to fetch the PDF data a standard Fetch API call (or\n * XHR as fallback) is used, which means it must follow same origin rules,\n * e.g. no cross-domain requests without CORS.\n *\n * @param {string | URL | TypedArray | ArrayBuffer | DocumentInitParameters}\n *   src - Can be a URL where a PDF file is located, a typed array (Uint8Array)\n *         already populated with data, or a parameter object.\n * @returns {PDFDocumentLoadingTask}\n */\nfunction getDocument(src = {}) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n    if (typeof src === \"string\" || src instanceof URL) {\n      src = { url: src };\n    } else if (src instanceof ArrayBuffer || ArrayBuffer.isView(src)) {\n      src = { data: src };\n    }\n  }\n  const task = new PDFDocumentLoadingTask();\n  const { docId } = task;\n\n  const url = src.url ? getUrlProp(src.url) : null;\n  const data = src.data ? getDataProp(src.data) : null;\n  const httpHeaders = src.httpHeaders || null;\n  const withCredentials = src.withCredentials === true;\n  const password = src.password ?? null;\n  const rangeTransport =\n    src.range instanceof PDFDataRangeTransport ? src.range : null;\n  const rangeChunkSize =\n    Number.isInteger(src.rangeChunkSize) && src.rangeChunkSize > 0\n      ? src.rangeChunkSize\n      : 2 ** 16;\n  let worker = src.worker instanceof PDFWorker ? src.worker : null;\n  const verbosity = src.verbosity;\n  // Ignore \"data:\"-URLs, since they can't be used to recover valid absolute\n  // URLs anyway. We want to avoid sending them to the worker-thread, since\n  // they contain the *entire* PDF document and can thus be arbitrarily long.\n  const docBaseUrl =\n    typeof src.docBaseUrl === \"string\" && !isDataScheme(src.docBaseUrl)\n      ? src.docBaseUrl\n      : null;\n  const cMapUrl = getFactoryUrlProp(src.cMapUrl);\n  const cMapPacked = src.cMapPacked !== false;\n  const CMapReaderFactory =\n    src.CMapReaderFactory ||\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n      ? NodeCMapReaderFactory\n      : DOMCMapReaderFactory);\n  const iccUrl = getFactoryUrlProp(src.iccUrl);\n  const standardFontDataUrl = getFactoryUrlProp(src.standardFontDataUrl);\n  const StandardFontDataFactory =\n    src.StandardFontDataFactory ||\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n      ? NodeStandardFontDataFactory\n      : DOMStandardFontDataFactory);\n  const wasmUrl = getFactoryUrlProp(src.wasmUrl);\n  const WasmFactory =\n    src.WasmFactory ||\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n      ? NodeWasmFactory\n      : DOMWasmFactory);\n  const ignoreErrors = src.stopAtErrors !== true;\n  const maxImageSize =\n    Number.isInteger(src.maxImageSize) && src.maxImageSize > -1\n      ? src.maxImageSize\n      : -1;\n  const isEvalSupported = src.isEvalSupported !== false;\n  const isOffscreenCanvasSupported =\n    typeof src.isOffscreenCanvasSupported === \"boolean\"\n      ? src.isOffscreenCanvasSupported\n      : !isNodeJS;\n  const isImageDecoderSupported =\n    // eslint-disable-next-line no-nested-ternary\n    typeof src.isImageDecoderSupported === \"boolean\"\n      ? src.isImageDecoderSupported\n      : // eslint-disable-next-line no-nested-ternary\n        typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")\n        ? true\n        : typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"CHROME\")\n          ? false\n          : !isNodeJS && (FeatureTest.platform.isFirefox || !globalThis.chrome);\n  const canvasMaxAreaInBytes = Number.isInteger(src.canvasMaxAreaInBytes)\n    ? src.canvasMaxAreaInBytes\n    : -1;\n  const disableFontFace =\n    typeof src.disableFontFace === \"boolean\" ? src.disableFontFace : isNodeJS;\n  const fontExtraProperties = src.fontExtraProperties === true;\n  const enableXfa = src.enableXfa === true;\n  const ownerDocument = src.ownerDocument || globalThis.document;\n  const disableRange = src.disableRange === true;\n  const disableStream = src.disableStream === true;\n  const disableAutoFetch = src.disableAutoFetch === true;\n  const pdfBug = src.pdfBug === true;\n  const CanvasFactory =\n    src.CanvasFactory ||\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n      ? NodeCanvasFactory\n      : DOMCanvasFactory);\n  const FilterFactory =\n    src.FilterFactory ||\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n      ? NodeFilterFactory\n      : DOMFilterFactory);\n  const enableHWA = src.enableHWA === true;\n  const useWasm = src.useWasm !== false;\n\n  // Parameters whose default values depend on other parameters.\n  const length = rangeTransport ? rangeTransport.length : (src.length ?? NaN);\n  const useSystemFonts =\n    typeof src.useSystemFonts === \"boolean\"\n      ? src.useSystemFonts\n      : !isNodeJS && !disableFontFace;\n  const useWorkerFetch =\n    typeof src.useWorkerFetch === \"boolean\"\n      ? src.useWorkerFetch\n      : (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n        !!(\n          CMapReaderFactory === DOMCMapReaderFactory &&\n          StandardFontDataFactory === DOMStandardFontDataFactory &&\n          WasmFactory === DOMWasmFactory &&\n          cMapUrl &&\n          standardFontDataUrl &&\n          wasmUrl &&\n          isValidFetchUrl(cMapUrl, document.baseURI) &&\n          isValidFetchUrl(standardFontDataUrl, document.baseURI) &&\n          isValidFetchUrl(wasmUrl, document.baseURI)\n        );\n\n  // Parameters only intended for development/testing purposes.\n  const styleElement =\n    typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")\n      ? src.styleElement\n      : null;\n\n  // Set the main-thread verbosity level.\n  setVerbosityLevel(verbosity);\n\n  // Ensure that the various factories can be initialized, when necessary,\n  // since the user may provide *custom* ones.\n  const transportFactory = {\n    canvasFactory: new CanvasFactory({ ownerDocument, enableHWA }),\n    filterFactory: new FilterFactory({ docId, ownerDocument }),\n    cMapReaderFactory:\n      (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n      useWorkerFetch\n        ? null\n        : new CMapReaderFactory({ baseUrl: cMapUrl, isCompressed: cMapPacked }),\n    standardFontDataFactory:\n      (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n      useWorkerFetch\n        ? null\n        : new StandardFontDataFactory({ baseUrl: standardFontDataUrl }),\n    wasmFactory:\n      (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n      useWorkerFetch\n        ? null\n        : new WasmFactory({ baseUrl: wasmUrl }),\n  };\n\n  if (!worker) {\n    // Worker was not provided -- creating and owning our own. If message port\n    // is specified in global worker options, using it.\n    worker = PDFWorker.create({\n      verbosity,\n      port: GlobalWorkerOptions.workerPort,\n    });\n    task._worker = worker;\n  }\n\n  const docParams = {\n    docId,\n    apiVersion:\n      typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"TESTING\")\n        ? PDFJSDev.eval(\"BUNDLE_VERSION\")\n        : null,\n    data,\n    password,\n    disableAutoFetch,\n    rangeChunkSize,\n    length,\n    docBaseUrl,\n    enableXfa,\n    evaluatorOptions: {\n      maxImageSize,\n      disableFontFace,\n      ignoreErrors,\n      isEvalSupported,\n      isOffscreenCanvasSupported,\n      isImageDecoderSupported,\n      canvasMaxAreaInBytes,\n      fontExtraProperties,\n      useSystemFonts,\n      useWasm,\n      useWorkerFetch,\n      cMapUrl,\n      iccUrl,\n      standardFontDataUrl,\n      wasmUrl,\n    },\n  };\n  const transportParams = {\n    ownerDocument,\n    pdfBug,\n    styleElement,\n    loadingParams: {\n      disableAutoFetch,\n      enableXfa,\n    },\n  };\n\n  worker.promise\n    .then(function () {\n      if (task.destroyed) {\n        throw new Error(\"Loading aborted\");\n      }\n      if (worker.destroyed) {\n        throw new Error(\"Worker was destroyed\");\n      }\n\n      const workerIdPromise = worker.messageHandler.sendWithPromise(\n        \"GetDocRequest\",\n        docParams,\n        data ? [data.buffer] : null\n      );\n\n      let networkStream;\n      if (rangeTransport) {\n        networkStream = new PDFDataTransportStream(rangeTransport, {\n          disableRange,\n          disableStream,\n        });\n      } else if (!data) {\n        if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n          throw new Error(\"Not implemented: NetworkStream\");\n        }\n        if (!url) {\n          throw new Error(\"getDocument - no `url` parameter provided.\");\n        }\n        // eslint-disable-next-line no-nested-ternary\n        const NetworkStream = isValidFetchUrl(url)\n          ? PDFFetchStream\n          : typeof PDFJSDev !== \"undefined\" &&\n              PDFJSDev.test(\"GENERIC\") &&\n              isNodeJS\n            ? PDFNodeStream\n            : PDFNetworkStream;\n\n        networkStream = new NetworkStream({\n          url,\n          length,\n          httpHeaders,\n          withCredentials,\n          rangeChunkSize,\n          disableRange,\n          disableStream,\n        });\n      }\n\n      return workerIdPromise.then(workerId => {\n        if (task.destroyed) {\n          throw new Error(\"Loading aborted\");\n        }\n        if (worker.destroyed) {\n          throw new Error(\"Worker was destroyed\");\n        }\n\n        const messageHandler = new MessageHandler(docId, workerId, worker.port);\n        const transport = new WorkerTransport(\n          messageHandler,\n          task,\n          networkStream,\n          transportParams,\n          transportFactory,\n          enableHWA\n        );\n        task._transport = transport;\n        messageHandler.send(\"Ready\", null);\n      });\n    })\n    .catch(task._capability.reject);\n\n  return task;\n}\n\n/**\n * @typedef {Object} OnProgressParameters\n * @property {number} loaded - Currently loaded number of bytes.\n * @property {number} total - Total number of bytes in the PDF file.\n */\n\n/**\n * The loading task controls the operations required to load a PDF document\n * (such as network requests) and provides a way to listen for completion,\n * after which individual pages can be rendered.\n */\nclass PDFDocumentLoadingTask {\n  static #docId = 0;\n\n  /**\n   * @private\n   */\n  _capability = Promise.withResolvers();\n\n  /**\n   * @private\n   */\n  _transport = null;\n\n  /**\n   * @private\n   */\n  _worker = null;\n\n  /**\n   * Unique identifier for the document loading task.\n   * @type {string}\n   */\n  docId = `d${PDFDocumentLoadingTask.#docId++}`;\n\n  /**\n   * Whether the loading task is destroyed or not.\n   * @type {boolean}\n   */\n  destroyed = false;\n\n  /**\n   * Callback to request a password if a wrong or no password was provided.\n   * The callback receives two parameters: a function that should be called\n   * with the new password, and a reason (see {@link PasswordResponses}).\n   * @type {function}\n   */\n  onPassword = null;\n\n  /**\n   * Callback to be able to monitor the loading progress of the PDF file\n   * (necessary to implement e.g. a loading bar).\n   * The callback receives an {@link OnProgressParameters} argument.\n   * @type {function}\n   */\n  onProgress = null;\n\n  /**\n   * Promise for document loading task completion.\n   * @type {Promise<PDFDocumentProxy>}\n   */\n  get promise() {\n    return this._capability.promise;\n  }\n\n  /**\n   * Abort all network requests and destroy the worker.\n   * @returns {Promise<void>} A promise that is resolved when destruction is\n   *   completed.\n   */\n  async destroy() {\n    this.destroyed = true;\n\n    try {\n      if (this._worker?.port) {\n        this._worker._pendingDestroy = true;\n      }\n      await this._transport?.destroy();\n    } catch (ex) {\n      if (this._worker?.port) {\n        delete this._worker._pendingDestroy;\n      }\n      throw ex;\n    }\n    this._transport = null;\n\n    this._worker?.destroy();\n    this._worker = null;\n  }\n\n  /**\n   * Attempt to fetch the raw data of the PDF document, when e.g.\n   *  - An exception was thrown during document initialization.\n   *  - An `onPassword` callback is delaying initialization.\n   * @returns {Promise<Uint8Array>}\n   */\n  async getData() {\n    return this._transport.getData();\n  }\n}\n\n/**\n * Abstract class to support range requests file loading.\n *\n * NOTE: The TypedArrays passed to the constructor and relevant methods below\n * will generally be transferred to the worker-thread. This will help reduce\n * main-thread memory usage, however it will take ownership of the TypedArrays.\n */\nclass PDFDataRangeTransport {\n  #capability = Promise.withResolvers();\n\n  #progressiveDoneListeners = [];\n\n  #progressiveReadListeners = [];\n\n  #progressListeners = [];\n\n  #rangeListeners = [];\n\n  /**\n   * @param {number} length\n   * @param {Uint8Array|null} initialData\n   * @param {boolean} [progressiveDone]\n   * @param {string} [contentDispositionFilename]\n   */\n  constructor(\n    length,\n    initialData,\n    progressiveDone = false,\n    contentDispositionFilename = null\n  ) {\n    this.length = length;\n    this.initialData = initialData;\n    this.progressiveDone = progressiveDone;\n    this.contentDispositionFilename = contentDispositionFilename;\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addRangeListener(listener) {\n    this.#rangeListeners.push(listener);\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addProgressListener(listener) {\n    this.#progressListeners.push(listener);\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addProgressiveReadListener(listener) {\n    this.#progressiveReadListeners.push(listener);\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addProgressiveDoneListener(listener) {\n    this.#progressiveDoneListeners.push(listener);\n  }\n\n  /**\n   * @param {number} begin\n   * @param {Uint8Array|null} chunk\n   */\n  onDataRange(begin, chunk) {\n    for (const listener of this.#rangeListeners) {\n      listener(begin, chunk);\n    }\n  }\n\n  /**\n   * @param {number} loaded\n   * @param {number|undefined} total\n   */\n  onDataProgress(loaded, total) {\n    this.#capability.promise.then(() => {\n      for (const listener of this.#progressListeners) {\n        listener(loaded, total);\n      }\n    });\n  }\n\n  /**\n   * @param {Uint8Array|null} chunk\n   */\n  onDataProgressiveRead(chunk) {\n    this.#capability.promise.then(() => {\n      for (const listener of this.#progressiveReadListeners) {\n        listener(chunk);\n      }\n    });\n  }\n\n  onDataProgressiveDone() {\n    this.#capability.promise.then(() => {\n      for (const listener of this.#progressiveDoneListeners) {\n        listener();\n      }\n    });\n  }\n\n  transportReady() {\n    this.#capability.resolve();\n  }\n\n  /**\n   * @param {number} begin\n   * @param {number} end\n   */\n  requestDataRange(begin, end) {\n    unreachable(\"Abstract method PDFDataRangeTransport.requestDataRange\");\n  }\n\n  abort() {}\n}\n\n/**\n * Proxy to a `PDFDocument` in the worker thread.\n */\nclass PDFDocumentProxy {\n  constructor(pdfInfo, transport) {\n    this._pdfInfo = pdfInfo;\n    this._transport = transport;\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"getNetworkStreamName\", {\n        value: () => this._transport.getNetworkStreamName(),\n      });\n      Object.defineProperty(this, \"getXFADatasets\", {\n        value: () => this._transport.getXFADatasets(),\n      });\n      Object.defineProperty(this, \"getStartXRefPos\", {\n        value: () => this._transport.getStartXRefPos(),\n      });\n      Object.defineProperty(this, \"getAnnotArray\", {\n        value: pageIndex => this._transport.getAnnotArray(pageIndex),\n      });\n    }\n  }\n\n  /**\n   * @type {AnnotationStorage} Storage for annotation data in forms.\n   */\n  get annotationStorage() {\n    return this._transport.annotationStorage;\n  }\n\n  /**\n   * @type {Object} The canvas factory instance.\n   */\n  get canvasFactory() {\n    return this._transport.canvasFactory;\n  }\n\n  /**\n   * @type {Object} The filter factory instance.\n   */\n  get filterFactory() {\n    return this._transport.filterFactory;\n  }\n\n  /**\n   * @type {number} Total number of pages in the PDF file.\n   */\n  get numPages() {\n    return this._pdfInfo.numPages;\n  }\n\n  /**\n   * @type {Array<string | null>} A (not guaranteed to be) unique ID to identify\n   *   the PDF document.\n   *   NOTE: The first element will always be defined for all PDF documents,\n   *   whereas the second element is only defined for *modified* PDF documents.\n   */\n  get fingerprints() {\n    return this._pdfInfo.fingerprints;\n  }\n\n  /**\n   * @type {boolean} True if only XFA form.\n   */\n  get isPureXfa() {\n    return shadow(this, \"isPureXfa\", !!this._transport._htmlForXfa);\n  }\n\n  /**\n   * NOTE: This is (mostly) intended to support printing of XFA forms.\n   *\n   * @type {Object | null} An object representing a HTML tree structure\n   *   to render the XFA, or `null` when no XFA form exists.\n   */\n  get allXfaHtml() {\n    return this._transport._htmlForXfa;\n  }\n\n  /**\n   * @param {number} pageNumber - The page number to get. The first page is 1.\n   * @returns {Promise<PDFPageProxy>} A promise that is resolved with\n   *   a {@link PDFPageProxy} object.\n   */\n  getPage(pageNumber) {\n    return this._transport.getPage(pageNumber);\n  }\n\n  /**\n   * @param {RefProxy} ref - The page reference.\n   * @returns {Promise<number>} A promise that is resolved with the page index,\n   *   starting from zero, that is associated with the reference.\n   */\n  getPageIndex(ref) {\n    return this._transport.getPageIndex(ref);\n  }\n\n  /**\n   * @returns {Promise<Object<string, Array<any>>>} A promise that is resolved\n   *   with a mapping from named destinations to references.\n   *\n   * This can be slow for large documents. Use `getDestination` instead.\n   */\n  getDestinations() {\n    return this._transport.getDestinations();\n  }\n\n  /**\n   * @param {string} id - The named destination to get.\n   * @returns {Promise<Array<any> | null>} A promise that is resolved with all\n   *   information of the given named destination, or `null` when the named\n   *   destination is not present in the PDF file.\n   */\n  getDestination(id) {\n    return this._transport.getDestination(id);\n  }\n\n  /**\n   * @returns {Promise<Array<string> | null>} A promise that is resolved with\n   *   an {Array} containing the page labels that correspond to the page\n   *   indexes, or `null` when no page labels are present in the PDF file.\n   */\n  getPageLabels() {\n    return this._transport.getPageLabels();\n  }\n\n  /**\n   * @returns {Promise<string>} A promise that is resolved with a {string}\n   *   containing the page layout name.\n   */\n  getPageLayout() {\n    return this._transport.getPageLayout();\n  }\n\n  /**\n   * @returns {Promise<string>} A promise that is resolved with a {string}\n   *   containing the page mode name.\n   */\n  getPageMode() {\n    return this._transport.getPageMode();\n  }\n\n  /**\n   * @returns {Promise<Object | null>} A promise that is resolved with an\n   *   {Object} containing the viewer preferences, or `null` when no viewer\n   *   preferences are present in the PDF file.\n   */\n  getViewerPreferences() {\n    return this._transport.getViewerPreferences();\n  }\n\n  /**\n   * @returns {Promise<any | null>} A promise that is resolved with an {Array}\n   *   containing the destination, or `null` when no open action is present\n   *   in the PDF.\n   */\n  getOpenAction() {\n    return this._transport.getOpenAction();\n  }\n\n  /**\n   * @returns {Promise<any>} A promise that is resolved with a lookup table\n   *   for mapping named attachments to their content.\n   */\n  getAttachments() {\n    return this._transport.getAttachments();\n  }\n\n  /**\n   * @param {Set<number>} types - The annotation types to retrieve.\n   * @param {Set<number>} pageIndexesToSkip\n   * @returns {Promise<Array<Object>>} A promise that is resolved with a list of\n   *   annotations data.\n   */\n  getAnnotationsByType(types, pageIndexesToSkip) {\n    return this._transport.getAnnotationsByType(types, pageIndexesToSkip);\n  }\n\n  /**\n   * @returns {Promise<Object | null>} A promise that is resolved with\n   *   an {Object} with the JavaScript actions:\n   *     - from the name tree.\n   *     - from A or AA entries in the catalog dictionary.\n   *   , or `null` if no JavaScript exists.\n   */\n  getJSActions() {\n    return this._transport.getDocJSActions();\n  }\n\n  /**\n   * @typedef {Object} OutlineNode\n   * @property {string} title\n   * @property {boolean} bold\n   * @property {boolean} italic\n   * @property {Uint8ClampedArray} color - The color in RGB format to use for\n   *   display purposes.\n   * @property {string | Array<any> | null} dest\n   * @property {string | null} url\n   * @property {string | undefined} unsafeUrl\n   * @property {boolean | undefined} newWindow\n   * @property {number | undefined} count\n   * @property {Array<OutlineNode>} items\n   */\n\n  /**\n   * @returns {Promise<Array<OutlineNode>>} A promise that is resolved with an\n   *   {Array} that is a tree outline (if it has one) of the PDF file.\n   */\n  getOutline() {\n    return this._transport.getOutline();\n  }\n\n  /**\n   * @typedef {Object} GetOptionalContentConfigParameters\n   * @property {string} [intent] - Determines the optional content groups that\n   *   are visible by default; valid values are:\n   *    - 'display' (viewable groups).\n   *    - 'print' (printable groups).\n   *    - 'any' (all groups).\n   *   The default value is 'display'.\n   */\n\n  /**\n   * @param {GetOptionalContentConfigParameters} [params] - Optional content\n   *   config parameters.\n   * @returns {Promise<OptionalContentConfig>} A promise that is resolved with\n   *   an {@link OptionalContentConfig} that contains all the optional content\n   *   groups (assuming that the document has any).\n   */\n  getOptionalContentConfig({ intent = \"display\" } = {}) {\n    const { renderingIntent } = this._transport.getRenderingIntent(intent);\n\n    return this._transport.getOptionalContentConfig(renderingIntent);\n  }\n\n  /**\n   * @returns {Promise<Array<number> | null>} A promise that is resolved with\n   *   an {Array} that contains the permission flags for the PDF document, or\n   *   `null` when no permissions are present in the PDF file.\n   */\n  getPermissions() {\n    return this._transport.getPermissions();\n  }\n\n  /**\n   * @returns {Promise<{ info: Object, metadata: Metadata }>} A promise that is\n   *   resolved with an {Object} that has `info` and `metadata` properties.\n   *   `info` is an {Object} filled with anything available in the information\n   *   dictionary and similarly `metadata` is a {Metadata} object with\n   *   information from the metadata section of the PDF.\n   */\n  getMetadata() {\n    return this._transport.getMetadata();\n  }\n\n  /**\n   * @typedef {Object} MarkInfo\n   * Properties correspond to Table 321 of the PDF 32000-1:2008 spec.\n   * @property {boolean} Marked\n   * @property {boolean} UserProperties\n   * @property {boolean} Suspects\n   */\n\n  /**\n   * @returns {Promise<MarkInfo | null>} A promise that is resolved with\n   *   a {MarkInfo} object that contains the MarkInfo flags for the PDF\n   *   document, or `null` when no MarkInfo values are present in the PDF file.\n   */\n  getMarkInfo() {\n    return this._transport.getMarkInfo();\n  }\n\n  /**\n   * @returns {Promise<Uint8Array>} A promise that is resolved with a\n   *   {Uint8Array} containing the raw data of the PDF document.\n   */\n  getData() {\n    return this._transport.getData();\n  }\n\n  /**\n   * @returns {Promise<Uint8Array>} A promise that is resolved with a\n   *   {Uint8Array} containing the full data of the saved document.\n   */\n  saveDocument() {\n    return this._transport.saveDocument();\n  }\n\n  /**\n   * @typedef {Object} PageInfo\n   * @property {null|Uint8Array} document\n   * @property {Array<Array<number>|number>} [includePages]\n   *  included ranges or indices.\n   * @property {Array<Array<number>|number>} [excludePages]\n   *  excluded ranges or indices.\n   */\n\n  /**\n   * @param {Array<PageInfo>} pageInfos - The pages to extract.\n   * @returns {Promise<Uint8Array>} A promise that is resolved with a\n   *   {Uint8Array} containing the full data of the saved document.\n   */\n  extractPages(pageInfos) {\n    return this._transport.extractPages(pageInfos);\n  }\n\n  /**\n   * @returns {Promise<{ length: number }>} A promise that is resolved when the\n   *   document's data is loaded. It is resolved with an {Object} that contains\n   *   the `length` property that indicates size of the PDF data in bytes.\n   */\n  getDownloadInfo() {\n    return this._transport.downloadInfoCapability.promise;\n  }\n\n  /**\n   * Cleans up resources allocated by the document on both the main and worker\n   * threads.\n   *\n   * NOTE: Do not, under any circumstances, call this method when rendering is\n   * currently ongoing since that may lead to rendering errors.\n   *\n   * @param {boolean} [keepLoadedFonts] - Let fonts remain attached to the DOM.\n   *   NOTE: This will increase persistent memory usage, hence don't use this\n   *   option unless absolutely necessary. The default value is `false`.\n   * @returns {Promise} A promise that is resolved when clean-up has finished.\n   */\n  cleanup(keepLoadedFonts = false) {\n    return this._transport.startCleanup(keepLoadedFonts || this.isPureXfa);\n  }\n\n  /**\n   * Destroys the current document instance and terminates the worker.\n   */\n  destroy() {\n    return this.loadingTask.destroy();\n  }\n\n  /**\n   * @param {RefProxy} ref - The page reference.\n   * @returns {number | null} The page number, if it's cached.\n   */\n  cachedPageNumber(ref) {\n    return this._transport.cachedPageNumber(ref);\n  }\n\n  /**\n   * @type {DocumentInitParameters} A subset of the current\n   *   {DocumentInitParameters}, which are needed in the viewer.\n   */\n  get loadingParams() {\n    return this._transport.loadingParams;\n  }\n\n  /**\n   * @type {PDFDocumentLoadingTask} The loadingTask for the current document.\n   */\n  get loadingTask() {\n    return this._transport.loadingTask;\n  }\n\n  /**\n   * @returns {Promise<Object<string, Array<Object>> | null>} A promise that is\n   *   resolved with an {Object} containing /AcroForm field data for the JS\n   *   sandbox, or `null` when no field data is present in the PDF file.\n   */\n  getFieldObjects() {\n    return this._transport.getFieldObjects();\n  }\n\n  /**\n   * @returns {Promise<boolean>} A promise that is resolved with `true`\n   *   if some /AcroForm fields have JavaScript actions.\n   */\n  hasJSActions() {\n    return this._transport.hasJSActions();\n  }\n\n  /**\n   * @returns {Promise<Array<string> | null>} A promise that is resolved with an\n   *   {Array<string>} containing IDs of annotations that have a calculation\n   *   action, or `null` when no such annotations are present in the PDF file.\n   */\n  getCalculationOrderIds() {\n    return this._transport.getCalculationOrderIds();\n  }\n}\n\n/**\n * Page getViewport parameters.\n *\n * @typedef {Object} GetViewportParameters\n * @property {number} scale - The desired scale of the viewport.\n * @property {number} [rotation] - The desired rotation, in degrees, of\n *   the viewport. If omitted it defaults to the page rotation.\n * @property {number} [offsetX] - The horizontal, i.e. x-axis, offset.\n *   The default value is `0`.\n * @property {number} [offsetY] - The vertical, i.e. y-axis, offset.\n *   The default value is `0`.\n * @property {boolean} [dontFlip] - If true, the y-axis will not be\n *   flipped. The default value is `false`.\n */\n\n/**\n * Page getTextContent parameters.\n *\n * @typedef {Object} getTextContentParameters\n * @property {boolean} [includeMarkedContent] - When true include marked\n *   content items in the items array of TextContent. The default is `false`.\n * @property {boolean} [disableNormalization] - When true the text is *not*\n *   normalized in the worker-thread. The default is `false`.\n */\n\n/**\n * Page text content.\n *\n * @typedef {Object} TextContent\n * @property {Array<TextItem | TextMarkedContent>} items - Array of\n *   {@link TextItem} and {@link TextMarkedContent} objects. TextMarkedContent\n *   items are included when includeMarkedContent is true.\n * @property {Object<string, TextStyle>} styles - {@link TextStyle} objects,\n *   indexed by font name.\n * @property {string | null} lang - The document /Lang attribute.\n */\n\n/**\n * Page text content part.\n *\n * @typedef {Object} TextItem\n * @property {string} str - Text content.\n * @property {string} dir - Text direction: 'ttb', 'ltr' or 'rtl'.\n * @property {Array<any>} transform - Transformation matrix.\n * @property {number} width - Width in device space.\n * @property {number} height - Height in device space.\n * @property {string} fontName - Font name used by PDF.js for converted font.\n * @property {boolean} hasEOL - Indicating if the text content is followed by a\n *   line-break.\n */\n\n/**\n * Page text marked content part.\n *\n * @typedef {Object} TextMarkedContent\n * @property {string} type - Either 'beginMarkedContent',\n *   'beginMarkedContentProps', or 'endMarkedContent'.\n * @property {string} id - The marked content identifier. Only used for type\n *   'beginMarkedContentProps'.\n */\n\n/**\n * Text style.\n *\n * @typedef {Object} TextStyle\n * @property {number} ascent - Font ascent.\n * @property {number} descent - Font descent.\n * @property {boolean} vertical - Whether or not the text is in vertical mode.\n * @property {string} fontFamily - The possible font family.\n */\n\n/**\n * Page annotation parameters.\n *\n * @typedef {Object} GetAnnotationsParameters\n * @property {string} [intent] - Determines the annotations that are fetched,\n *   can be 'display' (viewable annotations), 'print' (printable annotations),\n *   or 'any' (all annotations). The default value is 'display'.\n */\n\n/**\n * Page render parameters.\n *\n * @typedef {Object} RenderParameters\n * @property {HTMLCanvasElement|null} canvas - A DOM Canvas object. The default\n *   value is the canvas associated with the `canvasContext` parameter if no\n *   value is provided explicitly.\n * @property {PageViewport} viewport - Rendering viewport obtained by calling\n *   the `PDFPageProxy.getViewport` method.\n * @property {CanvasRenderingContext2D} [canvasContext] - 2D context of a DOM\n *   Canvas object for backwards compatibility; it is recommended to use the\n *   `canvas` parameter instead.\n *   If the context must absolutely be used to render the page, the canvas must\n *   be null.\n * @property {string} [intent] - Rendering intent, can be 'display', 'print',\n *   or 'any'. The default value is 'display'.\n * @property {number} [annotationMode] Controls which annotations are rendered\n *   onto the canvas, for annotations with appearance-data; the values from\n *   {@link AnnotationMode} should be used. The following values are supported:\n *    - `AnnotationMode.DISABLE`, which disables all annotations.\n *    - `AnnotationMode.ENABLE`, which includes all possible annotations (thus\n *      it also depends on the `intent`-option, see above).\n *    - `AnnotationMode.ENABLE_FORMS`, which excludes annotations that contain\n *      interactive form elements (those will be rendered in the display layer).\n *    - `AnnotationMode.ENABLE_STORAGE`, which includes all possible annotations\n *      (as above) but where interactive form elements are updated with data\n *      from the {@link AnnotationStorage}-instance; useful e.g. for printing.\n *   The default value is `AnnotationMode.ENABLE`.\n * @property {Array<any>} [transform] - Additional transform, applied just\n *   before viewport transform.\n * @property {CanvasGradient | CanvasPattern | string} [background] - Background\n *   to use for the canvas.\n *   Any valid `canvas.fillStyle` can be used: a `DOMString` parsed as CSS\n *   <color> value, a `CanvasGradient` object (a linear or radial gradient) or\n *   a `CanvasPattern` object (a repetitive image). The default value is\n *   'rgb(255,255,255)'.\n *\n *   NOTE: This option may be partially, or completely, ignored when the\n *   `pageColors`-option is used.\n * @property {Object} [pageColors] - Overwrites background and foreground colors\n *   with user defined ones in order to improve readability in high contrast\n *   mode.\n * @property {Promise<OptionalContentConfig>} [optionalContentConfigPromise] -\n *   A promise that should resolve with an {@link OptionalContentConfig}\n *   created from `PDFDocumentProxy.getOptionalContentConfig`. If `null`,\n *   the configuration will be fetched automatically with the default visibility\n *   states set.\n * @property {Map<string, HTMLCanvasElement>} [annotationCanvasMap] - Map some\n *   annotation ids with canvases used to render them.\n * @property {PrintAnnotationStorage} [printAnnotationStorage]\n * @property {boolean} [isEditing] - Render the page in editing mode.\n * @property {boolean} [recordOperations] - Record the dependencies and bounding\n *   boxes of all PDF operations that render onto the canvas.\n * @property {OperationsFilter} [operationsFilter] - If provided, only\n *   run for which this function returns `true`.\n */\n\n/**\n * @callback OperationsFilter\n * @param {number} index - The index of the operation.\n * @returns {boolean} If false, the operation is ignored.\n */\n\n/**\n * Page getOperatorList parameters.\n *\n * @typedef {Object} GetOperatorListParameters\n * @property {string} [intent] - Rendering intent, can be 'display', 'print',\n *   or 'any'. The default value is 'display'.\n * @property {number} [annotationMode] Controls which annotations are included\n *   in the operatorList, for annotations with appearance-data; the values from\n *   {@link AnnotationMode} should be used. The following values are supported:\n *    - `AnnotationMode.DISABLE`, which disables all annotations.\n *    - `AnnotationMode.ENABLE`, which includes all possible annotations (thus\n *      it also depends on the `intent`-option, see above).\n *    - `AnnotationMode.ENABLE_FORMS`, which excludes annotations that contain\n *      interactive form elements (those will be rendered in the display layer).\n *    - `AnnotationMode.ENABLE_STORAGE`, which includes all possible annotations\n *      (as above) but where interactive form elements are updated with data\n *      from the {@link AnnotationStorage}-instance; useful e.g. for printing.\n *   The default value is `AnnotationMode.ENABLE`.\n * @property {PrintAnnotationStorage} [printAnnotationStorage]\n * @property {boolean} [isEditing] - Render the page in editing mode.\n */\n\n/**\n * Structure tree node. The root node will have a role \"Root\".\n *\n * @typedef {Object} StructTreeNode\n * @property {Array<StructTreeNode | StructTreeContent>} children - Array of\n *   {@link StructTreeNode} and {@link StructTreeContent} objects.\n * @property {string} role - element's role, already mapped if a role map exists\n * in the PDF.\n */\n\n/**\n * Structure tree content.\n *\n * @typedef {Object} StructTreeContent\n * @property {string} type - either \"content\" for page and stream structure\n *   elements or \"object\" for object references.\n * @property {string} id - unique id that will map to the text layer.\n */\n\n/**\n * PDF page operator list.\n *\n * @typedef {Object} PDFOperatorList\n * @property {Array<number>} fnArray - Array containing the operator functions.\n * @property {Array<any>} argsArray - Array containing the arguments of the\n *   functions.\n */\n\n/**\n * Proxy to a `PDFPage` in the worker thread.\n */\nclass PDFPageProxy {\n  #pendingCleanup = false;\n\n  constructor(pageIndex, pageInfo, transport, pdfBug = false) {\n    this._pageIndex = pageIndex;\n    this._pageInfo = pageInfo;\n    this._transport = transport;\n    this._stats = pdfBug ? new StatTimer() : null;\n    this._pdfBug = pdfBug;\n    /** @type {PDFObjects} */\n    this.commonObjs = transport.commonObjs;\n    this.objs = new PDFObjects();\n\n    this._intentStates = new Map();\n    this.destroyed = false;\n    this.recordedBBoxes = null;\n  }\n\n  /**\n   * @type {number} Page number of the page. First page is 1.\n   */\n  get pageNumber() {\n    return this._pageIndex + 1;\n  }\n\n  /**\n   * @type {number} The number of degrees the page is rotated clockwise.\n   */\n  get rotate() {\n    return this._pageInfo.rotate;\n  }\n\n  /**\n   * @type {RefProxy | null} The reference that points to this page.\n   */\n  get ref() {\n    return this._pageInfo.ref;\n  }\n\n  /**\n   * @type {number} The default size of units in 1/72nds of an inch.\n   */\n  get userUnit() {\n    return this._pageInfo.userUnit;\n  }\n\n  /**\n   * @type {Array<number>} An array of the visible portion of the PDF page in\n   *   user space units [x1, y1, x2, y2].\n   */\n  get view() {\n    return this._pageInfo.view;\n  }\n\n  /**\n   * @param {GetViewportParameters} params - Viewport parameters.\n   * @returns {PageViewport} Contains 'width' and 'height' properties\n   *   along with transforms required for rendering.\n   */\n  getViewport({\n    scale,\n    rotation = this.rotate,\n    offsetX = 0,\n    offsetY = 0,\n    dontFlip = false,\n  } = {}) {\n    return new PageViewport({\n      viewBox: this.view,\n      userUnit: this.userUnit,\n      scale,\n      rotation,\n      offsetX,\n      offsetY,\n      dontFlip,\n    });\n  }\n\n  /**\n   * @param {GetAnnotationsParameters} [params] - Annotation parameters.\n   * @returns {Promise<Array<any>>} A promise that is resolved with an\n   *   {Array} of the annotation objects.\n   */\n  getAnnotations({ intent = \"display\" } = {}) {\n    const { renderingIntent } = this._transport.getRenderingIntent(intent);\n\n    return this._transport.getAnnotations(this._pageIndex, renderingIntent);\n  }\n\n  /**\n   * @returns {Promise<Object>} A promise that is resolved with an\n   *   {Object} with JS actions.\n   */\n  getJSActions() {\n    return this._transport.getPageJSActions(this._pageIndex);\n  }\n\n  /**\n   * @type {Object} The filter factory instance.\n   */\n  get filterFactory() {\n    return this._transport.filterFactory;\n  }\n\n  /**\n   * @type {boolean} True if only XFA form.\n   */\n  get isPureXfa() {\n    return shadow(this, \"isPureXfa\", !!this._transport._htmlForXfa);\n  }\n\n  /**\n   * @returns {Promise<Object | null>} A promise that is resolved with\n   *   an {Object} with a fake DOM object (a tree structure where elements\n   *   are {Object} with a name, attributes (class, style, ...), value and\n   *   children, very similar to a HTML DOM tree), or `null` if no XFA exists.\n   */\n  async getXfa() {\n    return this._transport._htmlForXfa?.children[this._pageIndex] || null;\n  }\n\n  /**\n   * Begins the process of rendering a page to the desired context.\n   *\n   * @param {RenderParameters} params - Page render parameters.\n   * @returns {RenderTask} An object that contains a promise that is\n   *   resolved when the page finishes rendering.\n   */\n  render({\n    canvasContext,\n    canvas = canvasContext.canvas,\n    viewport,\n    intent = \"display\",\n    annotationMode = AnnotationMode.ENABLE,\n    transform = null,\n    background = null,\n    optionalContentConfigPromise = null,\n    annotationCanvasMap = null,\n    pageColors = null,\n    printAnnotationStorage = null,\n    isEditing = false,\n    recordOperations = false,\n    operationsFilter = null,\n  }) {\n    this._stats?.time(\"Overall\");\n\n    const intentArgs = this._transport.getRenderingIntent(\n      intent,\n      annotationMode,\n      printAnnotationStorage,\n      isEditing\n    );\n    const { renderingIntent, cacheKey } = intentArgs;\n    // If there was a pending destroy, cancel it so no cleanup happens during\n    // this call to render.\n    this.#pendingCleanup = false;\n\n    optionalContentConfigPromise ||=\n      this._transport.getOptionalContentConfig(renderingIntent);\n\n    let intentState = this._intentStates.get(cacheKey);\n    if (!intentState) {\n      intentState = Object.create(null);\n      this._intentStates.set(cacheKey, intentState);\n    }\n\n    // Ensure that a pending `streamReader` cancel timeout is always aborted.\n    if (intentState.streamReaderCancelTimeout) {\n      clearTimeout(intentState.streamReaderCancelTimeout);\n      intentState.streamReaderCancelTimeout = null;\n    }\n\n    const intentPrint = !!(renderingIntent & RenderingIntentFlag.PRINT);\n\n    // If there's no displayReadyCapability yet, then the operatorList\n    // was never requested before. Make the request and create the promise.\n    if (!intentState.displayReadyCapability) {\n      intentState.displayReadyCapability = Promise.withResolvers();\n      intentState.operatorList = {\n        fnArray: [],\n        argsArray: [],\n        lastChunk: false,\n        separateAnnots: null,\n      };\n\n      this._stats?.time(\"Page Request\");\n      this._pumpOperatorList(intentArgs);\n    }\n\n    const recordForDebugger = Boolean(\n      this._pdfBug && globalThis.StepperManager?.enabled\n    );\n\n    const shouldRecordOperations =\n      !this.recordedBBoxes && (recordOperations || recordForDebugger);\n\n    const complete = error => {\n      intentState.renderTasks.delete(internalRenderTask);\n\n      if (shouldRecordOperations) {\n        const recordedBBoxes = internalRenderTask.gfx?.dependencyTracker.take();\n        if (recordedBBoxes) {\n          if (internalRenderTask.stepper) {\n            internalRenderTask.stepper.setOperatorBBoxes(\n              recordedBBoxes,\n              internalRenderTask.gfx.dependencyTracker.takeDebugMetadata()\n            );\n          }\n          if (recordOperations) {\n            this.recordedBBoxes = recordedBBoxes;\n          }\n        }\n      }\n\n      // Attempt to reduce memory usage during *printing*, by always running\n      // cleanup immediately once rendering has finished.\n      if (intentPrint) {\n        this.#pendingCleanup = true;\n      }\n      this.#tryCleanup();\n\n      if (error) {\n        internalRenderTask.capability.reject(error);\n\n        this._abortOperatorList({\n          intentState,\n          reason: error instanceof Error ? error : new Error(error),\n        });\n      } else {\n        internalRenderTask.capability.resolve();\n      }\n\n      if (this._stats) {\n        this._stats.timeEnd(\"Rendering\");\n        this._stats.timeEnd(\"Overall\");\n\n        if (globalThis.Stats?.enabled) {\n          globalThis.Stats.add(this.pageNumber, this._stats);\n        }\n      }\n    };\n\n    const internalRenderTask = new InternalRenderTask({\n      callback: complete,\n      // Only include the required properties, and *not* the entire object.\n      params: {\n        canvas,\n        canvasContext,\n        dependencyTracker: shouldRecordOperations\n          ? new CanvasDependencyTracker(\n              canvas,\n              intentState.operatorList.length,\n              recordForDebugger\n            )\n          : null,\n        viewport,\n        transform,\n        background,\n      },\n      objs: this.objs,\n      commonObjs: this.commonObjs,\n      annotationCanvasMap,\n      operatorList: intentState.operatorList,\n      pageIndex: this._pageIndex,\n      canvasFactory: this._transport.canvasFactory,\n      filterFactory: this._transport.filterFactory,\n      useRequestAnimationFrame: !intentPrint,\n      pdfBug: this._pdfBug,\n      pageColors,\n      enableHWA: this._transport.enableHWA,\n      operationsFilter,\n    });\n\n    (intentState.renderTasks ||= new Set()).add(internalRenderTask);\n    const renderTask = internalRenderTask.task;\n\n    Promise.all([\n      intentState.displayReadyCapability.promise,\n      optionalContentConfigPromise,\n    ])\n      .then(([transparency, optionalContentConfig]) => {\n        if (this.destroyed) {\n          complete();\n          return;\n        }\n        this._stats?.time(\"Rendering\");\n\n        if (!(optionalContentConfig.renderingIntent & renderingIntent)) {\n          throw new Error(\n            \"Must use the same `intent`-argument when calling the `PDFPageProxy.render` \" +\n              \"and `PDFDocumentProxy.getOptionalContentConfig` methods.\"\n          );\n        }\n        internalRenderTask.initializeGraphics({\n          transparency,\n          optionalContentConfig,\n        });\n        internalRenderTask.operatorListChanged();\n      })\n      .catch(complete);\n\n    return renderTask;\n  }\n\n  /**\n   * @param {GetOperatorListParameters} params - Page getOperatorList\n   *   parameters.\n   * @returns {Promise<PDFOperatorList>} A promise resolved with an\n   *   {@link PDFOperatorList} object that represents the page's operator list.\n   */\n  getOperatorList({\n    intent = \"display\",\n    annotationMode = AnnotationMode.ENABLE,\n    printAnnotationStorage = null,\n    isEditing = false,\n  } = {}) {\n    if (typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"GENERIC\")) {\n      throw new Error(\"Not implemented: getOperatorList\");\n    }\n    function operatorListChanged() {\n      if (intentState.operatorList.lastChunk) {\n        intentState.opListReadCapability.resolve(intentState.operatorList);\n\n        intentState.renderTasks.delete(opListTask);\n      }\n    }\n\n    const intentArgs = this._transport.getRenderingIntent(\n      intent,\n      annotationMode,\n      printAnnotationStorage,\n      isEditing,\n      /* isOpList = */ true\n    );\n    let intentState = this._intentStates.get(intentArgs.cacheKey);\n    if (!intentState) {\n      intentState = Object.create(null);\n      this._intentStates.set(intentArgs.cacheKey, intentState);\n    }\n    let opListTask;\n\n    if (!intentState.opListReadCapability) {\n      opListTask = Object.create(null);\n      opListTask.operatorListChanged = operatorListChanged;\n      intentState.opListReadCapability = Promise.withResolvers();\n      (intentState.renderTasks ||= new Set()).add(opListTask);\n      intentState.operatorList = {\n        fnArray: [],\n        argsArray: [],\n        lastChunk: false,\n        separateAnnots: null,\n      };\n\n      this._stats?.time(\"Page Request\");\n      this._pumpOperatorList(intentArgs);\n    }\n    return intentState.opListReadCapability.promise;\n  }\n\n  /**\n   * NOTE: All occurrences of whitespace will be replaced by\n   * standard spaces (0x20).\n   *\n   * @param {getTextContentParameters} params - getTextContent parameters.\n   * @returns {ReadableStream} Stream for reading text content chunks.\n   */\n  streamTextContent({\n    includeMarkedContent = false,\n    disableNormalization = false,\n  } = {}) {\n    const TEXT_CONTENT_CHUNK_SIZE = 100;\n\n    return this._transport.messageHandler.sendWithStream(\n      \"GetTextContent\",\n      {\n        pageIndex: this._pageIndex,\n        includeMarkedContent: includeMarkedContent === true,\n        disableNormalization: disableNormalization === true,\n      },\n      {\n        highWaterMark: TEXT_CONTENT_CHUNK_SIZE,\n        size(textContent) {\n          return textContent.items.length;\n        },\n      }\n    );\n  }\n\n  /**\n   * NOTE: All occurrences of whitespace will be replaced by\n   * standard spaces (0x20).\n   *\n   * @param {getTextContentParameters} params - getTextContent parameters.\n   * @returns {Promise<TextContent>} A promise that is resolved with a\n   *   {@link TextContent} object that represents the page's text content.\n   */\n  getTextContent(params = {}) {\n    if (this._transport._htmlForXfa) {\n      // TODO: We need to revisit this once the XFA foreground patch lands and\n      // only do this for non-foreground XFA.\n      return this.getXfa().then(xfa => XfaText.textContent(xfa));\n    }\n    const readableStream = this.streamTextContent(params);\n\n    return new Promise(function (resolve, reject) {\n      function pump() {\n        reader.read().then(function ({ value, done }) {\n          if (done) {\n            resolve(textContent);\n            return;\n          }\n          textContent.lang ??= value.lang;\n          Object.assign(textContent.styles, value.styles);\n          textContent.items.push(...value.items);\n          pump();\n        }, reject);\n      }\n\n      const reader = readableStream.getReader();\n      const textContent = {\n        items: [],\n        styles: Object.create(null),\n        lang: null,\n      };\n      pump();\n    });\n  }\n\n  /**\n   * @returns {Promise<StructTreeNode>} A promise that is resolved with a\n   *   {@link StructTreeNode} object that represents the page's structure tree,\n   *   or `null` when no structure tree is present for the current page.\n   */\n  getStructTree() {\n    return this._transport.getStructTree(this._pageIndex);\n  }\n\n  /**\n   * Destroys the page object.\n   * @private\n   */\n  _destroy() {\n    this.destroyed = true;\n\n    const waitOn = [];\n    for (const intentState of this._intentStates.values()) {\n      this._abortOperatorList({\n        intentState,\n        reason: new Error(\"Page was destroyed.\"),\n        force: true,\n      });\n\n      if (intentState.opListReadCapability) {\n        // Avoid errors below, since the renderTasks are just stubs.\n        continue;\n      }\n      for (const internalRenderTask of intentState.renderTasks) {\n        waitOn.push(internalRenderTask.completed);\n        internalRenderTask.cancel();\n      }\n    }\n    this.objs.clear();\n    this.#pendingCleanup = false;\n\n    return Promise.all(waitOn);\n  }\n\n  /**\n   * Cleans up resources allocated by the page.\n   *\n   * @param {boolean} [resetStats] - Reset page stats, if enabled.\n   *   The default value is `false`.\n   * @returns {boolean} Indicates if clean-up was successfully run.\n   */\n  cleanup(resetStats = false) {\n    this.#pendingCleanup = true;\n    const success = this.#tryCleanup();\n\n    if (resetStats && success) {\n      this._stats &&= new StatTimer();\n    }\n    return success;\n  }\n\n  /**\n   * Attempts to clean up if rendering is in a state where that's possible.\n   * @returns {boolean} Indicates if clean-up was successfully run.\n   */\n  #tryCleanup() {\n    if (!this.#pendingCleanup || this.destroyed) {\n      return false;\n    }\n    for (const { renderTasks, operatorList } of this._intentStates.values()) {\n      if (renderTasks.size > 0 || !operatorList.lastChunk) {\n        return false;\n      }\n    }\n    this._intentStates.clear();\n    this.objs.clear();\n    this.#pendingCleanup = false;\n    return true;\n  }\n\n  /**\n   * @private\n   */\n  _startRenderPage(transparency, cacheKey) {\n    const intentState = this._intentStates.get(cacheKey);\n    if (!intentState) {\n      return; // Rendering was cancelled.\n    }\n    this._stats?.timeEnd(\"Page Request\");\n\n    // TODO Refactor RenderPageRequest to separate rendering\n    // and operator list logic\n    intentState.displayReadyCapability?.resolve(transparency);\n  }\n\n  /**\n   * @private\n   */\n  _renderPageChunk(operatorListChunk, intentState) {\n    // Add the new chunk to the current operator list.\n    for (let i = 0, ii = operatorListChunk.length; i < ii; i++) {\n      intentState.operatorList.fnArray.push(operatorListChunk.fnArray[i]);\n      intentState.operatorList.argsArray.push(operatorListChunk.argsArray[i]);\n    }\n    intentState.operatorList.lastChunk = operatorListChunk.lastChunk;\n    intentState.operatorList.separateAnnots = operatorListChunk.separateAnnots;\n\n    // Notify all the rendering tasks there are more operators to be consumed.\n    for (const internalRenderTask of intentState.renderTasks) {\n      internalRenderTask.operatorListChanged();\n    }\n\n    if (operatorListChunk.lastChunk) {\n      this.#tryCleanup();\n    }\n  }\n\n  /**\n   * @private\n   */\n  _pumpOperatorList({\n    renderingIntent,\n    cacheKey,\n    annotationStorageSerializable,\n    modifiedIds,\n  }) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        Number.isInteger(renderingIntent) && renderingIntent > 0,\n        '_pumpOperatorList: Expected valid \"renderingIntent\" argument.'\n      );\n    }\n    const { map, transfer } = annotationStorageSerializable;\n\n    const readableStream = this._transport.messageHandler.sendWithStream(\n      \"GetOperatorList\",\n      {\n        pageIndex: this._pageIndex,\n        intent: renderingIntent,\n        cacheKey,\n        annotationStorage: map,\n        modifiedIds,\n      },\n      transfer\n    );\n    const reader = readableStream.getReader();\n\n    const intentState = this._intentStates.get(cacheKey);\n    intentState.streamReader = reader;\n\n    const pump = () => {\n      reader.read().then(\n        ({ value, done }) => {\n          if (done) {\n            intentState.streamReader = null;\n            return;\n          }\n          if (this._transport.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          this._renderPageChunk(value, intentState);\n          pump();\n        },\n        reason => {\n          intentState.streamReader = null;\n\n          if (this._transport.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          if (intentState.operatorList) {\n            // Mark operator list as complete.\n            intentState.operatorList.lastChunk = true;\n\n            for (const internalRenderTask of intentState.renderTasks) {\n              internalRenderTask.operatorListChanged();\n            }\n            this.#tryCleanup();\n          }\n\n          if (intentState.displayReadyCapability) {\n            intentState.displayReadyCapability.reject(reason);\n          } else if (intentState.opListReadCapability) {\n            intentState.opListReadCapability.reject(reason);\n          } else {\n            throw reason;\n          }\n        }\n      );\n    };\n    pump();\n  }\n\n  /**\n   * @private\n   */\n  _abortOperatorList({ intentState, reason, force = false }) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        reason instanceof Error,\n        '_abortOperatorList: Expected valid \"reason\" argument.'\n      );\n    }\n\n    if (!intentState.streamReader) {\n      return;\n    }\n    // Ensure that a pending `streamReader` cancel timeout is always aborted.\n    if (intentState.streamReaderCancelTimeout) {\n      clearTimeout(intentState.streamReaderCancelTimeout);\n      intentState.streamReaderCancelTimeout = null;\n    }\n\n    if (!force) {\n      // Ensure that an Error occurring in *only* one `InternalRenderTask`, e.g.\n      // multiple render() calls on the same canvas, won't break all rendering.\n      if (intentState.renderTasks.size > 0) {\n        return;\n      }\n      // Don't immediately abort parsing on the worker-thread when rendering is\n      // cancelled, since that will unnecessarily delay re-rendering when (for\n      // partially parsed pages) e.g. zooming/rotation occurs in the viewer.\n      if (reason instanceof RenderingCancelledException) {\n        let delay = RENDERING_CANCELLED_TIMEOUT;\n        if (reason.extraDelay > 0 && reason.extraDelay < /* ms = */ 1000) {\n          // Above, we prevent the total delay from becoming arbitrarily large.\n          delay += reason.extraDelay;\n        }\n\n        intentState.streamReaderCancelTimeout = setTimeout(() => {\n          intentState.streamReaderCancelTimeout = null;\n          this._abortOperatorList({ intentState, reason, force: true });\n        }, delay);\n        return;\n      }\n    }\n    intentState.streamReader\n      .cancel(new AbortException(reason.message))\n      .catch(() => {\n        // Avoid \"Uncaught promise\" messages in the console.\n      });\n    intentState.streamReader = null;\n\n    if (this._transport.destroyed) {\n      return; // Ignore any pending requests if the worker was terminated.\n    }\n    // Remove the current `intentState`, since a cancelled `getOperatorList`\n    // call on the worker-thread cannot be re-started...\n    for (const [curCacheKey, curIntentState] of this._intentStates) {\n      if (curIntentState === intentState) {\n        this._intentStates.delete(curCacheKey);\n        break;\n      }\n    }\n    // ... and force clean-up to ensure that any old state is always removed.\n    this.cleanup();\n  }\n\n  /**\n   * @type {StatTimer | null} Returns page stats, if enabled; returns `null`\n   *   otherwise.\n   */\n  get stats() {\n    return this._stats;\n  }\n}\n\n/**\n * @typedef {Object} PDFWorkerParameters\n * @property {string} [name] - The name of the worker.\n * @property {Worker} [port] - The `workerPort` object.\n * @property {number} [verbosity] - Controls the logging level;\n *   the constants from {@link VerbosityLevel} should be used.\n */\n\n/**\n * PDF.js web worker abstraction that controls the instantiation of PDF\n * documents. Message handlers are used to pass information from the main\n * thread to the worker thread and vice versa. If the creation of a web\n * worker is not possible, a \"fake\" worker will be used instead.\n *\n * @param {PDFWorkerParameters} params - The worker initialization parameters.\n */\nclass PDFWorker {\n  #capability = Promise.withResolvers();\n\n  #messageHandler = null;\n\n  #port = null;\n\n  #webWorker = null;\n\n  static #fakeWorkerId = 0;\n\n  static #isWorkerDisabled = false;\n\n  static #workerPorts = new WeakMap();\n\n  static {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      if (isNodeJS) {\n        // Workers aren't supported in Node.js, force-disabling them there.\n        this.#isWorkerDisabled = true;\n\n        GlobalWorkerOptions.workerSrc ||= PDFJSDev.test(\"LIB\")\n          ? \"../pdf.worker.js\"\n          : \"./pdf.worker.mjs\";\n      }\n\n      // Check if URLs have the same origin. For non-HTTP based URLs, returns\n      // false.\n      this._isSameOrigin = (baseUrl, otherUrl) => {\n        const base = URL.parse(baseUrl);\n        if (!base?.origin || base.origin === \"null\") {\n          return false; // non-HTTP url\n        }\n        const other = new URL(otherUrl, base);\n        return base.origin === other.origin;\n      };\n\n      this._createCDNWrapper = url => {\n        // We will rely on blob URL's property to specify origin.\n        // We want this function to fail in case if createObjectURL or Blob do\n        // not exist or fail for some reason -- our Worker creation will fail\n        // anyway.\n        const wrapper = `await import(\"${url}\");`;\n        return URL.createObjectURL(\n          new Blob([wrapper], { type: \"text/javascript\" })\n        );\n      };\n\n      this.fromPort = params => {\n        deprecated(\n          \"`PDFWorker.fromPort` - please use `PDFWorker.create` instead.\"\n        );\n        if (!params?.port) {\n          throw new Error(\"PDFWorker.fromPort - invalid method signature.\");\n        }\n        return this.create(params);\n      };\n    }\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      this._resetGlobalState = () => {\n        this.#isWorkerDisabled = false;\n        delete globalThis.pdfjsWorker;\n      };\n    }\n  }\n\n  constructor({\n    name = null,\n    port = null,\n    verbosity = getVerbosityLevel(),\n  } = {}) {\n    this.name = name;\n    this.destroyed = false;\n    this.verbosity = verbosity;\n\n    if (port) {\n      if (PDFWorker.#workerPorts.has(port)) {\n        throw new Error(\"Cannot use more than one PDFWorker per port.\");\n      }\n      PDFWorker.#workerPorts.set(port, this);\n      this.#initializeFromPort(port);\n    } else {\n      this.#initialize();\n    }\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"_webWorker\", {\n        get() {\n          return this.#webWorker;\n        },\n      });\n    }\n  }\n\n  /**\n   * Promise for worker initialization completion.\n   * @type {Promise<void>}\n   */\n  get promise() {\n    return this.#capability.promise;\n  }\n\n  #resolve() {\n    this.#capability.resolve();\n    // Send global setting, e.g. verbosity level.\n    this.#messageHandler.send(\"configure\", {\n      verbosity: this.verbosity,\n    });\n  }\n\n  /**\n   * The current `workerPort`, when it exists.\n   * @type {Worker}\n   */\n  get port() {\n    return this.#port;\n  }\n\n  /**\n   * The current MessageHandler-instance.\n   * @type {MessageHandler}\n   */\n  get messageHandler() {\n    return this.#messageHandler;\n  }\n\n  #initializeFromPort(port) {\n    this.#port = port;\n    this.#messageHandler = new MessageHandler(\"main\", \"worker\", port);\n    this.#messageHandler.on(\"ready\", () => {\n      // Ignoring \"ready\" event -- MessageHandler should already be initialized\n      // and ready to accept messages.\n    });\n    this.#resolve();\n  }\n\n  #initialize() {\n    // If worker support isn't disabled explicit and the browser has worker\n    // support, create a new web worker and test if it/the browser fulfills\n    // all requirements to run parts of pdf.js in a web worker.\n    // Right now, the requirement is, that an Uint8Array is still an\n    // Uint8Array as it arrives on the worker.\n    if (\n      PDFWorker.#isWorkerDisabled ||\n      PDFWorker.#mainThreadWorkerMessageHandler\n    ) {\n      this.#setupFakeWorker();\n      return;\n    }\n    let { workerSrc } = PDFWorker;\n\n    try {\n      // Wraps workerSrc path into blob URL, if the former does not belong\n      // to the same origin.\n      if (\n        typeof PDFJSDev !== \"undefined\" &&\n        PDFJSDev.test(\"GENERIC\") &&\n        !PDFWorker._isSameOrigin(window.location, workerSrc)\n      ) {\n        workerSrc = PDFWorker._createCDNWrapper(\n          new URL(workerSrc, window.location).href\n        );\n      }\n\n      const worker = new Worker(workerSrc, { type: \"module\" });\n      const messageHandler = new MessageHandler(\"main\", \"worker\", worker);\n      const terminateEarly = () => {\n        ac.abort();\n        messageHandler.destroy();\n        worker.terminate();\n        if (this.destroyed) {\n          this.#capability.reject(new Error(\"Worker was destroyed\"));\n        } else {\n          // Fall back to fake worker if the termination is caused by an\n          // error (e.g. NetworkError / SecurityError).\n          this.#setupFakeWorker();\n        }\n      };\n\n      const ac = new AbortController();\n      worker.addEventListener(\n        \"error\",\n        () => {\n          if (!this.#webWorker) {\n            // Worker failed to initialize due to an error. Clean up and fall\n            // back to the fake worker.\n            terminateEarly();\n          }\n        },\n        { signal: ac.signal }\n      );\n\n      messageHandler.on(\"test\", data => {\n        ac.abort();\n        if (this.destroyed || !data) {\n          terminateEarly();\n          return;\n        }\n        this.#messageHandler = messageHandler;\n        this.#port = worker;\n        this.#webWorker = worker;\n\n        this.#resolve();\n      });\n\n      messageHandler.on(\"ready\", data => {\n        ac.abort();\n        if (this.destroyed) {\n          terminateEarly();\n          return;\n        }\n        try {\n          sendTest();\n        } catch {\n          // We need fallback to a faked worker.\n          this.#setupFakeWorker();\n        }\n      });\n\n      const sendTest = () => {\n        const testObj = new Uint8Array();\n        // Ensure that we can use `postMessage` transfers.\n        messageHandler.send(\"test\", testObj, [testObj.buffer]);\n      };\n\n      // It might take time for the worker to initialize. We will try to send\n      // the \"test\" message immediately, and once the \"ready\" message arrives.\n      // The worker shall process only the first received \"test\" message.\n      sendTest();\n      return;\n    } catch {\n      info(\"The worker has been disabled.\");\n    }\n    // Either workers are not supported or have thrown an exception.\n    // Thus, we fallback to a faked worker.\n    this.#setupFakeWorker();\n  }\n\n  #setupFakeWorker() {\n    if (!PDFWorker.#isWorkerDisabled) {\n      warn(\"Setting up fake worker.\");\n      PDFWorker.#isWorkerDisabled = true;\n    }\n\n    PDFWorker._setupFakeWorkerGlobal\n      .then(WorkerMessageHandler => {\n        if (this.destroyed) {\n          this.#capability.reject(new Error(\"Worker was destroyed\"));\n          return;\n        }\n        const port = new LoopbackPort();\n        this.#port = port;\n\n        // All fake workers use the same port, making id unique.\n        const id = `fake${PDFWorker.#fakeWorkerId++}`;\n\n        // If the main thread is our worker, setup the handling for the\n        // messages -- the main thread sends to it self.\n        const workerHandler = new MessageHandler(id + \"_worker\", id, port);\n        WorkerMessageHandler.setup(workerHandler, port);\n\n        this.#messageHandler = new MessageHandler(id, id + \"_worker\", port);\n        this.#resolve();\n      })\n      .catch(reason => {\n        this.#capability.reject(\n          new Error(`Setting up fake worker failed: \"${reason.message}\".`)\n        );\n      });\n  }\n\n  /**\n   * Destroys the worker instance.\n   */\n  destroy() {\n    this.destroyed = true;\n\n    // We need to terminate only web worker created resource.\n    this.#webWorker?.terminate();\n    this.#webWorker = null;\n\n    PDFWorker.#workerPorts.delete(this.#port);\n    this.#port = null;\n\n    this.#messageHandler?.destroy();\n    this.#messageHandler = null;\n  }\n\n  /**\n   * @param {PDFWorkerParameters} params - The worker initialization parameters.\n   * @returns {PDFWorker}\n   */\n  static create(params) {\n    const cachedPort = this.#workerPorts.get(params?.port);\n    if (cachedPort) {\n      if (cachedPort._pendingDestroy) {\n        throw new Error(\n          \"PDFWorker.create - the worker is being destroyed.\\n\" +\n            \"Please remember to await `PDFDocumentLoadingTask.destroy()`-calls.\"\n        );\n      }\n      return cachedPort;\n    }\n    return new PDFWorker(params);\n  }\n\n  /**\n   * The current `workerSrc`, when it exists.\n   * @type {string}\n   */\n  static get workerSrc() {\n    if (GlobalWorkerOptions.workerSrc) {\n      return GlobalWorkerOptions.workerSrc;\n    }\n    throw new Error('No \"GlobalWorkerOptions.workerSrc\" specified.');\n  }\n\n  static get #mainThreadWorkerMessageHandler() {\n    try {\n      return globalThis.pdfjsWorker?.WorkerMessageHandler || null;\n    } catch {\n      return null;\n    }\n  }\n\n  // Loads worker code into the main-thread.\n  static get _setupFakeWorkerGlobal() {\n    const loader = async () => {\n      if (this.#mainThreadWorkerMessageHandler) {\n        // The worker was already loaded using e.g. a `<script>` tag.\n        return this.#mainThreadWorkerMessageHandler;\n      }\n      const worker =\n        typeof PDFJSDev === \"undefined\"\n          ? await import(\"pdfjs/pdf.worker.js\")\n          : await __raw_import__(this.workerSrc);\n      return worker.WorkerMessageHandler;\n    };\n\n    return shadow(this, \"_setupFakeWorkerGlobal\", loader());\n  }\n}\n\n/**\n * For internal use only.\n * @ignore\n */\nclass WorkerTransport {\n  #methodPromises = new Map();\n\n  #pageCache = new Map();\n\n  #pagePromises = new Map();\n\n  #pageRefCache = new Map();\n\n  #passwordCapability = null;\n\n  constructor(\n    messageHandler,\n    loadingTask,\n    networkStream,\n    params,\n    factory,\n    enableHWA\n  ) {\n    this.messageHandler = messageHandler;\n    this.loadingTask = loadingTask;\n    this.commonObjs = new PDFObjects();\n    this.fontLoader = new FontLoader({\n      ownerDocument: params.ownerDocument,\n      styleElement: params.styleElement,\n    });\n    this.loadingParams = params.loadingParams;\n    this._params = params;\n\n    this.canvasFactory = factory.canvasFactory;\n    this.filterFactory = factory.filterFactory;\n    this.cMapReaderFactory = factory.cMapReaderFactory;\n    this.standardFontDataFactory = factory.standardFontDataFactory;\n    this.wasmFactory = factory.wasmFactory;\n\n    this.destroyed = false;\n    this.destroyCapability = null;\n\n    this._networkStream = networkStream;\n    this._fullReader = null;\n    this._lastProgress = null;\n    this.downloadInfoCapability = Promise.withResolvers();\n    this.enableHWA = enableHWA;\n\n    this.setupMessageHandler();\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"getNetworkStreamName\", {\n        value: () => networkStream?.constructor?.name || null,\n      });\n      Object.defineProperty(this, \"getXFADatasets\", {\n        value: () =>\n          this.messageHandler.sendWithPromise(\"GetXFADatasets\", null),\n      });\n      Object.defineProperty(this, \"getXRefPrevValue\", {\n        value: () =>\n          this.messageHandler.sendWithPromise(\"GetXRefPrevValue\", null),\n      });\n      Object.defineProperty(this, \"getStartXRefPos\", {\n        value: () =>\n          this.messageHandler.sendWithPromise(\"GetStartXRefPos\", null),\n      });\n      Object.defineProperty(this, \"getAnnotArray\", {\n        value: pageIndex =>\n          this.messageHandler.sendWithPromise(\"GetAnnotArray\", { pageIndex }),\n      });\n    }\n  }\n\n  #cacheSimpleMethod(name, data = null) {\n    const cachedPromise = this.#methodPromises.get(name);\n    if (cachedPromise) {\n      return cachedPromise;\n    }\n    const promise = this.messageHandler.sendWithPromise(name, data);\n\n    this.#methodPromises.set(name, promise);\n    return promise;\n  }\n\n  get annotationStorage() {\n    return shadow(this, \"annotationStorage\", new AnnotationStorage());\n  }\n\n  getRenderingIntent(\n    intent,\n    annotationMode = AnnotationMode.ENABLE,\n    printAnnotationStorage = null,\n    isEditing = false,\n    isOpList = false\n  ) {\n    let renderingIntent = RenderingIntentFlag.DISPLAY; // Default value.\n    let annotationStorageSerializable = SerializableEmpty;\n\n    switch (intent) {\n      case \"any\":\n        renderingIntent = RenderingIntentFlag.ANY;\n        break;\n      case \"display\":\n        break;\n      case \"print\":\n        renderingIntent = RenderingIntentFlag.PRINT;\n        break;\n      default:\n        warn(`getRenderingIntent - invalid intent: ${intent}`);\n    }\n\n    const annotationStorage =\n      renderingIntent & RenderingIntentFlag.PRINT &&\n      printAnnotationStorage instanceof PrintAnnotationStorage\n        ? printAnnotationStorage\n        : this.annotationStorage;\n\n    switch (annotationMode) {\n      case AnnotationMode.DISABLE:\n        renderingIntent += RenderingIntentFlag.ANNOTATIONS_DISABLE;\n        break;\n      case AnnotationMode.ENABLE:\n        break;\n      case AnnotationMode.ENABLE_FORMS:\n        renderingIntent += RenderingIntentFlag.ANNOTATIONS_FORMS;\n        break;\n      case AnnotationMode.ENABLE_STORAGE:\n        renderingIntent += RenderingIntentFlag.ANNOTATIONS_STORAGE;\n\n        annotationStorageSerializable = annotationStorage.serializable;\n        break;\n      default:\n        warn(`getRenderingIntent - invalid annotationMode: ${annotationMode}`);\n    }\n\n    if (isEditing) {\n      renderingIntent += RenderingIntentFlag.IS_EDITING;\n    }\n    if (isOpList) {\n      renderingIntent += RenderingIntentFlag.OPLIST;\n    }\n\n    const { ids: modifiedIds, hash: modifiedIdsHash } =\n      annotationStorage.modifiedIds;\n\n    const cacheKeyBuf = [\n      renderingIntent,\n      annotationStorageSerializable.hash,\n      modifiedIdsHash,\n    ];\n\n    return {\n      renderingIntent,\n      cacheKey: cacheKeyBuf.join(\"_\"),\n      annotationStorageSerializable,\n      modifiedIds,\n    };\n  }\n\n  destroy() {\n    if (this.destroyCapability) {\n      return this.destroyCapability.promise;\n    }\n\n    this.destroyed = true;\n    this.destroyCapability = Promise.withResolvers();\n\n    this.#passwordCapability?.reject(\n      new Error(\"Worker was destroyed during onPassword callback\")\n    );\n\n    const waitOn = [];\n    // We need to wait for all renderings to be completed, e.g.\n    // timeout/rAF can take a long time.\n    for (const page of this.#pageCache.values()) {\n      waitOn.push(page._destroy());\n    }\n    this.#pageCache.clear();\n    this.#pagePromises.clear();\n    this.#pageRefCache.clear();\n    // Allow `AnnotationStorage`-related clean-up when destroying the document.\n    if (this.hasOwnProperty(\"annotationStorage\")) {\n      this.annotationStorage.resetModified();\n    }\n    // We also need to wait for the worker to finish its long running tasks.\n    const terminated = this.messageHandler.sendWithPromise(\"Terminate\", null);\n    waitOn.push(terminated);\n\n    Promise.all(waitOn).then(() => {\n      this.commonObjs.clear();\n      this.fontLoader.clear();\n      this.#methodPromises.clear();\n      this.filterFactory.destroy();\n      TextLayer.cleanup();\n\n      this._networkStream?.cancelAllRequests(\n        new AbortException(\"Worker was terminated.\")\n      );\n\n      this.messageHandler?.destroy();\n      this.messageHandler = null;\n\n      this.destroyCapability.resolve();\n    }, this.destroyCapability.reject);\n    return this.destroyCapability.promise;\n  }\n\n  setupMessageHandler() {\n    const { messageHandler, loadingTask } = this;\n\n    messageHandler.on(\"GetReader\", (data, sink) => {\n      assert(\n        this._networkStream,\n        \"GetReader - no `IPDFStream` instance available.\"\n      );\n      this._fullReader = this._networkStream.getFullReader();\n      this._fullReader.onProgress = evt => {\n        this._lastProgress = {\n          loaded: evt.loaded,\n          total: evt.total,\n        };\n      };\n      sink.onPull = () => {\n        this._fullReader\n          .read()\n          .then(function ({ value, done }) {\n            if (done) {\n              sink.close();\n              return;\n            }\n            assert(\n              value instanceof ArrayBuffer,\n              \"GetReader - expected an ArrayBuffer.\"\n            );\n            // Enqueue data chunk into sink, and transfer it\n            // to other side as `Transferable` object.\n            sink.enqueue(new Uint8Array(value), 1, [value]);\n          })\n          .catch(reason => {\n            sink.error(reason);\n          });\n      };\n\n      sink.onCancel = reason => {\n        this._fullReader.cancel(reason);\n\n        sink.ready.catch(readyReason => {\n          if (this.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          throw readyReason;\n        });\n      };\n    });\n\n    messageHandler.on(\"ReaderHeadersReady\", async data => {\n      await this._fullReader.headersReady;\n\n      const { isStreamingSupported, isRangeSupported, contentLength } =\n        this._fullReader;\n\n      // If stream or range are disabled, it's our only way to report\n      // loading progress.\n      if (!isStreamingSupported || !isRangeSupported) {\n        if (this._lastProgress) {\n          loadingTask.onProgress?.(this._lastProgress);\n        }\n        this._fullReader.onProgress = evt => {\n          loadingTask.onProgress?.({\n            loaded: evt.loaded,\n            total: evt.total,\n          });\n        };\n      }\n\n      return { isStreamingSupported, isRangeSupported, contentLength };\n    });\n\n    messageHandler.on(\"GetRangeReader\", (data, sink) => {\n      assert(\n        this._networkStream,\n        \"GetRangeReader - no `IPDFStream` instance available.\"\n      );\n      const rangeReader = this._networkStream.getRangeReader(\n        data.begin,\n        data.end\n      );\n\n      // When streaming is enabled, it's possible that the data requested here\n      // has already been fetched via the `_fullRequestReader` implementation.\n      // However, given that the PDF data is loaded asynchronously on the\n      // main-thread and then sent via `postMessage` to the worker-thread,\n      // it may not have been available during parsing (hence the attempt to\n      // use range requests here).\n      //\n      // To avoid wasting time and resources here, we'll thus *not* dispatch\n      // range requests if the data was already loaded but has not been sent to\n      // the worker-thread yet (which will happen via the `_fullRequestReader`).\n      if (!rangeReader) {\n        sink.close();\n        return;\n      }\n\n      sink.onPull = () => {\n        rangeReader\n          .read()\n          .then(function ({ value, done }) {\n            if (done) {\n              sink.close();\n              return;\n            }\n            assert(\n              value instanceof ArrayBuffer,\n              \"GetRangeReader - expected an ArrayBuffer.\"\n            );\n            sink.enqueue(new Uint8Array(value), 1, [value]);\n          })\n          .catch(reason => {\n            sink.error(reason);\n          });\n      };\n\n      sink.onCancel = reason => {\n        rangeReader.cancel(reason);\n\n        sink.ready.catch(readyReason => {\n          if (this.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          throw readyReason;\n        });\n      };\n    });\n\n    messageHandler.on(\"GetDoc\", ({ pdfInfo }) => {\n      this._numPages = pdfInfo.numPages;\n      this._htmlForXfa = pdfInfo.htmlForXfa;\n      delete pdfInfo.htmlForXfa;\n      loadingTask._capability.resolve(new PDFDocumentProxy(pdfInfo, this));\n    });\n\n    messageHandler.on(\"DocException\", ex => {\n      loadingTask._capability.reject(wrapReason(ex));\n    });\n\n    messageHandler.on(\"PasswordRequest\", ex => {\n      this.#passwordCapability = Promise.withResolvers();\n\n      try {\n        if (!loadingTask.onPassword) {\n          throw wrapReason(ex);\n        }\n\n        const updatePassword = password => {\n          if (password instanceof Error) {\n            this.#passwordCapability.reject(password);\n          } else {\n            this.#passwordCapability.resolve({ password });\n          }\n        };\n        loadingTask.onPassword(updatePassword, ex.code);\n      } catch (err) {\n        this.#passwordCapability.reject(err);\n      }\n      return this.#passwordCapability.promise;\n    });\n\n    messageHandler.on(\"DataLoaded\", data => {\n      // For consistency: Ensure that progress is always reported when the\n      // entire PDF file has been loaded, regardless of how it was fetched.\n      loadingTask.onProgress?.({\n        loaded: data.length,\n        total: data.length,\n      });\n\n      this.downloadInfoCapability.resolve(data);\n    });\n\n    messageHandler.on(\"StartRenderPage\", data => {\n      if (this.destroyed) {\n        return; // Ignore any pending requests if the worker was terminated.\n      }\n\n      const page = this.#pageCache.get(data.pageIndex);\n      page._startRenderPage(data.transparency, data.cacheKey);\n    });\n\n    messageHandler.on(\"commonobj\", ([id, type, exportedData]) => {\n      if (this.destroyed) {\n        return null; // Ignore any pending requests if the worker was terminated.\n      }\n\n      if (this.commonObjs.has(id)) {\n        return null;\n      }\n\n      switch (type) {\n        case \"Font\":\n          if (\"error\" in exportedData) {\n            const exportedError = exportedData.error;\n            warn(`Error during font loading: ${exportedError}`);\n            this.commonObjs.resolve(id, exportedError);\n            break;\n          }\n\n          const fontData = new FontInfo(exportedData);\n          const inspectFont =\n            this._params.pdfBug && globalThis.FontInspector?.enabled\n              ? (font, url) => globalThis.FontInspector.fontAdded(font, url)\n              : null;\n          const font = new FontFaceObject(\n            fontData,\n            inspectFont,\n            exportedData.extra,\n            exportedData.charProcOperatorList\n          );\n\n          this.fontLoader\n            .bind(font)\n            .catch(() => messageHandler.sendWithPromise(\"FontFallback\", { id }))\n            .finally(() => {\n              if (!font.fontExtraProperties && font.data) {\n                // Immediately release the `font.data` property once the font\n                // has been attached to the DOM, since it's no longer needed,\n                // rather than waiting for a `PDFDocumentProxy.cleanup` call.\n                // Since `font.data` could be very large, e.g. in some cases\n                // multiple megabytes, this will help reduce memory usage.\n                font.clearData();\n              }\n              this.commonObjs.resolve(id, font);\n            });\n          break;\n        case \"CopyLocalImage\":\n          const { imageRef } = exportedData;\n          assert(imageRef, \"The imageRef must be defined.\");\n\n          for (const pageProxy of this.#pageCache.values()) {\n            for (const [, data] of pageProxy.objs) {\n              if (data?.ref !== imageRef) {\n                continue;\n              }\n              if (!data.dataLen) {\n                return null;\n              }\n              this.commonObjs.resolve(id, structuredClone(data));\n              return data.dataLen;\n            }\n          }\n          break;\n        case \"FontPath\":\n          this.commonObjs.resolve(id, new FontPathInfo(exportedData));\n          break;\n        case \"Image\":\n          this.commonObjs.resolve(id, exportedData);\n          break;\n        case \"Pattern\":\n          const pattern = new PatternInfo(exportedData);\n          this.commonObjs.resolve(id, pattern.getIR());\n          break;\n        default:\n          throw new Error(`Got unknown common object type ${type}`);\n      }\n\n      return null;\n    });\n\n    messageHandler.on(\"obj\", ([id, pageIndex, type, imageData]) => {\n      if (this.destroyed) {\n        // Ignore any pending requests if the worker was terminated.\n        return;\n      }\n\n      const pageProxy = this.#pageCache.get(pageIndex);\n      if (pageProxy.objs.has(id)) {\n        return;\n      }\n      // Don't store data *after* cleanup has successfully run, see bug 1854145.\n      if (pageProxy._intentStates.size === 0) {\n        imageData?.bitmap?.close(); // Release any `ImageBitmap` data.\n        return;\n      }\n\n      switch (type) {\n        case \"Image\":\n        case \"Pattern\":\n          pageProxy.objs.resolve(id, imageData);\n          break;\n        default:\n          throw new Error(`Got unknown object type ${type}`);\n      }\n    });\n\n    messageHandler.on(\"DocProgress\", data => {\n      if (this.destroyed) {\n        return; // Ignore any pending requests if the worker was terminated.\n      }\n      loadingTask.onProgress?.({\n        loaded: data.loaded,\n        total: data.total,\n      });\n    });\n\n    messageHandler.on(\"FetchBinaryData\", async data => {\n      if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n        throw new Error(\"Not implemented: FetchBinaryData\");\n      }\n      if (this.destroyed) {\n        throw new Error(\"Worker was destroyed.\");\n      }\n      const factory = this[data.type];\n\n      if (!factory) {\n        throw new Error(\n          `${data.type} not initialized, see the \\`useWorkerFetch\\` parameter.`\n        );\n      }\n      return factory.fetch(data);\n    });\n  }\n\n  getData() {\n    return this.messageHandler.sendWithPromise(\"GetData\", null);\n  }\n\n  saveDocument() {\n    if (this.annotationStorage.size <= 0) {\n      warn(\n        \"saveDocument called while `annotationStorage` is empty, \" +\n          \"please use the getData-method instead.\"\n      );\n    }\n    const { map, transfer } = this.annotationStorage.serializable;\n\n    return this.messageHandler\n      .sendWithPromise(\n        \"SaveDocument\",\n        {\n          isPureXfa: !!this._htmlForXfa,\n          numPages: this._numPages,\n          annotationStorage: map,\n          filename: this._fullReader?.filename ?? null,\n        },\n        transfer\n      )\n      .finally(() => {\n        this.annotationStorage.resetModified();\n      });\n  }\n\n  extractPages(pageInfos) {\n    return this.messageHandler.sendWithPromise(\"ExtractPages\", { pageInfos });\n  }\n\n  getPage(pageNumber) {\n    if (\n      !Number.isInteger(pageNumber) ||\n      pageNumber <= 0 ||\n      pageNumber > this._numPages\n    ) {\n      return Promise.reject(new Error(\"Invalid page request.\"));\n    }\n\n    const pageIndex = pageNumber - 1,\n      cachedPromise = this.#pagePromises.get(pageIndex);\n    if (cachedPromise) {\n      return cachedPromise;\n    }\n    const promise = this.messageHandler\n      .sendWithPromise(\"GetPage\", {\n        pageIndex,\n      })\n      .then(pageInfo => {\n        if (this.destroyed) {\n          throw new Error(\"Transport destroyed\");\n        }\n        if (pageInfo.refStr) {\n          this.#pageRefCache.set(pageInfo.refStr, pageNumber);\n        }\n\n        const page = new PDFPageProxy(\n          pageIndex,\n          pageInfo,\n          this,\n          this._params.pdfBug\n        );\n        this.#pageCache.set(pageIndex, page);\n        return page;\n      });\n    this.#pagePromises.set(pageIndex, promise);\n    return promise;\n  }\n\n  getPageIndex(ref) {\n    if (!isRefProxy(ref)) {\n      return Promise.reject(new Error(\"Invalid pageIndex request.\"));\n    }\n    return this.messageHandler.sendWithPromise(\"GetPageIndex\", {\n      num: ref.num,\n      gen: ref.gen,\n    });\n  }\n\n  getAnnotations(pageIndex, intent) {\n    return this.messageHandler.sendWithPromise(\"GetAnnotations\", {\n      pageIndex,\n      intent,\n    });\n  }\n\n  getFieldObjects() {\n    return this.#cacheSimpleMethod(\"GetFieldObjects\");\n  }\n\n  hasJSActions() {\n    return this.#cacheSimpleMethod(\"HasJSActions\");\n  }\n\n  getCalculationOrderIds() {\n    return this.messageHandler.sendWithPromise(\"GetCalculationOrderIds\", null);\n  }\n\n  getDestinations() {\n    return this.messageHandler.sendWithPromise(\"GetDestinations\", null);\n  }\n\n  getDestination(id) {\n    if (typeof id !== \"string\") {\n      return Promise.reject(new Error(\"Invalid destination request.\"));\n    }\n    return this.messageHandler.sendWithPromise(\"GetDestination\", {\n      id,\n    });\n  }\n\n  getPageLabels() {\n    return this.messageHandler.sendWithPromise(\"GetPageLabels\", null);\n  }\n\n  getPageLayout() {\n    return this.messageHandler.sendWithPromise(\"GetPageLayout\", null);\n  }\n\n  getPageMode() {\n    return this.messageHandler.sendWithPromise(\"GetPageMode\", null);\n  }\n\n  getViewerPreferences() {\n    return this.messageHandler.sendWithPromise(\"GetViewerPreferences\", null);\n  }\n\n  getOpenAction() {\n    return this.messageHandler.sendWithPromise(\"GetOpenAction\", null);\n  }\n\n  getAttachments() {\n    return this.messageHandler.sendWithPromise(\"GetAttachments\", null);\n  }\n\n  getAnnotationsByType(types, pageIndexesToSkip) {\n    return this.messageHandler.sendWithPromise(\"GetAnnotationsByType\", {\n      types,\n      pageIndexesToSkip,\n    });\n  }\n\n  getDocJSActions() {\n    return this.#cacheSimpleMethod(\"GetDocJSActions\");\n  }\n\n  getPageJSActions(pageIndex) {\n    return this.messageHandler.sendWithPromise(\"GetPageJSActions\", {\n      pageIndex,\n    });\n  }\n\n  getStructTree(pageIndex) {\n    return this.messageHandler.sendWithPromise(\"GetStructTree\", {\n      pageIndex,\n    });\n  }\n\n  getOutline() {\n    return this.messageHandler.sendWithPromise(\"GetOutline\", null);\n  }\n\n  getOptionalContentConfig(renderingIntent) {\n    return this.#cacheSimpleMethod(\"GetOptionalContentConfig\").then(\n      data => new OptionalContentConfig(data, renderingIntent)\n    );\n  }\n\n  getPermissions() {\n    return this.messageHandler.sendWithPromise(\"GetPermissions\", null);\n  }\n\n  getMetadata() {\n    const name = \"GetMetadata\",\n      cachedPromise = this.#methodPromises.get(name);\n    if (cachedPromise) {\n      return cachedPromise;\n    }\n    const promise = this.messageHandler\n      .sendWithPromise(name, null)\n      .then(results => ({\n        info: results[0],\n        metadata: results[1] ? new Metadata(results[1]) : null,\n        contentDispositionFilename: this._fullReader?.filename ?? null,\n        contentLength: this._fullReader?.contentLength ?? null,\n        hasStructTree: results[2],\n      }));\n    this.#methodPromises.set(name, promise);\n    return promise;\n  }\n\n  getMarkInfo() {\n    return this.messageHandler.sendWithPromise(\"GetMarkInfo\", null);\n  }\n\n  async startCleanup(keepLoadedFonts = false) {\n    if (this.destroyed) {\n      return; // No need to manually clean-up when destruction has started.\n    }\n    await this.messageHandler.sendWithPromise(\"Cleanup\", null);\n\n    for (const page of this.#pageCache.values()) {\n      const cleanupSuccessful = page.cleanup();\n\n      if (!cleanupSuccessful) {\n        throw new Error(\n          `startCleanup: Page ${page.pageNumber} is currently rendering.`\n        );\n      }\n    }\n    this.commonObjs.clear();\n    if (!keepLoadedFonts) {\n      this.fontLoader.clear();\n    }\n    this.#methodPromises.clear();\n    this.filterFactory.destroy(/* keepHCM = */ true);\n    TextLayer.cleanup();\n  }\n\n  cachedPageNumber(ref) {\n    if (!isRefProxy(ref)) {\n      return null;\n    }\n    const refStr = ref.gen === 0 ? `${ref.num}R` : `${ref.num}R${ref.gen}`;\n    return this.#pageRefCache.get(refStr) ?? null;\n  }\n}\n\n/**\n * Allows controlling of the rendering tasks.\n */\nclass RenderTask {\n  #internalRenderTask = null;\n\n  /**\n   * Callback for incremental rendering -- a function that will be called\n   * each time the rendering is paused.  To continue rendering call the\n   * function that is the first argument to the callback.\n   * @type {function}\n   */\n  onContinue = null;\n\n  /**\n   * A function that will be synchronously called when the rendering tasks\n   * finishes with an error (either because of an actual error, or because the\n   * rendering is cancelled).\n   *\n   * @type {function}\n   * @param {Error} error\n   */\n  onError = null;\n\n  constructor(internalRenderTask) {\n    this.#internalRenderTask = internalRenderTask;\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"getOperatorList\", {\n        value: () => this.#internalRenderTask.operatorList,\n      });\n    }\n  }\n\n  /**\n   * Promise for rendering task completion.\n   * @type {Promise<void>}\n   */\n  get promise() {\n    return this.#internalRenderTask.capability.promise;\n  }\n\n  /**\n   * Cancels the rendering task. If the task is currently rendering it will\n   * not be cancelled until graphics pauses with a timeout. The promise that\n   * this object extends will be rejected when cancelled.\n   *\n   * @param {number} [extraDelay]\n   */\n  cancel(extraDelay = 0) {\n    this.#internalRenderTask.cancel(/* error = */ null, extraDelay);\n  }\n\n  /**\n   * Whether form fields are rendered separately from the main operatorList.\n   * @type {boolean}\n   */\n  get separateAnnots() {\n    const { separateAnnots } = this.#internalRenderTask.operatorList;\n    if (!separateAnnots) {\n      return false;\n    }\n    const { annotationCanvasMap } = this.#internalRenderTask;\n    return (\n      separateAnnots.form ||\n      (separateAnnots.canvas && annotationCanvasMap?.size > 0)\n    );\n  }\n}\n\n/**\n * For internal use only.\n * @ignore\n */\nclass InternalRenderTask {\n  #rAF = null;\n\n  static #canvasInUse = new WeakSet();\n\n  constructor({\n    callback,\n    params,\n    objs,\n    commonObjs,\n    annotationCanvasMap,\n    operatorList,\n    pageIndex,\n    canvasFactory,\n    filterFactory,\n    useRequestAnimationFrame = false,\n    pdfBug = false,\n    pageColors = null,\n    enableHWA = false,\n    operationsFilter = null,\n  }) {\n    this.callback = callback;\n    this.params = params;\n    this.objs = objs;\n    this.commonObjs = commonObjs;\n    this.annotationCanvasMap = annotationCanvasMap;\n    this.operatorListIdx = null;\n    this.operatorList = operatorList;\n    this._pageIndex = pageIndex;\n    this.canvasFactory = canvasFactory;\n    this.filterFactory = filterFactory;\n    this._pdfBug = pdfBug;\n    this.pageColors = pageColors;\n\n    this.running = false;\n    this.graphicsReadyCallback = null;\n    this.graphicsReady = false;\n    this._useRequestAnimationFrame =\n      useRequestAnimationFrame === true && typeof window !== \"undefined\";\n    this.cancelled = false;\n    this.capability = Promise.withResolvers();\n    this.task = new RenderTask(this);\n    // caching this-bound methods\n    this._cancelBound = this.cancel.bind(this);\n    this._continueBound = this._continue.bind(this);\n    this._scheduleNextBound = this._scheduleNext.bind(this);\n    this._nextBound = this._next.bind(this);\n    this._canvas = params.canvas;\n    this._canvasContext = params.canvas ? null : params.canvasContext;\n    this._enableHWA = enableHWA;\n    this._dependencyTracker = params.dependencyTracker;\n    this._operationsFilter = operationsFilter;\n  }\n\n  get completed() {\n    return this.capability.promise.catch(function () {\n      // Ignoring errors, since we only want to know when rendering is\n      // no longer pending.\n    });\n  }\n\n  initializeGraphics({ transparency = false, optionalContentConfig }) {\n    if (this.cancelled) {\n      return;\n    }\n    if (this._canvas) {\n      if (InternalRenderTask.#canvasInUse.has(this._canvas)) {\n        throw new Error(\n          \"Cannot use the same canvas during multiple render() operations. \" +\n            \"Use different canvas or ensure previous operations were \" +\n            \"cancelled or completed.\"\n        );\n      }\n      InternalRenderTask.#canvasInUse.add(this._canvas);\n    }\n\n    if (this._pdfBug && globalThis.StepperManager?.enabled) {\n      this.stepper = globalThis.StepperManager.create(this._pageIndex);\n      this.stepper.init(this.operatorList);\n      this.stepper.nextBreakPoint = this.stepper.getNextBreakPoint();\n    }\n    const { viewport, transform, background, dependencyTracker } = this.params;\n\n    // When printing in Firefox, we get a specific context in mozPrintCallback\n    // which cannot be created from the canvas itself.\n    const canvasContext =\n      this._canvasContext ||\n      this._canvas.getContext(\"2d\", {\n        alpha: false,\n        willReadFrequently: !this._enableHWA,\n      });\n\n    this.gfx = new CanvasGraphics(\n      canvasContext,\n      this.commonObjs,\n      this.objs,\n      this.canvasFactory,\n      this.filterFactory,\n      { optionalContentConfig },\n      this.annotationCanvasMap,\n      this.pageColors,\n      dependencyTracker\n    );\n    this.gfx.beginDrawing({\n      transform,\n      viewport,\n      transparency,\n      background,\n    });\n    this.operatorListIdx = 0;\n    this.graphicsReady = true;\n    this.graphicsReadyCallback?.();\n  }\n\n  cancel(error = null, extraDelay = 0) {\n    this.running = false;\n    this.cancelled = true;\n    this.gfx?.endDrawing();\n    if (this.#rAF) {\n      window.cancelAnimationFrame(this.#rAF);\n      this.#rAF = null;\n    }\n    InternalRenderTask.#canvasInUse.delete(this._canvas);\n\n    error ||= new RenderingCancelledException(\n      `Rendering cancelled, page ${this._pageIndex + 1}`,\n      extraDelay\n    );\n    this.callback(error);\n\n    this.task.onError?.(error);\n  }\n\n  operatorListChanged() {\n    if (!this.graphicsReady) {\n      this.graphicsReadyCallback ||= this._continueBound;\n      return;\n    }\n    this.gfx.dependencyTracker?.growOperationsCount(\n      this.operatorList.fnArray.length\n    );\n    this.stepper?.updateOperatorList(this.operatorList);\n\n    if (this.running) {\n      return;\n    }\n    this._continue();\n  }\n\n  _continue() {\n    this.running = true;\n    if (this.cancelled) {\n      return;\n    }\n    if (this.task.onContinue) {\n      this.task.onContinue(this._scheduleNextBound);\n    } else {\n      this._scheduleNext();\n    }\n  }\n\n  _scheduleNext() {\n    if (this._useRequestAnimationFrame) {\n      this.#rAF = window.requestAnimationFrame(() => {\n        this.#rAF = null;\n        this._nextBound().catch(this._cancelBound);\n      });\n    } else {\n      Promise.resolve().then(this._nextBound).catch(this._cancelBound);\n    }\n  }\n\n  async _next() {\n    if (this.cancelled) {\n      return;\n    }\n    this.operatorListIdx = this.gfx.executeOperatorList(\n      this.operatorList,\n      this.operatorListIdx,\n      this._continueBound,\n      this.stepper,\n      this._operationsFilter\n    );\n    if (this.operatorListIdx === this.operatorList.argsArray.length) {\n      this.running = false;\n      if (this.operatorList.lastChunk) {\n        this.gfx.endDrawing();\n        InternalRenderTask.#canvasInUse.delete(this._canvas);\n\n        this.callback();\n      }\n    }\n  }\n}\n\n/** @type {string} */\nconst version =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_VERSION\") : null;\n/** @type {string} */\nconst build =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_BUILD\") : null;\n\nexport {\n  build,\n  getDocument,\n  PDFDataRangeTransport,\n  PDFDocumentLoadingTask,\n  PDFDocumentProxy,\n  PDFPageProxy,\n  PDFWorker,\n  RenderTask,\n  version,\n};\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorParamsType, shadow } from \"../../shared/util.js\";\nimport { KeyboardManager } from \"./tools.js\";\nimport { noContextMenu } from \"../display_utils.js\";\n\n/**\n * ColorPicker class provides a color picker for the annotation editor.\n * It displays a dropdown with some predefined colors and allows the user\n * to select a color for the annotation.\n */\nclass ColorPicker {\n  #button = null;\n\n  #buttonSwatch = null;\n\n  #defaultColor;\n\n  #dropdown = null;\n\n  #dropdownWasFromKeyboard = false;\n\n  #isMainColorPicker = false;\n\n  #editor = null;\n\n  #eventBus;\n\n  #openDropdownAC = null;\n\n  #uiManager = null;\n\n  static #l10nColor = null;\n\n  static get _keyboardManager() {\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [\n          [\"Escape\", \"mac+Escape\"],\n          ColorPicker.prototype._hideDropdownFromKeyboard,\n        ],\n        [[\" \", \"mac+ \"], ColorPicker.prototype._colorSelectFromKeyboard],\n        [\n          [\"ArrowDown\", \"ArrowRight\", \"mac+ArrowDown\", \"mac+ArrowRight\"],\n          ColorPicker.prototype._moveToNext,\n        ],\n        [\n          [\"ArrowUp\", \"ArrowLeft\", \"mac+ArrowUp\", \"mac+ArrowLeft\"],\n          ColorPicker.prototype._moveToPrevious,\n        ],\n        [[\"Home\", \"mac+Home\"], ColorPicker.prototype._moveToBeginning],\n        [[\"End\", \"mac+End\"], ColorPicker.prototype._moveToEnd],\n      ])\n    );\n  }\n\n  constructor({ editor = null, uiManager = null }) {\n    if (editor) {\n      this.#isMainColorPicker = false;\n      this.#editor = editor;\n    } else {\n      this.#isMainColorPicker = true;\n    }\n    this.#uiManager = editor?._uiManager || uiManager;\n    this.#eventBus = this.#uiManager._eventBus;\n    this.#defaultColor =\n      editor?.color?.toUpperCase() ||\n      this.#uiManager?.highlightColors.values().next().value ||\n      \"#FFFF98\";\n\n    ColorPicker.#l10nColor ||= Object.freeze({\n      blue: \"pdfjs-editor-colorpicker-blue\",\n      green: \"pdfjs-editor-colorpicker-green\",\n      pink: \"pdfjs-editor-colorpicker-pink\",\n      red: \"pdfjs-editor-colorpicker-red\",\n      yellow: \"pdfjs-editor-colorpicker-yellow\",\n    });\n  }\n\n  renderButton() {\n    const button = (this.#button = document.createElement(\"button\"));\n    button.className = \"colorPicker\";\n    button.tabIndex = \"0\";\n    button.setAttribute(\"data-l10n-id\", \"pdfjs-editor-colorpicker-button\");\n    button.ariaHasPopup = \"true\";\n    if (this.#editor) {\n      button.ariaControls = `${this.#editor.id}_colorpicker_dropdown`;\n    }\n    const signal = this.#uiManager._signal;\n    button.addEventListener(\"click\", this.#openDropdown.bind(this), { signal });\n    button.addEventListener(\"keydown\", this.#keyDown.bind(this), { signal });\n    const swatch = (this.#buttonSwatch = document.createElement(\"span\"));\n    swatch.className = \"swatch\";\n    swatch.ariaHidden = \"true\";\n    swatch.style.backgroundColor = this.#defaultColor;\n    button.append(swatch);\n    return button;\n  }\n\n  renderMainDropdown() {\n    const dropdown = (this.#dropdown = this.#getDropdownRoot());\n    dropdown.ariaOrientation = \"horizontal\";\n    dropdown.ariaLabelledBy = \"highlightColorPickerLabel\";\n\n    return dropdown;\n  }\n\n  #getDropdownRoot() {\n    const div = document.createElement(\"div\");\n    const signal = this.#uiManager._signal;\n    div.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    div.className = \"dropdown\";\n    div.role = \"listbox\";\n    div.ariaMultiSelectable = \"false\";\n    div.ariaOrientation = \"vertical\";\n    div.setAttribute(\"data-l10n-id\", \"pdfjs-editor-colorpicker-dropdown\");\n    if (this.#editor) {\n      div.id = `${this.#editor.id}_colorpicker_dropdown`;\n    }\n    for (const [name, color] of this.#uiManager.highlightColors) {\n      const button = document.createElement(\"button\");\n      button.tabIndex = \"0\";\n      button.role = \"option\";\n      button.setAttribute(\"data-color\", color);\n      button.title = name;\n      button.setAttribute(\"data-l10n-id\", ColorPicker.#l10nColor[name]);\n      const swatch = document.createElement(\"span\");\n      button.append(swatch);\n      swatch.className = \"swatch\";\n      swatch.style.backgroundColor = color;\n      button.ariaSelected = color === this.#defaultColor;\n      button.addEventListener(\"click\", this.#colorSelect.bind(this, color), {\n        signal,\n      });\n      div.append(button);\n    }\n\n    div.addEventListener(\"keydown\", this.#keyDown.bind(this), { signal });\n\n    return div;\n  }\n\n  #colorSelect(color, event) {\n    event.stopPropagation();\n    this.#eventBus.dispatch(\"switchannotationeditorparams\", {\n      source: this,\n      type: AnnotationEditorParamsType.HIGHLIGHT_COLOR,\n      value: color,\n    });\n    this.updateColor(color);\n  }\n\n  _colorSelectFromKeyboard(event) {\n    if (event.target === this.#button) {\n      this.#openDropdown(event);\n      return;\n    }\n    const color = event.target.getAttribute(\"data-color\");\n    if (!color) {\n      return;\n    }\n    this.#colorSelect(color, event);\n  }\n\n  _moveToNext(event) {\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n      return;\n    }\n    if (event.target === this.#button) {\n      this.#dropdown.firstElementChild?.focus();\n      return;\n    }\n    event.target.nextSibling?.focus();\n  }\n\n  _moveToPrevious(event) {\n    if (\n      event.target === this.#dropdown?.firstElementChild ||\n      event.target === this.#button\n    ) {\n      if (this.#isDropdownVisible) {\n        this._hideDropdownFromKeyboard();\n      }\n      return;\n    }\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n    }\n    event.target.previousSibling?.focus();\n  }\n\n  _moveToBeginning(event) {\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n      return;\n    }\n    this.#dropdown.firstElementChild?.focus();\n  }\n\n  _moveToEnd(event) {\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n      return;\n    }\n    this.#dropdown.lastElementChild?.focus();\n  }\n\n  #keyDown(event) {\n    ColorPicker._keyboardManager.exec(this, event);\n  }\n\n  #openDropdown(event) {\n    if (this.#isDropdownVisible) {\n      this.hideDropdown();\n      return;\n    }\n    this.#dropdownWasFromKeyboard = event.detail === 0;\n\n    if (!this.#openDropdownAC) {\n      this.#openDropdownAC = new AbortController();\n\n      window.addEventListener(\"pointerdown\", this.#pointerDown.bind(this), {\n        signal: this.#uiManager.combinedSignal(this.#openDropdownAC),\n      });\n    }\n    this.#button.ariaExpanded = \"true\";\n    if (this.#dropdown) {\n      this.#dropdown.classList.remove(\"hidden\");\n      return;\n    }\n    const root = (this.#dropdown = this.#getDropdownRoot());\n    this.#button.append(root);\n  }\n\n  #pointerDown(event) {\n    if (this.#dropdown?.contains(event.target)) {\n      return;\n    }\n    this.hideDropdown();\n  }\n\n  hideDropdown() {\n    this.#dropdown?.classList.add(\"hidden\");\n    this.#button.ariaExpanded = \"false\";\n    this.#openDropdownAC?.abort();\n    this.#openDropdownAC = null;\n  }\n\n  get #isDropdownVisible() {\n    return this.#dropdown && !this.#dropdown.classList.contains(\"hidden\");\n  }\n\n  _hideDropdownFromKeyboard() {\n    if (this.#isMainColorPicker) {\n      return;\n    }\n    if (!this.#isDropdownVisible) {\n      // The user pressed Escape with no dropdown visible, so we must\n      // unselect it.\n      this.#editor?.unselect();\n      return;\n    }\n    this.hideDropdown();\n    this.#button.focus({\n      preventScroll: true,\n      focusVisible: this.#dropdownWasFromKeyboard,\n    });\n  }\n\n  updateColor(color) {\n    if (this.#buttonSwatch) {\n      this.#buttonSwatch.style.backgroundColor = color;\n    }\n    if (!this.#dropdown) {\n      return;\n    }\n\n    const i = this.#uiManager.highlightColors.values();\n    for (const child of this.#dropdown.children) {\n      child.ariaSelected = i.next().value === color.toUpperCase();\n    }\n  }\n\n  destroy() {\n    this.#button?.remove();\n    this.#button = null;\n    this.#buttonSwatch = null;\n    this.#dropdown?.remove();\n    this.#dropdown = null;\n  }\n}\n\n/**\n * BasicColorPicker class provides a simple color picker.\n * It displays an input element (with type=\"color\") that allows the user\n * to select a color for the annotation.\n */\nclass BasicColorPicker {\n  #input = null;\n\n  #editor = null;\n\n  #uiManager = null;\n\n  static #l10nColor = null;\n\n  constructor(editor) {\n    this.#editor = editor;\n    this.#uiManager = editor._uiManager;\n\n    BasicColorPicker.#l10nColor ||= Object.freeze({\n      freetext: \"pdfjs-editor-color-picker-free-text-input\",\n      ink: \"pdfjs-editor-color-picker-ink-input\",\n    });\n  }\n\n  renderButton() {\n    if (this.#input) {\n      return this.#input;\n    }\n    const { editorType, colorType, color } = this.#editor;\n    const input = (this.#input = document.createElement(\"input\"));\n    input.type = \"color\";\n    input.value = color || \"#000000\";\n    input.className = \"basicColorPicker\";\n    input.tabIndex = 0;\n    input.setAttribute(\"data-l10n-id\", BasicColorPicker.#l10nColor[editorType]);\n    input.addEventListener(\n      \"input\",\n      () => {\n        this.#uiManager.updateParams(colorType, input.value);\n      },\n      { signal: this.#uiManager._signal }\n    );\n    return input;\n  }\n\n  update(value) {\n    if (!this.#input) {\n      return;\n    }\n    this.#input.value = value;\n  }\n\n  destroy() {\n    this.#input?.remove();\n    this.#input = null;\n  }\n\n  hideDropdown() {}\n}\n\nexport { BasicColorPicker, ColorPicker };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * PLEASE NOTE: This file is currently imported in both the `../display/` and\n *              `../scripting_api/` folders, hence be EXTREMELY careful about\n *              introducing any dependencies here since that can lead to an\n *              unexpected/unnecessary size increase of the *built* files.\n */\n\nfunction makeColorComp(n) {\n  return Math.floor(Math.max(0, Math.min(1, n)) * 255)\n    .toString(16)\n    .padStart(2, \"0\");\n}\n\nfunction scaleAndClamp(x) {\n  return Math.max(0, Math.min(255, 255 * x));\n}\n\n// PDF specifications section 10.3\nclass ColorConverters {\n  static CMYK_G([c, y, m, k]) {\n    return [\"G\", 1 - Math.min(1, 0.3 * c + 0.59 * m + 0.11 * y + k)];\n  }\n\n  static G_CMYK([g]) {\n    return [\"CMYK\", 0, 0, 0, 1 - g];\n  }\n\n  static G_RGB([g]) {\n    return [\"RGB\", g, g, g];\n  }\n\n  static G_rgb([g]) {\n    g = scaleAndClamp(g);\n    return [g, g, g];\n  }\n\n  static G_HTML([g]) {\n    const G = makeColorComp(g);\n    return `#${G}${G}${G}`;\n  }\n\n  static RGB_G([r, g, b]) {\n    return [\"G\", 0.3 * r + 0.59 * g + 0.11 * b];\n  }\n\n  static RGB_rgb(color) {\n    return color.map(scaleAndClamp);\n  }\n\n  static RGB_HTML(color) {\n    return `#${color.map(makeColorComp).join(\"\")}`;\n  }\n\n  static T_HTML() {\n    return \"#00000000\";\n  }\n\n  static T_rgb() {\n    return [null];\n  }\n\n  static CMYK_RGB([c, y, m, k]) {\n    return [\n      \"RGB\",\n      1 - Math.min(1, c + k),\n      1 - Math.min(1, m + k),\n      1 - Math.min(1, y + k),\n    ];\n  }\n\n  static CMYK_rgb([c, y, m, k]) {\n    return [\n      scaleAndClamp(1 - Math.min(1, c + k)),\n      scaleAndClamp(1 - Math.min(1, m + k)),\n      scaleAndClamp(1 - Math.min(1, y + k)),\n    ];\n  }\n\n  static CMYK_HTML(components) {\n    const rgb = this.CMYK_RGB(components).slice(1);\n    return this.RGB_HTML(rgb);\n  }\n\n  static RGB_CMYK([r, g, b]) {\n    const c = 1 - r;\n    const m = 1 - g;\n    const y = 1 - b;\n    const k = Math.min(c, m, y);\n    return [\"CMYK\", c, m, y, k];\n  }\n}\n\nconst DateFormats = [\n  \"m/d\",\n  \"m/d/yy\",\n  \"mm/dd/yy\",\n  \"mm/yy\",\n  \"d-mmm\",\n  \"d-mmm-yy\",\n  \"dd-mmm-yy\",\n  \"yy-mm-dd\",\n  \"mmm-yy\",\n  \"mmmm-yy\",\n  \"mmm d, yyyy\",\n  \"mmmm d, yyyy\",\n  \"m/d/yy h:MM tt\",\n  \"m/d/yy HH:MM\",\n];\nconst TimeFormats = [\"HH:MM\", \"h:MM tt\", \"HH:MM:ss\", \"h:MM:ss tt\"];\n\nexport { ColorConverters, DateFormats, TimeFormats };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SVG_NS } from \"./display_utils.js\";\nimport { unreachable } from \"../shared/util.js\";\n\nclass BaseSVGFactory {\n  constructor() {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseSVGFactory\n    ) {\n      unreachable(\"Cannot initialize BaseSVGFactory.\");\n    }\n  }\n\n  create(width, height, skipDimensions = false) {\n    if (width <= 0 || height <= 0) {\n      throw new Error(\"Invalid SVG dimensions\");\n    }\n    const svg = this._createSVG(\"svg:svg\");\n    svg.setAttribute(\"version\", \"1.1\");\n\n    if (!skipDimensions) {\n      svg.setAttribute(\"width\", `${width}px`);\n      svg.setAttribute(\"height\", `${height}px`);\n    }\n\n    svg.setAttribute(\"preserveAspectRatio\", \"none\");\n    svg.setAttribute(\"viewBox\", `0 0 ${width} ${height}`);\n\n    return svg;\n  }\n\n  createElement(type) {\n    if (typeof type !== \"string\") {\n      throw new Error(\"Invalid SVG element type\");\n    }\n    return this._createSVG(type);\n  }\n\n  /**\n   * @ignore\n   */\n  _createSVG(type) {\n    unreachable(\"Abstract method `_createSVG` called.\");\n  }\n}\n\nclass DOMSVGFactory extends BaseSVGFactory {\n  /**\n   * @ignore\n   */\n  _createSVG(type) {\n    return document.createElementNS(SVG_NS, type);\n  }\n}\n\nexport { BaseSVGFactory, DOMSVGFactory };\n","/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./api\").PDFPageProxy} PDFPageProxy */\n/** @typedef {import(\"./display_utils\").PageViewport} PageViewport */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../web/text_accessibility.js\").TextAccessibilityManager} TextAccessibilityManager */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../web/interfaces\").IDownloadManager} IDownloadManager */\n/** @typedef {import(\"../../web/interfaces\").IPDFLinkService} IPDFLinkService */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/editor/tools.js\").AnnotationEditorUIManager} AnnotationEditorUIManager */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../web/struct_tree_layer_builder.js\").StructTreeLayerBuilder} StructTreeLayerBuilder */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../web/comment_manager.js\").CommentManager} CommentManager */\n\nimport {\n  AnnotationBorderStyleType,\n  AnnotationEditorPrefix,\n  AnnotationEditorType,\n  AnnotationPrefix,\n  AnnotationType,\n  FeatureTest,\n  LINE_FACTOR,\n  shadow,\n  unreachable,\n  Util,\n  warn,\n} from \"../shared/util.js\";\nimport {\n  PDFDateString,\n  renderRichText,\n  setLayerDimensions,\n} from \"./display_utils.js\";\nimport { AnnotationStorage } from \"./annotation_storage.js\";\nimport { ColorConverters } from \"../shared/scripting_utils.js\";\nimport { DOMSVGFactory } from \"./svg_factory.js\";\n\nconst DEFAULT_FONT_SIZE = 9;\nconst GetElementsByNameSet = new WeakSet();\nconst TIMEZONE_OFFSET = new Date().getTimezoneOffset() * 60 * 1000;\n\n/**\n * @typedef {Object} AnnotationElementParameters\n * @property {Object} data\n * @property {HTMLDivElement} layer\n * @property {IPDFLinkService} linkService\n * @property {IDownloadManager} [downloadManager]\n * @property {AnnotationStorage} [annotationStorage]\n * @property {string} [imageResourcesPath] - Path for image resources, mainly\n *   for annotation icons. Include trailing slash.\n * @property {boolean} renderForms\n * @property {Object} svgFactory\n * @property {boolean} [enableScripting]\n * @property {boolean} [hasJSActions]\n * @property {Object} [fieldObjects]\n */\n\nclass AnnotationElementFactory {\n  /**\n   * @param {AnnotationElementParameters} parameters\n   * @returns {AnnotationElement}\n   */\n  static create(parameters) {\n    const subtype = parameters.data.annotationType;\n\n    switch (subtype) {\n      case AnnotationType.LINK:\n        return new LinkAnnotationElement(parameters);\n\n      case AnnotationType.TEXT:\n        return new TextAnnotationElement(parameters);\n\n      case AnnotationType.WIDGET:\n        const fieldType = parameters.data.fieldType;\n\n        switch (fieldType) {\n          case \"Tx\":\n            return new TextWidgetAnnotationElement(parameters);\n          case \"Btn\":\n            if (parameters.data.radioButton) {\n              return new RadioButtonWidgetAnnotationElement(parameters);\n            } else if (parameters.data.checkBox) {\n              return new CheckboxWidgetAnnotationElement(parameters);\n            }\n            return new PushButtonWidgetAnnotationElement(parameters);\n          case \"Ch\":\n            return new ChoiceWidgetAnnotationElement(parameters);\n          case \"Sig\":\n            return new SignatureWidgetAnnotationElement(parameters);\n        }\n        return new WidgetAnnotationElement(parameters);\n\n      case AnnotationType.POPUP:\n        return new PopupAnnotationElement(parameters);\n\n      case AnnotationType.FREETEXT:\n        return new FreeTextAnnotationElement(parameters);\n\n      case AnnotationType.LINE:\n        return new LineAnnotationElement(parameters);\n\n      case AnnotationType.SQUARE:\n        return new SquareAnnotationElement(parameters);\n\n      case AnnotationType.CIRCLE:\n        return new CircleAnnotationElement(parameters);\n\n      case AnnotationType.POLYLINE:\n        return new PolylineAnnotationElement(parameters);\n\n      case AnnotationType.CARET:\n        return new CaretAnnotationElement(parameters);\n\n      case AnnotationType.INK:\n        return new InkAnnotationElement(parameters);\n\n      case AnnotationType.POLYGON:\n        return new PolygonAnnotationElement(parameters);\n\n      case AnnotationType.HIGHLIGHT:\n        return new HighlightAnnotationElement(parameters);\n\n      case AnnotationType.UNDERLINE:\n        return new UnderlineAnnotationElement(parameters);\n\n      case AnnotationType.SQUIGGLY:\n        return new SquigglyAnnotationElement(parameters);\n\n      case AnnotationType.STRIKEOUT:\n        return new StrikeOutAnnotationElement(parameters);\n\n      case AnnotationType.STAMP:\n        return new StampAnnotationElement(parameters);\n\n      case AnnotationType.FILEATTACHMENT:\n        return new FileAttachmentAnnotationElement(parameters);\n\n      default:\n        return new AnnotationElement(parameters);\n    }\n  }\n}\n\nclass AnnotationElement {\n  #updates = null;\n\n  #hasBorder = false;\n\n  #popupElement = null;\n\n  constructor(\n    parameters,\n    {\n      isRenderable = false,\n      ignoreBorder = false,\n      createQuadrilaterals = false,\n    } = {}\n  ) {\n    this.isRenderable = isRenderable;\n    this.data = parameters.data;\n    this.layer = parameters.layer;\n    this.linkService = parameters.linkService;\n    this.downloadManager = parameters.downloadManager;\n    this.imageResourcesPath = parameters.imageResourcesPath;\n    this.renderForms = parameters.renderForms;\n    this.svgFactory = parameters.svgFactory;\n    this.annotationStorage = parameters.annotationStorage;\n    this.enableComment = parameters.enableComment;\n    this.enableScripting = parameters.enableScripting;\n    this.hasJSActions = parameters.hasJSActions;\n    this._fieldObjects = parameters.fieldObjects;\n    this.parent = parameters.parent;\n    this.hasOwnCommentButton = false;\n\n    if (isRenderable) {\n      this.contentElement = this.container =\n        this._createContainer(ignoreBorder);\n    }\n    if (createQuadrilaterals) {\n      this._createQuadrilaterals();\n    }\n  }\n\n  static _hasPopupData({ contentsObj, richText }) {\n    return !!(contentsObj?.str || richText?.str);\n  }\n\n  get _isEditable() {\n    return this.data.isEditable;\n  }\n\n  get hasPopupData() {\n    return (\n      AnnotationElement._hasPopupData(this.data) ||\n      (this.enableComment && !!this.commentText)\n    );\n  }\n\n  get commentData() {\n    const { data } = this;\n    const editor = this.annotationStorage?.getEditor(data.id);\n    if (editor) {\n      return editor.getData();\n    }\n    return data;\n  }\n\n  get hasCommentButton() {\n    return this.enableComment && this.hasPopupElement;\n  }\n\n  get commentButtonPosition() {\n    const editor = this.annotationStorage?.getEditor(this.data.id);\n    if (editor) {\n      return editor.commentButtonPositionInPage;\n    }\n    const { quadPoints, inkLists, rect } = this.data;\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    if (quadPoints?.length >= 8) {\n      for (let i = 0; i < quadPoints.length; i += 8) {\n        if (quadPoints[i + 1] > maxY) {\n          maxY = quadPoints[i + 1];\n          maxX = quadPoints[i + 2];\n        } else if (quadPoints[i + 1] === maxY) {\n          maxX = Math.max(maxX, quadPoints[i + 2]);\n        }\n      }\n      return [maxX, maxY];\n    }\n    if (inkLists?.length >= 1) {\n      for (const inkList of inkLists) {\n        for (let i = 0, ii = inkList.length; i < ii; i += 2) {\n          if (inkList[i + 1] > maxY) {\n            maxY = inkList[i + 1];\n            maxX = inkList[i];\n          } else if (inkList[i + 1] === maxY) {\n            maxX = Math.max(maxX, inkList[i]);\n          }\n        }\n      }\n      if (maxX !== Infinity) {\n        return [maxX, maxY];\n      }\n    }\n    if (rect) {\n      return [rect[2], rect[3]];\n    }\n    return null;\n  }\n\n  _normalizePoint(point) {\n    const {\n      page: { view },\n      viewport: {\n        rawDims: { pageWidth, pageHeight, pageX, pageY },\n      },\n    } = this.parent;\n    point[1] = view[3] - point[1] + view[1];\n    point[0] = (100 * (point[0] - pageX)) / pageWidth;\n    point[1] = (100 * (point[1] - pageY)) / pageHeight;\n    return point;\n  }\n\n  get commentText() {\n    const { data } = this;\n    return (\n      this.annotationStorage.getRawValue(`${AnnotationEditorPrefix}${data.id}`)\n        ?.popup?.contents ||\n      data.contentsObj?.str ||\n      \"\"\n    );\n  }\n\n  set commentText(text) {\n    const { data } = this;\n    const popup = { deleted: !text, contents: text || \"\" };\n    if (!this.annotationStorage.updateEditor(data.id, { popup })) {\n      this.annotationStorage.setValue(`${AnnotationEditorPrefix}${data.id}`, {\n        id: data.id,\n        annotationType: data.annotationType,\n        pageIndex: this.parent.page._pageIndex,\n        popup,\n        popupRef: data.popupRef,\n        modificationDate: new Date(),\n      });\n    }\n    if (!text) {\n      this.removePopup();\n    }\n  }\n\n  removePopup() {\n    (this.#popupElement?.popup || this.popup)?.remove();\n    this.#popupElement = this.popup = null;\n  }\n\n  updateEdited(params) {\n    if (!this.container) {\n      return;\n    }\n\n    if (params.rect) {\n      this.#updates ||= {\n        rect: this.data.rect.slice(0),\n      };\n    }\n\n    const { rect, popup: newPopup } = params;\n\n    if (rect) {\n      this.#setRectEdited(rect);\n    }\n\n    let popup = this.#popupElement?.popup || this.popup;\n    if (!popup && newPopup?.text) {\n      this._createPopup(newPopup);\n      popup = this.#popupElement.popup;\n    }\n    if (!popup) {\n      return;\n    }\n    popup.updateEdited(params);\n    if (newPopup?.deleted) {\n      popup.remove();\n      this.#popupElement = null;\n      this.popup = null;\n    }\n  }\n\n  resetEdited() {\n    if (!this.#updates) {\n      return;\n    }\n    this.#setRectEdited(this.#updates.rect);\n    this.#popupElement?.popup.resetEdited();\n    this.#updates = null;\n  }\n\n  #setRectEdited(rect) {\n    const {\n      container: { style },\n      data: { rect: currentRect, rotation },\n      parent: {\n        viewport: {\n          rawDims: { pageWidth, pageHeight, pageX, pageY },\n        },\n      },\n    } = this;\n    currentRect?.splice(0, 4, ...rect);\n    style.left = `${(100 * (rect[0] - pageX)) / pageWidth}%`;\n    style.top = `${(100 * (pageHeight - rect[3] + pageY)) / pageHeight}%`;\n    if (rotation === 0) {\n      style.width = `${(100 * /* width = */ (rect[2] - rect[0])) / pageWidth}%`;\n      style.height = `${(100 * /* height = */ (rect[3] - rect[1])) / pageHeight}%`;\n    } else {\n      this.setRotation(rotation);\n    }\n  }\n\n  /**\n   * Create an empty container for the annotation's HTML element.\n   *\n   * @private\n   * @param {boolean} ignoreBorder\n   * @memberof AnnotationElement\n   * @returns {HTMLElement} A section element.\n   */\n  _createContainer(ignoreBorder) {\n    const {\n      data,\n      parent: { page, viewport },\n    } = this;\n\n    const container = document.createElement(\"section\");\n    container.setAttribute(\"data-annotation-id\", data.id);\n    if (\n      !(this instanceof WidgetAnnotationElement) &&\n      !(this instanceof LinkAnnotationElement)\n    ) {\n      container.tabIndex = 0;\n    }\n    const { style } = container;\n\n    // The accessibility manager will move the annotation in the DOM in\n    // order to match the visual ordering.\n    // But if an annotation is above an other one, then we must draw it\n    // after the other one whatever the order is in the DOM, hence the\n    // use of the z-index.\n    style.zIndex = this.parent.zIndex;\n    // Keep zIndex + 1 for stuff we want to add on top of this annotation.\n    this.parent.zIndex += 2;\n\n    if (data.alternativeText) {\n      container.title = data.alternativeText;\n    }\n\n    if (data.noRotate) {\n      container.classList.add(\"norotate\");\n    }\n\n    if (!data.rect || this instanceof PopupAnnotationElement) {\n      const { rotation } = data;\n      if (!data.hasOwnCanvas && rotation !== 0) {\n        this.setRotation(rotation, container);\n      }\n      return container;\n    }\n    const { width, height } = this;\n\n    if (!ignoreBorder && data.borderStyle.width > 0) {\n      style.borderWidth = `${data.borderStyle.width}px`;\n\n      const horizontalRadius = data.borderStyle.horizontalCornerRadius;\n      const verticalRadius = data.borderStyle.verticalCornerRadius;\n      if (horizontalRadius > 0 || verticalRadius > 0) {\n        const radius = `calc(${horizontalRadius}px * var(--total-scale-factor)) / calc(${verticalRadius}px * var(--total-scale-factor))`;\n        style.borderRadius = radius;\n      } else if (this instanceof RadioButtonWidgetAnnotationElement) {\n        const radius = `calc(${width}px * var(--total-scale-factor)) / calc(${height}px * var(--total-scale-factor))`;\n        style.borderRadius = radius;\n      }\n\n      switch (data.borderStyle.style) {\n        case AnnotationBorderStyleType.SOLID:\n          style.borderStyle = \"solid\";\n          break;\n\n        case AnnotationBorderStyleType.DASHED:\n          style.borderStyle = \"dashed\";\n          break;\n\n        case AnnotationBorderStyleType.BEVELED:\n          warn(\"Unimplemented border style: beveled\");\n          break;\n\n        case AnnotationBorderStyleType.INSET:\n          warn(\"Unimplemented border style: inset\");\n          break;\n\n        case AnnotationBorderStyleType.UNDERLINE:\n          style.borderBottomStyle = \"solid\";\n          break;\n\n        default:\n          break;\n      }\n\n      const borderColor = data.borderColor || null;\n      if (borderColor) {\n        this.#hasBorder = true;\n        style.borderColor = Util.makeHexColor(\n          borderColor[0] | 0,\n          borderColor[1] | 0,\n          borderColor[2] | 0\n        );\n      } else {\n        // Transparent (invisible) border, so do not draw it at all.\n        style.borderWidth = 0;\n      }\n    }\n\n    // Do *not* modify `data.rect`, since that will corrupt the annotation\n    // position on subsequent calls to `_createContainer` (see issue 6804).\n    const rect = Util.normalizeRect([\n      data.rect[0],\n      page.view[3] - data.rect[1] + page.view[1],\n      data.rect[2],\n      page.view[3] - data.rect[3] + page.view[1],\n    ]);\n    const { pageWidth, pageHeight, pageX, pageY } = viewport.rawDims;\n\n    style.left = `${(100 * (rect[0] - pageX)) / pageWidth}%`;\n    style.top = `${(100 * (rect[1] - pageY)) / pageHeight}%`;\n\n    const { rotation } = data;\n    if (data.hasOwnCanvas || rotation === 0) {\n      style.width = `${(100 * width) / pageWidth}%`;\n      style.height = `${(100 * height) / pageHeight}%`;\n    } else {\n      this.setRotation(rotation, container);\n    }\n\n    return container;\n  }\n\n  setRotation(angle, container = this.container) {\n    if (!this.data.rect) {\n      return;\n    }\n    const { pageWidth, pageHeight } = this.parent.viewport.rawDims;\n    let { width, height } = this;\n\n    if (angle % 180 !== 0) {\n      [width, height] = [height, width];\n    }\n    container.style.width = `${(100 * width) / pageWidth}%`;\n    container.style.height = `${(100 * height) / pageHeight}%`;\n\n    container.setAttribute(\"data-main-rotation\", (360 - angle) % 360);\n  }\n\n  get _commonActions() {\n    const setColor = (jsName, styleName, event) => {\n      const color = event.detail[jsName];\n      const colorType = color[0];\n      const colorArray = color.slice(1);\n      event.target.style[styleName] =\n        ColorConverters[`${colorType}_HTML`](colorArray);\n      this.annotationStorage.setValue(this.data.id, {\n        [styleName]: ColorConverters[`${colorType}_rgb`](colorArray),\n      });\n    };\n\n    return shadow(this, \"_commonActions\", {\n      display: event => {\n        const { display } = event.detail;\n        // See scripting/constants.js for the values of `Display`.\n        // 0 = visible, 1 = hidden, 2 = noPrint and 3 = noView.\n        const hidden = display % 2 === 1;\n        this.container.style.visibility = hidden ? \"hidden\" : \"visible\";\n        this.annotationStorage.setValue(this.data.id, {\n          noView: hidden,\n          noPrint: display === 1 || display === 2,\n        });\n      },\n      print: event => {\n        this.annotationStorage.setValue(this.data.id, {\n          noPrint: !event.detail.print,\n        });\n      },\n      hidden: event => {\n        const { hidden } = event.detail;\n        this.container.style.visibility = hidden ? \"hidden\" : \"visible\";\n        this.annotationStorage.setValue(this.data.id, {\n          noPrint: hidden,\n          noView: hidden,\n        });\n      },\n      focus: event => {\n        setTimeout(() => event.target.focus({ preventScroll: false }), 0);\n      },\n      userName: event => {\n        // tooltip\n        event.target.title = event.detail.userName;\n      },\n      readonly: event => {\n        event.target.disabled = event.detail.readonly;\n      },\n      required: event => {\n        this._setRequired(event.target, event.detail.required);\n      },\n      bgColor: event => {\n        setColor(\"bgColor\", \"backgroundColor\", event);\n      },\n      fillColor: event => {\n        setColor(\"fillColor\", \"backgroundColor\", event);\n      },\n      fgColor: event => {\n        setColor(\"fgColor\", \"color\", event);\n      },\n      textColor: event => {\n        setColor(\"textColor\", \"color\", event);\n      },\n      borderColor: event => {\n        setColor(\"borderColor\", \"borderColor\", event);\n      },\n      strokeColor: event => {\n        setColor(\"strokeColor\", \"borderColor\", event);\n      },\n      rotation: event => {\n        const angle = event.detail.rotation;\n        this.setRotation(angle);\n        this.annotationStorage.setValue(this.data.id, {\n          rotation: angle,\n        });\n      },\n    });\n  }\n\n  _dispatchEventFromSandbox(actions, jsEvent) {\n    const commonActions = this._commonActions;\n    for (const name of Object.keys(jsEvent.detail)) {\n      const action = actions[name] || commonActions[name];\n      action?.(jsEvent);\n    }\n  }\n\n  _setDefaultPropertiesFromJS(element) {\n    if (!this.enableScripting) {\n      return;\n    }\n\n    // Some properties may have been updated thanks to JS.\n    const storedData = this.annotationStorage.getRawValue(this.data.id);\n    if (!storedData) {\n      return;\n    }\n\n    const commonActions = this._commonActions;\n    for (const [actionName, detail] of Object.entries(storedData)) {\n      const action = commonActions[actionName];\n      if (action) {\n        const eventProxy = {\n          detail: {\n            [actionName]: detail,\n          },\n          target: element,\n        };\n        action(eventProxy);\n        // The action has been consumed: no need to keep it.\n        delete storedData[actionName];\n      }\n    }\n  }\n\n  /**\n   * Create quadrilaterals from the annotation's quadpoints.\n   *\n   * @private\n   * @memberof AnnotationElement\n   */\n  _createQuadrilaterals() {\n    if (!this.container) {\n      return;\n    }\n    const { quadPoints } = this.data;\n    if (!quadPoints) {\n      return;\n    }\n\n    const [rectBlX, rectBlY, rectTrX, rectTrY] = this.data.rect.map(x =>\n      Math.fround(x)\n    );\n\n    if (quadPoints.length === 8) {\n      const [trX, trY, blX, blY] = quadPoints.subarray(2, 6);\n      if (\n        rectTrX === trX &&\n        rectTrY === trY &&\n        rectBlX === blX &&\n        rectBlY === blY\n      ) {\n        // The quadpoints cover the whole annotation rectangle, so no need to\n        // create a quadrilateral.\n        return;\n      }\n    }\n\n    const { style } = this.container;\n    let svgBuffer;\n    if (this.#hasBorder) {\n      const { borderColor, borderWidth } = style;\n      style.borderWidth = 0;\n      svgBuffer = [\n        \"url('data:image/svg+xml;utf8,\",\n        `<svg xmlns=\"http://www.w3.org/2000/svg\"`,\n        ` preserveAspectRatio=\"none\" viewBox=\"0 0 1 1\">`,\n        `<g fill=\"transparent\" stroke=\"${borderColor}\" stroke-width=\"${borderWidth}\">`,\n      ];\n      this.container.classList.add(\"hasBorder\");\n    }\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      this.container.classList.add(\"hasClipPath\");\n    }\n\n    const width = rectTrX - rectBlX;\n    const height = rectTrY - rectBlY;\n\n    const { svgFactory } = this;\n    const svg = svgFactory.createElement(\"svg\");\n    svg.classList.add(\"quadrilateralsContainer\");\n    svg.setAttribute(\"width\", 0);\n    svg.setAttribute(\"height\", 0);\n    svg.role = \"none\";\n    const defs = svgFactory.createElement(\"defs\");\n    svg.append(defs);\n    const clipPath = svgFactory.createElement(\"clipPath\");\n    const id = `clippath_${this.data.id}`;\n    clipPath.setAttribute(\"id\", id);\n    clipPath.setAttribute(\"clipPathUnits\", \"objectBoundingBox\");\n    defs.append(clipPath);\n\n    for (let i = 2, ii = quadPoints.length; i < ii; i += 8) {\n      const trX = quadPoints[i];\n      const trY = quadPoints[i + 1];\n      const blX = quadPoints[i + 2];\n      const blY = quadPoints[i + 3];\n      const rect = svgFactory.createElement(\"rect\");\n      const x = (blX - rectBlX) / width;\n      const y = (rectTrY - trY) / height;\n      const rectWidth = (trX - blX) / width;\n      const rectHeight = (trY - blY) / height;\n      rect.setAttribute(\"x\", x);\n      rect.setAttribute(\"y\", y);\n      rect.setAttribute(\"width\", rectWidth);\n      rect.setAttribute(\"height\", rectHeight);\n      clipPath.append(rect);\n      svgBuffer?.push(\n        `<rect vector-effect=\"non-scaling-stroke\" x=\"${x}\" y=\"${y}\" width=\"${rectWidth}\" height=\"${rectHeight}\"/>`\n      );\n    }\n\n    if (this.#hasBorder) {\n      svgBuffer.push(`</g></svg>')`);\n      style.backgroundImage = svgBuffer.join(\"\");\n    }\n\n    this.container.append(svg);\n    this.container.style.clipPath = `url(#${id})`;\n  }\n\n  /**\n   * Create a popup for the annotation's HTML element. This is used for\n   * annotations that do not have a Popup entry in the dictionary, but\n   * are of a type that works with popups (such as Highlight annotations).\n   *\n   * @param {Object} [popupData] - The data for the popup, if any.\n   *\n   * @private\n   * @memberof AnnotationElement\n   */\n  _createPopup(popupData = null) {\n    const { data } = this;\n\n    let contentsObj, modificationDate;\n    if (popupData) {\n      contentsObj = {\n        str: popupData.text,\n      };\n      modificationDate = popupData.date;\n    } else {\n      contentsObj = data.contentsObj;\n      modificationDate = data.modificationDate;\n    }\n    this.#popupElement = new PopupAnnotationElement({\n      data: {\n        color: data.color,\n        titleObj: data.titleObj,\n        modificationDate,\n        contentsObj,\n        richText: data.richText,\n        parentRect: data.rect,\n        borderStyle: 0,\n        id: `popup_${data.id}`,\n        rotation: data.rotation,\n        noRotate: true,\n      },\n      linkService: this.linkService,\n      parent: this.parent,\n      elements: [this],\n    });\n  }\n\n  get hasPopupElement() {\n    return !!(this.#popupElement || this.popup || this.data.popupRef);\n  }\n\n  get extraPopupElement() {\n    return this.#popupElement;\n  }\n\n  /**\n   * Render the annotation's HTML element(s).\n   *\n   * @public\n   * @memberof AnnotationElement\n   */\n  render() {\n    unreachable(\"Abstract method `AnnotationElement.render` called\");\n  }\n\n  /**\n   * @private\n   * @returns {Array}\n   */\n  _getElementsByName(name, skipId = null) {\n    const fields = [];\n\n    if (this._fieldObjects) {\n      const fieldObj = this._fieldObjects[name];\n      if (fieldObj) {\n        for (const { page, id, exportValues } of fieldObj) {\n          if (page === -1) {\n            continue;\n          }\n          if (id === skipId) {\n            continue;\n          }\n          const exportValue =\n            typeof exportValues === \"string\" ? exportValues : null;\n\n          const domElement = document.querySelector(\n            `[data-element-id=\"${id}\"]`\n          );\n          if (domElement && !GetElementsByNameSet.has(domElement)) {\n            warn(`_getElementsByName - element not allowed: ${id}`);\n            continue;\n          }\n          fields.push({ id, exportValue, domElement });\n        }\n      }\n      return fields;\n    }\n    // Fallback to a regular DOM lookup, to ensure that the standalone\n    // viewer components won't break.\n    for (const domElement of document.getElementsByName(name)) {\n      const { exportValue } = domElement;\n      const id = domElement.getAttribute(\"data-element-id\");\n      if (id === skipId) {\n        continue;\n      }\n      if (!GetElementsByNameSet.has(domElement)) {\n        continue;\n      }\n      fields.push({ id, exportValue, domElement });\n    }\n    return fields;\n  }\n\n  show() {\n    if (this.container) {\n      this.container.hidden = false;\n    }\n    this.popup?.maybeShow();\n  }\n\n  hide() {\n    if (this.container) {\n      this.container.hidden = true;\n    }\n    this.popup?.forceHide();\n  }\n\n  /**\n   * Get the HTML element(s) which can trigger a popup when clicked or hovered.\n   *\n   * @public\n   * @memberof AnnotationElement\n   * @returns {Array<HTMLElement>|HTMLElement} An array of elements or an\n   *          element.\n   */\n  getElementsToTriggerPopup() {\n    return this.container;\n  }\n\n  addHighlightArea() {\n    const triggers = this.getElementsToTriggerPopup();\n    if (Array.isArray(triggers)) {\n      for (const element of triggers) {\n        element.classList.add(\"highlightArea\");\n      }\n    } else {\n      triggers.classList.add(\"highlightArea\");\n    }\n  }\n\n  _editOnDoubleClick() {\n    if (!this._isEditable) {\n      return;\n    }\n    const {\n      annotationEditorType: mode,\n      data: { id: editId },\n    } = this;\n    this.container.addEventListener(\"dblclick\", () => {\n      this.linkService.eventBus?.dispatch(\"switchannotationeditormode\", {\n        source: this,\n        mode,\n        editId,\n        mustEnterInEditMode: true,\n      });\n    });\n  }\n\n  get width() {\n    return this.data.rect[2] - this.data.rect[0];\n  }\n\n  get height() {\n    return this.data.rect[3] - this.data.rect[1];\n  }\n}\n\nclass EditorAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n    this.editor = parameters.editor;\n  }\n\n  render() {\n    this.container.className = \"editorAnnotation\";\n    return this.container;\n  }\n\n  createOrUpdatePopup() {\n    const { editor } = this;\n    if (!editor.hasComment) {\n      return;\n    }\n    this._createPopup(editor.comment);\n  }\n\n  get hasCommentButton() {\n    return this.enableComment && this.editor.hasComment;\n  }\n\n  get commentButtonPosition() {\n    return this.editor.commentButtonPositionInPage;\n  }\n\n  get commentText() {\n    return this.editor.comment.text;\n  }\n\n  set commentText(text) {\n    this.editor.comment = text;\n    if (!text) {\n      this.removePopup();\n    }\n  }\n\n  get commentData() {\n    return this.editor.getData();\n  }\n\n  remove() {\n    this.parent.removeAnnotation(this.data.id);\n    this.container.remove();\n    this.container = null;\n    this.removePopup();\n  }\n}\n\nclass LinkAnnotationElement extends AnnotationElement {\n  constructor(parameters, options = null) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: !!options?.ignoreBorder,\n      createQuadrilaterals: true,\n    });\n    this.isTooltipOnly = parameters.data.isTooltipOnly;\n  }\n\n  render() {\n    const { data, linkService } = this;\n    const link = document.createElement(\"a\");\n    link.setAttribute(\"data-element-id\", data.id);\n    let isBound = false;\n\n    if (data.url) {\n      linkService.addLinkAttributes(link, data.url, data.newWindow);\n      isBound = true;\n    } else if (data.action) {\n      this._bindNamedAction(link, data.action, data.overlaidText);\n      isBound = true;\n    } else if (data.attachment) {\n      this.#bindAttachment(\n        link,\n        data.attachment,\n        data.overlaidText,\n        data.attachmentDest\n      );\n      isBound = true;\n    } else if (data.setOCGState) {\n      this.#bindSetOCGState(link, data.setOCGState, data.overlaidText);\n      isBound = true;\n    } else if (data.dest) {\n      this._bindLink(link, data.dest, data.overlaidText);\n      isBound = true;\n    } else {\n      if (\n        data.actions &&\n        (data.actions.Action ||\n          data.actions[\"Mouse Up\"] ||\n          data.actions[\"Mouse Down\"]) &&\n        this.enableScripting &&\n        this.hasJSActions\n      ) {\n        this._bindJSAction(link, data);\n        isBound = true;\n      }\n\n      if (data.resetForm) {\n        this._bindResetFormAction(link, data.resetForm);\n        isBound = true;\n      } else if (this.isTooltipOnly && !isBound) {\n        this._bindLink(link, \"\");\n        isBound = true;\n      }\n    }\n\n    this.container.classList.add(\"linkAnnotation\");\n    if (isBound) {\n      this.contentElement = link;\n      this.container.append(link);\n    }\n\n    return this.container;\n  }\n\n  #setInternalLink() {\n    this.container.setAttribute(\"data-internal-link\", \"\");\n  }\n\n  /**\n   * Bind internal links to the link element.\n   *\n   * @private\n   * @param {Object} link\n   * @param {Object} destination\n   * @param {string} [overlaidText]\n   * @memberof LinkAnnotationElement\n   */\n  _bindLink(link, destination, overlaidText = \"\") {\n    link.href = this.linkService.getDestinationHash(destination);\n    link.onclick = () => {\n      if (destination) {\n        this.linkService.goToDestination(destination);\n      }\n      return false;\n    };\n    if (destination || destination === /* isTooltipOnly = */ \"\") {\n      this.#setInternalLink();\n    }\n    if (overlaidText) {\n      link.title = overlaidText;\n    }\n  }\n\n  /**\n   * Bind named actions to the link element.\n   *\n   * @private\n   * @param {Object} link\n   * @param {Object} action\n   * @param {string} [overlaidText]\n   * @memberof LinkAnnotationElement\n   */\n  _bindNamedAction(link, action, overlaidText = \"\") {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    link.onclick = () => {\n      this.linkService.executeNamedAction(action);\n      return false;\n    };\n    if (overlaidText) {\n      link.title = overlaidText;\n    }\n    this.#setInternalLink();\n  }\n\n  /**\n   * Bind attachments to the link element.\n   * @param {Object} link\n   * @param {Object} attachment\n   * @param {string} [overlaidText]\n   * @param {string} [dest]\n   */\n  #bindAttachment(link, attachment, overlaidText = \"\", dest = null) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    if (attachment.description) {\n      link.title = attachment.description;\n    } else if (overlaidText) {\n      link.title = overlaidText;\n    }\n    link.onclick = () => {\n      this.downloadManager?.openOrDownloadData(\n        attachment.content,\n        attachment.filename,\n        dest\n      );\n      return false;\n    };\n    this.#setInternalLink();\n  }\n\n  /**\n   * Bind SetOCGState actions to the link element.\n   * @param {Object} link\n   * @param {Object} action\n   * @param {string} [overlaidText]\n   */\n  #bindSetOCGState(link, action, overlaidText = \"\") {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    link.onclick = () => {\n      this.linkService.executeSetOCGState(action);\n      return false;\n    };\n    if (overlaidText) {\n      link.title = overlaidText;\n    }\n    this.#setInternalLink();\n  }\n\n  /**\n   * Bind JS actions to the link element.\n   *\n   * @private\n   * @param {Object} link\n   * @param {Object} data\n   * @memberof LinkAnnotationElement\n   */\n  _bindJSAction(link, data) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    const map = new Map([\n      [\"Action\", \"onclick\"],\n      [\"Mouse Up\", \"onmouseup\"],\n      [\"Mouse Down\", \"onmousedown\"],\n    ]);\n    for (const name of Object.keys(data.actions)) {\n      const jsName = map.get(name);\n      if (!jsName) {\n        continue;\n      }\n      link[jsName] = () => {\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: data.id,\n            name,\n          },\n        });\n        return false;\n      };\n    }\n    if (data.overlaidText) {\n      link.title = data.overlaidText;\n    }\n\n    if (!link.onclick) {\n      link.onclick = () => false;\n    }\n    this.#setInternalLink();\n  }\n\n  _bindResetFormAction(link, resetForm) {\n    const otherClickAction = link.onclick;\n    if (!otherClickAction) {\n      link.href = this.linkService.getAnchorUrl(\"\");\n    }\n    this.#setInternalLink();\n\n    if (!this._fieldObjects) {\n      warn(\n        `_bindResetFormAction - \"resetForm\" action not supported, ` +\n          \"ensure that the `fieldObjects` parameter is provided.\"\n      );\n      if (!otherClickAction) {\n        link.onclick = () => false;\n      }\n      return;\n    }\n\n    link.onclick = () => {\n      otherClickAction?.();\n\n      const {\n        fields: resetFormFields,\n        refs: resetFormRefs,\n        include,\n      } = resetForm;\n\n      const allFields = [];\n      if (resetFormFields.length !== 0 || resetFormRefs.length !== 0) {\n        const fieldIds = new Set(resetFormRefs);\n        for (const fieldName of resetFormFields) {\n          const fields = this._fieldObjects[fieldName] || [];\n          for (const { id } of fields) {\n            fieldIds.add(id);\n          }\n        }\n        for (const fields of Object.values(this._fieldObjects)) {\n          for (const field of fields) {\n            if (fieldIds.has(field.id) === include) {\n              allFields.push(field);\n            }\n          }\n        }\n      } else {\n        for (const fields of Object.values(this._fieldObjects)) {\n          allFields.push(...fields);\n        }\n      }\n\n      const storage = this.annotationStorage;\n      const allIds = [];\n      for (const field of allFields) {\n        const { id } = field;\n        allIds.push(id);\n        switch (field.type) {\n          case \"text\": {\n            const value = field.defaultValue || \"\";\n            storage.setValue(id, { value });\n            break;\n          }\n          case \"checkbox\":\n          case \"radiobutton\": {\n            const value = field.defaultValue === field.exportValues;\n            storage.setValue(id, { value });\n            break;\n          }\n          case \"combobox\":\n          case \"listbox\": {\n            const value = field.defaultValue || \"\";\n            storage.setValue(id, { value });\n            break;\n          }\n          default:\n            continue;\n        }\n\n        const domElement = document.querySelector(`[data-element-id=\"${id}\"]`);\n        if (!domElement) {\n          continue;\n        } else if (!GetElementsByNameSet.has(domElement)) {\n          warn(`_bindResetFormAction - element not allowed: ${id}`);\n          continue;\n        }\n        domElement.dispatchEvent(new Event(\"resetform\"));\n      }\n\n      if (this.enableScripting) {\n        // Update the values in the sandbox.\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: \"app\",\n            ids: allIds,\n            name: \"ResetForm\",\n          },\n        });\n      }\n\n      return false;\n    };\n  }\n}\n\nclass TextAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true });\n  }\n\n  render() {\n    this.container.classList.add(\"textAnnotation\");\n\n    const image = document.createElement(\"img\");\n    image.src =\n      this.imageResourcesPath +\n      \"annotation-\" +\n      this.data.name.toLowerCase() +\n      \".svg\";\n    image.setAttribute(\"data-l10n-id\", \"pdfjs-text-annotation-type\");\n    image.setAttribute(\n      \"data-l10n-args\",\n      JSON.stringify({ type: this.data.name })\n    );\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    this.container.append(image);\n    return this.container;\n  }\n}\n\nclass WidgetAnnotationElement extends AnnotationElement {\n  render() {\n    // Show only the container for unsupported field types.\n    return this.container;\n  }\n\n  showElementAndHideCanvas(element) {\n    if (this.data.hasOwnCanvas) {\n      if (element.previousSibling?.nodeName === \"CANVAS\") {\n        element.previousSibling.hidden = true;\n      }\n      element.hidden = false;\n    }\n  }\n\n  _getKeyModifier(event) {\n    return FeatureTest.platform.isMac ? event.metaKey : event.ctrlKey;\n  }\n\n  _setEventListener(element, elementData, baseName, eventName, valueGetter) {\n    if (baseName.includes(\"mouse\")) {\n      // Mouse events\n      element.addEventListener(baseName, event => {\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: this.data.id,\n            name: eventName,\n            value: valueGetter(event),\n            shift: event.shiftKey,\n            modifier: this._getKeyModifier(event),\n          },\n        });\n      });\n    } else {\n      // Non-mouse events\n      element.addEventListener(baseName, event => {\n        if (baseName === \"blur\") {\n          if (!elementData.focused || !event.relatedTarget) {\n            return;\n          }\n          elementData.focused = false;\n        } else if (baseName === \"focus\") {\n          if (elementData.focused) {\n            return;\n          }\n          elementData.focused = true;\n        }\n\n        if (!valueGetter) {\n          return;\n        }\n\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: this.data.id,\n            name: eventName,\n            value: valueGetter(event),\n          },\n        });\n      });\n    }\n  }\n\n  _setEventListeners(element, elementData, names, getter) {\n    for (const [baseName, eventName] of names) {\n      if (eventName === \"Action\" || this.data.actions?.[eventName]) {\n        if (eventName === \"Focus\" || eventName === \"Blur\") {\n          elementData ||= { focused: false };\n        }\n        this._setEventListener(\n          element,\n          elementData,\n          baseName,\n          eventName,\n          getter\n        );\n        if (eventName === \"Focus\" && !this.data.actions?.Blur) {\n          // Ensure that elementData will have the correct value.\n          this._setEventListener(element, elementData, \"blur\", \"Blur\", null);\n        } else if (eventName === \"Blur\" && !this.data.actions?.Focus) {\n          this._setEventListener(element, elementData, \"focus\", \"Focus\", null);\n        }\n      }\n    }\n  }\n\n  _setBackgroundColor(element) {\n    const color = this.data.backgroundColor || null;\n    element.style.backgroundColor =\n      color === null\n        ? \"transparent\"\n        : Util.makeHexColor(color[0], color[1], color[2]);\n  }\n\n  /**\n   * Apply text styles to the text in the element.\n   *\n   * @private\n   * @param {HTMLDivElement} element\n   * @memberof TextWidgetAnnotationElement\n   */\n  _setTextStyle(element) {\n    const TEXT_ALIGNMENT = [\"left\", \"center\", \"right\"];\n    const { fontColor } = this.data.defaultAppearanceData;\n    const fontSize =\n      this.data.defaultAppearanceData.fontSize || DEFAULT_FONT_SIZE;\n\n    const style = element.style;\n\n    // TODO: If the font-size is zero, calculate it based on the height and\n    //       width of the element.\n    // Not setting `style.fontSize` will use the default font-size for now.\n\n    // We don't use the font, as specified in the PDF document, for the <input>\n    // element. Hence using the original `fontSize` could look bad, which is why\n    // it's instead based on the field height.\n    // If the height is \"big\" then it could lead to a too big font size\n    // so in this case use the one we've in the pdf (hence the min).\n    let computedFontSize;\n    const BORDER_SIZE = 2;\n    const roundToOneDecimal = x => Math.round(10 * x) / 10;\n    if (this.data.multiLine) {\n      const height = Math.abs(\n        this.data.rect[3] - this.data.rect[1] - BORDER_SIZE\n      );\n      const numberOfLines = Math.round(height / (LINE_FACTOR * fontSize)) || 1;\n      const lineHeight = height / numberOfLines;\n      computedFontSize = Math.min(\n        fontSize,\n        roundToOneDecimal(lineHeight / LINE_FACTOR)\n      );\n    } else {\n      const height = Math.abs(\n        this.data.rect[3] - this.data.rect[1] - BORDER_SIZE\n      );\n      computedFontSize = Math.min(\n        fontSize,\n        roundToOneDecimal(height / LINE_FACTOR)\n      );\n    }\n    style.fontSize = `calc(${computedFontSize}px * var(--total-scale-factor))`;\n\n    style.color = Util.makeHexColor(fontColor[0], fontColor[1], fontColor[2]);\n\n    if (this.data.textAlignment !== null) {\n      style.textAlign = TEXT_ALIGNMENT[this.data.textAlignment];\n    }\n  }\n\n  _setRequired(element, isRequired) {\n    if (isRequired) {\n      element.setAttribute(\"required\", true);\n    } else {\n      element.removeAttribute(\"required\");\n    }\n    element.setAttribute(\"aria-required\", isRequired);\n  }\n}\n\nclass TextWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    const isRenderable =\n      parameters.renderForms ||\n      parameters.data.hasOwnCanvas ||\n      (!parameters.data.hasAppearance && !!parameters.data.fieldValue);\n    super(parameters, { isRenderable });\n  }\n\n  setPropertyOnSiblings(base, key, value, keyInStorage) {\n    const storage = this.annotationStorage;\n    for (const element of this._getElementsByName(\n      base.name,\n      /* skipId = */ base.id\n    )) {\n      if (element.domElement) {\n        element.domElement[key] = value;\n      }\n      storage.setValue(element.id, { [keyInStorage]: value });\n    }\n  }\n\n  render() {\n    const storage = this.annotationStorage;\n    const id = this.data.id;\n\n    this.container.classList.add(\"textWidgetAnnotation\");\n\n    let element = null;\n    if (this.renderForms) {\n      // NOTE: We cannot set the values using `element.value` below, since it\n      //       prevents the AnnotationLayer rasterizer in `test/driver.js`\n      //       from parsing the elements correctly for the reference tests.\n      const storedData = storage.getValue(id, {\n        value: this.data.fieldValue,\n      });\n      let textContent = storedData.value || \"\";\n      const maxLen = storage.getValue(id, {\n        charLimit: this.data.maxLen,\n      }).charLimit;\n      if (maxLen && textContent.length > maxLen) {\n        textContent = textContent.slice(0, maxLen);\n      }\n\n      let fieldFormattedValues =\n        storedData.formattedValue || this.data.textContent?.join(\"\\n\") || null;\n      if (fieldFormattedValues && this.data.comb) {\n        fieldFormattedValues = fieldFormattedValues.replaceAll(/\\s+/g, \"\");\n      }\n\n      const elementData = {\n        userValue: textContent,\n        formattedValue: fieldFormattedValues,\n        lastCommittedValue: null,\n        commitKey: 1,\n        focused: false,\n      };\n\n      if (this.data.multiLine) {\n        element = document.createElement(\"textarea\");\n        element.textContent = fieldFormattedValues ?? textContent;\n        if (this.data.doNotScroll) {\n          element.style.overflowY = \"hidden\";\n        }\n      } else {\n        element = document.createElement(\"input\");\n        element.type = this.data.password ? \"password\" : \"text\";\n        element.setAttribute(\"value\", fieldFormattedValues ?? textContent);\n        if (this.data.doNotScroll) {\n          element.style.overflowX = \"hidden\";\n        }\n      }\n      if (this.data.hasOwnCanvas) {\n        element.hidden = true;\n      }\n      GetElementsByNameSet.add(element);\n      this.contentElement = element;\n      element.setAttribute(\"data-element-id\", id);\n\n      element.disabled = this.data.readOnly;\n      element.name = this.data.fieldName;\n      element.tabIndex = 0;\n      const { datetimeFormat, datetimeType, timeStep } = this.data;\n      const hasDateOrTime = !!datetimeType && this.enableScripting;\n      if (datetimeFormat) {\n        element.title = datetimeFormat;\n      }\n\n      this._setRequired(element, this.data.required);\n\n      if (maxLen) {\n        element.maxLength = maxLen;\n      }\n\n      element.addEventListener(\"input\", event => {\n        storage.setValue(id, { value: event.target.value });\n        this.setPropertyOnSiblings(\n          element,\n          \"value\",\n          event.target.value,\n          \"value\"\n        );\n        elementData.formattedValue = null;\n      });\n\n      element.addEventListener(\"resetform\", event => {\n        const defaultValue = this.data.defaultFieldValue ?? \"\";\n        element.value = elementData.userValue = defaultValue;\n        elementData.formattedValue = null;\n      });\n\n      let blurListener = event => {\n        const { formattedValue } = elementData;\n        if (formattedValue !== null && formattedValue !== undefined) {\n          event.target.value = formattedValue;\n        }\n        // Reset the cursor position to the start of the field (issue 12359).\n        event.target.scrollLeft = 0;\n      };\n\n      if (this.enableScripting && this.hasJSActions) {\n        element.addEventListener(\"focus\", event => {\n          if (elementData.focused) {\n            return;\n          }\n          const { target } = event;\n          if (hasDateOrTime) {\n            target.type = datetimeType;\n            if (timeStep) {\n              target.step = timeStep;\n            }\n          }\n\n          if (elementData.userValue) {\n            const value = elementData.userValue;\n            if (hasDateOrTime) {\n              if (datetimeType === \"time\") {\n                const date = new Date(value);\n                const parts = [\n                  date.getHours(),\n                  date.getMinutes(),\n                  date.getSeconds(),\n                ];\n                target.value = parts\n                  .map(v => v.toString().padStart(2, \"0\"))\n                  .join(\":\");\n              } else {\n                target.value = new Date(value - TIMEZONE_OFFSET)\n                  .toISOString()\n                  .split(datetimeType === \"date\" ? \"T\" : \".\", 1)[0];\n              }\n            } else {\n              target.value = value;\n            }\n          }\n          elementData.lastCommittedValue = target.value;\n          elementData.commitKey = 1;\n          if (!this.data.actions?.Focus) {\n            elementData.focused = true;\n          }\n        });\n\n        element.addEventListener(\"updatefromsandbox\", jsEvent => {\n          this.showElementAndHideCanvas(jsEvent.target);\n          const actions = {\n            value(event) {\n              elementData.userValue = event.detail.value ?? \"\";\n              if (!hasDateOrTime) {\n                storage.setValue(id, {\n                  value: elementData.userValue.toString(),\n                });\n              }\n              event.target.value = elementData.userValue;\n            },\n            formattedValue(event) {\n              const { formattedValue } = event.detail;\n              elementData.formattedValue = formattedValue;\n              if (\n                formattedValue !== null &&\n                formattedValue !== undefined &&\n                event.target !== document.activeElement\n              ) {\n                // Input hasn't the focus so display formatted string\n                event.target.value = formattedValue;\n              }\n              const data = {\n                formattedValue,\n              };\n              if (hasDateOrTime) {\n                // If the field is a date or time, we store the formatted value\n                // in the `value` property, so that it can be used by the\n                // `Keystroke` action.\n                data.value = formattedValue;\n              }\n              storage.setValue(id, data);\n            },\n            selRange(event) {\n              event.target.setSelectionRange(...event.detail.selRange);\n            },\n            charLimit: event => {\n              const { charLimit } = event.detail;\n              const { target } = event;\n              if (charLimit === 0) {\n                target.removeAttribute(\"maxLength\");\n                return;\n              }\n\n              target.setAttribute(\"maxLength\", charLimit);\n              let value = elementData.userValue;\n              if (!value || value.length <= charLimit) {\n                return;\n              }\n              value = value.slice(0, charLimit);\n              target.value = elementData.userValue = value;\n              storage.setValue(id, { value });\n\n              this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n                source: this,\n                detail: {\n                  id,\n                  name: \"Keystroke\",\n                  value,\n                  willCommit: true,\n                  commitKey: 1,\n                  selStart: target.selectionStart,\n                  selEnd: target.selectionEnd,\n                },\n              });\n            },\n          };\n          this._dispatchEventFromSandbox(actions, jsEvent);\n        });\n\n        // Even if the field hasn't any actions\n        // leaving it can still trigger some actions with Calculate\n        element.addEventListener(\"keydown\", event => {\n          elementData.commitKey = 1;\n          // If the key is one of Escape, Enter then the data are committed.\n          // If we've a Tab then data will be committed on blur.\n          let commitKey = -1;\n          if (event.key === \"Escape\") {\n            commitKey = 0;\n          } else if (event.key === \"Enter\" && !this.data.multiLine) {\n            // When we've a multiline field, \"Enter\" key is a key as the other\n            // hence we don't commit the data (Acrobat behaves the same way)\n            // (see issue #15627).\n            commitKey = 2;\n          } else if (event.key === \"Tab\") {\n            elementData.commitKey = 3;\n          }\n          if (commitKey === -1) {\n            return;\n          }\n          const { value } = event.target;\n          if (elementData.lastCommittedValue === value) {\n            return;\n          }\n          elementData.lastCommittedValue = value;\n          // Save the entered value\n          elementData.userValue = value;\n          this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n            source: this,\n            detail: {\n              id,\n              name: \"Keystroke\",\n              value,\n              willCommit: true,\n              commitKey,\n              selStart: event.target.selectionStart,\n              selEnd: event.target.selectionEnd,\n            },\n          });\n        });\n        const _blurListener = blurListener;\n        blurListener = null;\n        element.addEventListener(\"blur\", event => {\n          if (!elementData.focused || !event.relatedTarget) {\n            return;\n          }\n          if (!this.data.actions?.Blur) {\n            elementData.focused = false;\n          }\n          const { target } = event;\n          let { value } = target;\n          if (hasDateOrTime) {\n            if (value && datetimeType === \"time\") {\n              const parts = value.split(\":\").map(v => parseInt(v, 10));\n              value = new Date(\n                2000,\n                0,\n                1,\n                parts[0],\n                parts[1],\n                parts[2] || 0\n              ).valueOf();\n              target.step = \"\";\n            } else {\n              // Unfortunately, when the date is \"2025-09-23\", the parser\n              // converts it to UTC time which may lead to the date being off by\n              // one day depending on the timezone. To workaround this, we\n              // append \"T00:00\" to the date so that it's parsed as local\n              // time (bug 1989874).\n              if (!value.includes(\"T\")) {\n                value = `${value}T00:00`;\n              }\n              value = new Date(value).valueOf();\n            }\n            target.type = \"text\";\n          }\n          elementData.userValue = value;\n          if (elementData.lastCommittedValue !== value) {\n            this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n              source: this,\n              detail: {\n                id,\n                name: \"Keystroke\",\n                value,\n                willCommit: true,\n                commitKey: elementData.commitKey,\n                selStart: event.target.selectionStart,\n                selEnd: event.target.selectionEnd,\n              },\n            });\n          }\n          _blurListener(event);\n        });\n\n        if (this.data.actions?.Keystroke) {\n          element.addEventListener(\"beforeinput\", event => {\n            elementData.lastCommittedValue = null;\n            const { data, target } = event;\n            const { value, selectionStart, selectionEnd } = target;\n\n            let selStart = selectionStart,\n              selEnd = selectionEnd;\n\n            switch (event.inputType) {\n              // https://rawgit.com/w3c/input-events/v1/index.html#interface-InputEvent-Attributes\n              case \"deleteWordBackward\": {\n                const match = value\n                  .substring(0, selectionStart)\n                  .match(/\\w*[^\\w]*$/);\n                if (match) {\n                  selStart -= match[0].length;\n                }\n                break;\n              }\n              case \"deleteWordForward\": {\n                const match = value\n                  .substring(selectionStart)\n                  .match(/^[^\\w]*\\w*/);\n                if (match) {\n                  selEnd += match[0].length;\n                }\n                break;\n              }\n              case \"deleteContentBackward\":\n                if (selectionStart === selectionEnd) {\n                  selStart -= 1;\n                }\n                break;\n              case \"deleteContentForward\":\n                if (selectionStart === selectionEnd) {\n                  selEnd += 1;\n                }\n                break;\n            }\n\n            // We handle the event ourselves.\n            event.preventDefault();\n            this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n              source: this,\n              detail: {\n                id,\n                name: \"Keystroke\",\n                value,\n                change: data || \"\",\n                willCommit: false,\n                selStart,\n                selEnd,\n              },\n            });\n          });\n        }\n\n        this._setEventListeners(\n          element,\n          elementData,\n          [\n            [\"focus\", \"Focus\"],\n            [\"blur\", \"Blur\"],\n            [\"mousedown\", \"Mouse Down\"],\n            [\"mouseenter\", \"Mouse Enter\"],\n            [\"mouseleave\", \"Mouse Exit\"],\n            [\"mouseup\", \"Mouse Up\"],\n          ],\n          event => event.target.value\n        );\n      }\n\n      if (blurListener) {\n        element.addEventListener(\"blur\", blurListener);\n      }\n\n      if (this.data.comb) {\n        const fieldWidth = this.data.rect[2] - this.data.rect[0];\n        const combWidth = fieldWidth / maxLen;\n\n        element.classList.add(\"comb\");\n        element.style.letterSpacing = `calc(${combWidth}px * var(--total-scale-factor) - 1ch)`;\n      }\n    } else {\n      element = document.createElement(\"div\");\n      element.textContent = this.data.fieldValue;\n      element.style.verticalAlign = \"middle\";\n      element.style.display = \"table-cell\";\n\n      if (this.data.hasOwnCanvas) {\n        element.hidden = true;\n      }\n    }\n\n    this._setTextStyle(element);\n    this._setBackgroundColor(element);\n    this._setDefaultPropertiesFromJS(element);\n\n    this.container.append(element);\n    return this.container;\n  }\n}\n\nclass SignatureWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: !!parameters.data.hasOwnCanvas });\n  }\n}\n\nclass CheckboxWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: parameters.renderForms });\n  }\n\n  render() {\n    const storage = this.annotationStorage;\n    const data = this.data;\n    const id = data.id;\n    let value = storage.getValue(id, {\n      value: data.exportValue === data.fieldValue,\n    }).value;\n    if (typeof value === \"string\") {\n      // The value has been changed through js and set in annotationStorage.\n      value = value !== \"Off\";\n      storage.setValue(id, { value });\n    }\n\n    this.container.classList.add(\"buttonWidgetAnnotation\", \"checkBox\");\n\n    const element = document.createElement(\"input\");\n    GetElementsByNameSet.add(element);\n    element.setAttribute(\"data-element-id\", id);\n\n    element.disabled = data.readOnly;\n    this._setRequired(element, this.data.required);\n    element.type = \"checkbox\";\n    element.name = data.fieldName;\n    if (value) {\n      element.setAttribute(\"checked\", true);\n    }\n    element.setAttribute(\"exportValue\", data.exportValue);\n    element.tabIndex = 0;\n\n    element.addEventListener(\"change\", event => {\n      const { name, checked } = event.target;\n      for (const checkbox of this._getElementsByName(name, /* skipId = */ id)) {\n        const curChecked = checked && checkbox.exportValue === data.exportValue;\n        if (checkbox.domElement) {\n          checkbox.domElement.checked = curChecked;\n        }\n        storage.setValue(checkbox.id, { value: curChecked });\n      }\n      storage.setValue(id, { value: checked });\n    });\n\n    element.addEventListener(\"resetform\", event => {\n      const defaultValue = data.defaultFieldValue || \"Off\";\n      event.target.checked = defaultValue === data.exportValue;\n    });\n\n    if (this.enableScripting && this.hasJSActions) {\n      element.addEventListener(\"updatefromsandbox\", jsEvent => {\n        const actions = {\n          value(event) {\n            event.target.checked = event.detail.value !== \"Off\";\n            storage.setValue(id, { value: event.target.checked });\n          },\n        };\n        this._dispatchEventFromSandbox(actions, jsEvent);\n      });\n\n      this._setEventListeners(\n        element,\n        null,\n        [\n          [\"change\", \"Validate\"],\n          [\"change\", \"Action\"],\n          [\"focus\", \"Focus\"],\n          [\"blur\", \"Blur\"],\n          [\"mousedown\", \"Mouse Down\"],\n          [\"mouseenter\", \"Mouse Enter\"],\n          [\"mouseleave\", \"Mouse Exit\"],\n          [\"mouseup\", \"Mouse Up\"],\n        ],\n        event => event.target.checked\n      );\n    }\n\n    this._setBackgroundColor(element);\n    this._setDefaultPropertiesFromJS(element);\n\n    this.container.append(element);\n    return this.container;\n  }\n}\n\nclass RadioButtonWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: parameters.renderForms });\n  }\n\n  render() {\n    this.container.classList.add(\"buttonWidgetAnnotation\", \"radioButton\");\n    const storage = this.annotationStorage;\n    const data = this.data;\n    const id = data.id;\n    let value = storage.getValue(id, {\n      value: data.fieldValue === data.buttonValue,\n    }).value;\n    if (typeof value === \"string\") {\n      // The value has been changed through js and set in annotationStorage.\n      value = value !== data.buttonValue;\n      storage.setValue(id, { value });\n    }\n\n    if (value) {\n      // It's possible that multiple radio buttons are checked.\n      // So if this one is checked we just reset the other ones.\n      // (see bug 1864136). Then when the other ones will be rendered they will\n      // unchecked (because of their value in the storage).\n      // Consequently, the first checked radio button will be the only checked\n      // one.\n      for (const radio of this._getElementsByName(\n        data.fieldName,\n        /* skipId = */ id\n      )) {\n        storage.setValue(radio.id, { value: false });\n      }\n    }\n\n    const element = document.createElement(\"input\");\n    GetElementsByNameSet.add(element);\n    element.setAttribute(\"data-element-id\", id);\n\n    element.disabled = data.readOnly;\n    this._setRequired(element, this.data.required);\n    element.type = \"radio\";\n    element.name = data.fieldName;\n    if (value) {\n      element.setAttribute(\"checked\", true);\n    }\n    element.tabIndex = 0;\n\n    element.addEventListener(\"change\", event => {\n      const { name, checked } = event.target;\n      for (const radio of this._getElementsByName(name, /* skipId = */ id)) {\n        storage.setValue(radio.id, { value: false });\n      }\n      storage.setValue(id, { value: checked });\n    });\n\n    element.addEventListener(\"resetform\", event => {\n      const defaultValue = data.defaultFieldValue;\n      event.target.checked =\n        defaultValue !== null &&\n        defaultValue !== undefined &&\n        defaultValue === data.buttonValue;\n    });\n\n    if (this.enableScripting && this.hasJSActions) {\n      const pdfButtonValue = data.buttonValue;\n      element.addEventListener(\"updatefromsandbox\", jsEvent => {\n        const actions = {\n          value: event => {\n            const checked = pdfButtonValue === event.detail.value;\n            for (const radio of this._getElementsByName(event.target.name)) {\n              const curChecked = checked && radio.id === id;\n              if (radio.domElement) {\n                radio.domElement.checked = curChecked;\n              }\n              storage.setValue(radio.id, { value: curChecked });\n            }\n          },\n        };\n        this._dispatchEventFromSandbox(actions, jsEvent);\n      });\n\n      this._setEventListeners(\n        element,\n        null,\n        [\n          [\"change\", \"Validate\"],\n          [\"change\", \"Action\"],\n          [\"focus\", \"Focus\"],\n          [\"blur\", \"Blur\"],\n          [\"mousedown\", \"Mouse Down\"],\n          [\"mouseenter\", \"Mouse Enter\"],\n          [\"mouseleave\", \"Mouse Exit\"],\n          [\"mouseup\", \"Mouse Up\"],\n        ],\n        event => event.target.checked\n      );\n    }\n\n    this._setBackgroundColor(element);\n    this._setDefaultPropertiesFromJS(element);\n\n    this.container.append(element);\n    return this.container;\n  }\n}\n\nclass PushButtonWidgetAnnotationElement extends LinkAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { ignoreBorder: parameters.data.hasAppearance });\n  }\n\n  render() {\n    // The rendering and functionality of a push button widget annotation is\n    // equal to that of a link annotation, but may have more functionality, such\n    // as performing actions on form fields (resetting, submitting, et cetera).\n    const container = super.render();\n    container.classList.add(\"buttonWidgetAnnotation\", \"pushButton\");\n\n    const linkElement = container.lastChild;\n    if (this.enableScripting && this.hasJSActions && linkElement) {\n      this._setDefaultPropertiesFromJS(linkElement);\n\n      linkElement.addEventListener(\"updatefromsandbox\", jsEvent => {\n        this._dispatchEventFromSandbox({}, jsEvent);\n      });\n    }\n\n    return container;\n  }\n}\n\nclass ChoiceWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: parameters.renderForms });\n  }\n\n  render() {\n    this.container.classList.add(\"choiceWidgetAnnotation\");\n    const storage = this.annotationStorage;\n    const id = this.data.id;\n\n    const storedData = storage.getValue(id, {\n      value: this.data.fieldValue,\n    });\n\n    const selectElement = document.createElement(\"select\");\n    GetElementsByNameSet.add(selectElement);\n    selectElement.setAttribute(\"data-element-id\", id);\n\n    selectElement.disabled = this.data.readOnly;\n    this._setRequired(selectElement, this.data.required);\n    selectElement.name = this.data.fieldName;\n    selectElement.tabIndex = 0;\n\n    let addAnEmptyEntry = this.data.combo && this.data.options.length > 0;\n\n    if (!this.data.combo) {\n      // List boxes have a size and (optionally) multiple selection.\n      selectElement.size = this.data.options.length;\n      if (this.data.multiSelect) {\n        selectElement.multiple = true;\n      }\n    }\n\n    selectElement.addEventListener(\"resetform\", event => {\n      const defaultValue = this.data.defaultFieldValue;\n      for (const option of selectElement.options) {\n        option.selected = option.value === defaultValue;\n      }\n    });\n\n    // Insert the options into the choice field.\n    for (const option of this.data.options) {\n      const optionElement = document.createElement(\"option\");\n      optionElement.textContent = option.displayValue;\n      optionElement.value = option.exportValue;\n      if (storedData.value.includes(option.exportValue)) {\n        optionElement.setAttribute(\"selected\", true);\n        addAnEmptyEntry = false;\n      }\n      selectElement.append(optionElement);\n    }\n\n    let removeEmptyEntry = null;\n    if (addAnEmptyEntry) {\n      const noneOptionElement = document.createElement(\"option\");\n      noneOptionElement.value = \" \";\n      noneOptionElement.setAttribute(\"hidden\", true);\n      noneOptionElement.setAttribute(\"selected\", true);\n      selectElement.prepend(noneOptionElement);\n\n      removeEmptyEntry = () => {\n        noneOptionElement.remove();\n        selectElement.removeEventListener(\"input\", removeEmptyEntry);\n        removeEmptyEntry = null;\n      };\n      selectElement.addEventListener(\"input\", removeEmptyEntry);\n    }\n\n    const getValue = isExport => {\n      const name = isExport ? \"value\" : \"textContent\";\n      const { options, multiple } = selectElement;\n      if (!multiple) {\n        return options.selectedIndex === -1\n          ? null\n          : options[options.selectedIndex][name];\n      }\n      return Array.prototype.filter\n        .call(options, option => option.selected)\n        .map(option => option[name]);\n    };\n\n    let selectedValues = getValue(/* isExport */ false);\n\n    const getItems = event => {\n      const options = event.target.options;\n      return Array.prototype.map.call(options, option => ({\n        displayValue: option.textContent,\n        exportValue: option.value,\n      }));\n    };\n\n    if (this.enableScripting && this.hasJSActions) {\n      selectElement.addEventListener(\"updatefromsandbox\", jsEvent => {\n        const actions = {\n          value(event) {\n            removeEmptyEntry?.();\n            const value = event.detail.value;\n            const values = new Set(Array.isArray(value) ? value : [value]);\n            for (const option of selectElement.options) {\n              option.selected = values.has(option.value);\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          multipleSelection(event) {\n            selectElement.multiple = true;\n          },\n          remove(event) {\n            const options = selectElement.options;\n            const index = event.detail.remove;\n            options[index].selected = false;\n            selectElement.remove(index);\n            if (options.length > 0) {\n              const i = Array.prototype.findIndex.call(\n                options,\n                option => option.selected\n              );\n              if (i === -1) {\n                options[0].selected = true;\n              }\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n              items: getItems(event),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          clear(event) {\n            while (selectElement.length !== 0) {\n              selectElement.remove(0);\n            }\n            storage.setValue(id, { value: null, items: [] });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          insert(event) {\n            const { index, displayValue, exportValue } = event.detail.insert;\n            const selectChild = selectElement.children[index];\n            const optionElement = document.createElement(\"option\");\n            optionElement.textContent = displayValue;\n            optionElement.value = exportValue;\n\n            if (selectChild) {\n              selectChild.before(optionElement);\n            } else {\n              selectElement.append(optionElement);\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n              items: getItems(event),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          items(event) {\n            const { items } = event.detail;\n            while (selectElement.length !== 0) {\n              selectElement.remove(0);\n            }\n            for (const item of items) {\n              const { displayValue, exportValue } = item;\n              const optionElement = document.createElement(\"option\");\n              optionElement.textContent = displayValue;\n              optionElement.value = exportValue;\n              selectElement.append(optionElement);\n            }\n            if (selectElement.options.length > 0) {\n              selectElement.options[0].selected = true;\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n              items: getItems(event),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          indices(event) {\n            const indices = new Set(event.detail.indices);\n            for (const option of event.target.options) {\n              option.selected = indices.has(option.index);\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          editable(event) {\n            event.target.disabled = !event.detail.editable;\n          },\n        };\n        this._dispatchEventFromSandbox(actions, jsEvent);\n      });\n\n      selectElement.addEventListener(\"input\", event => {\n        const exportValue = getValue(/* isExport */ true);\n        const change = getValue(/* isExport */ false);\n        storage.setValue(id, { value: exportValue });\n\n        event.preventDefault();\n\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id,\n            name: \"Keystroke\",\n            value: selectedValues,\n            change,\n            changeEx: exportValue,\n            willCommit: false,\n            commitKey: 1,\n            keyDown: false,\n          },\n        });\n      });\n\n      this._setEventListeners(\n        selectElement,\n        null,\n        [\n          [\"focus\", \"Focus\"],\n          [\"blur\", \"Blur\"],\n          [\"mousedown\", \"Mouse Down\"],\n          [\"mouseenter\", \"Mouse Enter\"],\n          [\"mouseleave\", \"Mouse Exit\"],\n          [\"mouseup\", \"Mouse Up\"],\n          [\"input\", \"Action\"],\n          [\"input\", \"Validate\"],\n        ],\n        event => event.target.value\n      );\n    } else {\n      selectElement.addEventListener(\"input\", function (event) {\n        storage.setValue(id, { value: getValue(/* isExport */ true) });\n      });\n    }\n\n    if (this.data.combo) {\n      this._setTextStyle(selectElement);\n    } else {\n      // Just use the default font size...\n      // it's a bit hard to guess what is a good size.\n    }\n    this._setBackgroundColor(selectElement);\n    this._setDefaultPropertiesFromJS(selectElement);\n\n    this.container.append(selectElement);\n    return this.container;\n  }\n}\n\nclass PopupAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    const { data, elements, parent } = parameters;\n    const hasCommentManager = !!parent._commentManager;\n    super(parameters, {\n      isRenderable: !hasCommentManager && AnnotationElement._hasPopupData(data),\n    });\n    this.elements = elements;\n    if (hasCommentManager && AnnotationElement._hasPopupData(data)) {\n      const popup = (this.popup = this.#createPopup());\n      for (const element of elements) {\n        element.popup = popup;\n      }\n    } else {\n      this.popup = null;\n    }\n  }\n\n  #createPopup() {\n    return new PopupElement({\n      container: this.container,\n      color: this.data.color,\n      titleObj: this.data.titleObj,\n      modificationDate: this.data.modificationDate || this.data.creationDate,\n      contentsObj: this.data.contentsObj,\n      richText: this.data.richText,\n      rect: this.data.rect,\n      parentRect: this.data.parentRect || null,\n      parent: this.parent,\n      elements: this.elements,\n      open: this.data.open,\n      commentManager: this.parent._commentManager,\n    });\n  }\n\n  render() {\n    const { container } = this;\n    container.classList.add(\"popupAnnotation\");\n    container.role = \"comment\";\n\n    const popup = (this.popup = this.#createPopup());\n\n    const elementIds = [];\n    for (const element of this.elements) {\n      element.popup = popup;\n      element.container.ariaHasPopup = \"dialog\";\n      elementIds.push(element.data.id);\n      element.addHighlightArea();\n    }\n\n    this.container.setAttribute(\n      \"aria-controls\",\n      elementIds.map(id => `${AnnotationPrefix}${id}`).join(\",\")\n    );\n\n    return this.container;\n  }\n}\n\nclass PopupElement {\n  #commentManager = null;\n\n  #boundKeyDown = this.#keyDown.bind(this);\n\n  #boundHide = this.#hide.bind(this);\n\n  #boundShow = this.#show.bind(this);\n\n  #boundToggle = this.#toggle.bind(this);\n\n  #color = null;\n\n  #container = null;\n\n  #contentsObj = null;\n\n  #dateObj = null;\n\n  #elements = null;\n\n  #parent = null;\n\n  #parentRect = null;\n\n  #pinned = false;\n\n  #popup = null;\n\n  #popupAbortController = null;\n\n  #position = null;\n\n  #commentButton = null;\n\n  #commentButtonPosition = null;\n\n  #popupPosition = null;\n\n  #rect = null;\n\n  #richText = null;\n\n  #titleObj = null;\n\n  #updates = null;\n\n  #wasVisible = false;\n\n  #firstElement = null;\n\n  #commentText = null;\n\n  constructor({\n    container,\n    color,\n    elements,\n    titleObj,\n    modificationDate,\n    contentsObj,\n    richText,\n    parent,\n    rect,\n    parentRect,\n    open,\n    commentManager = null,\n  }) {\n    this.#container = container;\n    this.#titleObj = titleObj;\n    this.#contentsObj = contentsObj;\n    this.#richText = richText;\n    this.#parent = parent;\n    this.#color = color;\n    this.#rect = rect;\n    this.#parentRect = parentRect;\n    this.#elements = elements;\n    this.#commentManager = commentManager;\n    this.#firstElement = elements[0];\n\n    // The modification date is shown in the popup instead of the creation\n    // date if it is available and can be parsed correctly, which is\n    // consistent with other viewers such as Adobe Acrobat.\n    this.#dateObj = PDFDateString.toDateObject(modificationDate);\n\n    // The elements that will trigger the popup.\n    this.trigger = elements.flatMap(e => e.getElementsToTriggerPopup());\n\n    if (!commentManager) {\n      this.#addEventListeners();\n\n      this.#container.hidden = true;\n      if (open) {\n        this.#toggle();\n      }\n\n      if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n        // Since the popup is lazily created, we need to ensure that it'll be\n        // created and displayed during reference tests.\n        this.#parent.popupShow.push(async () => {\n          if (this.#container.hidden) {\n            this.#show();\n          }\n        });\n      }\n    }\n  }\n\n  #addEventListeners() {\n    if (this.#popupAbortController) {\n      return;\n    }\n    this.#popupAbortController = new AbortController();\n    const { signal } = this.#popupAbortController;\n\n    // Attach the event listeners to the trigger element.\n    for (const element of this.trigger) {\n      element.addEventListener(\"click\", this.#boundToggle, { signal });\n      element.addEventListener(\"pointerenter\", this.#boundShow, { signal });\n      element.addEventListener(\"pointerleave\", this.#boundHide, { signal });\n      element.classList.add(\"popupTriggerArea\");\n    }\n\n    // Attach the event listener to toggle the popup with the keyboard.\n    for (const element of this.#elements) {\n      element.container?.addEventListener(\"keydown\", this.#boundKeyDown, {\n        signal,\n      });\n    }\n  }\n\n  #setCommentButtonPosition() {\n    const element = this.#elements.find(e => e.hasCommentButton);\n    if (!element) {\n      return;\n    }\n    this.#commentButtonPosition = element._normalizePoint(\n      element.commentButtonPosition\n    );\n  }\n\n  renderCommentButton() {\n    if (this.#commentButton) {\n      if (!this.#commentButton.parentNode) {\n        this.#firstElement.container.after(this.#commentButton);\n      }\n      return;\n    }\n\n    if (!this.#commentButtonPosition) {\n      this.#setCommentButtonPosition();\n    }\n\n    if (!this.#commentButtonPosition) {\n      return;\n    }\n\n    const { signal } = (this.#popupAbortController = new AbortController());\n    const hasOwnButton = this.#firstElement.hasOwnCommentButton;\n    const togglePopup = () => {\n      this.#commentManager.toggleCommentPopup(\n        this,\n        /* isSelected = */ true,\n        /* visibility = */ undefined,\n        /* isEditable = */ !hasOwnButton\n      );\n    };\n    const showPopup = () => {\n      this.#commentManager.toggleCommentPopup(\n        this,\n        /* isSelected = */ false,\n        /* visibility = */ true,\n        /* isEditable = */ !hasOwnButton\n      );\n    };\n    const hidePopup = () => {\n      this.#commentManager.toggleCommentPopup(\n        this,\n        /* isSelected = */ false,\n        /* visibility = */ false\n      );\n    };\n\n    if (!hasOwnButton) {\n      const button = (this.#commentButton = document.createElement(\"button\"));\n      button.className = \"annotationCommentButton\";\n      const parentContainer = this.#firstElement.container;\n      button.style.zIndex = parentContainer.style.zIndex + 1;\n      button.tabIndex = 0;\n      button.ariaHasPopup = \"dialog\";\n      button.ariaControls = \"commentPopup\";\n      button.setAttribute(\"data-l10n-id\", \"pdfjs-show-comment-button\");\n      this.#updateColor();\n      this.#updateCommentButtonPosition();\n      button.addEventListener(\"keydown\", this.#boundKeyDown, { signal });\n      button.addEventListener(\"click\", togglePopup, { signal });\n      button.addEventListener(\"pointerenter\", showPopup, { signal });\n      button.addEventListener(\"pointerleave\", hidePopup, { signal });\n      parentContainer.after(button);\n    } else {\n      this.#commentButton = this.#firstElement.container;\n      for (const element of this.trigger) {\n        element.ariaHasPopup = \"dialog\";\n        element.ariaControls = \"commentPopup\";\n        element.addEventListener(\"keydown\", this.#boundKeyDown, { signal });\n        element.addEventListener(\"click\", togglePopup, { signal });\n        element.addEventListener(\"pointerenter\", showPopup, { signal });\n        element.addEventListener(\"pointerleave\", hidePopup, { signal });\n        element.classList.add(\"popupTriggerArea\");\n      }\n    }\n  }\n\n  #updateCommentButtonPosition() {\n    if (this.#firstElement.extraPopupElement && !this.#firstElement.editor) {\n      // If there's no editor associated with the annotation then the comment\n      // button position can't be changed.\n      return;\n    }\n    if (!this.#commentButton) {\n      this.renderCommentButton();\n    }\n    const [x, y] = this.#commentButtonPosition;\n    const { style } = this.#commentButton;\n    style.left = `calc(${x}%)`;\n    style.top = `calc(${y}% - var(--comment-button-dim))`;\n  }\n\n  #updateColor() {\n    if (this.#firstElement.extraPopupElement) {\n      return;\n    }\n    if (!this.#commentButton) {\n      this.renderCommentButton();\n    }\n    this.#commentButton.style.backgroundColor = this.commentButtonColor || \"\";\n  }\n\n  get commentButtonColor() {\n    const { color, opacity } = this.#firstElement.commentData;\n    if (!color) {\n      return null;\n    }\n    return this.#parent._commentManager.makeCommentColor(color, opacity);\n  }\n\n  focusCommentButton() {\n    setTimeout(() => {\n      this.#commentButton?.focus();\n    }, 0);\n  }\n\n  getData() {\n    const { richText, color, opacity, creationDate, modificationDate } =\n      this.#firstElement.commentData;\n    return {\n      contentsObj: { str: this.comment },\n      richText,\n      color,\n      opacity,\n      creationDate,\n      modificationDate,\n    };\n  }\n\n  get elementBeforePopup() {\n    return this.#commentButton;\n  }\n\n  get comment() {\n    this.#commentText ||= this.#firstElement.commentText;\n    return this.#commentText;\n  }\n\n  set comment(text) {\n    if (text === this.comment) {\n      return;\n    }\n    this.#firstElement.commentText = this.#commentText = text;\n  }\n\n  focus() {\n    this.#firstElement.container?.focus();\n  }\n\n  get parentBoundingClientRect() {\n    return this.#firstElement.layer.getBoundingClientRect();\n  }\n\n  setCommentButtonStates({ selected, hasPopup }) {\n    if (!this.#commentButton) {\n      return;\n    }\n    this.#commentButton.classList.toggle(\"selected\", selected);\n    this.#commentButton.ariaExpanded = hasPopup;\n  }\n\n  setSelectedCommentButton(selected) {\n    this.#commentButton.classList.toggle(\"selected\", selected);\n  }\n\n  get commentPopupPosition() {\n    if (this.#popupPosition) {\n      return this.#popupPosition;\n    }\n    const { x, y, height } = this.#commentButton.getBoundingClientRect();\n    const {\n      x: parentX,\n      y: parentY,\n      width: parentWidth,\n      height: parentHeight,\n    } = this.#firstElement.layer.getBoundingClientRect();\n    return [(x - parentX) / parentWidth, (y + height - parentY) / parentHeight];\n  }\n\n  set commentPopupPosition(pos) {\n    this.#popupPosition = pos;\n  }\n\n  hasDefaultPopupPosition() {\n    return this.#popupPosition === null;\n  }\n\n  get commentButtonPosition() {\n    return this.#commentButtonPosition;\n  }\n\n  get commentButtonWidth() {\n    return (\n      this.#commentButton.getBoundingClientRect().width /\n      this.parentBoundingClientRect.width\n    );\n  }\n\n  editComment(options) {\n    const [posX, posY] =\n      this.#popupPosition || this.commentButtonPosition.map(x => x / 100);\n    const parentDimensions = this.parentBoundingClientRect;\n    const {\n      x: parentX,\n      y: parentY,\n      width: parentWidth,\n      height: parentHeight,\n    } = parentDimensions;\n    this.#commentManager.showDialog(\n      null,\n      this,\n      parentX + posX * parentWidth,\n      parentY + posY * parentHeight,\n      { ...options, parentDimensions }\n    );\n  }\n\n  render() {\n    if (this.#popup) {\n      return;\n    }\n\n    const popup = (this.#popup = document.createElement(\"div\"));\n    popup.className = \"popup\";\n\n    if (this.#color) {\n      const baseColor = (popup.style.outlineColor = Util.makeHexColor(\n        ...this.#color\n      ));\n      popup.style.backgroundColor = `color-mix(in srgb, ${baseColor} 30%, white)`;\n    }\n\n    const header = document.createElement(\"span\");\n    header.className = \"header\";\n    if (this.#titleObj?.str) {\n      const title = document.createElement(\"span\");\n      title.className = \"title\";\n      header.append(title);\n      ({ dir: title.dir, str: title.textContent } = this.#titleObj);\n    }\n    popup.append(header);\n\n    if (this.#dateObj) {\n      const modificationDate = document.createElement(\"time\");\n      modificationDate.className = \"popupDate\";\n      modificationDate.setAttribute(\n        \"data-l10n-id\",\n        \"pdfjs-annotation-date-time-string\"\n      );\n      modificationDate.setAttribute(\n        \"data-l10n-args\",\n        JSON.stringify({ dateObj: this.#dateObj.valueOf() })\n      );\n      modificationDate.dateTime = this.#dateObj.toISOString();\n      header.append(modificationDate);\n    }\n\n    renderRichText(\n      {\n        html: this.#html || this.#contentsObj.str,\n        dir: this.#contentsObj?.dir,\n        className: \"popupContent\",\n      },\n      popup\n    );\n\n    this.#container.append(popup);\n  }\n\n  get #html() {\n    const richText = this.#richText;\n    const contentsObj = this.#contentsObj;\n    if (\n      richText?.str &&\n      (!contentsObj?.str || contentsObj.str === richText.str)\n    ) {\n      return this.#richText.html || null;\n    }\n    return null;\n  }\n\n  get #fontSize() {\n    return this.#html?.attributes?.style?.fontSize || 0;\n  }\n\n  get #fontColor() {\n    return this.#html?.attributes?.style?.color || null;\n  }\n\n  #makePopupContent(text) {\n    const popupLines = [];\n    const popupContent = {\n      str: text,\n      html: {\n        name: \"div\",\n        attributes: {\n          dir: \"auto\",\n        },\n        children: [\n          {\n            name: \"p\",\n            children: popupLines,\n          },\n        ],\n      },\n    };\n    const lineAttributes = {\n      style: {\n        color: this.#fontColor,\n        fontSize: this.#fontSize\n          ? `calc(${this.#fontSize}px * var(--total-scale-factor))`\n          : \"\",\n      },\n    };\n    for (const line of text.split(\"\\n\")) {\n      popupLines.push({\n        name: \"span\",\n        value: line,\n        attributes: lineAttributes,\n      });\n    }\n    return popupContent;\n  }\n\n  #keyDown(event) {\n    if (event.altKey || event.shiftKey || event.ctrlKey || event.metaKey) {\n      return;\n    }\n\n    if (event.key === \"Enter\" || (event.key === \"Escape\" && this.#pinned)) {\n      this.#toggle();\n    }\n  }\n\n  updateEdited({ rect, popup, deleted }) {\n    if (this.#commentManager) {\n      if (deleted) {\n        this.remove();\n        this.#commentText = null;\n      } else if (popup) {\n        if (popup.deleted) {\n          this.remove();\n        } else {\n          this.#updateColor();\n          this.#commentText = popup.text;\n        }\n      }\n      if (rect) {\n        this.#commentButtonPosition = null;\n        this.#setCommentButtonPosition();\n        this.#updateCommentButtonPosition();\n      }\n      return;\n    }\n    if (deleted || popup?.deleted) {\n      this.remove();\n      return;\n    }\n    this.#addEventListeners();\n    this.#updates ||= {\n      contentsObj: this.#contentsObj,\n      richText: this.#richText,\n    };\n    if (rect) {\n      this.#position = null;\n    }\n    if (popup && popup.text) {\n      this.#richText = this.#makePopupContent(popup.text);\n      this.#dateObj = PDFDateString.toDateObject(popup.date);\n      this.#contentsObj = null;\n    }\n    this.#popup?.remove();\n    this.#popup = null;\n  }\n\n  resetEdited() {\n    if (!this.#updates) {\n      return;\n    }\n    ({ contentsObj: this.#contentsObj, richText: this.#richText } =\n      this.#updates);\n    this.#updates = null;\n    this.#popup?.remove();\n    this.#popup = null;\n    this.#position = null;\n  }\n\n  remove() {\n    this.#popupAbortController?.abort();\n    this.#popupAbortController = null;\n    this.#popup?.remove();\n    this.#popup = null;\n    this.#wasVisible = false;\n    this.#pinned = false;\n    this.#commentButton?.remove();\n    this.#commentButton = null;\n    if (this.trigger) {\n      for (const element of this.trigger) {\n        element.classList.remove(\"popupTriggerArea\");\n      }\n    }\n  }\n\n  #setPosition() {\n    if (this.#position !== null) {\n      return;\n    }\n    const {\n      page: { view },\n      viewport: {\n        rawDims: { pageWidth, pageHeight, pageX, pageY },\n      },\n    } = this.#parent;\n\n    let useParentRect = !!this.#parentRect;\n    let rect = useParentRect ? this.#parentRect : this.#rect;\n    for (const element of this.#elements) {\n      if (!rect || Util.intersect(element.data.rect, rect) !== null) {\n        rect = element.data.rect;\n        useParentRect = true;\n        break;\n      }\n    }\n\n    const normalizedRect = Util.normalizeRect([\n      rect[0],\n      view[3] - rect[1] + view[1],\n      rect[2],\n      view[3] - rect[3] + view[1],\n    ]);\n\n    const HORIZONTAL_SPACE_AFTER_ANNOTATION = 5;\n    const parentWidth = useParentRect\n      ? rect[2] - rect[0] + HORIZONTAL_SPACE_AFTER_ANNOTATION\n      : 0;\n    const popupLeft = normalizedRect[0] + parentWidth;\n    const popupTop = normalizedRect[1];\n    this.#position = [\n      (100 * (popupLeft - pageX)) / pageWidth,\n      (100 * (popupTop - pageY)) / pageHeight,\n    ];\n\n    const { style } = this.#container;\n    style.left = `${this.#position[0]}%`;\n    style.top = `${this.#position[1]}%`;\n  }\n\n  /**\n   * Toggle the visibility of the popup.\n   */\n  #toggle() {\n    if (this.#commentManager) {\n      this.#commentManager.toggleCommentPopup(this, /* isSelected = */ false);\n      return;\n    }\n\n    this.#pinned = !this.#pinned;\n    if (this.#pinned) {\n      this.#show();\n      this.#container.addEventListener(\"click\", this.#boundToggle);\n      this.#container.addEventListener(\"keydown\", this.#boundKeyDown);\n    } else {\n      this.#hide();\n      this.#container.removeEventListener(\"click\", this.#boundToggle);\n      this.#container.removeEventListener(\"keydown\", this.#boundKeyDown);\n    }\n  }\n\n  /**\n   * Show the popup.\n   */\n  #show() {\n    if (!this.#popup) {\n      this.render();\n    }\n    if (!this.isVisible) {\n      this.#setPosition();\n      this.#container.hidden = false;\n      this.#container.style.zIndex =\n        parseInt(this.#container.style.zIndex) + 1000;\n    } else if (this.#pinned) {\n      this.#container.classList.add(\"focused\");\n    }\n  }\n\n  /**\n   * Hide the popup.\n   */\n  #hide() {\n    this.#container.classList.remove(\"focused\");\n    if (this.#pinned || !this.isVisible) {\n      return;\n    }\n    this.#container.hidden = true;\n    this.#container.style.zIndex =\n      parseInt(this.#container.style.zIndex) - 1000;\n  }\n\n  forceHide() {\n    this.#wasVisible = this.isVisible;\n    if (!this.#wasVisible) {\n      return;\n    }\n    this.#container.hidden = true;\n  }\n\n  maybeShow() {\n    if (this.#commentManager) {\n      return;\n    }\n    this.#addEventListeners();\n    if (!this.#wasVisible) {\n      return;\n    }\n    if (!this.#popup) {\n      this.#show();\n    }\n    this.#wasVisible = false;\n    this.#container.hidden = false;\n  }\n\n  get isVisible() {\n    if (this.#commentManager) {\n      return false;\n    }\n    return this.#container.hidden === false;\n  }\n}\n\nclass FreeTextAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n    this.textContent = parameters.data.textContent;\n    this.textPosition = parameters.data.textPosition;\n    this.annotationEditorType = AnnotationEditorType.FREETEXT;\n  }\n\n  render() {\n    this.container.classList.add(\"freeTextAnnotation\");\n\n    if (this.textContent) {\n      const content = (this.contentElement = document.createElement(\"div\"));\n      content.classList.add(\"annotationTextContent\");\n      content.setAttribute(\"role\", \"comment\");\n      for (const line of this.textContent) {\n        const lineSpan = document.createElement(\"span\");\n        lineSpan.textContent = line;\n        content.append(lineSpan);\n      }\n      this.container.append(content);\n    }\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    this._editOnDoubleClick();\n\n    return this.container;\n  }\n}\n\nclass LineAnnotationElement extends AnnotationElement {\n  #line = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"lineAnnotation\");\n\n    // Create an invisible line with the same starting and ending coordinates\n    // that acts as the trigger for the popup. Only the line itself should\n    // trigger the popup, not the entire container.\n    const { data, width, height } = this;\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // PDF coordinates are calculated from a bottom left origin, so transform\n    // the line coordinates to a top left origin for the SVG element.\n    const line = (this.#line = this.svgFactory.createElement(\"svg:line\"));\n    line.setAttribute(\"x1\", data.rect[2] - data.lineCoordinates[0]);\n    line.setAttribute(\"y1\", data.rect[3] - data.lineCoordinates[1]);\n    line.setAttribute(\"x2\", data.rect[2] - data.lineCoordinates[2]);\n    line.setAttribute(\"y2\", data.rect[3] - data.lineCoordinates[3]);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    line.setAttribute(\"stroke-width\", data.borderStyle.width || 1);\n    line.setAttribute(\"stroke\", \"transparent\");\n    line.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(line);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the line instead\n    // of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#line;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass SquareAnnotationElement extends AnnotationElement {\n  #square = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"squareAnnotation\");\n\n    // Create an invisible square with the same rectangle that acts as the\n    // trigger for the popup. Only the square itself should trigger the\n    // popup, not the entire container.\n    const { data, width, height } = this;\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // The browser draws half of the borders inside the square and half of\n    // the borders outside the square by default. This behavior cannot be\n    // changed programmatically, so correct for that here.\n    const borderWidth = data.borderStyle.width;\n    const square = (this.#square = this.svgFactory.createElement(\"svg:rect\"));\n    square.setAttribute(\"x\", borderWidth / 2);\n    square.setAttribute(\"y\", borderWidth / 2);\n    square.setAttribute(\"width\", width - borderWidth);\n    square.setAttribute(\"height\", height - borderWidth);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    square.setAttribute(\"stroke-width\", borderWidth || 1);\n    square.setAttribute(\"stroke\", \"transparent\");\n    square.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(square);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the square instead\n    // of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#square;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass CircleAnnotationElement extends AnnotationElement {\n  #circle = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"circleAnnotation\");\n\n    // Create an invisible circle with the same ellipse that acts as the\n    // trigger for the popup. Only the circle itself should trigger the\n    // popup, not the entire container.\n    const { data, width, height } = this;\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // The browser draws half of the borders inside the circle and half of\n    // the borders outside the circle by default. This behavior cannot be\n    // changed programmatically, so correct for that here.\n    const borderWidth = data.borderStyle.width;\n    const circle = (this.#circle =\n      this.svgFactory.createElement(\"svg:ellipse\"));\n    circle.setAttribute(\"cx\", width / 2);\n    circle.setAttribute(\"cy\", height / 2);\n    circle.setAttribute(\"rx\", width / 2 - borderWidth / 2);\n    circle.setAttribute(\"ry\", height / 2 - borderWidth / 2);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    circle.setAttribute(\"stroke-width\", borderWidth || 1);\n    circle.setAttribute(\"stroke\", \"transparent\");\n    circle.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(circle);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the circle instead\n    // of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#circle;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass PolylineAnnotationElement extends AnnotationElement {\n  #polyline = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n\n    this.containerClassName = \"polylineAnnotation\";\n    this.svgElementName = \"svg:polyline\";\n  }\n\n  render() {\n    this.container.classList.add(this.containerClassName);\n\n    // Create an invisible polyline with the same points that acts as the\n    // trigger for the popup. Only the polyline itself should trigger the\n    // popup, not the entire container.\n    const {\n      data: { rect, vertices, borderStyle, popupRef },\n      width,\n      height,\n    } = this;\n    if (!vertices) {\n      return this.container;\n    }\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // Convert the vertices array to a single points string that the SVG\n    // polyline element expects (\"x1,y1 x2,y2 ...\"). PDF coordinates are\n    // calculated from a bottom left origin, so transform the polyline\n    // coordinates to a top left origin for the SVG element.\n    let points = [];\n    for (let i = 0, ii = vertices.length; i < ii; i += 2) {\n      const x = vertices[i] - rect[0];\n      const y = rect[3] - vertices[i + 1];\n      points.push(`${x},${y}`);\n    }\n    points = points.join(\" \");\n\n    const polyline = (this.#polyline = this.svgFactory.createElement(\n      this.svgElementName\n    ));\n    polyline.setAttribute(\"points\", points);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    polyline.setAttribute(\"stroke-width\", borderStyle.width || 1);\n    polyline.setAttribute(\"stroke\", \"transparent\");\n    polyline.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(polyline);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the polyline\n    // instead of to the entire container (which is the default).\n    if (!popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#polyline;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass PolygonAnnotationElement extends PolylineAnnotationElement {\n  constructor(parameters) {\n    // Polygons are specific forms of polylines, so reuse their logic.\n    super(parameters);\n\n    this.containerClassName = \"polygonAnnotation\";\n    this.svgElementName = \"svg:polygon\";\n  }\n}\n\nclass CaretAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"caretAnnotation\");\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n    return this.container;\n  }\n}\n\nclass InkAnnotationElement extends AnnotationElement {\n  #polylinesGroupElement = null;\n\n  #polylines = [];\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n\n    this.containerClassName = \"inkAnnotation\";\n\n    // Use the polyline SVG element since it allows us to use coordinates\n    // directly and to draw both straight lines and curves.\n    this.svgElementName = \"svg:polyline\";\n\n    this.annotationEditorType =\n      this.data.it === \"InkHighlight\"\n        ? AnnotationEditorType.HIGHLIGHT\n        : AnnotationEditorType.INK;\n  }\n\n  #getTransform(rotation, rect) {\n    // PDF coordinates are calculated from a bottom left origin, so\n    // transform the polyline coordinates to a top left origin for the\n    // SVG element.\n    switch (rotation) {\n      case 90:\n        return {\n          transform: `rotate(90) translate(${-rect[0]},${rect[1]}) scale(1,-1)`,\n          width: rect[3] - rect[1],\n          height: rect[2] - rect[0],\n        };\n      case 180:\n        return {\n          transform: `rotate(180) translate(${-rect[2]},${rect[1]}) scale(1,-1)`,\n          width: rect[2] - rect[0],\n          height: rect[3] - rect[1],\n        };\n      case 270:\n        return {\n          transform: `rotate(270) translate(${-rect[2]},${rect[3]}) scale(1,-1)`,\n          width: rect[3] - rect[1],\n          height: rect[2] - rect[0],\n        };\n      default:\n        return {\n          transform: `translate(${-rect[0]},${rect[3]}) scale(1,-1)`,\n          width: rect[2] - rect[0],\n          height: rect[3] - rect[1],\n        };\n    }\n  }\n\n  render() {\n    this.container.classList.add(this.containerClassName);\n\n    // Create an invisible polyline with the same points that acts as the\n    // trigger for the popup.\n    const {\n      data: { rect, rotation, inkLists, borderStyle, popupRef },\n    } = this;\n    const { transform, width, height } = this.#getTransform(rotation, rect);\n\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n    const g = (this.#polylinesGroupElement =\n      this.svgFactory.createElement(\"svg:g\"));\n    svg.append(g);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    g.setAttribute(\"stroke-width\", borderStyle.width || 1);\n    g.setAttribute(\"stroke-linecap\", \"round\");\n    g.setAttribute(\"stroke-linejoin\", \"round\");\n    g.setAttribute(\"stroke-miterlimit\", 10);\n    g.setAttribute(\"stroke\", \"transparent\");\n    g.setAttribute(\"fill\", \"transparent\");\n    g.setAttribute(\"transform\", transform);\n\n    for (let i = 0, ii = inkLists.length; i < ii; i++) {\n      const polyline = this.svgFactory.createElement(this.svgElementName);\n      this.#polylines.push(polyline);\n      polyline.setAttribute(\"points\", inkLists[i].join(\",\"));\n      g.append(polyline);\n    }\n\n    if (!popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    this.container.append(svg);\n    this._editOnDoubleClick();\n\n    return this.container;\n  }\n\n  updateEdited(params) {\n    super.updateEdited(params);\n    const { thickness, points, rect } = params;\n    const g = this.#polylinesGroupElement;\n    if (thickness >= 0) {\n      g.setAttribute(\"stroke-width\", thickness || 1);\n    }\n    if (points) {\n      for (let i = 0, ii = this.#polylines.length; i < ii; i++) {\n        this.#polylines[i].setAttribute(\"points\", points[i].join(\",\"));\n      }\n    }\n    if (rect) {\n      const { transform, width, height } = this.#getTransform(\n        this.data.rotation,\n        rect\n      );\n      const root = g.parentElement;\n      root.setAttribute(\"viewBox\", `0 0 ${width} ${height}`);\n      g.setAttribute(\"transform\", transform);\n    }\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#polylines;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass HighlightAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n    this.annotationEditorType = AnnotationEditorType.HIGHLIGHT;\n  }\n\n  render() {\n    const {\n      data: { overlaidText, popupRef },\n    } = this;\n    if (!popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"highlightAnnotation\");\n    this._editOnDoubleClick();\n\n    if (overlaidText) {\n      const mark = document.createElement(\"mark\");\n      mark.classList.add(\"overlaidText\");\n      mark.textContent = overlaidText;\n      this.container.append(mark);\n    }\n\n    return this.container;\n  }\n}\n\nclass UnderlineAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    const {\n      data: { overlaidText, popupRef },\n    } = this;\n    if (!popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"underlineAnnotation\");\n\n    if (overlaidText) {\n      const underline = document.createElement(\"u\");\n      underline.classList.add(\"overlaidText\");\n      underline.textContent = overlaidText;\n      this.container.append(underline);\n    }\n\n    return this.container;\n  }\n}\n\nclass SquigglyAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    const {\n      data: { overlaidText, popupRef },\n    } = this;\n    if (!popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"squigglyAnnotation\");\n\n    if (overlaidText) {\n      const underline = document.createElement(\"u\");\n      underline.classList.add(\"overlaidText\");\n      underline.textContent = overlaidText;\n      this.container.append(underline);\n    }\n\n    return this.container;\n  }\n}\n\nclass StrikeOutAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    const {\n      data: { overlaidText, popupRef },\n    } = this;\n    if (!popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"strikeoutAnnotation\");\n\n    if (overlaidText) {\n      const strikeout = document.createElement(\"s\");\n      strikeout.classList.add(\"overlaidText\");\n      strikeout.textContent = overlaidText;\n      this.container.append(strikeout);\n    }\n\n    return this.container;\n  }\n}\n\nclass StampAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n    this.annotationEditorType = AnnotationEditorType.STAMP;\n  }\n\n  render() {\n    this.container.classList.add(\"stampAnnotation\");\n    this.container.setAttribute(\"role\", \"img\");\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n    this._editOnDoubleClick();\n\n    return this.container;\n  }\n}\n\nclass FileAttachmentAnnotationElement extends AnnotationElement {\n  #trigger = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true });\n\n    const { file } = this.data;\n    this.filename = file.filename;\n    this.content = file.content;\n\n    this.linkService.eventBus?.dispatch(\"fileattachmentannotation\", {\n      source: this,\n      ...file,\n    });\n  }\n\n  render() {\n    this.container.classList.add(\"fileAttachmentAnnotation\");\n\n    const { container, data } = this;\n    let trigger;\n    if (data.hasAppearance || data.fillAlpha === 0) {\n      trigger = document.createElement(\"div\");\n    } else {\n      // Unfortunately it seems that it's not clearly specified exactly what\n      // names are actually valid, since Table 184 contains:\n      //   Conforming readers shall provide predefined icon appearances for at\n      //   least the following standard names: GraphPushPin, PaperclipTag.\n      //   Additional names may be supported as well. Default value: PushPin.\n      trigger = document.createElement(\"img\");\n      trigger.src = `${this.imageResourcesPath}annotation-${\n        /paperclip/i.test(data.name) ? \"paperclip\" : \"pushpin\"\n      }.svg`;\n\n      if (data.fillAlpha && data.fillAlpha < 1) {\n        trigger.style = `filter: opacity(${Math.round(\n          data.fillAlpha * 100\n        )}%);`;\n\n        if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n          this.container.classList.add(\"hasFillAlpha\");\n        }\n      }\n    }\n    trigger.addEventListener(\"dblclick\", this.#download.bind(this));\n    this.#trigger = trigger;\n\n    const { isMac } = FeatureTest.platform;\n    container.addEventListener(\"keydown\", evt => {\n      if (evt.key === \"Enter\" && (isMac ? evt.metaKey : evt.ctrlKey)) {\n        this.#download();\n      }\n    });\n\n    if (!data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    } else {\n      trigger.classList.add(\"popupTriggerArea\");\n    }\n\n    container.append(trigger);\n    return container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#trigger;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n\n  /**\n   * Download the file attachment associated with this annotation.\n   */\n  #download() {\n    this.downloadManager?.openOrDownloadData(this.content, this.filename);\n  }\n}\n\n/**\n * @typedef {Object} AnnotationLayerParameters\n * @property {PageViewport} viewport\n * @property {HTMLDivElement} div\n * @property {Array} annotations\n * @property {PDFPageProxy} page\n * @property {IPDFLinkService} linkService\n * @property {IDownloadManager} [downloadManager]\n * @property {AnnotationStorage} [annotationStorage]\n * @property {string} [imageResourcesPath] - Path for image resources, mainly\n *   for annotation icons. Include trailing slash.\n * @property {boolean} renderForms\n * @property {boolean} [enableScripting] - Enable embedded script execution.\n * @property {boolean} [hasJSActions] - Some fields have JS actions.\n *   The default value is `false`.\n * @property {Object<string, Array<Object>> | null} [fieldObjects]\n * @property {Map<string, HTMLCanvasElement>} [annotationCanvasMap]\n * @property {TextAccessibilityManager} [accessibilityManager]\n * @property {AnnotationEditorUIManager} [annotationEditorUIManager]\n * @property {StructTreeLayerBuilder} [structTreeLayer]\n * @property {CommentManager} [commentManager] - The comment manager instance.\n */\n\n/**\n * Manage the layer containing all the annotations.\n */\nclass AnnotationLayer {\n  #accessibilityManager = null;\n\n  #annotationCanvasMap = null;\n\n  #annotationStorage = null;\n\n  #editableAnnotations = new Map();\n\n  #structTreeLayer = null;\n\n  #linkService = null;\n\n  #elements = [];\n\n  #hasAriaAttributesFromStructTree = false;\n\n  constructor({\n    div,\n    accessibilityManager,\n    annotationCanvasMap,\n    annotationEditorUIManager,\n    page,\n    viewport,\n    structTreeLayer,\n    commentManager,\n    linkService,\n    annotationStorage,\n  }) {\n    this.div = div;\n    this.#accessibilityManager = accessibilityManager;\n    this.#annotationCanvasMap = annotationCanvasMap;\n    this.#structTreeLayer = structTreeLayer || null;\n    this.#linkService = linkService || null;\n    this.#annotationStorage = annotationStorage || new AnnotationStorage();\n    this.page = page;\n    this.viewport = viewport;\n    this.zIndex = 0;\n    this._annotationEditorUIManager = annotationEditorUIManager;\n    this._commentManager = commentManager || null;\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"showPopups\", {\n        value: async () => {\n          for (const show of this.popupShow) {\n            await show();\n          }\n        },\n      });\n      this.popupShow = [];\n    }\n  }\n\n  hasEditableAnnotations() {\n    return this.#editableAnnotations.size > 0;\n  }\n\n  /**\n   * Render a new annotation layer with all annotation elements.\n   *\n   * @param {AnnotationLayerParameters} params\n   * @memberof AnnotationLayer\n   */\n  async render(params) {\n    const { annotations } = params;\n    const layer = this.div;\n    setLayerDimensions(layer, this.viewport);\n\n    const popupToElements = new Map();\n    const popupAnnotations = [];\n    const elementParams = {\n      data: null,\n      layer,\n      linkService: this.#linkService,\n      downloadManager: params.downloadManager,\n      imageResourcesPath: params.imageResourcesPath || \"\",\n      renderForms: params.renderForms !== false,\n      svgFactory: new DOMSVGFactory(),\n      annotationStorage: this.#annotationStorage,\n      enableComment: params.enableComment === true,\n      enableScripting: params.enableScripting === true,\n      hasJSActions: params.hasJSActions,\n      fieldObjects: params.fieldObjects,\n      parent: this,\n      elements: null,\n    };\n\n    for (const data of annotations) {\n      if (data.noHTML) {\n        continue;\n      }\n      const isPopupAnnotation = data.annotationType === AnnotationType.POPUP;\n      if (!isPopupAnnotation) {\n        if (data.rect[2] === data.rect[0] || data.rect[3] === data.rect[1]) {\n          continue; // Ignore empty annotations.\n        }\n      } else {\n        const elements = popupToElements.get(data.id);\n        if (!elements) {\n          // Ignore popup annotations without a corresponding annotation.\n          continue;\n        }\n        if (!this._commentManager) {\n          popupAnnotations.push(data);\n          continue;\n        }\n        elementParams.elements = elements;\n      }\n      elementParams.data = data;\n      const element = AnnotationElementFactory.create(elementParams);\n\n      if (!element.isRenderable) {\n        continue;\n      }\n\n      if (!isPopupAnnotation) {\n        this.#elements.push(element);\n\n        if (data.popupRef) {\n          const elements = popupToElements.get(data.popupRef);\n          if (!elements) {\n            popupToElements.set(data.popupRef, [element]);\n          } else {\n            elements.push(element);\n          }\n        }\n      }\n\n      const rendered = element.render();\n      if (data.hidden) {\n        rendered.style.visibility = \"hidden\";\n      }\n\n      if (element._isEditable) {\n        this.#editableAnnotations.set(element.data.id, element);\n        this._annotationEditorUIManager?.renderAnnotationElement(element);\n      }\n    }\n\n    await this.#addElementsToDOM();\n\n    for (const data of popupAnnotations) {\n      const elements = (elementParams.elements = popupToElements.get(data.id));\n      elementParams.data = data;\n      const element = AnnotationElementFactory.create(elementParams);\n      if (!element.isRenderable) {\n        continue;\n      }\n      const rendered = element.render();\n      element.contentElement.id = `${AnnotationPrefix}${data.id}`;\n      if (data.hidden) {\n        rendered.style.visibility = \"hidden\";\n      }\n      elements.at(-1).container.after(rendered);\n    }\n\n    this.#setAnnotationCanvasMap();\n  }\n\n  async #addElementsToDOM() {\n    if (this.#elements.length === 0) {\n      return;\n    }\n    // Clear the existing annotations in order to make sure comment buttons\n    // don't have a parent any longer.\n    this.div.replaceChildren();\n\n    const promises = [];\n    if (!this.#hasAriaAttributesFromStructTree) {\n      this.#hasAriaAttributesFromStructTree = true;\n      for (const {\n        contentElement,\n        data: { id },\n      } of this.#elements) {\n        const annotationId = (contentElement.id = `${AnnotationPrefix}${id}`);\n        promises.push(\n          this.#structTreeLayer\n            ?.getAriaAttributes(annotationId)\n            .then(ariaAttributes => {\n              if (ariaAttributes) {\n                for (const [key, value] of ariaAttributes) {\n                  contentElement.setAttribute(key, value);\n                }\n              }\n            })\n        );\n      }\n    }\n    this.#elements.sort(\n      (\n        {\n          data: {\n            rect: [a0, a1, a2, a3],\n          },\n        },\n        {\n          data: {\n            rect: [b0, b1, b2, b3],\n          },\n        }\n      ) => {\n        // We are in page coordinates, which has the origin at the\n        // bottom left.\n        if (a0 === a2 && a1 === a3) {\n          return +1;\n        }\n\n        if (b0 === b2 && b1 === b3) {\n          return -1;\n        }\n\n        const top1 = a3;\n        const bot1 = a1;\n        const mid1 = (a1 + a3) / 2;\n\n        const top2 = b3;\n        const bot2 = b1;\n        const mid2 = (b1 + b3) / 2;\n\n        if (mid1 >= top2 && mid2 <= bot1) {\n          return -1;\n        }\n\n        if (mid2 >= top1 && mid1 <= bot2) {\n          return +1;\n        }\n\n        const centerX1 = (a0 + a2) / 2;\n        const centerX2 = (b0 + b2) / 2;\n\n        return centerX1 - centerX2;\n      }\n    );\n\n    const fragment = document.createDocumentFragment();\n    for (const element of this.#elements) {\n      fragment.append(element.container);\n      if (this._commentManager) {\n        (\n          element.extraPopupElement?.popup || element.popup\n        )?.renderCommentButton();\n      } else if (element.extraPopupElement) {\n        fragment.append(element.extraPopupElement.render());\n      }\n    }\n    this.div.append(fragment);\n    await Promise.all(promises);\n    if (this.#accessibilityManager) {\n      for (const element of this.#elements) {\n        this.#accessibilityManager.addPointerInTextLayer(\n          element.contentElement,\n          /* isRemovable = */ false\n        );\n      }\n    }\n  }\n\n  /**\n   * Add link annotations to the annotation layer.\n   *\n   * @param {Array<Object>} annotations\n   * @param {IPDFLinkService} linkService\n   * @memberof AnnotationLayer\n   */\n  async addLinkAnnotations(annotations) {\n    const elementParams = {\n      data: null,\n      layer: this.div,\n      linkService: this.#linkService,\n      svgFactory: new DOMSVGFactory(),\n      parent: this,\n    };\n    for (const data of annotations) {\n      data.borderStyle ||= AnnotationLayer._defaultBorderStyle;\n\n      elementParams.data = data;\n      const element = AnnotationElementFactory.create(elementParams);\n\n      if (!element.isRenderable) {\n        continue;\n      }\n      element.render();\n      element.contentElement.id = `${AnnotationPrefix}${data.id}`;\n      this.#elements.push(element);\n    }\n    await this.#addElementsToDOM();\n  }\n\n  /**\n   * Update the annotation elements on existing annotation layer.\n   *\n   * @param {AnnotationLayerParameters} viewport\n   * @memberof AnnotationLayer\n   */\n  update({ viewport }) {\n    const layer = this.div;\n    this.viewport = viewport;\n    setLayerDimensions(layer, { rotation: viewport.rotation });\n\n    this.#setAnnotationCanvasMap();\n    layer.hidden = false;\n  }\n\n  #setAnnotationCanvasMap() {\n    if (!this.#annotationCanvasMap) {\n      return;\n    }\n    const layer = this.div;\n    for (const [id, canvas] of this.#annotationCanvasMap) {\n      const element = layer.querySelector(`[data-annotation-id=\"${id}\"]`);\n      if (!element) {\n        continue;\n      }\n\n      canvas.className = \"annotationContent\";\n      const { firstChild } = element;\n      if (!firstChild) {\n        element.append(canvas);\n      } else if (firstChild.nodeName === \"CANVAS\") {\n        firstChild.replaceWith(canvas);\n      } else if (!firstChild.classList.contains(\"annotationContent\")) {\n        firstChild.before(canvas);\n      } else {\n        firstChild.after(canvas);\n      }\n\n      const editableAnnotation = this.#editableAnnotations.get(id);\n      if (!editableAnnotation) {\n        continue;\n      }\n      if (editableAnnotation._hasNoCanvas) {\n        // The canvas wasn't available when the annotation was created.\n        this._annotationEditorUIManager?.setMissingCanvas(\n          id,\n          element.id,\n          canvas\n        );\n        editableAnnotation._hasNoCanvas = false;\n      } else {\n        editableAnnotation.canvas = canvas;\n      }\n    }\n    this.#annotationCanvasMap.clear();\n  }\n\n  getEditableAnnotations() {\n    return Array.from(this.#editableAnnotations.values());\n  }\n\n  getEditableAnnotation(id) {\n    return this.#editableAnnotations.get(id);\n  }\n\n  addFakeAnnotation(editor) {\n    const { div } = this;\n    const { id, rotation } = editor;\n    const element = new EditorAnnotationElement({\n      data: {\n        id,\n        rect: editor.getPDFRect(),\n        rotation,\n      },\n      editor,\n      layer: div,\n      parent: this,\n      enableComment: !!this._commentManager,\n      linkService: this.#linkService,\n      annotationStorage: this.#annotationStorage,\n    });\n    element.render();\n    element.contentElement.id = `${AnnotationPrefix}${id}`;\n    element.createOrUpdatePopup();\n    this.#elements.push(element);\n    return element;\n  }\n\n  removeAnnotation(id) {\n    const index = this.#elements.findIndex(el => el.data.id === id);\n    if (index < 0) {\n      return;\n    }\n    const [element] = this.#elements.splice(index, 1);\n    this.#accessibilityManager?.removePointerInTextLayer(\n      element.contentElement\n    );\n  }\n\n  updateFakeAnnotations(editors) {\n    if (editors.length === 0) {\n      return;\n    }\n    for (const editor of editors) {\n      editor.updateFakeAnnotationElement(this);\n    }\n    this.#addElementsToDOM();\n  }\n\n  togglePointerEvents(enabled = false) {\n    this.div.classList.toggle(\"disabled\", !enabled);\n  }\n\n  /**\n   * @private\n   */\n  static get _defaultBorderStyle() {\n    return shadow(\n      this,\n      \"_defaultBorderStyle\",\n      Object.freeze({\n        width: 1,\n        rawWidth: 1,\n        style: AnnotationBorderStyleType.SOLID,\n        dashArray: [3],\n        horizontalCornerRadius: 0,\n        verticalCornerRadius: 0,\n      })\n    );\n  }\n}\n\nexport {\n  AnnotationLayer,\n  FreeTextAnnotationElement,\n  HighlightAnnotationElement,\n  InkAnnotationElement,\n  StampAnnotationElement,\n};\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_editor_layer.js\").AnnotationEditorLayer} AnnotationEditorLayer */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  assert,\n  LINE_FACTOR,\n  shadow,\n  Util,\n} from \"../../shared/util.js\";\nimport { AnnotationEditorUIManager, KeyboardManager } from \"./tools.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { BasicColorPicker } from \"./color_picker.js\";\nimport { FreeTextAnnotationElement } from \"../annotation_layer.js\";\n\nconst EOL_PATTERN = /\\r\\n?|\\n/g;\n\n/**\n * Basic text editor in order to create a FreeTex annotation.\n */\nclass FreeTextEditor extends AnnotationEditor {\n  #content = \"\";\n\n  #editorDivId = `${this.id}-editor`;\n\n  #editModeAC = null;\n\n  #fontSize;\n\n  _colorPicker = null;\n\n  static _freeTextDefaultContent = \"\";\n\n  static _internalPadding = 0;\n\n  static _defaultColor = null;\n\n  static _defaultFontSize = 10;\n\n  static get _keyboardManager() {\n    const proto = FreeTextEditor.prototype;\n\n    const arrowChecker = self => self.isEmpty();\n\n    const small = AnnotationEditorUIManager.TRANSLATE_SMALL;\n    const big = AnnotationEditorUIManager.TRANSLATE_BIG;\n\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [\n          // Commit the text in case the user use ctrl+s to save the document.\n          // The event must bubble in order to be caught by the viewer.\n          // See bug 1831574.\n          [\"ctrl+s\", \"mac+meta+s\", \"ctrl+p\", \"mac+meta+p\"],\n          proto.commitOrRemove,\n          { bubbles: true },\n        ],\n        [\n          [\"ctrl+Enter\", \"mac+meta+Enter\", \"Escape\", \"mac+Escape\"],\n          proto.commitOrRemove,\n        ],\n        [\n          [\"ArrowLeft\", \"mac+ArrowLeft\"],\n          proto._translateEmpty,\n          { args: [-small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowLeft\", \"mac+shift+ArrowLeft\"],\n          proto._translateEmpty,\n          { args: [-big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowRight\", \"mac+ArrowRight\"],\n          proto._translateEmpty,\n          { args: [small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowRight\", \"mac+shift+ArrowRight\"],\n          proto._translateEmpty,\n          { args: [big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowUp\", \"mac+ArrowUp\"],\n          proto._translateEmpty,\n          { args: [0, -small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowUp\", \"mac+shift+ArrowUp\"],\n          proto._translateEmpty,\n          { args: [0, -big], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowDown\", \"mac+ArrowDown\"],\n          proto._translateEmpty,\n          { args: [0, small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowDown\", \"mac+shift+ArrowDown\"],\n          proto._translateEmpty,\n          { args: [0, big], checker: arrowChecker },\n        ],\n      ])\n    );\n  }\n\n  static _type = \"freetext\";\n\n  static _editorType = AnnotationEditorType.FREETEXT;\n\n  constructor(params) {\n    super({ ...params, name: \"freeTextEditor\" });\n    this.color =\n      params.color ||\n      FreeTextEditor._defaultColor ||\n      AnnotationEditor._defaultLineColor;\n    this.#fontSize = params.fontSize || FreeTextEditor._defaultFontSize;\n    if (!this.annotationElementId) {\n      this._uiManager.a11yAlert(\"pdfjs-editor-freetext-added-alert\");\n    }\n    this.canAddComment = false;\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n    const style = getComputedStyle(document.documentElement);\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      const lineHeight = parseFloat(\n        style.getPropertyValue(\"--freetext-line-height\")\n      );\n      assert(\n        lineHeight === LINE_FACTOR,\n        \"Update the CSS variable to agree with the constant.\"\n      );\n    }\n\n    this._internalPadding = parseFloat(\n      style.getPropertyValue(\"--freetext-padding\")\n    );\n  }\n\n  /** @inheritdoc */\n  static updateDefaultParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.FREETEXT_SIZE:\n        FreeTextEditor._defaultFontSize = value;\n        break;\n      case AnnotationEditorParamsType.FREETEXT_COLOR:\n        FreeTextEditor._defaultColor = value;\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  updateParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.FREETEXT_SIZE:\n        this.#updateFontSize(value);\n        break;\n      case AnnotationEditorParamsType.FREETEXT_COLOR:\n        this.#updateColor(value);\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  static get defaultPropertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.FREETEXT_SIZE,\n        FreeTextEditor._defaultFontSize,\n      ],\n      [\n        AnnotationEditorParamsType.FREETEXT_COLOR,\n        FreeTextEditor._defaultColor || AnnotationEditor._defaultLineColor,\n      ],\n    ];\n  }\n\n  /** @inheritdoc */\n  get propertiesToUpdate() {\n    return [\n      [AnnotationEditorParamsType.FREETEXT_SIZE, this.#fontSize],\n      [AnnotationEditorParamsType.FREETEXT_COLOR, this.color],\n    ];\n  }\n\n  /** @inheritdoc */\n  get toolbarButtons() {\n    this._colorPicker ||= new BasicColorPicker(this);\n    return [[\"colorPicker\", this._colorPicker]];\n  }\n\n  get colorType() {\n    return AnnotationEditorParamsType.FREETEXT_COLOR;\n  }\n\n  /**\n   * Update the font size and make this action as undoable.\n   * @param {number} fontSize\n   */\n  #updateFontSize(fontSize) {\n    const setFontsize = size => {\n      this.editorDiv.style.fontSize = `calc(${size}px * var(--total-scale-factor))`;\n      this.translate(0, -(size - this.#fontSize) * this.parentScale);\n      this.#fontSize = size;\n      this.#setEditorDimensions();\n    };\n    const savedFontsize = this.#fontSize;\n    this.addCommands({\n      cmd: setFontsize.bind(this, fontSize),\n      undo: setFontsize.bind(this, savedFontsize),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.FREETEXT_SIZE,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /** @inheritdoc */\n  onUpdatedColor() {\n    this.editorDiv.style.color = this.color;\n    this._colorPicker?.update(this.color);\n    super.onUpdatedColor();\n  }\n\n  /**\n   * Update the color and make this action undoable.\n   * @param {string} color\n   */\n  #updateColor(color) {\n    const setColor = col => {\n      this.color = col;\n      this.onUpdatedColor();\n    };\n    const savedColor = this.color;\n    this.addCommands({\n      cmd: setColor.bind(this, color),\n      undo: setColor.bind(this, savedColor),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.FREETEXT_COLOR,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /**\n   * Helper to translate the editor with the keyboard when it's empty.\n   * @param {number} x in page units.\n   * @param {number} y in page units.\n   */\n  _translateEmpty(x, y) {\n    this._uiManager.translateSelectedEditors(x, y, /* noCommit = */ true);\n  }\n\n  /** @inheritdoc */\n  getInitialTranslation() {\n    // The start of the base line is where the user clicked.\n    const scale = this.parentScale;\n    return [\n      -FreeTextEditor._internalPadding * scale,\n      -(FreeTextEditor._internalPadding + this.#fontSize) * scale,\n    ];\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilting it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  /** @inheritdoc */\n  enableEditMode() {\n    if (!super.enableEditMode()) {\n      return false;\n    }\n\n    this.overlayDiv.classList.remove(\"enabled\");\n    this.editorDiv.contentEditable = true;\n    this._isDraggable = false;\n    this.div.removeAttribute(\"aria-activedescendant\");\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        !this.#editModeAC,\n        \"No `this.#editModeAC` AbortController should exist.\"\n      );\n    }\n    this.#editModeAC = new AbortController();\n    const signal = this._uiManager.combinedSignal(this.#editModeAC);\n\n    this.editorDiv.addEventListener(\n      \"keydown\",\n      this.editorDivKeydown.bind(this),\n      { signal }\n    );\n    this.editorDiv.addEventListener(\"focus\", this.editorDivFocus.bind(this), {\n      signal,\n    });\n    this.editorDiv.addEventListener(\"blur\", this.editorDivBlur.bind(this), {\n      signal,\n    });\n    this.editorDiv.addEventListener(\"input\", this.editorDivInput.bind(this), {\n      signal,\n    });\n    this.editorDiv.addEventListener(\"paste\", this.editorDivPaste.bind(this), {\n      signal,\n    });\n\n    return true;\n  }\n\n  /** @inheritdoc */\n  disableEditMode() {\n    if (!super.disableEditMode()) {\n      return false;\n    }\n\n    this.overlayDiv.classList.add(\"enabled\");\n    this.editorDiv.contentEditable = false;\n    this.div.setAttribute(\"aria-activedescendant\", this.#editorDivId);\n    this._isDraggable = true;\n\n    this.#editModeAC?.abort();\n    this.#editModeAC = null;\n\n    // On Chrome, the focus is given to <body> when contentEditable is set to\n    // false, hence we focus the div.\n    this.div.focus({\n      preventScroll: true /* See issue #15744 */,\n    });\n\n    // In case the blur callback hasn't been called.\n    this.isEditing = false;\n    this.parent.div.classList.add(\"freetextEditing\");\n\n    return true;\n  }\n\n  /** @inheritdoc */\n  focusin(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n    super.focusin(event);\n    if (event.target !== this.editorDiv) {\n      this.editorDiv.focus();\n    }\n  }\n\n  /** @inheritdoc */\n  onceAdded(focus) {\n    if (this.width) {\n      // The editor was created in using ctrl+c.\n      return;\n    }\n    this.enableEditMode();\n    if (focus) {\n      this.editorDiv.focus();\n    }\n    if (this._initialOptions?.isCentered) {\n      this.center();\n    }\n    this._initialOptions = null;\n  }\n\n  /** @inheritdoc */\n  isEmpty() {\n    return !this.editorDiv || this.editorDiv.innerText.trim() === \"\";\n  }\n\n  /** @inheritdoc */\n  remove() {\n    this.isEditing = false;\n    if (this.parent) {\n      this.parent.setEditingState(true);\n      this.parent.div.classList.add(\"freetextEditing\");\n    }\n    super.remove();\n  }\n\n  /**\n   * Extract the text from this editor.\n   * @returns {string}\n   */\n  #extractText() {\n    // We don't use innerText because there are some bugs with line breaks.\n    const buffer = [];\n    this.editorDiv.normalize();\n    let prevChild = null;\n    for (const child of this.editorDiv.childNodes) {\n      if (prevChild?.nodeType === Node.TEXT_NODE && child.nodeName === \"BR\") {\n        // It can happen if the user uses shift+enter to add a new line.\n        // If we don't skip it, we'll end up with an extra line (one for the\n        // text and one for the br element).\n        continue;\n      }\n      buffer.push(FreeTextEditor.#getNodeContent(child));\n      prevChild = child;\n    }\n    return buffer.join(\"\\n\");\n  }\n\n  #setEditorDimensions() {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n\n    let rect;\n    if (this.isAttachedToDOM) {\n      rect = this.div.getBoundingClientRect();\n    } else {\n      // This editor isn't on screen but we need to get its dimensions, so\n      // we just insert it in the DOM, get its bounding box and then remove it.\n      const { currentLayer, div } = this;\n      const savedDisplay = div.style.display;\n      const savedVisibility = div.classList.contains(\"hidden\");\n      div.classList.remove(\"hidden\");\n      div.style.display = \"hidden\";\n      currentLayer.div.append(this.div);\n      rect = div.getBoundingClientRect();\n      div.remove();\n      div.style.display = savedDisplay;\n      div.classList.toggle(\"hidden\", savedVisibility);\n    }\n\n    // The dimensions are relative to the rotation of the page, hence we need to\n    // take that into account (see issue #16636).\n    if (this.rotation % 180 === this.parentRotation % 180) {\n      this.width = rect.width / parentWidth;\n      this.height = rect.height / parentHeight;\n    } else {\n      this.width = rect.height / parentWidth;\n      this.height = rect.width / parentHeight;\n    }\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Commit the content we have in this editor.\n   * @returns {undefined}\n   */\n  commit() {\n    if (!this.isInEditMode()) {\n      return;\n    }\n\n    super.commit();\n    this.disableEditMode();\n    const savedText = this.#content;\n    const newText = (this.#content = this.#extractText().trimEnd());\n    if (savedText === newText) {\n      return;\n    }\n\n    const setText = text => {\n      this.#content = text;\n      if (!text) {\n        this.remove();\n        return;\n      }\n      this.#setContent();\n      this._uiManager.rebuild(this);\n      this.#setEditorDimensions();\n    };\n    this.addCommands({\n      cmd: () => {\n        setText(newText);\n      },\n      undo: () => {\n        setText(savedText);\n      },\n      mustExec: false,\n    });\n    this.#setEditorDimensions();\n  }\n\n  /** @inheritdoc */\n  shouldGetKeyboardEvents() {\n    return this.isInEditMode();\n  }\n\n  /** @inheritdoc */\n  enterInEditMode() {\n    this.enableEditMode();\n    this.editorDiv.focus();\n  }\n\n  /** @inheritdoc */\n  keydown(event) {\n    if (event.target === this.div && event.key === \"Enter\") {\n      this.enterInEditMode();\n      // Avoid to add an unwanted new line.\n      event.preventDefault();\n    }\n  }\n\n  editorDivKeydown(event) {\n    FreeTextEditor._keyboardManager.exec(this, event);\n  }\n\n  editorDivFocus(event) {\n    this.isEditing = true;\n  }\n\n  editorDivBlur(event) {\n    this.isEditing = false;\n  }\n\n  editorDivInput(event) {\n    this.parent.div.classList.toggle(\"freetextEditing\", this.isEmpty());\n  }\n\n  /** @inheritdoc */\n  disableEditing() {\n    this.editorDiv.setAttribute(\"role\", \"comment\");\n    this.editorDiv.removeAttribute(\"aria-multiline\");\n  }\n\n  /** @inheritdoc */\n  enableEditing() {\n    this.editorDiv.setAttribute(\"role\", \"textbox\");\n    this.editorDiv.setAttribute(\"aria-multiline\", true);\n  }\n\n  /** @inheritdoc */\n  get canChangeContent() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    if (this._isCopy || this.annotationElementId) {\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    super.render();\n    this.editorDiv = document.createElement(\"div\");\n    this.editorDiv.className = \"internal\";\n\n    this.editorDiv.setAttribute(\"id\", this.#editorDivId);\n    this.editorDiv.setAttribute(\"data-l10n-id\", \"pdfjs-free-text2\");\n    this.editorDiv.setAttribute(\"data-l10n-attrs\", \"default-content\");\n    this.enableEditing();\n\n    this.editorDiv.contentEditable = true;\n\n    const { style } = this.editorDiv;\n    style.fontSize = `calc(${this.#fontSize}px * var(--total-scale-factor))`;\n    style.color = this.color;\n\n    this.div.append(this.editorDiv);\n\n    this.overlayDiv = document.createElement(\"div\");\n    this.overlayDiv.classList.add(\"overlay\", \"enabled\");\n    this.div.append(this.overlayDiv);\n\n    if (this._isCopy || this.annotationElementId) {\n      // This editor was created in using copy (ctrl+c).\n      const [parentWidth, parentHeight] = this.parentDimensions;\n      if (this.annotationElementId) {\n        // This stuff is hard to test: if something is changed here, please\n        // test with the following PDF file:\n        //  - freetexts.pdf\n        //  - rotated_freetexts.pdf\n        // Only small variations between the original annotation and its editor\n        // are allowed.\n\n        // position is the position of the first glyph in the annotation\n        // and it's relative to its container.\n        const { position } = this._initialData;\n        let [tx, ty] = this.getInitialTranslation();\n        [tx, ty] = this.pageTranslationToScreen(tx, ty);\n        const [pageWidth, pageHeight] = this.pageDimensions;\n        const [pageX, pageY] = this.pageTranslation;\n        let posX, posY;\n        switch (this.rotation) {\n          case 0:\n            posX = baseX + (position[0] - pageX) / pageWidth;\n            posY = baseY + this.height - (position[1] - pageY) / pageHeight;\n            break;\n          case 90:\n            posX = baseX + (position[0] - pageX) / pageWidth;\n            posY = baseY - (position[1] - pageY) / pageHeight;\n            [tx, ty] = [ty, -tx];\n            break;\n          case 180:\n            posX = baseX - this.width + (position[0] - pageX) / pageWidth;\n            posY = baseY - (position[1] - pageY) / pageHeight;\n            [tx, ty] = [-tx, -ty];\n            break;\n          case 270:\n            posX =\n              baseX +\n              (position[0] - pageX - this.height * pageHeight) / pageWidth;\n            posY =\n              baseY +\n              (position[1] - pageY - this.width * pageWidth) / pageHeight;\n            [tx, ty] = [-ty, tx];\n            break;\n        }\n        this.setAt(posX * parentWidth, posY * parentHeight, tx, ty);\n      } else {\n        this._moveAfterPaste(baseX, baseY);\n      }\n\n      this.#setContent();\n      this._isDraggable = true;\n      this.editorDiv.contentEditable = false;\n    } else {\n      this._isDraggable = false;\n      this.editorDiv.contentEditable = true;\n    }\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      this.div.setAttribute(\"annotation-id\", this.annotationElementId);\n    }\n\n    return this.div;\n  }\n\n  static #getNodeContent(node) {\n    return (\n      node.nodeType === Node.TEXT_NODE ? node.nodeValue : node.innerText\n    ).replaceAll(EOL_PATTERN, \"\");\n  }\n\n  editorDivPaste(event) {\n    const clipboardData = event.clipboardData || window.clipboardData;\n    const { types } = clipboardData;\n    if (types.length === 1 && types[0] === \"text/plain\") {\n      return;\n    }\n\n    event.preventDefault();\n    const paste = FreeTextEditor.#deserializeContent(\n      clipboardData.getData(\"text\") || \"\"\n    ).replaceAll(EOL_PATTERN, \"\\n\");\n    if (!paste) {\n      return;\n    }\n    const selection = window.getSelection();\n    if (!selection.rangeCount) {\n      return;\n    }\n    this.editorDiv.normalize();\n    selection.deleteFromDocument();\n    const range = selection.getRangeAt(0);\n    if (!paste.includes(\"\\n\")) {\n      range.insertNode(document.createTextNode(paste));\n      this.editorDiv.normalize();\n      selection.collapseToStart();\n      return;\n    }\n\n    // Collect the text before and after the caret.\n    const { startContainer, startOffset } = range;\n    const bufferBefore = [];\n    const bufferAfter = [];\n    if (startContainer.nodeType === Node.TEXT_NODE) {\n      const parent = startContainer.parentElement;\n      bufferAfter.push(\n        startContainer.nodeValue.slice(startOffset).replaceAll(EOL_PATTERN, \"\")\n      );\n      if (parent !== this.editorDiv) {\n        let buffer = bufferBefore;\n        for (const child of this.editorDiv.childNodes) {\n          if (child === parent) {\n            buffer = bufferAfter;\n            continue;\n          }\n          buffer.push(FreeTextEditor.#getNodeContent(child));\n        }\n      }\n      bufferBefore.push(\n        startContainer.nodeValue\n          .slice(0, startOffset)\n          .replaceAll(EOL_PATTERN, \"\")\n      );\n    } else if (startContainer === this.editorDiv) {\n      let buffer = bufferBefore;\n      let i = 0;\n      for (const child of this.editorDiv.childNodes) {\n        if (i++ === startOffset) {\n          buffer = bufferAfter;\n        }\n        buffer.push(FreeTextEditor.#getNodeContent(child));\n      }\n    }\n    this.#content = `${bufferBefore.join(\"\\n\")}${paste}${bufferAfter.join(\"\\n\")}`;\n    this.#setContent();\n\n    // Set the caret at the right position.\n    const newRange = new Range();\n    let beforeLength = Math.sumPrecise(bufferBefore.map(line => line.length));\n    for (const { firstChild } of this.editorDiv.childNodes) {\n      // Each child is either a div with a text node or a br element.\n      if (firstChild.nodeType === Node.TEXT_NODE) {\n        const length = firstChild.nodeValue.length;\n        if (beforeLength <= length) {\n          newRange.setStart(firstChild, beforeLength);\n          newRange.setEnd(firstChild, beforeLength);\n          break;\n        }\n        beforeLength -= length;\n      }\n    }\n    selection.removeAllRanges();\n    selection.addRange(newRange);\n  }\n\n  #setContent() {\n    this.editorDiv.replaceChildren();\n    if (!this.#content) {\n      return;\n    }\n    for (const line of this.#content.split(\"\\n\")) {\n      const div = document.createElement(\"div\");\n      div.append(\n        line ? document.createTextNode(line) : document.createElement(\"br\")\n      );\n      this.editorDiv.append(div);\n    }\n  }\n\n  #serializeContent() {\n    return this.#content.replaceAll(\"\\xa0\", \" \");\n  }\n\n  static #deserializeContent(content) {\n    return content.replaceAll(\" \", \"\\xa0\");\n  }\n\n  /** @inheritdoc */\n  get contentDiv() {\n    return this.editorDiv;\n  }\n\n  /** @inheritdoc */\n  getPDFRect() {\n    const padding = FreeTextEditor._internalPadding * this.parentScale;\n    return this.getRect(padding, padding);\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    let initialData = null;\n    if (data instanceof FreeTextAnnotationElement) {\n      const {\n        data: {\n          defaultAppearanceData: { fontSize, fontColor },\n          rect,\n          rotation,\n          id,\n          popupRef,\n          richText,\n          contentsObj,\n          creationDate,\n          modificationDate,\n        },\n        textContent,\n        textPosition,\n        parent: {\n          page: { pageNumber },\n        },\n      } = data;\n      // textContent is supposed to be an array of strings containing each line\n      // of text. However, it can be null or empty.\n      if (!textContent || textContent.length === 0) {\n        // Empty annotation.\n        return null;\n      }\n      initialData = data = {\n        annotationType: AnnotationEditorType.FREETEXT,\n        color: Array.from(fontColor),\n        fontSize,\n        value: textContent.join(\"\\n\"),\n        position: textPosition,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        annotationElementId: id,\n        id,\n        deleted: false,\n        popupRef,\n        comment: contentsObj?.str || null,\n        richText,\n        creationDate,\n        modificationDate,\n      };\n    }\n    const editor = await super.deserialize(data, parent, uiManager);\n    editor.#fontSize = data.fontSize;\n    editor.color = Util.makeHexColor(...data.color);\n    editor.#content = FreeTextEditor.#deserializeContent(data.value);\n    editor._initialData = initialData;\n    if (data.comment) {\n      editor.setCommentData(data);\n    }\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    if (this.deleted) {\n      return this.serializeDeleted();\n    }\n\n    const color = AnnotationEditor._colorManager.convert(\n      this.isAttachedToDOM ? getComputedStyle(this.editorDiv).color : this.color\n    );\n    const serialized = Object.assign(super.serialize(isForCopying), {\n      color,\n      fontSize: this.#fontSize,\n      value: this.#serializeContent(),\n    });\n    this.addComment(serialized);\n\n    if (isForCopying) {\n      // Don't add the id when copying because the pasted editor mustn't be\n      // linked to an existing annotation.\n      serialized.isCopy = true;\n      return serialized;\n    }\n\n    if (this.annotationElementId && !this.#hasElementChanged(serialized)) {\n      return null;\n    }\n\n    serialized.id = this.annotationElementId;\n\n    return serialized;\n  }\n\n  #hasElementChanged(serialized) {\n    const { value, fontSize, color, pageIndex } = this._initialData;\n\n    return (\n      this.hasEditedComment ||\n      this._hasBeenMoved ||\n      serialized.value !== value ||\n      serialized.fontSize !== fontSize ||\n      serialized.color.some((c, i) => c !== color[i]) ||\n      serialized.pageIndex !== pageIndex\n    );\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    const content = super.renderAnnotationElement(annotation);\n    if (!content) {\n      return null;\n    }\n    const { style } = content;\n    style.fontSize = `calc(${this.#fontSize}px * var(--total-scale-factor))`;\n    style.color = this.color;\n\n    content.replaceChildren();\n    for (const line of this.#content.split(\"\\n\")) {\n      const div = document.createElement(\"div\");\n      div.append(\n        line ? document.createTextNode(line) : document.createElement(\"br\")\n      );\n      content.append(div);\n    }\n\n    annotation.updateEdited({\n      rect: this.getPDFRect(),\n      popup:\n        this._uiManager.hasCommentManager() || this.hasEditedComment\n          ? this.comment\n          : { text: this.#content },\n    });\n\n    return content;\n  }\n\n  resetAnnotationElement(annotation) {\n    super.resetAnnotationElement(annotation);\n    annotation.resetEdited();\n  }\n}\n\nexport { FreeTextEditor };\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { unreachable } from \"../../../shared/util.js\";\n\nclass Outline {\n  static PRECISION = 1e-4;\n\n  /**\n   * @returns {string} The SVG path of the outline.\n   */\n  toSVGPath() {\n    unreachable(\"Abstract method `toSVGPath` must be implemented.\");\n  }\n\n  /**\n   * @type {Object|null} The bounding box of the outline.\n   */\n  // eslint-disable-next-line getter-return\n  get box() {\n    unreachable(\"Abstract getter `box` must be implemented.\");\n  }\n\n  serialize(_bbox, _rotation) {\n    unreachable(\"Abstract method `serialize` must be implemented.\");\n  }\n\n  static _rescale(src, tx, ty, sx, sy, dest) {\n    dest ||= new Float32Array(src.length);\n    for (let i = 0, ii = src.length; i < ii; i += 2) {\n      dest[i] = tx + src[i] * sx;\n      dest[i + 1] = ty + src[i + 1] * sy;\n    }\n    return dest;\n  }\n\n  static _rescaleAndSwap(src, tx, ty, sx, sy, dest) {\n    dest ||= new Float32Array(src.length);\n    for (let i = 0, ii = src.length; i < ii; i += 2) {\n      dest[i] = tx + src[i + 1] * sx;\n      dest[i + 1] = ty + src[i] * sy;\n    }\n    return dest;\n  }\n\n  static _translate(src, tx, ty, dest) {\n    dest ||= new Float32Array(src.length);\n    for (let i = 0, ii = src.length; i < ii; i += 2) {\n      dest[i] = tx + src[i];\n      dest[i + 1] = ty + src[i + 1];\n    }\n    return dest;\n  }\n\n  static svgRound(x) {\n    // 0.1234 will be 1234 and this way we economize 2 bytes per number.\n    // Of course, it makes sense only when the viewBox is [0 0 10000 10000].\n    // And it helps to avoid bugs like:\n    //  https://bugzilla.mozilla.org/show_bug.cgi?id=1929340\n    return Math.round(x * 10000);\n  }\n\n  static _normalizePoint(x, y, parentWidth, parentHeight, rotation) {\n    switch (rotation) {\n      case 90:\n        return [1 - y / parentWidth, x / parentHeight];\n      case 180:\n        return [1 - x / parentWidth, 1 - y / parentHeight];\n      case 270:\n        return [y / parentWidth, 1 - x / parentHeight];\n      default:\n        return [x / parentWidth, y / parentHeight];\n    }\n  }\n\n  static _normalizePagePoint(x, y, rotation) {\n    switch (rotation) {\n      case 90:\n        return [1 - y, x];\n      case 180:\n        return [1 - x, 1 - y];\n      case 270:\n        return [y, 1 - x];\n      default:\n        return [x, y];\n    }\n  }\n\n  static createBezierPoints(x1, y1, x2, y2, x3, y3) {\n    return [\n      (x1 + 5 * x2) / 6,\n      (y1 + 5 * y2) / 6,\n      (5 * x2 + x3) / 6,\n      (5 * y2 + y3) / 6,\n      (x2 + x3) / 2,\n      (y2 + y3) / 2,\n    ];\n  }\n}\n\nexport { Outline };\n","/* Copyright 2024 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Outline } from \"./outline.js\";\nimport { Util } from \"../../../shared/util.js\";\n\nclass FreeDrawOutliner {\n  #box;\n\n  #bottom = [];\n\n  #innerMargin;\n\n  #isLTR;\n\n  #top = [];\n\n  // The first 6 elements are the last 3 points of the top part of the outline.\n  // The next 6 elements are the last 3 points of the line.\n  // The next 6 elements are the last 3 points of the bottom part of the\n  // outline.\n  // We track the last 3 points in order to be able to:\n  //  - compute the normal of the line,\n  //  - compute the control points of the quadratic Bzier curve.\n  #last = new Float32Array(18);\n\n  #lastX;\n\n  #lastY;\n\n  #min;\n\n  #min_dist;\n\n  #scaleFactor;\n\n  #thickness;\n\n  #points = [];\n\n  static #MIN_DIST = 8;\n\n  static #MIN_DIFF = 2;\n\n  static #MIN = FreeDrawOutliner.#MIN_DIST + FreeDrawOutliner.#MIN_DIFF;\n\n  constructor({ x, y }, box, scaleFactor, thickness, isLTR, innerMargin = 0) {\n    this.#box = box;\n    this.#thickness = thickness * scaleFactor;\n    this.#isLTR = isLTR;\n    this.#last.set([NaN, NaN, NaN, NaN, x, y], 6);\n    this.#innerMargin = innerMargin;\n    this.#min_dist = FreeDrawOutliner.#MIN_DIST * scaleFactor;\n    this.#min = FreeDrawOutliner.#MIN * scaleFactor;\n    this.#scaleFactor = scaleFactor;\n    this.#points.push(x, y);\n  }\n\n  isEmpty() {\n    // When we add a second point then this.#last.slice(6) will be something\n    // like [NaN, NaN, firstX, firstY, secondX, secondY,...] so having a NaN\n    // at index 8 means that we've only one point.\n    return isNaN(this.#last[8]);\n  }\n\n  #getLastCoords() {\n    const lastTop = this.#last.subarray(4, 6);\n    const lastBottom = this.#last.subarray(16, 18);\n    const [x, y, width, height] = this.#box;\n\n    return [\n      (this.#lastX + (lastTop[0] - lastBottom[0]) / 2 - x) / width,\n      (this.#lastY + (lastTop[1] - lastBottom[1]) / 2 - y) / height,\n      (this.#lastX + (lastBottom[0] - lastTop[0]) / 2 - x) / width,\n      (this.#lastY + (lastBottom[1] - lastTop[1]) / 2 - y) / height,\n    ];\n  }\n\n  add({ x, y }) {\n    this.#lastX = x;\n    this.#lastY = y;\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n    let [x1, y1, x2, y2] = this.#last.subarray(8, 12);\n    const diffX = x - x2;\n    const diffY = y - y2;\n    const d = Math.hypot(diffX, diffY);\n    if (d < this.#min) {\n      // The idea is to avoid garbage points around the last point.\n      // When the points are too close, it just leads to bad normal vectors and\n      // control points.\n      return false;\n    }\n    const diffD = d - this.#min_dist;\n    const K = diffD / d;\n    const shiftX = K * diffX;\n    const shiftY = K * diffY;\n\n    // We update the last 3 points of the line.\n    let x0 = x1;\n    let y0 = y1;\n    x1 = x2;\n    y1 = y2;\n    x2 += shiftX;\n    y2 += shiftY;\n\n    // We keep track of the points in order to be able to compute the focus\n    // outline.\n    this.#points?.push(x, y);\n\n    // Create the normal unit vector.\n    // |(shiftX, shiftY)| = |K| * |(diffX, diffY)| = |K| * d = diffD.\n    const nX = -shiftY / diffD;\n    const nY = shiftX / diffD;\n    const thX = nX * this.#thickness;\n    const thY = nY * this.#thickness;\n    this.#last.set(this.#last.subarray(2, 8), 0);\n    this.#last.set([x2 + thX, y2 + thY], 4);\n    this.#last.set(this.#last.subarray(14, 18), 12);\n    this.#last.set([x2 - thX, y2 - thY], 16);\n\n    if (isNaN(this.#last[6])) {\n      if (this.#top.length === 0) {\n        this.#last.set([x1 + thX, y1 + thY], 2);\n        this.#top.push(\n          NaN,\n          NaN,\n          NaN,\n          NaN,\n          (x1 + thX - layerX) / layerWidth,\n          (y1 + thY - layerY) / layerHeight\n        );\n        this.#last.set([x1 - thX, y1 - thY], 14);\n        this.#bottom.push(\n          NaN,\n          NaN,\n          NaN,\n          NaN,\n          (x1 - thX - layerX) / layerWidth,\n          (y1 - thY - layerY) / layerHeight\n        );\n      }\n      this.#last.set([x0, y0, x1, y1, x2, y2], 6);\n      return !this.isEmpty();\n    }\n\n    this.#last.set([x0, y0, x1, y1, x2, y2], 6);\n\n    const angle = Math.abs(\n      Math.atan2(y0 - y1, x0 - x1) - Math.atan2(shiftY, shiftX)\n    );\n    if (angle < Math.PI / 2) {\n      // In order to avoid some possible artifacts, we're going to use the a\n      // straight line instead of a quadratic Bzier curve.\n      [x1, y1, x2, y2] = this.#last.subarray(2, 6);\n      this.#top.push(\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        ((x1 + x2) / 2 - layerX) / layerWidth,\n        ((y1 + y2) / 2 - layerY) / layerHeight\n      );\n      [x1, y1, x0, y0] = this.#last.subarray(14, 18);\n      this.#bottom.push(\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        ((x0 + x1) / 2 - layerX) / layerWidth,\n        ((y0 + y1) / 2 - layerY) / layerHeight\n      );\n      return true;\n    }\n\n    // Control points and the final point for the quadratic Bzier curve.\n    [x0, y0, x1, y1, x2, y2] = this.#last.subarray(0, 6);\n    this.#top.push(\n      ((x0 + 5 * x1) / 6 - layerX) / layerWidth,\n      ((y0 + 5 * y1) / 6 - layerY) / layerHeight,\n      ((5 * x1 + x2) / 6 - layerX) / layerWidth,\n      ((5 * y1 + y2) / 6 - layerY) / layerHeight,\n      ((x1 + x2) / 2 - layerX) / layerWidth,\n      ((y1 + y2) / 2 - layerY) / layerHeight\n    );\n    [x2, y2, x1, y1, x0, y0] = this.#last.subarray(12, 18);\n    this.#bottom.push(\n      ((x0 + 5 * x1) / 6 - layerX) / layerWidth,\n      ((y0 + 5 * y1) / 6 - layerY) / layerHeight,\n      ((5 * x1 + x2) / 6 - layerX) / layerWidth,\n      ((5 * y1 + y2) / 6 - layerY) / layerHeight,\n      ((x1 + x2) / 2 - layerX) / layerWidth,\n      ((y1 + y2) / 2 - layerY) / layerHeight\n    );\n    return true;\n  }\n\n  toSVGPath() {\n    if (this.isEmpty()) {\n      // We've only one point.\n      return \"\";\n    }\n    const top = this.#top;\n    const bottom = this.#bottom;\n\n    if (isNaN(this.#last[6]) && !this.isEmpty()) {\n      // We've only two points.\n      return this.#toSVGPathTwoPoints();\n    }\n\n    const buffer = [];\n    buffer.push(`M${top[4]} ${top[5]}`);\n    for (let i = 6; i < top.length; i += 6) {\n      if (isNaN(top[i])) {\n        buffer.push(`L${top[i + 4]} ${top[i + 5]}`);\n      } else {\n        buffer.push(\n          `C${top[i]} ${top[i + 1]} ${top[i + 2]} ${top[i + 3]} ${top[i + 4]} ${\n            top[i + 5]\n          }`\n        );\n      }\n    }\n\n    this.#toSVGPathEnd(buffer);\n\n    for (let i = bottom.length - 6; i >= 6; i -= 6) {\n      if (isNaN(bottom[i])) {\n        buffer.push(`L${bottom[i + 4]} ${bottom[i + 5]}`);\n      } else {\n        buffer.push(\n          `C${bottom[i]} ${bottom[i + 1]} ${bottom[i + 2]} ${bottom[i + 3]} ${\n            bottom[i + 4]\n          } ${bottom[i + 5]}`\n        );\n      }\n    }\n\n    this.#toSVGPathStart(buffer);\n\n    return buffer.join(\" \");\n  }\n\n  #toSVGPathTwoPoints() {\n    const [x, y, width, height] = this.#box;\n    const [lastTopX, lastTopY, lastBottomX, lastBottomY] =\n      this.#getLastCoords();\n\n    return `M${(this.#last[2] - x) / width} ${\n      (this.#last[3] - y) / height\n    } L${(this.#last[4] - x) / width} ${(this.#last[5] - y) / height} L${lastTopX} ${lastTopY} L${lastBottomX} ${lastBottomY} L${\n      (this.#last[16] - x) / width\n    } ${(this.#last[17] - y) / height} L${(this.#last[14] - x) / width} ${\n      (this.#last[15] - y) / height\n    } Z`;\n  }\n\n  #toSVGPathStart(buffer) {\n    const bottom = this.#bottom;\n    buffer.push(`L${bottom[4]} ${bottom[5]} Z`);\n  }\n\n  #toSVGPathEnd(buffer) {\n    const [x, y, width, height] = this.#box;\n    const lastTop = this.#last.subarray(4, 6);\n    const lastBottom = this.#last.subarray(16, 18);\n    const [lastTopX, lastTopY, lastBottomX, lastBottomY] =\n      this.#getLastCoords();\n\n    buffer.push(\n      `L${(lastTop[0] - x) / width} ${(lastTop[1] - y) / height} L${lastTopX} ${lastTopY} L${lastBottomX} ${lastBottomY} L${\n        (lastBottom[0] - x) / width\n      } ${(lastBottom[1] - y) / height}`\n    );\n  }\n\n  newFreeDrawOutline(outline, points, box, scaleFactor, innerMargin, isLTR) {\n    return new FreeDrawOutline(\n      outline,\n      points,\n      box,\n      scaleFactor,\n      innerMargin,\n      isLTR\n    );\n  }\n\n  getOutlines() {\n    const top = this.#top;\n    const bottom = this.#bottom;\n    const last = this.#last;\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n\n    const points = new Float32Array((this.#points?.length ?? 0) + 2);\n    for (let i = 0, ii = points.length - 2; i < ii; i += 2) {\n      points[i] = (this.#points[i] - layerX) / layerWidth;\n      points[i + 1] = (this.#points[i + 1] - layerY) / layerHeight;\n    }\n    points[points.length - 2] = (this.#lastX - layerX) / layerWidth;\n    points[points.length - 1] = (this.#lastY - layerY) / layerHeight;\n\n    if (isNaN(last[6]) && !this.isEmpty()) {\n      // We've only two points.\n      return this.#getOutlineTwoPoints(points);\n    }\n\n    const outline = new Float32Array(\n      this.#top.length + 24 + this.#bottom.length\n    );\n    let N = top.length;\n    for (let i = 0; i < N; i += 2) {\n      if (isNaN(top[i])) {\n        outline[i] = outline[i + 1] = NaN;\n        continue;\n      }\n      outline[i] = top[i];\n      outline[i + 1] = top[i + 1];\n    }\n\n    N = this.#getOutlineEnd(outline, N);\n\n    for (let i = bottom.length - 6; i >= 6; i -= 6) {\n      for (let j = 0; j < 6; j += 2) {\n        if (isNaN(bottom[i + j])) {\n          outline[N] = outline[N + 1] = NaN;\n          N += 2;\n          continue;\n        }\n        outline[N] = bottom[i + j];\n        outline[N + 1] = bottom[i + j + 1];\n        N += 2;\n      }\n    }\n\n    this.#getOutlineStart(outline, N);\n\n    return this.newFreeDrawOutline(\n      outline,\n      points,\n      this.#box,\n      this.#scaleFactor,\n      this.#innerMargin,\n      this.#isLTR\n    );\n  }\n\n  #getOutlineTwoPoints(points) {\n    const last = this.#last;\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n    const [lastTopX, lastTopY, lastBottomX, lastBottomY] =\n      this.#getLastCoords();\n    const outline = new Float32Array(36);\n    outline.set(\n      [\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (last[2] - layerX) / layerWidth,\n        (last[3] - layerY) / layerHeight,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (last[4] - layerX) / layerWidth,\n        (last[5] - layerY) / layerHeight,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        lastTopX,\n        lastTopY,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        lastBottomX,\n        lastBottomY,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (last[16] - layerX) / layerWidth,\n        (last[17] - layerY) / layerHeight,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (last[14] - layerX) / layerWidth,\n        (last[15] - layerY) / layerHeight,\n      ],\n      0\n    );\n    return this.newFreeDrawOutline(\n      outline,\n      points,\n      this.#box,\n      this.#scaleFactor,\n      this.#innerMargin,\n      this.#isLTR\n    );\n  }\n\n  #getOutlineStart(outline, pos) {\n    const bottom = this.#bottom;\n    outline.set([NaN, NaN, NaN, NaN, bottom[4], bottom[5]], pos);\n    return (pos += 6);\n  }\n\n  #getOutlineEnd(outline, pos) {\n    const lastTop = this.#last.subarray(4, 6);\n    const lastBottom = this.#last.subarray(16, 18);\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n    const [lastTopX, lastTopY, lastBottomX, lastBottomY] =\n      this.#getLastCoords();\n    outline.set(\n      [\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (lastTop[0] - layerX) / layerWidth,\n        (lastTop[1] - layerY) / layerHeight,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        lastTopX,\n        lastTopY,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        lastBottomX,\n        lastBottomY,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (lastBottom[0] - layerX) / layerWidth,\n        (lastBottom[1] - layerY) / layerHeight,\n      ],\n      pos\n    );\n    return (pos += 24);\n  }\n}\n\nclass FreeDrawOutline extends Outline {\n  #box;\n\n  #bbox = new Float32Array(4);\n\n  #innerMargin;\n\n  #isLTR;\n\n  #points;\n\n  #scaleFactor;\n\n  #outline;\n\n  constructor(outline, points, box, scaleFactor, innerMargin, isLTR) {\n    super();\n    this.#outline = outline;\n    this.#points = points;\n    this.#box = box;\n    this.#scaleFactor = scaleFactor;\n    this.#innerMargin = innerMargin;\n    this.#isLTR = isLTR;\n    this.firstPoint = [NaN, NaN];\n    this.lastPoint = [NaN, NaN];\n    this.#computeMinMax(isLTR);\n\n    const [x, y, width, height] = this.#bbox;\n    for (let i = 0, ii = outline.length; i < ii; i += 2) {\n      outline[i] = (outline[i] - x) / width;\n      outline[i + 1] = (outline[i + 1] - y) / height;\n    }\n    for (let i = 0, ii = points.length; i < ii; i += 2) {\n      points[i] = (points[i] - x) / width;\n      points[i + 1] = (points[i + 1] - y) / height;\n    }\n  }\n\n  toSVGPath() {\n    const buffer = [`M${this.#outline[4]} ${this.#outline[5]}`];\n    for (let i = 6, ii = this.#outline.length; i < ii; i += 6) {\n      if (isNaN(this.#outline[i])) {\n        buffer.push(`L${this.#outline[i + 4]} ${this.#outline[i + 5]}`);\n        continue;\n      }\n      buffer.push(\n        `C${this.#outline[i]} ${this.#outline[i + 1]} ${this.#outline[i + 2]} ${\n          this.#outline[i + 3]\n        } ${this.#outline[i + 4]} ${this.#outline[i + 5]}`\n      );\n    }\n    buffer.push(\"Z\");\n    return buffer.join(\" \");\n  }\n\n  serialize([blX, blY, trX, trY], rotation) {\n    const width = trX - blX;\n    const height = trY - blY;\n    let outline;\n    let points;\n    switch (rotation) {\n      case 0:\n        outline = Outline._rescale(this.#outline, blX, trY, width, -height);\n        points = Outline._rescale(this.#points, blX, trY, width, -height);\n        break;\n      case 90:\n        outline = Outline._rescaleAndSwap(\n          this.#outline,\n          blX,\n          blY,\n          width,\n          height\n        );\n        points = Outline._rescaleAndSwap(this.#points, blX, blY, width, height);\n        break;\n      case 180:\n        outline = Outline._rescale(this.#outline, trX, blY, -width, height);\n        points = Outline._rescale(this.#points, trX, blY, -width, height);\n        break;\n      case 270:\n        outline = Outline._rescaleAndSwap(\n          this.#outline,\n          trX,\n          trY,\n          -width,\n          -height\n        );\n        points = Outline._rescaleAndSwap(\n          this.#points,\n          trX,\n          trY,\n          -width,\n          -height\n        );\n        break;\n    }\n    return { outline: Array.from(outline), points: [Array.from(points)] };\n  }\n\n  #computeMinMax(isLTR) {\n    const outline = this.#outline;\n    let lastX = outline[4];\n    let lastY = outline[5];\n    const minMax = [lastX, lastY, lastX, lastY];\n    let firstPointX = lastX;\n    let firstPointY = lastY;\n    let lastPointX = lastX;\n    let lastPointY = lastY;\n    const ltrCallback = isLTR ? Math.max : Math.min;\n    const bezierBbox = new Float32Array(4);\n\n    for (let i = 6, ii = outline.length; i < ii; i += 6) {\n      const x = outline[i + 4],\n        y = outline[i + 5];\n\n      if (isNaN(outline[i])) {\n        Util.pointBoundingBox(x, y, minMax);\n\n        if (firstPointY > y) {\n          firstPointX = x;\n          firstPointY = y;\n        } else if (firstPointY === y) {\n          firstPointX = ltrCallback(firstPointX, x);\n        }\n        if (lastPointY < y) {\n          lastPointX = x;\n          lastPointY = y;\n        } else if (lastPointY === y) {\n          lastPointX = ltrCallback(lastPointX, x);\n        }\n      } else {\n        bezierBbox[0] = bezierBbox[1] = Infinity;\n        bezierBbox[2] = bezierBbox[3] = -Infinity;\n        Util.bezierBoundingBox(\n          lastX,\n          lastY,\n          ...outline.slice(i, i + 6),\n          bezierBbox\n        );\n\n        Util.rectBoundingBox(\n          bezierBbox[0],\n          bezierBbox[1],\n          bezierBbox[2],\n          bezierBbox[3],\n          minMax\n        );\n\n        if (firstPointY > bezierBbox[1]) {\n          firstPointX = bezierBbox[0];\n          firstPointY = bezierBbox[1];\n        } else if (firstPointY === bezierBbox[1]) {\n          firstPointX = ltrCallback(firstPointX, bezierBbox[0]);\n        }\n        if (lastPointY < bezierBbox[3]) {\n          lastPointX = bezierBbox[2];\n          lastPointY = bezierBbox[3];\n        } else if (lastPointY === bezierBbox[3]) {\n          lastPointX = ltrCallback(lastPointX, bezierBbox[2]);\n        }\n      }\n      lastX = x;\n      lastY = y;\n    }\n\n    const bbox = this.#bbox;\n    bbox[0] = minMax[0] - this.#innerMargin;\n    bbox[1] = minMax[1] - this.#innerMargin;\n    bbox[2] = minMax[2] - minMax[0] + 2 * this.#innerMargin;\n    bbox[3] = minMax[3] - minMax[1] + 2 * this.#innerMargin;\n    this.firstPoint = [firstPointX, firstPointY];\n    this.lastPoint = [lastPointX, lastPointY];\n  }\n\n  get box() {\n    return this.#bbox;\n  }\n\n  newOutliner(point, box, scaleFactor, thickness, isLTR, innerMargin = 0) {\n    return new FreeDrawOutliner(\n      point,\n      box,\n      scaleFactor,\n      thickness,\n      isLTR,\n      innerMargin\n    );\n  }\n\n  getNewOutline(thickness, innerMargin) {\n    // Build the outline of the highlight to use as the focus outline.\n    const [x, y, width, height] = this.#bbox;\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n    const sx = width * layerWidth;\n    const sy = height * layerHeight;\n    const tx = x * layerWidth + layerX;\n    const ty = y * layerHeight + layerY;\n    const outliner = this.newOutliner(\n      {\n        x: this.#points[0] * sx + tx,\n        y: this.#points[1] * sy + ty,\n      },\n      this.#box,\n      this.#scaleFactor,\n      thickness,\n      this.#isLTR,\n      innerMargin ?? this.#innerMargin\n    );\n    for (let i = 2; i < this.#points.length; i += 2) {\n      outliner.add({\n        x: this.#points[i] * sx + tx,\n        y: this.#points[i + 1] * sy + ty,\n      });\n    }\n    return outliner.getOutlines();\n  }\n}\n\nexport { FreeDrawOutline, FreeDrawOutliner };\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FreeDrawOutline, FreeDrawOutliner } from \"./freedraw.js\";\nimport { Outline } from \"./outline.js\";\nimport { Util } from \"../../../shared/util.js\";\n\nclass HighlightOutliner {\n  #box;\n\n  #firstPoint;\n\n  #lastPoint;\n\n  #verticalEdges = [];\n\n  #intervals = [];\n\n  /**\n   * Construct an outliner.\n   * @param {Array<Object>} boxes - An array of axis-aligned rectangles.\n   * @param {number} borderWidth - The width of the border of the boxes, it\n   *   allows to make the boxes bigger (or smaller).\n   * @param {number} innerMargin - The margin between the boxes and the\n   *   outlines. It's important to not have a null innerMargin when we want to\n   *   draw the outline else the stroked outline could be clipped because of its\n   *   width.\n   * @param {boolean} isLTR - true if we're in LTR mode. It's used to determine\n   *   the last point of the boxes.\n   */\n  constructor(boxes, borderWidth = 0, innerMargin = 0, isLTR = true) {\n    const minMax = [Infinity, Infinity, -Infinity, -Infinity];\n\n    // We round the coordinates to slightly reduce the number of edges in the\n    // final outlines.\n    const NUMBER_OF_DIGITS = 4;\n    const EPSILON = 10 ** -NUMBER_OF_DIGITS;\n\n    // The coordinates of the boxes are in the page coordinate system.\n    for (const { x, y, width, height } of boxes) {\n      const x1 = Math.floor((x - borderWidth) / EPSILON) * EPSILON;\n      const x2 = Math.ceil((x + width + borderWidth) / EPSILON) * EPSILON;\n      const y1 = Math.floor((y - borderWidth) / EPSILON) * EPSILON;\n      const y2 = Math.ceil((y + height + borderWidth) / EPSILON) * EPSILON;\n      const left = [x1, y1, y2, true];\n      const right = [x2, y1, y2, false];\n      this.#verticalEdges.push(left, right);\n\n      Util.rectBoundingBox(x1, y1, x2, y2, minMax);\n    }\n\n    const bboxWidth = minMax[2] - minMax[0] + 2 * innerMargin;\n    const bboxHeight = minMax[3] - minMax[1] + 2 * innerMargin;\n    const shiftedMinX = minMax[0] - innerMargin;\n    const shiftedMinY = minMax[1] - innerMargin;\n    let firstPointX = isLTR ? -Infinity : Infinity;\n    let firstPointY = Infinity;\n    const lastEdge = this.#verticalEdges.at(isLTR ? -1 : -2);\n    const lastPoint = [lastEdge[0], lastEdge[2]];\n\n    // Convert the coordinates of the edges into box coordinates.\n    for (const edge of this.#verticalEdges) {\n      const [x, y1, y2, left] = edge;\n      if (!left && isLTR) {\n        if (y1 < firstPointY) {\n          firstPointY = y1;\n          firstPointX = x;\n        } else if (y1 === firstPointY) {\n          firstPointX = Math.max(firstPointX, x);\n        }\n      } else if (left && !isLTR) {\n        if (y1 < firstPointY) {\n          firstPointY = y1;\n          firstPointX = x;\n        } else if (y1 === firstPointY) {\n          firstPointX = Math.min(firstPointX, x);\n        }\n      }\n\n      edge[0] = (x - shiftedMinX) / bboxWidth;\n      edge[1] = (y1 - shiftedMinY) / bboxHeight;\n      edge[2] = (y2 - shiftedMinY) / bboxHeight;\n    }\n\n    this.#box = new Float32Array([\n      shiftedMinX,\n      shiftedMinY,\n      bboxWidth,\n      bboxHeight,\n    ]);\n    this.#firstPoint = [firstPointX, firstPointY];\n    this.#lastPoint = lastPoint;\n  }\n\n  getOutlines() {\n    // We begin to sort lexicographically the vertical edges by their abscissa,\n    // and then by their ordinate.\n    this.#verticalEdges.sort(\n      (a, b) => a[0] - b[0] || a[1] - b[1] || a[2] - b[2]\n    );\n\n    // We're now using a sweep line algorithm to find the outlines.\n    // We start with the leftmost vertical edge, and we're going to iterate\n    // over all the vertical edges from left to right.\n    // Each time we encounter a left edge, we're going to insert the interval\n    // [y1, y2] in the set of intervals.\n    // This set of intervals is used to break the vertical edges into chunks:\n    // we only take the part of the vertical edge that isn't in the union of\n    // the intervals.\n    const outlineVerticalEdges = [];\n    for (const edge of this.#verticalEdges) {\n      if (edge[3]) {\n        // Left edge.\n        outlineVerticalEdges.push(...this.#breakEdge(edge));\n        this.#insert(edge);\n      } else {\n        // Right edge.\n        this.#remove(edge);\n        outlineVerticalEdges.push(...this.#breakEdge(edge));\n      }\n    }\n    return this.#getOutlines(outlineVerticalEdges);\n  }\n\n  #getOutlines(outlineVerticalEdges) {\n    const edges = [];\n    const allEdges = new Set();\n\n    for (const edge of outlineVerticalEdges) {\n      const [x, y1, y2] = edge;\n      edges.push([x, y1, edge], [x, y2, edge]);\n    }\n\n    // We sort lexicographically the vertices of each edge by their ordinate and\n    // by their abscissa.\n    // Every pair (v_2i, v_{2i + 1}) of vertices defines a horizontal edge.\n    // So for every vertical edge, we're going to add the two vertical edges\n    // which are connected to it through a horizontal edge.\n    edges.sort((a, b) => a[1] - b[1] || a[0] - b[0]);\n    for (let i = 0, ii = edges.length; i < ii; i += 2) {\n      const edge1 = edges[i][2];\n      const edge2 = edges[i + 1][2];\n      edge1.push(edge2);\n      edge2.push(edge1);\n      allEdges.add(edge1);\n      allEdges.add(edge2);\n    }\n    const outlines = [];\n    let outline;\n\n    while (allEdges.size > 0) {\n      const edge = allEdges.values().next().value;\n      let [x, y1, y2, edge1, edge2] = edge;\n      allEdges.delete(edge);\n      let lastPointX = x;\n      let lastPointY = y1;\n\n      outline = [x, y2];\n      outlines.push(outline);\n\n      while (true) {\n        let e;\n        if (allEdges.has(edge1)) {\n          e = edge1;\n        } else if (allEdges.has(edge2)) {\n          e = edge2;\n        } else {\n          break;\n        }\n\n        allEdges.delete(e);\n        [x, y1, y2, edge1, edge2] = e;\n\n        if (lastPointX !== x) {\n          outline.push(lastPointX, lastPointY, x, lastPointY === y1 ? y1 : y2);\n          lastPointX = x;\n        }\n        lastPointY = lastPointY === y1 ? y2 : y1;\n      }\n      outline.push(lastPointX, lastPointY);\n    }\n    return new HighlightOutline(\n      outlines,\n      this.#box,\n      this.#firstPoint,\n      this.#lastPoint\n    );\n  }\n\n  #binarySearch(y) {\n    const array = this.#intervals;\n    let start = 0;\n    let end = array.length - 1;\n\n    while (start <= end) {\n      const middle = (start + end) >> 1;\n      const y1 = array[middle][0];\n      if (y1 === y) {\n        return middle;\n      }\n      if (y1 < y) {\n        start = middle + 1;\n      } else {\n        end = middle - 1;\n      }\n    }\n    return end + 1;\n  }\n\n  #insert([, y1, y2]) {\n    const index = this.#binarySearch(y1);\n    this.#intervals.splice(index, 0, [y1, y2]);\n  }\n\n  #remove([, y1, y2]) {\n    const index = this.#binarySearch(y1);\n    for (let i = index; i < this.#intervals.length; i++) {\n      const [start, end] = this.#intervals[i];\n      if (start !== y1) {\n        break;\n      }\n      if (start === y1 && end === y2) {\n        this.#intervals.splice(i, 1);\n        return;\n      }\n    }\n    for (let i = index - 1; i >= 0; i--) {\n      const [start, end] = this.#intervals[i];\n      if (start !== y1) {\n        break;\n      }\n      if (start === y1 && end === y2) {\n        this.#intervals.splice(i, 1);\n        return;\n      }\n    }\n  }\n\n  #breakEdge(edge) {\n    const [x, y1, y2] = edge;\n    const results = [[x, y1, y2]];\n    const index = this.#binarySearch(y2);\n    for (let i = 0; i < index; i++) {\n      const [start, end] = this.#intervals[i];\n      for (let j = 0, jj = results.length; j < jj; j++) {\n        const [, y3, y4] = results[j];\n        if (end <= y3 || y4 <= start) {\n          // There is no intersection between the interval and the edge, hence\n          // we keep it as is.\n          continue;\n        }\n        if (y3 >= start) {\n          if (y4 > end) {\n            results[j][1] = end;\n          } else {\n            if (jj === 1) {\n              return [];\n            }\n            // The edge is included in the interval, hence we remove it.\n            results.splice(j, 1);\n            j--;\n            jj--;\n          }\n          continue;\n        }\n        results[j][2] = start;\n        if (y4 > end) {\n          results.push([x, end, y4]);\n        }\n      }\n    }\n    return results;\n  }\n}\n\nclass HighlightOutline extends Outline {\n  #box;\n\n  #outlines;\n\n  constructor(outlines, box, firstPoint, lastPoint) {\n    super();\n    this.#outlines = outlines;\n    this.#box = box;\n    this.firstPoint = firstPoint;\n    this.lastPoint = lastPoint;\n  }\n\n  toSVGPath() {\n    const buffer = [];\n    for (const polygon of this.#outlines) {\n      let [prevX, prevY] = polygon;\n      buffer.push(`M${prevX} ${prevY}`);\n      for (let i = 2; i < polygon.length; i += 2) {\n        const x = polygon[i];\n        const y = polygon[i + 1];\n        if (x === prevX) {\n          buffer.push(`V${y}`);\n          prevY = y;\n        } else if (y === prevY) {\n          buffer.push(`H${x}`);\n          prevX = x;\n        }\n      }\n      buffer.push(\"Z\");\n    }\n    return buffer.join(\" \");\n  }\n\n  /**\n   * Serialize the outlines into the PDF page coordinate system.\n   * @param {Array<number>} _bbox - the bounding box of the annotation.\n   * @param {number} _rotation - the rotation of the annotation.\n   * @returns {Array<Array<number>>}\n   */\n  serialize([blX, blY, trX, trY], _rotation) {\n    const outlines = [];\n    const width = trX - blX;\n    const height = trY - blY;\n    for (const outline of this.#outlines) {\n      const points = new Array(outline.length);\n      for (let i = 0; i < outline.length; i += 2) {\n        points[i] = blX + outline[i] * width;\n        points[i + 1] = trY - outline[i + 1] * height;\n      }\n      outlines.push(points);\n    }\n    return outlines;\n  }\n\n  get box() {\n    return this.#box;\n  }\n\n  get classNamesForOutlining() {\n    return [\"highlightOutline\"];\n  }\n}\n\nclass FreeHighlightOutliner extends FreeDrawOutliner {\n  newFreeDrawOutline(outline, points, box, scaleFactor, innerMargin, isLTR) {\n    return new FreeHighlightOutline(\n      outline,\n      points,\n      box,\n      scaleFactor,\n      innerMargin,\n      isLTR\n    );\n  }\n}\n\nclass FreeHighlightOutline extends FreeDrawOutline {\n  newOutliner(point, box, scaleFactor, thickness, isLTR, innerMargin = 0) {\n    return new FreeHighlightOutliner(\n      point,\n      box,\n      scaleFactor,\n      thickness,\n      isLTR,\n      innerMargin\n    );\n  }\n}\n\nexport { FreeHighlightOutliner, HighlightOutliner };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  shadow,\n  Util,\n} from \"../../shared/util.js\";\nimport { bindEvents, KeyboardManager } from \"./tools.js\";\nimport {\n  FreeHighlightOutliner,\n  HighlightOutliner,\n} from \"./drawers/highlight.js\";\nimport {\n  HighlightAnnotationElement,\n  InkAnnotationElement,\n} from \"../annotation_layer.js\";\nimport { noContextMenu, stopEvent } from \"../display_utils.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { ColorPicker } from \"./color_picker.js\";\n\n/**\n * Basic draw editor in order to generate an Highlight annotation.\n */\nclass HighlightEditor extends AnnotationEditor {\n  #anchorNode = null;\n\n  #anchorOffset = 0;\n\n  #boxes;\n\n  #clipPathId = null;\n\n  #colorPicker = null;\n\n  #focusOutlines = null;\n\n  #focusNode = null;\n\n  #focusOffset = 0;\n\n  #highlightDiv = null;\n\n  #highlightOutlines = null;\n\n  #id = null;\n\n  #isFreeHighlight = false;\n\n  #firstPoint = null;\n\n  #lastPoint = null;\n\n  #outlineId = null;\n\n  #text = \"\";\n\n  #thickness;\n\n  #methodOfCreation = \"\";\n\n  static _defaultColor = null;\n\n  static _defaultOpacity = 1;\n\n  static _defaultThickness = 12;\n\n  static _type = \"highlight\";\n\n  static _editorType = AnnotationEditorType.HIGHLIGHT;\n\n  static _freeHighlightId = -1;\n\n  static _freeHighlight = null;\n\n  static _freeHighlightClipId = \"\";\n\n  static get _keyboardManager() {\n    const proto = HighlightEditor.prototype;\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [[\"ArrowLeft\", \"mac+ArrowLeft\"], proto._moveCaret, { args: [0] }],\n        [[\"ArrowRight\", \"mac+ArrowRight\"], proto._moveCaret, { args: [1] }],\n        [[\"ArrowUp\", \"mac+ArrowUp\"], proto._moveCaret, { args: [2] }],\n        [[\"ArrowDown\", \"mac+ArrowDown\"], proto._moveCaret, { args: [3] }],\n      ])\n    );\n  }\n\n  constructor(params) {\n    super({ ...params, name: \"highlightEditor\" });\n    this.color = params.color || HighlightEditor._defaultColor;\n    this.#thickness = params.thickness || HighlightEditor._defaultThickness;\n    this.opacity = params.opacity || HighlightEditor._defaultOpacity;\n    this.#boxes = params.boxes || null;\n    this.#methodOfCreation = params.methodOfCreation || \"\";\n    this.#text = params.text || \"\";\n    this._isDraggable = false;\n    this.defaultL10nId = \"pdfjs-editor-highlight-editor\";\n\n    if (params.highlightId > -1) {\n      this.#isFreeHighlight = true;\n      this.#createFreeOutlines(params);\n      this.#addToDrawLayer();\n    } else if (this.#boxes) {\n      this.#anchorNode = params.anchorNode;\n      this.#anchorOffset = params.anchorOffset;\n      this.#focusNode = params.focusNode;\n      this.#focusOffset = params.focusOffset;\n      this.#createOutlines();\n      this.#addToDrawLayer();\n      this.rotate(this.rotation);\n    }\n\n    if (!this.annotationElementId) {\n      this._uiManager.a11yAlert(\"pdfjs-editor-highlight-added-alert\");\n    }\n  }\n\n  /** @inheritdoc */\n  get telemetryInitialData() {\n    return {\n      action: \"added\",\n      type: this.#isFreeHighlight ? \"free_highlight\" : \"highlight\",\n      color: this._uiManager.getNonHCMColorName(this.color),\n      thickness: this.#thickness,\n      methodOfCreation: this.#methodOfCreation,\n    };\n  }\n\n  /** @inheritdoc */\n  get telemetryFinalData() {\n    return {\n      type: \"highlight\",\n      color: this._uiManager.getNonHCMColorName(this.color),\n    };\n  }\n\n  static computeTelemetryFinalData(data) {\n    // We want to know how many colors have been used.\n    return { numberOfColors: data.get(\"color\").size };\n  }\n\n  #createOutlines() {\n    const outliner = new HighlightOutliner(\n      this.#boxes,\n      /* borderWidth = */ 0.001\n    );\n    this.#highlightOutlines = outliner.getOutlines();\n    [this.x, this.y, this.width, this.height] = this.#highlightOutlines.box;\n\n    const outlinerForOutline = new HighlightOutliner(\n      this.#boxes,\n      /* borderWidth = */ 0.0025,\n      /* innerMargin = */ 0.001,\n      this._uiManager.direction === \"ltr\"\n    );\n    this.#focusOutlines = outlinerForOutline.getOutlines();\n\n    const { firstPoint } = this.#highlightOutlines;\n    this.#firstPoint = [\n      (firstPoint[0] - this.x) / this.width,\n      (firstPoint[1] - this.y) / this.height,\n    ];\n    // The last point is in the pages coordinate system.\n    const { lastPoint } = this.#focusOutlines;\n    this.#lastPoint = [\n      (lastPoint[0] - this.x) / this.width,\n      (lastPoint[1] - this.y) / this.height,\n    ];\n  }\n\n  #createFreeOutlines({ highlightOutlines, highlightId, clipPathId }) {\n    this.#highlightOutlines = highlightOutlines;\n    const extraThickness = 1.5;\n    this.#focusOutlines = highlightOutlines.getNewOutline(\n      /* Slightly bigger than the highlight in order to have a little\n         space between the highlight and the outline. */\n      this.#thickness / 2 + extraThickness,\n      /* innerMargin = */ 0.0025\n    );\n\n    if (highlightId >= 0) {\n      this.#id = highlightId;\n      this.#clipPathId = clipPathId;\n      // We need to redraw the highlight because we change the coordinates to be\n      // in the box coordinate system.\n      this.parent.drawLayer.finalizeDraw(highlightId, {\n        bbox: highlightOutlines.box,\n        path: {\n          d: highlightOutlines.toSVGPath(),\n        },\n      });\n      this.#outlineId = this.parent.drawLayer.drawOutline(\n        {\n          rootClass: {\n            highlightOutline: true,\n            free: true,\n          },\n          bbox: this.#focusOutlines.box,\n          path: {\n            d: this.#focusOutlines.toSVGPath(),\n          },\n        },\n        /* mustRemoveSelfIntersections = */ true\n      );\n    } else if (this.parent) {\n      const angle = this.parent.viewport.rotation;\n      this.parent.drawLayer.updateProperties(this.#id, {\n        bbox: HighlightEditor.#rotateBbox(\n          this.#highlightOutlines.box,\n          (angle - this.rotation + 360) % 360\n        ),\n        path: {\n          d: highlightOutlines.toSVGPath(),\n        },\n      });\n      this.parent.drawLayer.updateProperties(this.#outlineId, {\n        bbox: HighlightEditor.#rotateBbox(this.#focusOutlines.box, angle),\n        path: {\n          d: this.#focusOutlines.toSVGPath(),\n        },\n      });\n    }\n    const [x, y, width, height] = highlightOutlines.box;\n    switch (this.rotation) {\n      case 0:\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n        break;\n      case 90: {\n        const [pageWidth, pageHeight] = this.parentDimensions;\n        this.x = y;\n        this.y = 1 - x;\n        this.width = (width * pageHeight) / pageWidth;\n        this.height = (height * pageWidth) / pageHeight;\n        break;\n      }\n      case 180:\n        this.x = 1 - x;\n        this.y = 1 - y;\n        this.width = width;\n        this.height = height;\n        break;\n      case 270: {\n        const [pageWidth, pageHeight] = this.parentDimensions;\n        this.x = 1 - y;\n        this.y = x;\n        this.width = (width * pageHeight) / pageWidth;\n        this.height = (height * pageWidth) / pageHeight;\n        break;\n      }\n    }\n\n    const { firstPoint } = highlightOutlines;\n    this.#firstPoint = [\n      (firstPoint[0] - x) / width,\n      (firstPoint[1] - y) / height,\n    ];\n    const { lastPoint } = this.#focusOutlines;\n    this.#lastPoint = [(lastPoint[0] - x) / width, (lastPoint[1] - y) / height];\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n    HighlightEditor._defaultColor ||=\n      uiManager.highlightColors?.values().next().value || \"#fff066\";\n  }\n\n  /** @inheritdoc */\n  static updateDefaultParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.HIGHLIGHT_COLOR:\n        HighlightEditor._defaultColor = value;\n        break;\n      case AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:\n        HighlightEditor._defaultThickness = value;\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  translateInPage(x, y) {}\n\n  /** @inheritdoc */\n  get toolbarPosition() {\n    return this.#lastPoint;\n  }\n\n  /** @inheritdoc */\n  get commentButtonPosition() {\n    return this.#firstPoint;\n  }\n\n  /** @inheritdoc */\n  updateParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.HIGHLIGHT_COLOR:\n        this.#updateColor(value);\n        break;\n      case AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:\n        this.#updateThickness(value);\n        break;\n    }\n  }\n\n  static get defaultPropertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_COLOR,\n        HighlightEditor._defaultColor,\n      ],\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,\n        HighlightEditor._defaultThickness,\n      ],\n    ];\n  }\n\n  /** @inheritdoc */\n  get propertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_COLOR,\n        this.color || HighlightEditor._defaultColor,\n      ],\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,\n        this.#thickness || HighlightEditor._defaultThickness,\n      ],\n      [AnnotationEditorParamsType.HIGHLIGHT_FREE, this.#isFreeHighlight],\n    ];\n  }\n\n  /** @inheritdoc */\n  onUpdatedColor() {\n    this.parent?.drawLayer.updateProperties(this.#id, {\n      root: {\n        fill: this.color,\n        \"fill-opacity\": this.opacity,\n      },\n    });\n    this.#colorPicker?.updateColor(this.color);\n    super.onUpdatedColor();\n  }\n\n  /**\n   * Update the color and make this action undoable.\n   * @param {string} color\n   */\n  #updateColor(color) {\n    const setColorAndOpacity = (col, opa) => {\n      this.color = col;\n      this.opacity = opa;\n      this.onUpdatedColor();\n    };\n    const savedColor = this.color;\n    const savedOpacity = this.opacity;\n    this.addCommands({\n      cmd: setColorAndOpacity.bind(\n        this,\n        color,\n        HighlightEditor._defaultOpacity\n      ),\n      undo: setColorAndOpacity.bind(this, savedColor, savedOpacity),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.HIGHLIGHT_COLOR,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n\n    this._reportTelemetry(\n      {\n        action: \"color_changed\",\n        color: this._uiManager.getNonHCMColorName(color),\n      },\n      /* mustWait = */ true\n    );\n  }\n\n  /**\n   * Update the thickness and make this action undoable.\n   * @param {number} thickness\n   */\n  #updateThickness(thickness) {\n    const savedThickness = this.#thickness;\n    const setThickness = th => {\n      this.#thickness = th;\n      this.#changeThickness(th);\n    };\n    this.addCommands({\n      cmd: setThickness.bind(this, thickness),\n      undo: setThickness.bind(this, savedThickness),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.INK_THICKNESS,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n    this._reportTelemetry(\n      { action: \"thickness_changed\", thickness },\n      /* mustWait = */ true\n    );\n  }\n\n  /** @inheritdoc */\n  get toolbarButtons() {\n    if (this._uiManager.highlightColors) {\n      const colorPicker = (this.#colorPicker = new ColorPicker({\n        editor: this,\n      }));\n      return [[\"colorPicker\", colorPicker]];\n    }\n    return super.toolbarButtons;\n  }\n\n  /** @inheritdoc */\n  disableEditing() {\n    super.disableEditing();\n    this.div.classList.toggle(\"disabled\", true);\n  }\n\n  /** @inheritdoc */\n  enableEditing() {\n    super.enableEditing();\n    this.div.classList.toggle(\"disabled\", false);\n  }\n\n  /** @inheritdoc */\n  fixAndSetPosition() {\n    return super.fixAndSetPosition(this.#getRotation());\n  }\n\n  /** @inheritdoc */\n  getBaseTranslation() {\n    // The editor itself doesn't have any CSS border (we're drawing one\n    // ourselves in using SVG).\n    return [0, 0];\n  }\n\n  /** @inheritdoc */\n  getRect(tx, ty) {\n    return super.getRect(tx, ty, this.#getRotation());\n  }\n\n  /** @inheritdoc */\n  onceAdded(focus) {\n    if (!this.annotationElementId) {\n      this.parent.addUndoableEditor(this);\n    }\n    if (focus) {\n      this.div.focus();\n    }\n  }\n\n  /** @inheritdoc */\n  remove() {\n    this.#cleanDrawLayer();\n    this._reportTelemetry({\n      action: \"deleted\",\n    });\n    super.remove();\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    this.#addToDrawLayer();\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilding it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  setParent(parent) {\n    let mustBeSelected = false;\n    if (this.parent && !parent) {\n      this.#cleanDrawLayer();\n    } else if (parent) {\n      this.#addToDrawLayer(parent);\n      // If mustBeSelected is true it means that this editor was selected\n      // when its parent has been destroyed, hence we must select it again.\n      mustBeSelected =\n        !this.parent && this.div?.classList.contains(\"selectedEditor\");\n    }\n    super.setParent(parent);\n    this.show(this._isVisible);\n    if (mustBeSelected) {\n      // We select it after the parent has been set.\n      this.select();\n    }\n  }\n\n  #changeThickness(thickness) {\n    if (!this.#isFreeHighlight) {\n      return;\n    }\n    this.#createFreeOutlines({\n      highlightOutlines: this.#highlightOutlines.getNewOutline(thickness / 2),\n    });\n    this.fixAndSetPosition();\n    this.setDims();\n  }\n\n  #cleanDrawLayer() {\n    if (this.#id === null || !this.parent) {\n      return;\n    }\n    this.parent.drawLayer.remove(this.#id);\n    this.#id = null;\n    this.parent.drawLayer.remove(this.#outlineId);\n    this.#outlineId = null;\n  }\n\n  #addToDrawLayer(parent = this.parent) {\n    if (this.#id !== null) {\n      return;\n    }\n    ({ id: this.#id, clipPathId: this.#clipPathId } = parent.drawLayer.draw(\n      {\n        bbox: this.#highlightOutlines.box,\n        root: {\n          viewBox: \"0 0 1 1\",\n          fill: this.color,\n          \"fill-opacity\": this.opacity,\n        },\n        rootClass: {\n          highlight: true,\n          free: this.#isFreeHighlight,\n        },\n        path: {\n          d: this.#highlightOutlines.toSVGPath(),\n        },\n      },\n      /* isPathUpdatable = */ false,\n      /* hasClip = */ true\n    ));\n    this.#outlineId = parent.drawLayer.drawOutline(\n      {\n        rootClass: {\n          highlightOutline: true,\n          free: this.#isFreeHighlight,\n        },\n        bbox: this.#focusOutlines.box,\n        path: {\n          d: this.#focusOutlines.toSVGPath(),\n        },\n      },\n      /* mustRemoveSelfIntersections = */ this.#isFreeHighlight\n    );\n\n    if (this.#highlightDiv) {\n      this.#highlightDiv.style.clipPath = this.#clipPathId;\n    }\n  }\n\n  static #rotateBbox([x, y, width, height], angle) {\n    switch (angle) {\n      case 90:\n        return [1 - y - height, x, height, width];\n      case 180:\n        return [1 - x - width, 1 - y - height, width, height];\n      case 270:\n        return [y, 1 - x - width, height, width];\n    }\n    return [x, y, width, height];\n  }\n\n  /** @inheritdoc */\n  rotate(angle) {\n    // We need to rotate the svgs because of the coordinates system.\n    const { drawLayer } = this.parent;\n    let box;\n    if (this.#isFreeHighlight) {\n      angle = (angle - this.rotation + 360) % 360;\n      box = HighlightEditor.#rotateBbox(this.#highlightOutlines.box, angle);\n    } else {\n      // An highlight annotation is always drawn horizontally.\n      box = HighlightEditor.#rotateBbox(\n        [this.x, this.y, this.width, this.height],\n        angle\n      );\n    }\n    drawLayer.updateProperties(this.#id, {\n      bbox: box,\n      root: {\n        \"data-main-rotation\": angle,\n      },\n    });\n    drawLayer.updateProperties(this.#outlineId, {\n      bbox: HighlightEditor.#rotateBbox(this.#focusOutlines.box, angle),\n      root: {\n        \"data-main-rotation\": angle,\n      },\n    });\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    const div = super.render();\n    if (this.#text) {\n      div.setAttribute(\"aria-label\", this.#text);\n      div.setAttribute(\"role\", \"mark\");\n    }\n    if (this.#isFreeHighlight) {\n      div.classList.add(\"free\");\n    } else {\n      this.div.addEventListener(\"keydown\", this.#keydown.bind(this), {\n        signal: this._uiManager._signal,\n      });\n    }\n    const highlightDiv = (this.#highlightDiv = document.createElement(\"div\"));\n    div.append(highlightDiv);\n    highlightDiv.setAttribute(\"aria-hidden\", \"true\");\n    highlightDiv.className = \"internal\";\n    highlightDiv.style.clipPath = this.#clipPathId;\n    this.setDims();\n\n    bindEvents(this, this.#highlightDiv, [\"pointerover\", \"pointerleave\"]);\n    this.enableEditing();\n\n    return div;\n  }\n\n  pointerover() {\n    if (!this.isSelected) {\n      this.parent?.drawLayer.updateProperties(this.#outlineId, {\n        rootClass: {\n          hovered: true,\n        },\n      });\n    }\n  }\n\n  pointerleave() {\n    if (!this.isSelected) {\n      this.parent?.drawLayer.updateProperties(this.#outlineId, {\n        rootClass: {\n          hovered: false,\n        },\n      });\n    }\n  }\n\n  #keydown(event) {\n    HighlightEditor._keyboardManager.exec(this, event);\n  }\n\n  _moveCaret(direction) {\n    this.parent.unselect(this);\n    switch (direction) {\n      case 0 /* left */:\n      case 2 /* up */:\n        this.#setCaret(/* start = */ true);\n        break;\n      case 1 /* right */:\n      case 3 /* down */:\n        this.#setCaret(/* start = */ false);\n        break;\n    }\n  }\n\n  #setCaret(start) {\n    if (!this.#anchorNode) {\n      return;\n    }\n    const selection = window.getSelection();\n    if (start) {\n      selection.setPosition(this.#anchorNode, this.#anchorOffset);\n    } else {\n      selection.setPosition(this.#focusNode, this.#focusOffset);\n    }\n  }\n\n  /** @inheritdoc */\n  select() {\n    super.select();\n    if (!this.#outlineId) {\n      return;\n    }\n    this.parent?.drawLayer.updateProperties(this.#outlineId, {\n      rootClass: {\n        hovered: false,\n        selected: true,\n      },\n    });\n  }\n\n  /** @inheritdoc */\n  unselect() {\n    super.unselect();\n    if (!this.#outlineId) {\n      return;\n    }\n    this.parent?.drawLayer.updateProperties(this.#outlineId, {\n      rootClass: {\n        selected: false,\n      },\n    });\n    if (!this.#isFreeHighlight) {\n      this.#setCaret(/* start = */ false);\n    }\n  }\n\n  /** @inheritdoc */\n  get _mustFixPosition() {\n    return !this.#isFreeHighlight;\n  }\n\n  /** @inheritdoc */\n  show(visible = this._isVisible) {\n    super.show(visible);\n    if (this.parent) {\n      this.parent.drawLayer.updateProperties(this.#id, {\n        rootClass: {\n          hidden: !visible,\n        },\n      });\n      this.parent.drawLayer.updateProperties(this.#outlineId, {\n        rootClass: {\n          hidden: !visible,\n        },\n      });\n    }\n  }\n\n  #getRotation() {\n    // Highlight annotations are always drawn horizontally but if\n    // a free highlight annotation can be rotated.\n    return this.#isFreeHighlight ? this.rotation : 0;\n  }\n\n  #serializeBoxes() {\n    if (this.#isFreeHighlight) {\n      return null;\n    }\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const [pageX, pageY] = this.pageTranslation;\n    const boxes = this.#boxes;\n    const quadPoints = new Float32Array(boxes.length * 8);\n    let i = 0;\n    for (const { x, y, width, height } of boxes) {\n      const sx = x * pageWidth + pageX;\n      const sy = (1 - y) * pageHeight + pageY;\n      // Serializes the rectangle in the Adobe Acrobat format.\n      // The rectangle's coordinates (b = bottom, t = top, L = left, R = right)\n      // are ordered as follows: tL, tR, bL, bR (bL origin).\n      quadPoints[i] = quadPoints[i + 4] = sx;\n      quadPoints[i + 1] = quadPoints[i + 3] = sy;\n      quadPoints[i + 2] = quadPoints[i + 6] = sx + width * pageWidth;\n      quadPoints[i + 5] = quadPoints[i + 7] = sy - height * pageHeight;\n      i += 8;\n    }\n    return quadPoints;\n  }\n\n  #serializeOutlines(rect) {\n    return this.#highlightOutlines.serialize(rect, this.#getRotation());\n  }\n\n  static startHighlighting(parent, isLTR, { target: textLayer, x, y }) {\n    const {\n      x: layerX,\n      y: layerY,\n      width: parentWidth,\n      height: parentHeight,\n    } = textLayer.getBoundingClientRect();\n\n    const ac = new AbortController();\n    const signal = parent.combinedSignal(ac);\n\n    const pointerUpCallback = e => {\n      ac.abort();\n      this.#endHighlight(parent, e);\n    };\n    window.addEventListener(\"blur\", pointerUpCallback, { signal });\n    window.addEventListener(\"pointerup\", pointerUpCallback, { signal });\n    window.addEventListener(\n      \"pointerdown\",\n      stopEvent /* Avoid to have undesired clicks during the drawing. */,\n      {\n        capture: true,\n        passive: false,\n        signal,\n      }\n    );\n    window.addEventListener(\"contextmenu\", noContextMenu, { signal });\n\n    textLayer.addEventListener(\n      \"pointermove\",\n      this.#highlightMove.bind(this, parent),\n      { signal }\n    );\n    this._freeHighlight = new FreeHighlightOutliner(\n      { x, y },\n      [layerX, layerY, parentWidth, parentHeight],\n      parent.scale,\n      this._defaultThickness / 2,\n      isLTR,\n      /* innerMargin = */ 0.001\n    );\n    ({ id: this._freeHighlightId, clipPathId: this._freeHighlightClipId } =\n      parent.drawLayer.draw(\n        {\n          bbox: [0, 0, 1, 1],\n          root: {\n            viewBox: \"0 0 1 1\",\n            fill: this._defaultColor,\n            \"fill-opacity\": this._defaultOpacity,\n          },\n          rootClass: {\n            highlight: true,\n            free: true,\n          },\n          path: {\n            d: this._freeHighlight.toSVGPath(),\n          },\n        },\n        /* isPathUpdatable = */ true,\n        /* hasClip = */ true\n      ));\n  }\n\n  static #highlightMove(parent, event) {\n    if (this._freeHighlight.add(event)) {\n      // Redraw only if the point has been added.\n      parent.drawLayer.updateProperties(this._freeHighlightId, {\n        path: {\n          d: this._freeHighlight.toSVGPath(),\n        },\n      });\n    }\n  }\n\n  static #endHighlight(parent, event) {\n    if (!this._freeHighlight.isEmpty()) {\n      parent.createAndAddNewEditor(event, false, {\n        highlightId: this._freeHighlightId,\n        highlightOutlines: this._freeHighlight.getOutlines(),\n        clipPathId: this._freeHighlightClipId,\n        methodOfCreation: \"main_toolbar\",\n      });\n    } else {\n      parent.drawLayer.remove(this._freeHighlightId);\n    }\n    this._freeHighlightId = -1;\n    this._freeHighlight = null;\n    this._freeHighlightClipId = \"\";\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    let initialData = null;\n    if (data instanceof HighlightAnnotationElement) {\n      const {\n        data: {\n          quadPoints,\n          rect,\n          rotation,\n          id,\n          color,\n          opacity,\n          popupRef,\n          richText,\n          contentsObj,\n          creationDate,\n          modificationDate,\n        },\n        parent: {\n          page: { pageNumber },\n        },\n      } = data;\n      initialData = data = {\n        annotationType: AnnotationEditorType.HIGHLIGHT,\n        color: Array.from(color),\n        opacity,\n        quadPoints,\n        boxes: null,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        annotationElementId: id,\n        id,\n        deleted: false,\n        popupRef,\n        richText,\n        comment: contentsObj?.str || null,\n        creationDate,\n        modificationDate,\n      };\n    } else if (data instanceof InkAnnotationElement) {\n      const {\n        data: {\n          inkLists,\n          rect,\n          rotation,\n          id,\n          color,\n          borderStyle: { rawWidth: thickness },\n          popupRef,\n          richText,\n          contentsObj,\n          creationDate,\n          modificationDate,\n        },\n        parent: {\n          page: { pageNumber },\n        },\n      } = data;\n      initialData = data = {\n        annotationType: AnnotationEditorType.HIGHLIGHT,\n        color: Array.from(color),\n        thickness,\n        inkLists,\n        boxes: null,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        annotationElementId: id,\n        id,\n        deleted: false,\n        popupRef,\n        richText,\n        comment: contentsObj?.str || null,\n        creationDate,\n        modificationDate,\n      };\n    }\n\n    const { color, quadPoints, inkLists, opacity } = data;\n    const editor = await super.deserialize(data, parent, uiManager);\n\n    editor.color = Util.makeHexColor(...color);\n    editor.opacity = opacity || 1;\n    if (inkLists) {\n      editor.#thickness = data.thickness;\n    }\n    editor._initialData = initialData;\n    if (data.comment) {\n      editor.setCommentData(data);\n    }\n\n    const [pageWidth, pageHeight] = editor.pageDimensions;\n    const [pageX, pageY] = editor.pageTranslation;\n\n    if (quadPoints) {\n      const boxes = (editor.#boxes = []);\n      for (let i = 0; i < quadPoints.length; i += 8) {\n        boxes.push({\n          x: (quadPoints[i] - pageX) / pageWidth,\n          y: 1 - (quadPoints[i + 1] - pageY) / pageHeight,\n          width: (quadPoints[i + 2] - quadPoints[i]) / pageWidth,\n          height: (quadPoints[i + 1] - quadPoints[i + 5]) / pageHeight,\n        });\n      }\n      editor.#createOutlines();\n      editor.#addToDrawLayer();\n      editor.rotate(editor.rotation);\n    } else if (inkLists) {\n      editor.#isFreeHighlight = true;\n      const points = inkLists[0];\n      const point = {\n        x: points[0] - pageX,\n        y: pageHeight - (points[1] - pageY),\n      };\n      const outliner = new FreeHighlightOutliner(\n        point,\n        [0, 0, pageWidth, pageHeight],\n        1,\n        editor.#thickness / 2,\n        true,\n        0.001\n      );\n      for (let i = 0, ii = points.length; i < ii; i += 2) {\n        point.x = points[i] - pageX;\n        point.y = pageHeight - (points[i + 1] - pageY);\n        outliner.add(point);\n      }\n      const { id, clipPathId } = parent.drawLayer.draw(\n        {\n          bbox: [0, 0, 1, 1],\n          root: {\n            viewBox: \"0 0 1 1\",\n            fill: editor.color,\n            \"fill-opacity\": editor._defaultOpacity,\n          },\n          rootClass: {\n            highlight: true,\n            free: true,\n          },\n          path: {\n            d: outliner.toSVGPath(),\n          },\n        },\n        /* isPathUpdatable = */ true,\n        /* hasClip = */ true\n      );\n      editor.#createFreeOutlines({\n        highlightOutlines: outliner.getOutlines(),\n        highlightId: id,\n        clipPathId,\n      });\n      editor.#addToDrawLayer();\n      editor.rotate(editor.parentRotation);\n    }\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    // It doesn't make sense to copy/paste a highlight annotation.\n    if (this.isEmpty() || isForCopying) {\n      return null;\n    }\n\n    if (this.deleted) {\n      return this.serializeDeleted();\n    }\n\n    const color = AnnotationEditor._colorManager.convert(\n      this._uiManager.getNonHCMColor(this.color)\n    );\n    const serialized = super.serialize(isForCopying);\n    Object.assign(serialized, {\n      color,\n      opacity: this.opacity,\n      thickness: this.#thickness,\n      quadPoints: this.#serializeBoxes(),\n      outlines: this.#serializeOutlines(serialized.rect),\n    });\n    this.addComment(serialized);\n\n    if (this.annotationElementId && !this.#hasElementChanged(serialized)) {\n      return null;\n    }\n\n    serialized.id = this.annotationElementId;\n    return serialized;\n  }\n\n  #hasElementChanged(serialized) {\n    const { color } = this._initialData;\n    return (\n      this.hasEditedComment || serialized.color.some((c, i) => c !== color[i])\n    );\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    if (this.deleted) {\n      annotation.hide();\n      return null;\n    }\n    annotation.updateEdited({\n      rect: this.getPDFRect(),\n      popup: this.comment,\n    });\n\n    return null;\n  }\n\n  static canCreateNewEmptyEditor() {\n    return false;\n  }\n}\n\nexport { HighlightEditor };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorParamsType, unreachable } from \"../../shared/util.js\";\nimport { noContextMenu, stopEvent } from \"../display_utils.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { CurrentPointers } from \"./tools.js\";\n\nclass DrawingOptions {\n  #svgProperties = Object.create(null);\n\n  updateProperty(name, value) {\n    this[name] = value;\n    this.updateSVGProperty(name, value);\n  }\n\n  updateProperties(properties) {\n    if (!properties) {\n      return;\n    }\n    for (const [name, value] of Object.entries(properties)) {\n      if (!name.startsWith(\"_\")) {\n        this.updateProperty(name, value);\n      }\n    }\n  }\n\n  updateSVGProperty(name, value) {\n    this.#svgProperties[name] = value;\n  }\n\n  toSVGProperties() {\n    const root = this.#svgProperties;\n    this.#svgProperties = Object.create(null);\n    return { root };\n  }\n\n  reset() {\n    this.#svgProperties = Object.create(null);\n  }\n\n  updateAll(options = this) {\n    this.updateProperties(options);\n  }\n\n  clone() {\n    unreachable(\"Not implemented\");\n  }\n}\n\n/**\n * Basic draw editor.\n */\nclass DrawingEditor extends AnnotationEditor {\n  #drawOutlines = null;\n\n  #mustBeCommitted;\n\n  _colorPicker = null;\n\n  _drawId = null;\n\n  static _currentDrawId = -1;\n\n  static _currentParent = null;\n\n  static #currentDraw = null;\n\n  static #currentDrawingAC = null;\n\n  static #currentDrawingOptions = null;\n\n  static _INNER_MARGIN = 3;\n\n  constructor(params) {\n    super(params);\n    this.#mustBeCommitted = params.mustBeCommitted || false;\n\n    this._addOutlines(params);\n  }\n\n  /** @inheritdoc */\n  onUpdatedColor() {\n    this._colorPicker?.update(this.color);\n    super.onUpdatedColor();\n  }\n\n  _addOutlines(params) {\n    if (params.drawOutlines) {\n      this.#createDrawOutlines(params);\n      this.#addToDrawLayer();\n    }\n  }\n\n  #createDrawOutlines({ drawOutlines, drawId, drawingOptions }) {\n    this.#drawOutlines = drawOutlines;\n    this._drawingOptions ||= drawingOptions;\n    if (!this.annotationElementId) {\n      this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`);\n    }\n\n    if (drawId >= 0) {\n      this._drawId = drawId;\n      // We need to redraw the drawing because we changed the coordinates to be\n      // in the box coordinate system.\n      this.parent.drawLayer.finalizeDraw(\n        drawId,\n        drawOutlines.defaultProperties\n      );\n    } else {\n      // We create a new drawing.\n      this._drawId = this.#createDrawing(drawOutlines, this.parent);\n    }\n\n    this.#updateBbox(drawOutlines.box);\n  }\n\n  #createDrawing(drawOutlines, parent) {\n    const { id } = parent.drawLayer.draw(\n      DrawingEditor._mergeSVGProperties(\n        this._drawingOptions.toSVGProperties(),\n        drawOutlines.defaultSVGProperties\n      ),\n      /* isPathUpdatable = */ false,\n      /* hasClip = */ false\n    );\n    return id;\n  }\n\n  static _mergeSVGProperties(p1, p2) {\n    const p1Keys = new Set(Object.keys(p1));\n\n    for (const [key, value] of Object.entries(p2)) {\n      if (p1Keys.has(key)) {\n        Object.assign(p1[key], value);\n      } else {\n        p1[key] = value;\n      }\n    }\n    return p1;\n  }\n\n  /**\n   * @param {Object} options\n   * @return {DrawingOptions} the default options to use for a new editor.\n   */\n  static getDefaultDrawingOptions(_options) {\n    unreachable(\"Not implemented\");\n  }\n\n  /**\n   * @return {Map<AnnotationEditorParamsType, string>} a map between the\n   *   parameter types and the name of the options.\n   */\n  // eslint-disable-next-line getter-return\n  static get typesMap() {\n    unreachable(\"Not implemented\");\n  }\n\n  static get isDrawer() {\n    return true;\n  }\n\n  /**\n   * @returns {boolean} `true` if several drawings can be added to the\n   * annotation.\n   */\n  static get supportMultipleDrawings() {\n    return false;\n  }\n\n  /** @inheritdoc */\n  static updateDefaultParams(type, value) {\n    const propertyName = this.typesMap.get(type);\n    if (propertyName) {\n      this._defaultDrawingOptions.updateProperty(propertyName, value);\n    }\n    if (this._currentParent) {\n      DrawingEditor.#currentDraw.updateProperty(propertyName, value);\n      this._currentParent.drawLayer.updateProperties(\n        this._currentDrawId,\n        this._defaultDrawingOptions.toSVGProperties()\n      );\n    }\n  }\n\n  /** @inheritdoc */\n  updateParams(type, value) {\n    const propertyName = this.constructor.typesMap.get(type);\n    if (propertyName) {\n      this._updateProperty(type, propertyName, value);\n    }\n  }\n\n  /** @inheritdoc */\n  static get defaultPropertiesToUpdate() {\n    const properties = [];\n    const options = this._defaultDrawingOptions;\n    for (const [type, name] of this.typesMap) {\n      properties.push([type, options[name]]);\n    }\n    return properties;\n  }\n\n  /** @inheritdoc */\n  get propertiesToUpdate() {\n    const properties = [];\n    const { _drawingOptions } = this;\n    for (const [type, name] of this.constructor.typesMap) {\n      properties.push([type, _drawingOptions[name]]);\n    }\n    return properties;\n  }\n\n  /**\n   * Update a property and make this action undoable.\n   * @param {string} color\n   */\n  _updateProperty(type, name, value) {\n    const options = this._drawingOptions;\n    const savedValue = options[name];\n    const setter = val => {\n      options.updateProperty(name, val);\n      const bbox = this.#drawOutlines.updateProperty(name, val);\n      if (bbox) {\n        this.#updateBbox(bbox);\n      }\n      this.parent?.drawLayer.updateProperties(\n        this._drawId,\n        options.toSVGProperties()\n      );\n      if (type === this.colorType) {\n        this.onUpdatedColor();\n      }\n    };\n    this.addCommands({\n      cmd: setter.bind(this, value),\n      undo: setter.bind(this, savedValue),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /** @inheritdoc */\n  _onResizing() {\n    this.parent?.drawLayer.updateProperties(\n      this._drawId,\n      DrawingEditor._mergeSVGProperties(\n        this.#drawOutlines.getPathResizingSVGProperties(\n          this.#convertToDrawSpace()\n        ),\n        {\n          bbox: this.#rotateBox(),\n        }\n      )\n    );\n  }\n\n  /** @inheritdoc */\n  _onResized() {\n    this.parent?.drawLayer.updateProperties(\n      this._drawId,\n      DrawingEditor._mergeSVGProperties(\n        this.#drawOutlines.getPathResizedSVGProperties(\n          this.#convertToDrawSpace()\n        ),\n        {\n          bbox: this.#rotateBox(),\n        }\n      )\n    );\n  }\n\n  /** @inheritdoc */\n  _onTranslating(_x, _y) {\n    this.parent?.drawLayer.updateProperties(this._drawId, {\n      bbox: this.#rotateBox(),\n    });\n  }\n\n  /** @inheritdoc */\n  _onTranslated() {\n    this.parent?.drawLayer.updateProperties(\n      this._drawId,\n      DrawingEditor._mergeSVGProperties(\n        this.#drawOutlines.getPathTranslatedSVGProperties(\n          this.#convertToDrawSpace(),\n          this.parentDimensions\n        ),\n        {\n          bbox: this.#rotateBox(),\n        }\n      )\n    );\n  }\n\n  _onStartDragging() {\n    this.parent?.drawLayer.updateProperties(this._drawId, {\n      rootClass: {\n        moving: true,\n      },\n    });\n  }\n\n  _onStopDragging() {\n    this.parent?.drawLayer.updateProperties(this._drawId, {\n      rootClass: {\n        moving: false,\n      },\n    });\n  }\n\n  /** @inheritdoc */\n  commit() {\n    super.commit();\n\n    this.disableEditMode();\n    this.disableEditing();\n  }\n\n  /** @inheritdoc */\n  disableEditing() {\n    super.disableEditing();\n    this.div.classList.toggle(\"disabled\", true);\n  }\n\n  /** @inheritdoc */\n  enableEditing() {\n    super.enableEditing();\n    this.div.classList.toggle(\"disabled\", false);\n  }\n\n  /** @inheritdoc */\n  getBaseTranslation() {\n    // The editor itself doesn't have any CSS border (we're drawing one\n    // ourselves in using SVG).\n    return [0, 0];\n  }\n\n  /** @inheritdoc */\n  get isResizable() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  onceAdded(focus) {\n    if (!this.annotationElementId) {\n      this.parent.addUndoableEditor(this);\n    }\n    this._isDraggable = true;\n    if (this.#mustBeCommitted) {\n      this.#mustBeCommitted = false;\n      this.commit();\n      this.parent.setSelected(this);\n      if (focus && this.isOnScreen) {\n        this.div.focus();\n      }\n    }\n  }\n\n  /** @inheritdoc */\n  remove() {\n    this.#cleanDrawLayer();\n    super.remove();\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    this.#addToDrawLayer();\n    this.#updateBbox(this.#drawOutlines.box);\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilding it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  setParent(parent) {\n    let mustBeSelected = false;\n    if (this.parent && !parent) {\n      this._uiManager.removeShouldRescale(this);\n      this.#cleanDrawLayer();\n    } else if (parent) {\n      this._uiManager.addShouldRescale(this);\n      this.#addToDrawLayer(parent);\n      // If mustBeSelected is true it means that this editor was selected\n      // when its parent has been destroyed, hence we must select it again.\n      mustBeSelected =\n        !this.parent && this.div?.classList.contains(\"selectedEditor\");\n    }\n    super.setParent(parent);\n    if (mustBeSelected) {\n      // We select it after the parent has been set.\n      this.select();\n    }\n  }\n\n  #cleanDrawLayer() {\n    if (this._drawId === null || !this.parent) {\n      return;\n    }\n    this.parent.drawLayer.remove(this._drawId);\n    this._drawId = null;\n\n    // All the SVG properties must be reset in order to make it possible to\n    // undo.\n    this._drawingOptions.reset();\n  }\n\n  #addToDrawLayer(parent = this.parent) {\n    if (this._drawId !== null && this.parent === parent) {\n      return;\n    }\n    if (this._drawId !== null) {\n      // The parent has changed, we need to move the drawing to the new parent.\n      this.parent.drawLayer.updateParent(this._drawId, parent.drawLayer);\n      return;\n    }\n    this._drawingOptions.updateAll();\n    this._drawId = this.#createDrawing(this.#drawOutlines, parent);\n  }\n\n  #convertToParentSpace([x, y, width, height]) {\n    const {\n      parentDimensions: [pW, pH],\n      rotation,\n    } = this;\n    switch (rotation) {\n      case 90:\n        return [y, 1 - x, width * (pH / pW), height * (pW / pH)];\n      case 180:\n        return [1 - x, 1 - y, width, height];\n      case 270:\n        return [1 - y, x, width * (pH / pW), height * (pW / pH)];\n      default:\n        return [x, y, width, height];\n    }\n  }\n\n  #convertToDrawSpace() {\n    const {\n      x,\n      y,\n      width,\n      height,\n      parentDimensions: [pW, pH],\n      rotation,\n    } = this;\n    switch (rotation) {\n      case 90:\n        return [1 - y, x, width * (pW / pH), height * (pH / pW)];\n      case 180:\n        return [1 - x, 1 - y, width, height];\n      case 270:\n        return [y, 1 - x, width * (pW / pH), height * (pH / pW)];\n      default:\n        return [x, y, width, height];\n    }\n  }\n\n  #updateBbox(bbox) {\n    [this.x, this.y, this.width, this.height] =\n      this.#convertToParentSpace(bbox);\n    if (this.div) {\n      this.fixAndSetPosition();\n      this.setDims();\n    }\n    this._onResized();\n  }\n\n  #rotateBox() {\n    // We've to deal with two rotations: the rotation of the annotation and the\n    // rotation of the parent page.\n    // When the page is rotated, all the layers are just rotated thanks to CSS\n    // but there is a notable exception: the canvas wrapper.\n    // The canvas wrapper is not rotated but the dimensions are (or not) swapped\n    // and the page is redrawn with the rotation applied to the canvas.\n    // The drawn layer is under the canvas wrapper and is not rotated so we have\n    // to \"manually\" rotate the coordinates.\n    //\n    // The coordinates (this.x, this.y) correspond to the top-left corner of\n    // the editor after it has been rotated in the page coordinate system.\n\n    const {\n      x,\n      y,\n      width,\n      height,\n      rotation,\n      parentRotation,\n      parentDimensions: [pW, pH],\n    } = this;\n    switch ((rotation * 4 + parentRotation) / 90) {\n      case 1:\n        // 0 -> 90\n        return [1 - y - height, x, height, width];\n      case 2:\n        // 0 -> 180\n        return [1 - x - width, 1 - y - height, width, height];\n      case 3:\n        // 0 -> 270\n        return [y, 1 - x - width, height, width];\n      case 4:\n        // 90 -> 0\n        return [\n          x,\n          y - width * (pW / pH),\n          height * (pH / pW),\n          width * (pW / pH),\n        ];\n      case 5:\n        // 90 -> 90\n        return [1 - y, x, width * (pW / pH), height * (pH / pW)];\n      case 6:\n        // 90 -> 180\n        return [\n          1 - x - height * (pH / pW),\n          1 - y,\n          height * (pH / pW),\n          width * (pW / pH),\n        ];\n      case 7:\n        // 90 -> 270\n        return [\n          y - width * (pW / pH),\n          1 - x - height * (pH / pW),\n          width * (pW / pH),\n          height * (pH / pW),\n        ];\n      case 8:\n        // 180 -> 0\n        return [x - width, y - height, width, height];\n      case 9:\n        // 180 -> 90\n        return [1 - y, x - width, height, width];\n      case 10:\n        // 180 -> 180\n        return [1 - x, 1 - y, width, height];\n      case 11:\n        // 180 -> 270\n        return [y - height, 1 - x, height, width];\n      case 12:\n        // 270 -> 0\n        return [\n          x - height * (pH / pW),\n          y,\n          height * (pH / pW),\n          width * (pW / pH),\n        ];\n      case 13:\n        // 270 -> 90\n        return [\n          1 - y - width * (pW / pH),\n          x - height * (pH / pW),\n          width * (pW / pH),\n          height * (pH / pW),\n        ];\n      case 14:\n        // 270 -> 180\n        return [\n          1 - x,\n          1 - y - width * (pW / pH),\n          height * (pH / pW),\n          width * (pW / pH),\n        ];\n      case 15:\n        // 270 -> 270\n        return [y, 1 - x, width * (pW / pH), height * (pH / pW)];\n      default:\n        // 0 -> 0\n        return [x, y, width, height];\n    }\n  }\n\n  /** @inheritdoc */\n  rotate() {\n    if (!this.parent) {\n      return;\n    }\n    this.parent.drawLayer.updateProperties(\n      this._drawId,\n      DrawingEditor._mergeSVGProperties(\n        {\n          bbox: this.#rotateBox(),\n        },\n        this.#drawOutlines.updateRotation(\n          (this.parentRotation - this.rotation + 360) % 360\n        )\n      )\n    );\n  }\n\n  onScaleChanging() {\n    if (!this.parent) {\n      return;\n    }\n    this.#updateBbox(\n      this.#drawOutlines.updateParentDimensions(\n        this.parentDimensions,\n        this.parent.scale\n      )\n    );\n  }\n\n  static onScaleChangingWhenDrawing() {}\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    if (this._isCopy) {\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    const div = super.render();\n    div.classList.add(\"draw\");\n\n    const drawDiv = document.createElement(\"div\");\n    div.append(drawDiv);\n    drawDiv.setAttribute(\"aria-hidden\", \"true\");\n    drawDiv.className = \"internal\";\n    this.setDims();\n    this._uiManager.addShouldRescale(this);\n    this.disableEditing();\n\n    if (this._isCopy) {\n      this._moveAfterPaste(baseX, baseY);\n    }\n\n    return div;\n  }\n\n  /**\n   * Create a new drawer instance.\n   * @param {number} x - The x coordinate of the event.\n   * @param {number} y - The y coordinate of the event.\n   * @param {number} parentWidth - The parent width.\n   * @param {number} parentHeight - The parent height.\n   * @param {number} rotation - The parent rotation.\n   */\n  static createDrawerInstance(_x, _y, _parentWidth, _parentHeight, _rotation) {\n    unreachable(\"Not implemented\");\n  }\n\n  static startDrawing(parent, uiManager, _isLTR, event) {\n    // The pointerType of CurrentPointer is set when the user starts an empty\n    // drawing session. If, in the same drawing session, the user starts using a\n    // different type of pointer (e.g. a pen and then a finger), we just return.\n    //\n    // If the user starts to draw with a finger and then uses a second finger,\n    // we just stop the current drawing and let the user zoom the document.\n\n    const { target, offsetX: x, offsetY: y, pointerId, pointerType } = event;\n    if (CurrentPointers.isInitializedAndDifferentPointerType(pointerType)) {\n      return;\n    }\n\n    const {\n      viewport: { rotation },\n    } = parent;\n    const { width: parentWidth, height: parentHeight } =\n      target.getBoundingClientRect();\n\n    const ac = (DrawingEditor.#currentDrawingAC = new AbortController());\n    const signal = parent.combinedSignal(ac);\n\n    CurrentPointers.setPointer(pointerType, pointerId);\n\n    window.addEventListener(\n      \"pointerup\",\n      e => {\n        if (CurrentPointers.isSamePointerIdOrRemove(e.pointerId)) {\n          this._endDraw(e);\n        }\n      },\n      { signal }\n    );\n    window.addEventListener(\n      \"pointercancel\",\n      e => {\n        if (CurrentPointers.isSamePointerIdOrRemove(e.pointerId)) {\n          this._currentParent.endDrawingSession();\n        }\n      },\n      { signal }\n    );\n    window.addEventListener(\n      \"pointerdown\",\n      e => {\n        if (!CurrentPointers.isSamePointerType(e.pointerType)) {\n          // For example, we started with a pen and the user\n          // is now using a finger.\n          return;\n        }\n\n        // For example, the user is using a second finger.\n        CurrentPointers.initializeAndAddPointerId(e.pointerId);\n\n        // The first finger created a first point and a second finger just\n        // started, so we stop the drawing and remove this only point.\n        if (DrawingEditor.#currentDraw.isCancellable()) {\n          DrawingEditor.#currentDraw.removeLastElement();\n          if (DrawingEditor.#currentDraw.isEmpty()) {\n            this._currentParent.endDrawingSession(/* isAborted = */ true);\n          } else {\n            this._endDraw(null);\n          }\n        }\n      },\n      {\n        capture: true,\n        passive: false,\n        signal,\n      }\n    );\n    window.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    target.addEventListener(\"pointermove\", this._drawMove.bind(this), {\n      signal,\n    });\n    target.addEventListener(\n      \"touchmove\",\n      e => {\n        if (CurrentPointers.isSameTimeStamp(e.timeStamp)) {\n          // This move event is used to draw so we don't want to scroll.\n          stopEvent(e);\n        }\n      },\n      { signal }\n    );\n    parent.toggleDrawing();\n    uiManager._editorUndoBar?.hide();\n\n    if (DrawingEditor.#currentDraw) {\n      parent.drawLayer.updateProperties(\n        this._currentDrawId,\n        DrawingEditor.#currentDraw.startNew(\n          x,\n          y,\n          parentWidth,\n          parentHeight,\n          rotation\n        )\n      );\n      return;\n    }\n\n    uiManager.updateUIForDefaultProperties(this);\n\n    DrawingEditor.#currentDraw = this.createDrawerInstance(\n      x,\n      y,\n      parentWidth,\n      parentHeight,\n      rotation\n    );\n    DrawingEditor.#currentDrawingOptions = this.getDefaultDrawingOptions();\n    this._currentParent = parent;\n\n    ({ id: this._currentDrawId } = parent.drawLayer.draw(\n      this._mergeSVGProperties(\n        DrawingEditor.#currentDrawingOptions.toSVGProperties(),\n        DrawingEditor.#currentDraw.defaultSVGProperties\n      ),\n      /* isPathUpdatable = */ true,\n      /* hasClip = */ false\n    ));\n  }\n\n  static _drawMove(event) {\n    CurrentPointers.isSameTimeStamp(event.timeStamp);\n    if (!DrawingEditor.#currentDraw) {\n      return;\n    }\n    const { offsetX, offsetY, pointerId } = event;\n\n    if (!CurrentPointers.isSamePointerId(pointerId)) {\n      return;\n    }\n    if (CurrentPointers.isUsingMultiplePointers()) {\n      // The user is using multiple fingers and the first one is moving.\n      this._endDraw(event);\n      return;\n    }\n    this._currentParent.drawLayer.updateProperties(\n      this._currentDrawId,\n      DrawingEditor.#currentDraw.add(offsetX, offsetY)\n    );\n    // We track the timestamp to know if the touchmove event is used to draw.\n    CurrentPointers.setTimeStamp(event.timeStamp);\n    stopEvent(event);\n  }\n\n  static _cleanup(all) {\n    if (all) {\n      this._currentDrawId = -1;\n      this._currentParent = null;\n      DrawingEditor.#currentDraw = null;\n      DrawingEditor.#currentDrawingOptions = null;\n      CurrentPointers.clearTimeStamp();\n    }\n\n    if (DrawingEditor.#currentDrawingAC) {\n      DrawingEditor.#currentDrawingAC.abort();\n      DrawingEditor.#currentDrawingAC = null;\n      CurrentPointers.clearPointerIds();\n    }\n  }\n\n  static _endDraw(event) {\n    const parent = this._currentParent;\n    if (!parent) {\n      return;\n    }\n\n    parent.toggleDrawing(true);\n    this._cleanup(false);\n\n    if (event?.target === parent.div) {\n      parent.drawLayer.updateProperties(\n        this._currentDrawId,\n        DrawingEditor.#currentDraw.end(event.offsetX, event.offsetY)\n      );\n    }\n    if (this.supportMultipleDrawings) {\n      const draw = DrawingEditor.#currentDraw;\n      const drawId = this._currentDrawId;\n      const lastElement = draw.getLastElement();\n      parent.addCommands({\n        cmd: () => {\n          parent.drawLayer.updateProperties(\n            drawId,\n            draw.setLastElement(lastElement)\n          );\n        },\n        undo: () => {\n          parent.drawLayer.updateProperties(drawId, draw.removeLastElement());\n        },\n        mustExec: false,\n        type: AnnotationEditorParamsType.DRAW_STEP,\n      });\n\n      return;\n    }\n\n    this.endDrawing(/* isAborted = */ false);\n  }\n\n  static endDrawing(isAborted) {\n    const parent = this._currentParent;\n    if (!parent) {\n      return null;\n    }\n    parent.toggleDrawing(true);\n    parent.cleanUndoStack(AnnotationEditorParamsType.DRAW_STEP);\n\n    if (!DrawingEditor.#currentDraw.isEmpty()) {\n      const {\n        pageDimensions: [pageWidth, pageHeight],\n        scale,\n      } = parent;\n\n      const editor = parent.createAndAddNewEditor(\n        { offsetX: 0, offsetY: 0 },\n        false,\n        {\n          drawId: this._currentDrawId,\n          drawOutlines: DrawingEditor.#currentDraw.getOutlines(\n            pageWidth * scale,\n            pageHeight * scale,\n            scale,\n            this._INNER_MARGIN\n          ),\n          drawingOptions: DrawingEditor.#currentDrawingOptions,\n          mustBeCommitted: !isAborted,\n        }\n      );\n      this._cleanup(true);\n      return editor;\n    }\n\n    parent.drawLayer.remove(this._currentDrawId);\n    this._cleanup(true);\n    return null;\n  }\n\n  /**\n   * Create the drawing options.\n   * @param {Object} _data\n   */\n  createDrawingOptions(_data) {}\n\n  /**\n   * Deserialize the drawing outlines.\n   * @param {number} pageX - The x coordinate of the page.\n   * @param {number} pageY - The y coordinate of the page.\n   * @param {number} pageWidth - The width of the page.\n   * @param {number} pageHeight - The height of the page.\n   * @param {number} innerWidth - The inner width.\n   * @param {Object} data - The data to deserialize.\n   * @returns {Object} The deserialized outlines.\n   */\n  static deserializeDraw(\n    _pageX,\n    _pageY,\n    _pageWidth,\n    _pageHeight,\n    _innerWidth,\n    _data\n  ) {\n    unreachable(\"Not implemented\");\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    const {\n      rawDims: { pageWidth, pageHeight, pageX, pageY },\n    } = parent.viewport;\n    const drawOutlines = this.deserializeDraw(\n      pageX,\n      pageY,\n      pageWidth,\n      pageHeight,\n      this._INNER_MARGIN,\n      data\n    );\n    const editor = await super.deserialize(data, parent, uiManager);\n    editor.createDrawingOptions(data);\n    editor.#createDrawOutlines({ drawOutlines });\n    editor.#addToDrawLayer();\n    editor.onScaleChanging();\n    editor.rotate();\n\n    return editor;\n  }\n\n  serializeDraw(isForCopying) {\n    const [pageX, pageY] = this.pageTranslation;\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    return this.#drawOutlines.serialize(\n      [pageX, pageY, pageWidth, pageHeight],\n      isForCopying\n    );\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    annotation.updateEdited({\n      rect: this.getPDFRect(),\n    });\n\n    return null;\n  }\n\n  static canCreateNewEmptyEditor() {\n    return false;\n  }\n}\n\nexport { DrawingEditor, DrawingOptions };\n","/* Copyright 2024 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { MathClamp, Util } from \"../../../shared/util.js\";\nimport { Outline } from \"./outline.js\";\n\nclass InkDrawOutliner {\n  // The last 3 points of the line.\n  #last = new Float64Array(6);\n\n  #line;\n\n  #lines;\n\n  #rotation;\n\n  #thickness;\n\n  #points;\n\n  #lastSVGPath = \"\";\n\n  #lastIndex = 0;\n\n  #outlines = new InkDrawOutline();\n\n  #parentWidth;\n\n  #parentHeight;\n\n  constructor(x, y, parentWidth, parentHeight, rotation, thickness) {\n    this.#parentWidth = parentWidth;\n    this.#parentHeight = parentHeight;\n    this.#rotation = rotation;\n    this.#thickness = thickness;\n\n    [x, y] = this.#normalizePoint(x, y);\n\n    const line = (this.#line = [NaN, NaN, NaN, NaN, x, y]);\n    this.#points = [x, y];\n    this.#lines = [{ line, points: this.#points }];\n    this.#last.set(line, 0);\n  }\n\n  updateProperty(name, value) {\n    if (name === \"stroke-width\") {\n      this.#thickness = value;\n    }\n  }\n\n  #normalizePoint(x, y) {\n    return Outline._normalizePoint(\n      x,\n      y,\n      this.#parentWidth,\n      this.#parentHeight,\n      this.#rotation\n    );\n  }\n\n  isEmpty() {\n    return !this.#lines || this.#lines.length === 0;\n  }\n\n  isCancellable() {\n    // The user a second finger after drawing 5 points: it's small enough\n    // to not be a real drawing.\n    return this.#points.length <= 10;\n  }\n\n  add(x, y) {\n    // The point is in canvas coordinates which means that there is no rotation.\n    // It's the same as parent coordinates.\n    [x, y] = this.#normalizePoint(x, y);\n    const [x1, y1, x2, y2] = this.#last.subarray(2, 6);\n    const diffX = x - x2;\n    const diffY = y - y2;\n    const d = Math.hypot(this.#parentWidth * diffX, this.#parentHeight * diffY);\n    if (d <= 2) {\n      // The idea is to avoid garbage points around the last point.\n      // When the points are too close, it just leads to bad normal vectors and\n      // control points.\n      return null;\n    }\n\n    this.#points.push(x, y);\n\n    if (isNaN(x1)) {\n      // We've only one point.\n      this.#last.set([x2, y2, x, y], 2);\n      this.#line.push(NaN, NaN, NaN, NaN, x, y);\n      return {\n        path: {\n          d: this.toSVGPath(),\n        },\n      };\n    }\n\n    if (isNaN(this.#last[0])) {\n      // We've only two points.\n      this.#line.splice(6, 6);\n    }\n\n    this.#last.set([x1, y1, x2, y2, x, y], 0);\n    this.#line.push(...Outline.createBezierPoints(x1, y1, x2, y2, x, y));\n\n    return {\n      path: {\n        d: this.toSVGPath(),\n      },\n    };\n  }\n\n  end(x, y) {\n    const change = this.add(x, y);\n    if (change) {\n      return change;\n    }\n    if (this.#points.length === 2) {\n      // We've only one point.\n      return {\n        path: {\n          d: this.toSVGPath(),\n        },\n      };\n    }\n    return null;\n  }\n\n  startNew(x, y, parentWidth, parentHeight, rotation) {\n    this.#parentWidth = parentWidth;\n    this.#parentHeight = parentHeight;\n    this.#rotation = rotation;\n\n    [x, y] = this.#normalizePoint(x, y);\n\n    const line = (this.#line = [NaN, NaN, NaN, NaN, x, y]);\n    this.#points = [x, y];\n    const last = this.#lines.at(-1);\n    if (last) {\n      last.line = new Float32Array(last.line);\n      last.points = new Float32Array(last.points);\n    }\n    this.#lines.push({ line, points: this.#points });\n    this.#last.set(line, 0);\n    this.#lastIndex = 0;\n    this.toSVGPath();\n\n    return null;\n  }\n\n  getLastElement() {\n    return this.#lines.at(-1);\n  }\n\n  setLastElement(element) {\n    if (!this.#lines) {\n      return this.#outlines.setLastElement(element);\n    }\n    this.#lines.push(element);\n    this.#line = element.line;\n    this.#points = element.points;\n    this.#lastIndex = 0;\n    return {\n      path: {\n        d: this.toSVGPath(),\n      },\n    };\n  }\n\n  removeLastElement() {\n    if (!this.#lines) {\n      return this.#outlines.removeLastElement();\n    }\n    this.#lines.pop();\n    this.#lastSVGPath = \"\";\n    for (let i = 0, ii = this.#lines.length; i < ii; i++) {\n      const { line, points } = this.#lines[i];\n      this.#line = line;\n      this.#points = points;\n      this.#lastIndex = 0;\n      this.toSVGPath();\n    }\n\n    return {\n      path: {\n        d: this.#lastSVGPath,\n      },\n    };\n  }\n\n  toSVGPath() {\n    const firstX = Outline.svgRound(this.#line[4]);\n    const firstY = Outline.svgRound(this.#line[5]);\n    if (this.#points.length === 2) {\n      this.#lastSVGPath = `${this.#lastSVGPath} M ${firstX} ${firstY} Z`;\n      return this.#lastSVGPath;\n    }\n\n    if (this.#points.length <= 6) {\n      // We've 2 or 3 points.\n      const i = this.#lastSVGPath.lastIndexOf(\"M\");\n      this.#lastSVGPath = `${this.#lastSVGPath.slice(0, i)} M ${firstX} ${firstY}`;\n      this.#lastIndex = 6;\n    }\n\n    if (this.#points.length === 4) {\n      const secondX = Outline.svgRound(this.#line[10]);\n      const secondY = Outline.svgRound(this.#line[11]);\n      this.#lastSVGPath = `${this.#lastSVGPath} L ${secondX} ${secondY}`;\n      this.#lastIndex = 12;\n      return this.#lastSVGPath;\n    }\n\n    const buffer = [];\n    if (this.#lastIndex === 0) {\n      buffer.push(`M ${firstX} ${firstY}`);\n      this.#lastIndex = 6;\n    }\n\n    for (let i = this.#lastIndex, ii = this.#line.length; i < ii; i += 6) {\n      const [c1x, c1y, c2x, c2y, x, y] = this.#line\n        .slice(i, i + 6)\n        .map(Outline.svgRound);\n      buffer.push(`C${c1x} ${c1y} ${c2x} ${c2y} ${x} ${y}`);\n    }\n    this.#lastSVGPath += buffer.join(\" \");\n    this.#lastIndex = this.#line.length;\n\n    return this.#lastSVGPath;\n  }\n\n  getOutlines(parentWidth, parentHeight, scale, innerMargin) {\n    const last = this.#lines.at(-1);\n    last.line = new Float32Array(last.line);\n    last.points = new Float32Array(last.points);\n\n    this.#outlines.build(\n      this.#lines,\n      parentWidth,\n      parentHeight,\n      scale,\n      this.#rotation,\n      this.#thickness,\n      innerMargin\n    );\n\n    // We reset everything: the drawing is done.\n    this.#last = null;\n    this.#line = null;\n    this.#lines = null;\n    this.#lastSVGPath = null;\n\n    return this.#outlines;\n  }\n\n  get defaultSVGProperties() {\n    return {\n      root: {\n        viewBox: \"0 0 10000 10000\",\n      },\n      rootClass: {\n        draw: true,\n      },\n      bbox: [0, 0, 1, 1],\n    };\n  }\n}\n\nclass InkDrawOutline extends Outline {\n  #bbox;\n\n  #currentRotation = 0;\n\n  #innerMargin;\n\n  #lines;\n\n  #parentWidth;\n\n  #parentHeight;\n\n  #parentScale;\n\n  #rotation;\n\n  #thickness;\n\n  build(\n    lines,\n    parentWidth,\n    parentHeight,\n    parentScale,\n    rotation,\n    thickness,\n    innerMargin\n  ) {\n    this.#parentWidth = parentWidth;\n    this.#parentHeight = parentHeight;\n    this.#parentScale = parentScale;\n    this.#rotation = rotation;\n    this.#thickness = thickness;\n    this.#innerMargin = innerMargin ?? 0;\n    this.#lines = lines;\n\n    this.#computeBbox();\n  }\n\n  get thickness() {\n    return this.#thickness;\n  }\n\n  setLastElement(element) {\n    this.#lines.push(element);\n    return {\n      path: {\n        d: this.toSVGPath(),\n      },\n    };\n  }\n\n  removeLastElement() {\n    this.#lines.pop();\n    return {\n      path: {\n        d: this.toSVGPath(),\n      },\n    };\n  }\n\n  toSVGPath() {\n    const buffer = [];\n    for (const { line } of this.#lines) {\n      buffer.push(`M${Outline.svgRound(line[4])} ${Outline.svgRound(line[5])}`);\n      if (line.length === 6) {\n        buffer.push(\"Z\");\n        continue;\n      }\n      if (line.length === 12 && isNaN(line[6])) {\n        buffer.push(\n          `L${Outline.svgRound(line[10])} ${Outline.svgRound(line[11])}`\n        );\n        continue;\n      }\n      for (let i = 6, ii = line.length; i < ii; i += 6) {\n        const [c1x, c1y, c2x, c2y, x, y] = line\n          .subarray(i, i + 6)\n          .map(Outline.svgRound);\n        buffer.push(`C${c1x} ${c1y} ${c2x} ${c2y} ${x} ${y}`);\n      }\n    }\n    return buffer.join(\"\");\n  }\n\n  serialize([pageX, pageY, pageWidth, pageHeight], isForCopying) {\n    const serializedLines = [];\n    const serializedPoints = [];\n    const [x, y, width, height] = this.#getBBoxWithNoMargin();\n    let tx, ty, sx, sy, x1, y1, x2, y2, rescaleFn;\n\n    switch (this.#rotation) {\n      case 0:\n        rescaleFn = Outline._rescale;\n        tx = pageX;\n        ty = pageY + pageHeight;\n        sx = pageWidth;\n        sy = -pageHeight;\n        x1 = pageX + x * pageWidth;\n        y1 = pageY + (1 - y - height) * pageHeight;\n        x2 = pageX + (x + width) * pageWidth;\n        y2 = pageY + (1 - y) * pageHeight;\n        break;\n      case 90:\n        rescaleFn = Outline._rescaleAndSwap;\n        tx = pageX;\n        ty = pageY;\n        sx = pageWidth;\n        sy = pageHeight;\n        x1 = pageX + y * pageWidth;\n        y1 = pageY + x * pageHeight;\n        x2 = pageX + (y + height) * pageWidth;\n        y2 = pageY + (x + width) * pageHeight;\n        break;\n      case 180:\n        rescaleFn = Outline._rescale;\n        tx = pageX + pageWidth;\n        ty = pageY;\n        sx = -pageWidth;\n        sy = pageHeight;\n        x1 = pageX + (1 - x - width) * pageWidth;\n        y1 = pageY + y * pageHeight;\n        x2 = pageX + (1 - x) * pageWidth;\n        y2 = pageY + (y + height) * pageHeight;\n        break;\n      case 270:\n        rescaleFn = Outline._rescaleAndSwap;\n        tx = pageX + pageWidth;\n        ty = pageY + pageHeight;\n        sx = -pageWidth;\n        sy = -pageHeight;\n        x1 = pageX + (1 - y - height) * pageWidth;\n        y1 = pageY + (1 - x - width) * pageHeight;\n        x2 = pageX + (1 - y) * pageWidth;\n        y2 = pageY + (1 - x) * pageHeight;\n        break;\n    }\n\n    for (const { line, points } of this.#lines) {\n      serializedLines.push(\n        rescaleFn(\n          line,\n          tx,\n          ty,\n          sx,\n          sy,\n          isForCopying ? new Array(line.length) : null\n        )\n      );\n      serializedPoints.push(\n        rescaleFn(\n          points,\n          tx,\n          ty,\n          sx,\n          sy,\n          isForCopying ? new Array(points.length) : null\n        )\n      );\n    }\n\n    return {\n      lines: serializedLines,\n      points: serializedPoints,\n      rect: [x1, y1, x2, y2],\n    };\n  }\n\n  static deserialize(\n    pageX,\n    pageY,\n    pageWidth,\n    pageHeight,\n    innerMargin,\n    { paths: { lines, points }, rotation, thickness }\n  ) {\n    const newLines = [];\n    let tx, ty, sx, sy, rescaleFn;\n    switch (rotation) {\n      case 0:\n        rescaleFn = Outline._rescale;\n        tx = -pageX / pageWidth;\n        ty = pageY / pageHeight + 1;\n        sx = 1 / pageWidth;\n        sy = -1 / pageHeight;\n        break;\n      case 90:\n        rescaleFn = Outline._rescaleAndSwap;\n        tx = -pageY / pageHeight;\n        ty = -pageX / pageWidth;\n        sx = 1 / pageHeight;\n        sy = 1 / pageWidth;\n        break;\n      case 180:\n        rescaleFn = Outline._rescale;\n        tx = pageX / pageWidth + 1;\n        ty = -pageY / pageHeight;\n        sx = -1 / pageWidth;\n        sy = 1 / pageHeight;\n        break;\n      case 270:\n        rescaleFn = Outline._rescaleAndSwap;\n        tx = pageY / pageHeight + 1;\n        ty = pageX / pageWidth + 1;\n        sx = -1 / pageHeight;\n        sy = -1 / pageWidth;\n        break;\n    }\n\n    if (!lines) {\n      lines = [];\n      for (const point of points) {\n        const len = point.length;\n        if (len === 2) {\n          lines.push(\n            new Float32Array([NaN, NaN, NaN, NaN, point[0], point[1]])\n          );\n          continue;\n        }\n        if (len === 4) {\n          lines.push(\n            new Float32Array([\n              NaN,\n              NaN,\n              NaN,\n              NaN,\n              point[0],\n              point[1],\n              NaN,\n              NaN,\n              NaN,\n              NaN,\n              point[2],\n              point[3],\n            ])\n          );\n          continue;\n        }\n        const line = new Float32Array(3 * (len - 2));\n        lines.push(line);\n        let [x1, y1, x2, y2] = point.subarray(0, 4);\n        line.set([NaN, NaN, NaN, NaN, x1, y1], 0);\n        for (let i = 4; i < len; i += 2) {\n          const x = point[i];\n          const y = point[i + 1];\n          line.set(\n            Outline.createBezierPoints(x1, y1, x2, y2, x, y),\n            (i - 2) * 3\n          );\n          [x1, y1, x2, y2] = [x2, y2, x, y];\n        }\n      }\n    }\n\n    for (let i = 0, ii = lines.length; i < ii; i++) {\n      newLines.push({\n        line: rescaleFn(\n          lines[i].map(x => x ?? NaN),\n          tx,\n          ty,\n          sx,\n          sy\n        ),\n        points: rescaleFn(\n          points[i].map(x => x ?? NaN),\n          tx,\n          ty,\n          sx,\n          sy\n        ),\n      });\n    }\n\n    const outlines = new this.prototype.constructor();\n    outlines.build(\n      newLines,\n      pageWidth,\n      pageHeight,\n      1,\n      rotation,\n      thickness,\n      innerMargin\n    );\n\n    return outlines;\n  }\n\n  #getMarginComponents(thickness = this.#thickness) {\n    const margin = this.#innerMargin + (thickness / 2) * this.#parentScale;\n    return this.#rotation % 180 === 0\n      ? [margin / this.#parentWidth, margin / this.#parentHeight]\n      : [margin / this.#parentHeight, margin / this.#parentWidth];\n  }\n\n  #getBBoxWithNoMargin() {\n    const [x, y, width, height] = this.#bbox;\n    const [marginX, marginY] = this.#getMarginComponents(0);\n\n    return [\n      x + marginX,\n      y + marginY,\n      width - 2 * marginX,\n      height - 2 * marginY,\n    ];\n  }\n\n  #computeBbox() {\n    const bbox = (this.#bbox = new Float32Array([\n      Infinity,\n      Infinity,\n      -Infinity,\n      -Infinity,\n    ]));\n\n    for (const { line } of this.#lines) {\n      if (line.length <= 12) {\n        // We've only one or two points => no bezier curve.\n        for (let i = 4, ii = line.length; i < ii; i += 6) {\n          Util.pointBoundingBox(line[i], line[i + 1], bbox);\n        }\n        continue;\n      }\n      let lastX = line[4],\n        lastY = line[5];\n      for (let i = 6, ii = line.length; i < ii; i += 6) {\n        const [c1x, c1y, c2x, c2y, x, y] = line.subarray(i, i + 6);\n        Util.bezierBoundingBox(lastX, lastY, c1x, c1y, c2x, c2y, x, y, bbox);\n        lastX = x;\n        lastY = y;\n      }\n    }\n\n    const [marginX, marginY] = this.#getMarginComponents();\n    bbox[0] = MathClamp(bbox[0] - marginX, 0, 1);\n    bbox[1] = MathClamp(bbox[1] - marginY, 0, 1);\n    bbox[2] = MathClamp(bbox[2] + marginX, 0, 1);\n    bbox[3] = MathClamp(bbox[3] + marginY, 0, 1);\n\n    bbox[2] -= bbox[0];\n    bbox[3] -= bbox[1];\n  }\n\n  get box() {\n    return this.#bbox;\n  }\n\n  updateProperty(name, value) {\n    if (name === \"stroke-width\") {\n      return this.#updateThickness(value);\n    }\n    return null;\n  }\n\n  #updateThickness(thickness) {\n    const [oldMarginX, oldMarginY] = this.#getMarginComponents();\n    this.#thickness = thickness;\n    const [newMarginX, newMarginY] = this.#getMarginComponents();\n    const [diffMarginX, diffMarginY] = [\n      newMarginX - oldMarginX,\n      newMarginY - oldMarginY,\n    ];\n    const bbox = this.#bbox;\n    bbox[0] -= diffMarginX;\n    bbox[1] -= diffMarginY;\n    bbox[2] += 2 * diffMarginX;\n    bbox[3] += 2 * diffMarginY;\n\n    return bbox;\n  }\n\n  updateParentDimensions([width, height], scale) {\n    const [oldMarginX, oldMarginY] = this.#getMarginComponents();\n    this.#parentWidth = width;\n    this.#parentHeight = height;\n    this.#parentScale = scale;\n    const [newMarginX, newMarginY] = this.#getMarginComponents();\n    const diffMarginX = newMarginX - oldMarginX;\n    const diffMarginY = newMarginY - oldMarginY;\n\n    const bbox = this.#bbox;\n    bbox[0] -= diffMarginX;\n    bbox[1] -= diffMarginY;\n    bbox[2] += 2 * diffMarginX;\n    bbox[3] += 2 * diffMarginY;\n\n    return bbox;\n  }\n\n  updateRotation(rotation) {\n    this.#currentRotation = rotation;\n    return {\n      path: {\n        transform: this.rotationTransform,\n      },\n    };\n  }\n\n  get viewBox() {\n    return this.#bbox.map(Outline.svgRound).join(\" \");\n  }\n\n  get defaultProperties() {\n    const [x, y] = this.#bbox;\n    return {\n      root: {\n        viewBox: this.viewBox,\n      },\n      path: {\n        \"transform-origin\": `${Outline.svgRound(x)} ${Outline.svgRound(y)}`,\n      },\n    };\n  }\n\n  get rotationTransform() {\n    const [, , width, height] = this.#bbox;\n    let a = 0,\n      b = 0,\n      c = 0,\n      d = 0,\n      e = 0,\n      f = 0;\n    switch (this.#currentRotation) {\n      case 90:\n        b = height / width;\n        c = -width / height;\n        e = width;\n        break;\n      case 180:\n        a = -1;\n        d = -1;\n        e = width;\n        f = height;\n        break;\n      case 270:\n        b = -height / width;\n        c = width / height;\n        f = height;\n        break;\n      default:\n        return \"\";\n    }\n    return `matrix(${a} ${b} ${c} ${d} ${Outline.svgRound(e)} ${Outline.svgRound(f)})`;\n  }\n\n  getPathResizingSVGProperties([newX, newY, newWidth, newHeight]) {\n    const [marginX, marginY] = this.#getMarginComponents();\n    const [x, y, width, height] = this.#bbox;\n\n    if (\n      Math.abs(width - marginX) <= Outline.PRECISION ||\n      Math.abs(height - marginY) <= Outline.PRECISION\n    ) {\n      // Center the path in the new bounding box.\n      const tx = newX + newWidth / 2 - (x + width / 2);\n      const ty = newY + newHeight / 2 - (y + height / 2);\n      return {\n        path: {\n          \"transform-origin\": `${Outline.svgRound(newX)} ${Outline.svgRound(newY)}`,\n          transform: `${this.rotationTransform} translate(${tx} ${ty})`,\n        },\n      };\n    }\n\n    // We compute the following transform:\n    //  1. Translate the path to the origin (-marginX, -marginY).\n    //  2. Scale the path to the new size:\n    //   ((newWidth - 2*marginX) / (bbox.width - 2*marginX),\n    //   (newHeight - 2*marginY) / (bbox.height - 2*marginY)).\n    //  3. Translate the path back to its original position\n    //   (marginX, marginY).\n    //  4. Scale the inverse of bbox scaling:\n    //   (bbox.width / newWidth, bbox.height / newHeight).\n\n    const s1x = (newWidth - 2 * marginX) / (width - 2 * marginX);\n    const s1y = (newHeight - 2 * marginY) / (height - 2 * marginY);\n    const s2x = width / newWidth;\n    const s2y = height / newHeight;\n\n    return {\n      path: {\n        \"transform-origin\": `${Outline.svgRound(x)} ${Outline.svgRound(y)}`,\n        transform:\n          `${this.rotationTransform} scale(${s2x} ${s2y}) ` +\n          `translate(${Outline.svgRound(marginX)} ${Outline.svgRound(marginY)}) scale(${s1x} ${s1y}) ` +\n          `translate(${Outline.svgRound(-marginX)} ${Outline.svgRound(-marginY)})`,\n      },\n    };\n  }\n\n  getPathResizedSVGProperties([newX, newY, newWidth, newHeight]) {\n    const [marginX, marginY] = this.#getMarginComponents();\n    const bbox = this.#bbox;\n    const [x, y, width, height] = bbox;\n\n    bbox[0] = newX;\n    bbox[1] = newY;\n    bbox[2] = newWidth;\n    bbox[3] = newHeight;\n\n    if (\n      Math.abs(width - marginX) <= Outline.PRECISION ||\n      Math.abs(height - marginY) <= Outline.PRECISION\n    ) {\n      // Center the path in the new bounding box.\n      const tx = newX + newWidth / 2 - (x + width / 2);\n      const ty = newY + newHeight / 2 - (y + height / 2);\n      for (const { line, points } of this.#lines) {\n        Outline._translate(line, tx, ty, line);\n        Outline._translate(points, tx, ty, points);\n      }\n      return {\n        root: {\n          viewBox: this.viewBox,\n        },\n        path: {\n          \"transform-origin\": `${Outline.svgRound(newX)} ${Outline.svgRound(newY)}`,\n          transform: this.rotationTransform || null,\n          d: this.toSVGPath(),\n        },\n      };\n    }\n\n    // We compute the following transform:\n    //  1. Translate the path to the origin (-(x + marginX), -(y + marginY)).\n    //  2. Scale the path to the new size:\n    //   ((newWidth - 2*marginX) / (bbox.width - 2*marginX),\n    //   (newHeight - 2*marginY) / (bbox.height - 2*marginY)).\n    //  3. Translate the path back to its new position\n    //     (newX + marginX,y newY + marginY).\n\n    const s1x = (newWidth - 2 * marginX) / (width - 2 * marginX);\n    const s1y = (newHeight - 2 * marginY) / (height - 2 * marginY);\n    const tx = -s1x * (x + marginX) + newX + marginX;\n    const ty = -s1y * (y + marginY) + newY + marginY;\n\n    if (s1x !== 1 || s1y !== 1 || tx !== 0 || ty !== 0) {\n      for (const { line, points } of this.#lines) {\n        Outline._rescale(line, tx, ty, s1x, s1y, line);\n        Outline._rescale(points, tx, ty, s1x, s1y, points);\n      }\n    }\n\n    return {\n      root: {\n        viewBox: this.viewBox,\n      },\n      path: {\n        \"transform-origin\": `${Outline.svgRound(newX)} ${Outline.svgRound(newY)}`,\n        transform: this.rotationTransform || null,\n        d: this.toSVGPath(),\n      },\n    };\n  }\n\n  getPathTranslatedSVGProperties([newX, newY], parentDimensions) {\n    const [newParentWidth, newParentHeight] = parentDimensions;\n    const bbox = this.#bbox;\n    const tx = newX - bbox[0];\n    const ty = newY - bbox[1];\n\n    if (\n      this.#parentWidth === newParentWidth &&\n      this.#parentHeight === newParentHeight\n    ) {\n      // We don't change the parent dimensions so it's a simple translation.\n      for (const { line, points } of this.#lines) {\n        Outline._translate(line, tx, ty, line);\n        Outline._translate(points, tx, ty, points);\n      }\n    } else {\n      const sx = this.#parentWidth / newParentWidth;\n      const sy = this.#parentHeight / newParentHeight;\n      this.#parentWidth = newParentWidth;\n      this.#parentHeight = newParentHeight;\n\n      for (const { line, points } of this.#lines) {\n        Outline._rescale(line, tx, ty, sx, sy, line);\n        Outline._rescale(points, tx, ty, sx, sy, points);\n      }\n      bbox[2] *= sx;\n      bbox[3] *= sy;\n    }\n    bbox[0] = newX;\n    bbox[1] = newY;\n\n    return {\n      root: {\n        viewBox: this.viewBox,\n      },\n      path: {\n        d: this.toSVGPath(),\n        \"transform-origin\": `${Outline.svgRound(newX)} ${Outline.svgRound(newY)}`,\n      },\n    };\n  }\n\n  get defaultSVGProperties() {\n    const bbox = this.#bbox;\n    return {\n      root: {\n        viewBox: this.viewBox,\n      },\n      rootClass: {\n        draw: true,\n      },\n      path: {\n        d: this.toSVGPath(),\n        \"transform-origin\": `${Outline.svgRound(bbox[0])} ${Outline.svgRound(bbox[1])}`,\n        transform: this.rotationTransform || null,\n      },\n      bbox,\n    };\n  }\n}\n\nexport { InkDrawOutline, InkDrawOutliner };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  shadow,\n  Util,\n} from \"../../shared/util.js\";\nimport { DrawingEditor, DrawingOptions } from \"./draw.js\";\nimport { InkDrawOutline, InkDrawOutliner } from \"./drawers/inkdraw.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { BasicColorPicker } from \"./color_picker.js\";\nimport { InkAnnotationElement } from \"../annotation_layer.js\";\n\nclass InkDrawingOptions extends DrawingOptions {\n  constructor(viewerParameters) {\n    super();\n    this._viewParameters = viewerParameters;\n\n    super.updateProperties({\n      fill: \"none\",\n      stroke: AnnotationEditor._defaultLineColor,\n      \"stroke-opacity\": 1,\n      \"stroke-width\": 1,\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"stroke-miterlimit\": 10,\n    });\n  }\n\n  updateSVGProperty(name, value) {\n    if (name === \"stroke-width\") {\n      value ??= this[\"stroke-width\"];\n      value *= this._viewParameters.realScale;\n    }\n    super.updateSVGProperty(name, value);\n  }\n\n  clone() {\n    const clone = new InkDrawingOptions(this._viewParameters);\n    clone.updateAll(this);\n    return clone;\n  }\n}\n\n/**\n * Basic draw editor in order to generate an Ink annotation.\n */\nclass InkEditor extends DrawingEditor {\n  static _type = \"ink\";\n\n  static _editorType = AnnotationEditorType.INK;\n\n  static _defaultDrawingOptions = null;\n\n  constructor(params) {\n    super({ ...params, name: \"inkEditor\" });\n    this._willKeepAspectRatio = true;\n    this.defaultL10nId = \"pdfjs-editor-ink-editor\";\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n    this._defaultDrawingOptions = new InkDrawingOptions(\n      uiManager.viewParameters\n    );\n  }\n\n  /** @inheritdoc */\n  static getDefaultDrawingOptions(options) {\n    const clone = this._defaultDrawingOptions.clone();\n    clone.updateProperties(options);\n    return clone;\n  }\n\n  /** @inheritdoc */\n  static get supportMultipleDrawings() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  static get typesMap() {\n    return shadow(\n      this,\n      \"typesMap\",\n      new Map([\n        [AnnotationEditorParamsType.INK_THICKNESS, \"stroke-width\"],\n        [AnnotationEditorParamsType.INK_COLOR, \"stroke\"],\n        [AnnotationEditorParamsType.INK_OPACITY, \"stroke-opacity\"],\n      ])\n    );\n  }\n\n  /** @inheritdoc */\n  static createDrawerInstance(x, y, parentWidth, parentHeight, rotation) {\n    return new InkDrawOutliner(\n      x,\n      y,\n      parentWidth,\n      parentHeight,\n      rotation,\n      this._defaultDrawingOptions[\"stroke-width\"]\n    );\n  }\n\n  /** @inheritdoc */\n  static deserializeDraw(\n    pageX,\n    pageY,\n    pageWidth,\n    pageHeight,\n    innerMargin,\n    data\n  ) {\n    return InkDrawOutline.deserialize(\n      pageX,\n      pageY,\n      pageWidth,\n      pageHeight,\n      innerMargin,\n      data\n    );\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    let initialData = null;\n    if (data instanceof InkAnnotationElement) {\n      const {\n        data: {\n          inkLists,\n          rect,\n          rotation,\n          id,\n          color,\n          opacity,\n          borderStyle: { rawWidth: thickness },\n          popupRef,\n          richText,\n          contentsObj,\n          creationDate,\n          modificationDate,\n        },\n        parent: {\n          page: { pageNumber },\n        },\n      } = data;\n      initialData = data = {\n        annotationType: AnnotationEditorType.INK,\n        color: Array.from(color),\n        thickness,\n        opacity,\n        paths: { points: inkLists },\n        boxes: null,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        annotationElementId: id,\n        id,\n        deleted: false,\n        popupRef,\n        richText,\n        comment: contentsObj?.str || null,\n        creationDate,\n        modificationDate,\n      };\n    }\n\n    const editor = await super.deserialize(data, parent, uiManager);\n    editor._initialData = initialData;\n    if (data.comment) {\n      editor.setCommentData(data);\n    }\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  get toolbarButtons() {\n    this._colorPicker ||= new BasicColorPicker(this);\n    return [[\"colorPicker\", this._colorPicker]];\n  }\n\n  get colorType() {\n    return AnnotationEditorParamsType.INK_COLOR;\n  }\n\n  get color() {\n    return this._drawingOptions.stroke;\n  }\n\n  get opacity() {\n    return this._drawingOptions[\"stroke-opacity\"];\n  }\n\n  /** @inheritdoc */\n  onScaleChanging() {\n    if (!this.parent) {\n      return;\n    }\n    super.onScaleChanging();\n    const { _drawId, _drawingOptions, parent } = this;\n    _drawingOptions.updateSVGProperty(\"stroke-width\");\n    parent.drawLayer.updateProperties(\n      _drawId,\n      _drawingOptions.toSVGProperties()\n    );\n  }\n\n  static onScaleChangingWhenDrawing() {\n    const parent = this._currentParent;\n    if (!parent) {\n      return;\n    }\n    super.onScaleChangingWhenDrawing();\n    this._defaultDrawingOptions.updateSVGProperty(\"stroke-width\");\n    parent.drawLayer.updateProperties(\n      this._currentDrawId,\n      this._defaultDrawingOptions.toSVGProperties()\n    );\n  }\n\n  /** @inheritdoc */\n  createDrawingOptions({ color, thickness, opacity }) {\n    this._drawingOptions = InkEditor.getDefaultDrawingOptions({\n      stroke: Util.makeHexColor(...color),\n      \"stroke-width\": thickness,\n      \"stroke-opacity\": opacity,\n    });\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    if (this.deleted) {\n      return this.serializeDeleted();\n    }\n\n    const { lines, points } = this.serializeDraw(isForCopying);\n    const {\n      _drawingOptions: {\n        stroke,\n        \"stroke-opacity\": opacity,\n        \"stroke-width\": thickness,\n      },\n    } = this;\n    const serialized = Object.assign(super.serialize(isForCopying), {\n      color: AnnotationEditor._colorManager.convert(stroke),\n      opacity,\n      thickness,\n      paths: {\n        lines,\n        points,\n      },\n    });\n    this.addComment(serialized);\n\n    if (isForCopying) {\n      serialized.isCopy = true;\n      return serialized;\n    }\n\n    if (this.annotationElementId && !this.#hasElementChanged(serialized)) {\n      return null;\n    }\n\n    serialized.id = this.annotationElementId;\n    return serialized;\n  }\n\n  #hasElementChanged(serialized) {\n    const { color, thickness, opacity, pageIndex } = this._initialData;\n    return (\n      this.hasEditedComment ||\n      this._hasBeenMoved ||\n      this._hasBeenResized ||\n      serialized.color.some((c, i) => c !== color[i]) ||\n      serialized.thickness !== thickness ||\n      serialized.opacity !== opacity ||\n      serialized.pageIndex !== pageIndex\n    );\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    if (this.deleted) {\n      annotation.hide();\n      return null;\n    }\n    const { points, rect } = this.serializeDraw(/* isForCopying = */ false);\n    annotation.updateEdited({\n      rect,\n      thickness: this._drawingOptions[\"stroke-width\"],\n      points,\n      popup: this.comment,\n    });\n\n    return null;\n  }\n}\n\nexport { InkDrawingOptions, InkEditor };\n","/* Copyright 2024 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InkDrawOutline } from \"./inkdraw.js\";\n\nclass ContourDrawOutline extends InkDrawOutline {\n  toSVGPath() {\n    let path = super.toSVGPath();\n    if (!path.endsWith(\"Z\")) {\n      path += \"Z\";\n    }\n    return path;\n  }\n}\n\nexport { ContourDrawOutline };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { fromBase64Util, toBase64Util, warn } from \"../../../shared/util.js\";\nimport { ContourDrawOutline } from \"./contour.js\";\nimport { InkDrawOutline } from \"./inkdraw.js\";\nimport { Outline } from \"./outline.js\";\n\nconst BASE_HEADER_LENGTH = 8;\nconst POINTS_PROPERTIES_NUMBER = 3;\n\n/**\n * Basic text editor in order to create a Signature annotation.\n */\nclass SignatureExtractor {\n  static #PARAMETERS = {\n    maxDim: 512,\n    sigmaSFactor: 0.02,\n    sigmaR: 25,\n    kernelSize: 16,\n  };\n\n  static #neighborIndexToId(i0, j0, i, j) {\n    /*\n      The idea is to map the neighbors of a pixel into a unique id.\n        3 2 1\n        4 X 0\n        5 6 7\n    */\n\n    i -= i0;\n    j -= j0;\n\n    if (i === 0) {\n      return j > 0 ? 0 : 4;\n    }\n\n    if (i === 1) {\n      return j + 6;\n    }\n\n    return 2 - j;\n  }\n\n  static #neighborIdToIndex = new Int32Array([\n    0, 1, -1, 1, -1, 0, -1, -1, 0, -1, 1, -1, 1, 0, 1, 1,\n  ]);\n\n  static #clockwiseNonZero(buf, width, i0, j0, i, j, offset) {\n    const id = this.#neighborIndexToId(i0, j0, i, j);\n    for (let k = 0; k < 8; k++) {\n      const kk = (-k + id - offset + 16) % 8;\n      const shiftI = this.#neighborIdToIndex[2 * kk];\n      const shiftJ = this.#neighborIdToIndex[2 * kk + 1];\n      if (buf[(i0 + shiftI) * width + (j0 + shiftJ)] !== 0) {\n        return kk;\n      }\n    }\n    return -1;\n  }\n\n  static #counterClockwiseNonZero(buf, width, i0, j0, i, j, offset) {\n    const id = this.#neighborIndexToId(i0, j0, i, j);\n    for (let k = 0; k < 8; k++) {\n      const kk = (k + id + offset + 16) % 8;\n      const shiftI = this.#neighborIdToIndex[2 * kk];\n      const shiftJ = this.#neighborIdToIndex[2 * kk + 1];\n      if (buf[(i0 + shiftI) * width + (j0 + shiftJ)] !== 0) {\n        return kk;\n      }\n    }\n    return -1;\n  }\n\n  static #findContours(buf, width, height, threshold) {\n    // Based on the Suzuki's algorithm:\n    //  https://web.archive.org/web/20231213161741/https://www.nevis.columbia.edu/~vgenty/public/suzuki_et_al.pdf\n\n    const N = buf.length;\n    const types = new Int32Array(N);\n    for (let i = 0; i < N; i++) {\n      types[i] = buf[i] <= threshold ? 1 : 0;\n    }\n\n    for (let i = 1; i < height - 1; i++) {\n      types[i * width] = types[i * width + width - 1] = 0;\n    }\n    for (let i = 0; i < width; i++) {\n      types[i] = types[width * height - 1 - i] = 0;\n    }\n\n    let nbd = 1;\n    let lnbd;\n    const contours = [];\n\n    for (let i = 1; i < height - 1; i++) {\n      lnbd = 1;\n      for (let j = 1; j < width - 1; j++) {\n        const ij = i * width + j;\n        const pix = types[ij];\n        if (pix === 0) {\n          continue;\n        }\n\n        let i2 = i;\n        let j2 = j;\n\n        if (pix === 1 && types[ij - 1] === 0) {\n          // Outer border.\n          nbd += 1;\n          j2 -= 1;\n        } else if (pix >= 1 && types[ij + 1] === 0) {\n          // Hole border.\n          nbd += 1;\n          j2 += 1;\n          if (pix > 1) {\n            lnbd = pix;\n          }\n        } else {\n          if (pix !== 1) {\n            lnbd = Math.abs(pix);\n          }\n          continue;\n        }\n\n        const points = [j, i];\n        const isHole = j2 === j + 1;\n        const contour = {\n          isHole,\n          points,\n          id: nbd,\n          parent: 0,\n        };\n        contours.push(contour);\n\n        let contour0;\n        for (const c of contours) {\n          if (c.id === lnbd) {\n            contour0 = c;\n            break;\n          }\n        }\n\n        if (!contour0) {\n          contour.parent = isHole ? lnbd : 0;\n        } else if (contour0.isHole) {\n          contour.parent = isHole ? contour0.parent : lnbd;\n        } else {\n          contour.parent = isHole ? lnbd : contour0.parent;\n        }\n\n        const k = this.#clockwiseNonZero(types, width, i, j, i2, j2, 0);\n        if (k === -1) {\n          types[ij] = -nbd;\n          if (types[ij] !== 1) {\n            lnbd = Math.abs(types[ij]);\n          }\n          continue;\n        }\n\n        let shiftI = this.#neighborIdToIndex[2 * k];\n        let shiftJ = this.#neighborIdToIndex[2 * k + 1];\n        const i1 = i + shiftI;\n        const j1 = j + shiftJ;\n        i2 = i1;\n        j2 = j1;\n        let i3 = i;\n        let j3 = j;\n\n        while (true) {\n          const kk = this.#counterClockwiseNonZero(\n            types,\n            width,\n            i3,\n            j3,\n            i2,\n            j2,\n            1\n          );\n          shiftI = this.#neighborIdToIndex[2 * kk];\n          shiftJ = this.#neighborIdToIndex[2 * kk + 1];\n          const i4 = i3 + shiftI;\n          const j4 = j3 + shiftJ;\n          points.push(j4, i4);\n          const ij3 = i3 * width + j3;\n          if (types[ij3 + 1] === 0) {\n            types[ij3] = -nbd;\n          } else if (types[ij3] === 1) {\n            types[ij3] = nbd;\n          }\n\n          if (i4 === i && j4 === j && i3 === i1 && j3 === j1) {\n            if (types[ij] !== 1) {\n              lnbd = Math.abs(types[ij]);\n            }\n            break;\n          } else {\n            i2 = i3;\n            j2 = j3;\n            i3 = i4;\n            j3 = j4;\n          }\n        }\n      }\n    }\n    return contours;\n  }\n\n  static #douglasPeuckerHelper(points, start, end, output) {\n    // Based on the Douglas-Peucker algorithm:\n    //  https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm\n    if (end - start <= 4) {\n      for (let i = start; i < end - 2; i += 2) {\n        output.push(points[i], points[i + 1]);\n      }\n      return;\n    }\n\n    const ax = points[start];\n    const ay = points[start + 1];\n    const abx = points[end - 4] - ax;\n    const aby = points[end - 3] - ay;\n    const dist = Math.hypot(abx, aby);\n    const nabx = abx / dist;\n    const naby = aby / dist;\n    const aa = nabx * ay - naby * ax;\n\n    // Guessing the epsilon value.\n    // See \"A novel framework for making dominant point detection methods\n    // non-parametric\".\n    const m = aby / abx;\n    const invS = 1 / dist;\n    const phi = Math.atan(m);\n    const cosPhi = Math.cos(phi);\n    const sinPhi = Math.sin(phi);\n    const tmax = invS * (Math.abs(cosPhi) + Math.abs(sinPhi));\n    const poly = invS * (1 - tmax + tmax ** 2);\n    const partialPhi = Math.max(\n      Math.atan(Math.abs(sinPhi + cosPhi) * poly),\n      Math.atan(Math.abs(sinPhi - cosPhi) * poly)\n    );\n\n    let dmax = 0;\n    let index = start;\n    for (let i = start + 2; i < end - 2; i += 2) {\n      const d = Math.abs(aa - nabx * points[i + 1] + naby * points[i]);\n      if (d > dmax) {\n        index = i;\n        dmax = d;\n      }\n    }\n\n    if (dmax > (dist * partialPhi) ** 2) {\n      this.#douglasPeuckerHelper(points, start, index + 2, output);\n      this.#douglasPeuckerHelper(points, index, end, output);\n    } else {\n      output.push(ax, ay);\n    }\n  }\n\n  static #douglasPeucker(points) {\n    const output = [];\n    const len = points.length;\n    this.#douglasPeuckerHelper(points, 0, len, output);\n    output.push(points[len - 2], points[len - 1]);\n    return output.length <= 4 ? null : output;\n  }\n\n  static #bilateralFilter(buf, width, height, sigmaS, sigmaR, kernelSize) {\n    // The bilateral filter is a nonlinear filter that does spatial averaging.\n    // Its main interest is to preserve edges while removing noise.\n    // See https://en.wikipedia.org/wiki/Bilateral_filter for more details.\n    // sigmaS is the standard deviation of the spatial gaussian.\n    // sigmaR is the standard deviation of the range (in term of pixel\n    // intensity) gaussian.\n\n    // Create a gaussian kernel\n    const kernel = new Float32Array(kernelSize ** 2);\n    const sigmaS2 = -2 * sigmaS ** 2;\n    const halfSize = kernelSize >> 1;\n\n    for (let i = 0; i < kernelSize; i++) {\n      const x = (i - halfSize) ** 2;\n      for (let j = 0; j < kernelSize; j++) {\n        kernel[i * kernelSize + j] = Math.exp(\n          (x + (j - halfSize) ** 2) / sigmaS2\n        );\n      }\n    }\n\n    // Create the range values to be used with the distance between pixels.\n    // It's a way faster with a lookup table than computing the exponential.\n    const rangeValues = new Float32Array(256);\n    const sigmaR2 = -2 * sigmaR ** 2;\n    for (let i = 0; i < 256; i++) {\n      rangeValues[i] = Math.exp(i ** 2 / sigmaR2);\n    }\n\n    const N = buf.length;\n    const out = new Uint8Array(N);\n\n    // We compute the histogram here instead of doing it later: it's slightly\n    // faster.\n    const histogram = new Uint32Array(256);\n    for (let i = 0; i < height; i++) {\n      for (let j = 0; j < width; j++) {\n        const ij = i * width + j;\n        const center = buf[ij];\n        let sum = 0;\n        let norm = 0;\n\n        for (let k = 0; k < kernelSize; k++) {\n          const y = i + k - halfSize;\n          if (y < 0 || y >= height) {\n            continue;\n          }\n          for (let l = 0; l < kernelSize; l++) {\n            const x = j + l - halfSize;\n            if (x < 0 || x >= width) {\n              continue;\n            }\n            const neighbour = buf[y * width + x];\n            const w =\n              kernel[k * kernelSize + l] *\n              rangeValues[Math.abs(neighbour - center)];\n            sum += neighbour * w;\n            norm += w;\n          }\n        }\n\n        const pix = (out[ij] = Math.round(sum / norm));\n        histogram[pix]++;\n      }\n    }\n\n    return [out, histogram];\n  }\n\n  static #getHistogram(buf) {\n    const histogram = new Uint32Array(256);\n    for (const g of buf) {\n      histogram[g]++;\n    }\n    return histogram;\n  }\n\n  static #toUint8(buf) {\n    // We have a RGBA buffer, containing a grayscale image.\n    // We want to convert it into a basic G buffer.\n    // Also, we want to normalize the values between 0 and 255 in order to\n    // increase the contrast.\n    const N = buf.length;\n    const out = new Uint8ClampedArray(N >> 2);\n    let max = -Infinity;\n    let min = Infinity;\n    for (let i = 0, ii = out.length; i < ii; i++) {\n      const pix = (out[i] = buf[i << 2]);\n      max = Math.max(max, pix);\n      min = Math.min(min, pix);\n    }\n    const ratio = 255 / (max - min);\n    for (let i = 0, ii = out.length; i < ii; i++) {\n      out[i] = (out[i] - min) * ratio;\n    }\n\n    return out;\n  }\n\n  static #guessThreshold(histogram) {\n    // We want to find the threshold that will separate the background from the\n    // foreground.\n    // We could have used Otsu's method, but unfortunately it doesn't work well\n    // when the background has too much shade of greys.\n    // So the idea is to find a maximum in the black part of the histogram and\n    // figure out the value which will be the first one of the white part.\n\n    let i;\n    let M = -Infinity;\n    let L = -Infinity;\n    const min = histogram.findIndex(v => v !== 0);\n    let pos = min;\n    let spos = min;\n    for (i = min; i < 256; i++) {\n      const v = histogram[i];\n      if (v > M) {\n        if (i - pos > L) {\n          L = i - pos;\n          spos = i - 1;\n        }\n        M = v;\n        pos = i;\n      }\n    }\n    for (i = spos - 1; i >= 0; i--) {\n      if (histogram[i] > histogram[i + 1]) {\n        break;\n      }\n    }\n\n    return i;\n  }\n\n  static #getGrayPixels(bitmap) {\n    const originalBitmap = bitmap;\n    const { width, height } = bitmap;\n    const { maxDim } = this.#PARAMETERS;\n    let newWidth = width;\n    let newHeight = height;\n\n    if (width > maxDim || height > maxDim) {\n      let prevWidth = width;\n      let prevHeight = height;\n\n      let steps = Math.log2(Math.max(width, height) / maxDim);\n      const isteps = Math.floor(steps);\n      steps = steps === isteps ? isteps - 1 : isteps;\n      for (let i = 0; i < steps; i++) {\n        newWidth = Math.ceil(prevWidth / 2);\n        newHeight = Math.ceil(prevHeight / 2);\n\n        const offscreen = new OffscreenCanvas(newWidth, newHeight);\n        const ctx = offscreen.getContext(\"2d\");\n        ctx.drawImage(\n          bitmap,\n          0,\n          0,\n          prevWidth,\n          prevHeight,\n          0,\n          0,\n          newWidth,\n          newHeight\n        );\n        prevWidth = newWidth;\n        prevHeight = newHeight;\n\n        // Release the resources associated with the bitmap.\n        if (bitmap !== originalBitmap) {\n          bitmap.close();\n        }\n        bitmap = offscreen.transferToImageBitmap();\n      }\n\n      const ratio = Math.min(maxDim / newWidth, maxDim / newHeight);\n      newWidth = Math.round(newWidth * ratio);\n      newHeight = Math.round(newHeight * ratio);\n    }\n    const offscreen = new OffscreenCanvas(newWidth, newHeight);\n    const ctx = offscreen.getContext(\"2d\", { willReadFrequently: true });\n    ctx.fillStyle = \"white\";\n    ctx.fillRect(0, 0, newWidth, newHeight);\n    ctx.filter = \"grayscale(1)\";\n    ctx.drawImage(\n      bitmap,\n      0,\n      0,\n      bitmap.width,\n      bitmap.height,\n      0,\n      0,\n      newWidth,\n      newHeight\n    );\n    const grayImage = ctx.getImageData(0, 0, newWidth, newHeight).data;\n    const uint8Buf = this.#toUint8(grayImage);\n\n    return [uint8Buf, newWidth, newHeight];\n  }\n\n  static extractContoursFromText(\n    text,\n    { fontFamily, fontStyle, fontWeight },\n    pageWidth,\n    pageHeight,\n    rotation,\n    innerMargin\n  ) {\n    let canvas = new OffscreenCanvas(1, 1);\n    let ctx = canvas.getContext(\"2d\", { alpha: false });\n    const fontSize = 200;\n    const font =\n      (ctx.font = `${fontStyle} ${fontWeight} ${fontSize}px ${fontFamily}`);\n    const {\n      actualBoundingBoxLeft,\n      actualBoundingBoxRight,\n      actualBoundingBoxAscent,\n      actualBoundingBoxDescent,\n      fontBoundingBoxAscent,\n      fontBoundingBoxDescent,\n      width,\n    } = ctx.measureText(text);\n\n    // We rescale the canvas to make \"sure\" the text fits.\n    const SCALE = 1.5;\n    const canvasWidth = Math.ceil(\n      Math.max(\n        Math.abs(actualBoundingBoxLeft) + Math.abs(actualBoundingBoxRight) || 0,\n        width\n      ) * SCALE\n    );\n    const canvasHeight = Math.ceil(\n      Math.max(\n        Math.abs(actualBoundingBoxAscent) +\n          Math.abs(actualBoundingBoxDescent) || fontSize,\n        Math.abs(fontBoundingBoxAscent) + Math.abs(fontBoundingBoxDescent) ||\n          fontSize\n      ) * SCALE\n    );\n    canvas = new OffscreenCanvas(canvasWidth, canvasHeight);\n    ctx = canvas.getContext(\"2d\", { alpha: true, willReadFrequently: true });\n    ctx.font = font;\n    ctx.filter = \"grayscale(1)\";\n    ctx.fillStyle = \"white\";\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n    ctx.fillStyle = \"black\";\n    ctx.fillText(\n      text,\n      (canvasWidth * (SCALE - 1)) / 2,\n      (canvasHeight * (3 - SCALE)) / 2\n    );\n\n    const uint8Buf = this.#toUint8(\n      ctx.getImageData(0, 0, canvasWidth, canvasHeight).data\n    );\n    const histogram = this.#getHistogram(uint8Buf);\n    const threshold = this.#guessThreshold(histogram);\n\n    const contourList = this.#findContours(\n      uint8Buf,\n      canvasWidth,\n      canvasHeight,\n      threshold\n    );\n\n    return this.processDrawnLines({\n      lines: { curves: contourList, width: canvasWidth, height: canvasHeight },\n      pageWidth,\n      pageHeight,\n      rotation,\n      innerMargin,\n      mustSmooth: true,\n      areContours: true,\n    });\n  }\n\n  static process(bitmap, pageWidth, pageHeight, rotation, innerMargin) {\n    const [uint8Buf, width, height] = this.#getGrayPixels(bitmap);\n    const [buffer, histogram] = this.#bilateralFilter(\n      uint8Buf,\n      width,\n      height,\n      Math.hypot(width, height) * this.#PARAMETERS.sigmaSFactor,\n      this.#PARAMETERS.sigmaR,\n      this.#PARAMETERS.kernelSize\n    );\n\n    const threshold = this.#guessThreshold(histogram);\n    const contourList = this.#findContours(buffer, width, height, threshold);\n\n    return this.processDrawnLines({\n      lines: { curves: contourList, width, height },\n      pageWidth,\n      pageHeight,\n      rotation,\n      innerMargin,\n      mustSmooth: true,\n      areContours: true,\n    });\n  }\n\n  static processDrawnLines({\n    lines,\n    pageWidth,\n    pageHeight,\n    rotation,\n    innerMargin,\n    mustSmooth,\n    areContours,\n  }) {\n    if (rotation % 180 !== 0) {\n      [pageWidth, pageHeight] = [pageHeight, pageWidth];\n    }\n\n    const { curves, width, height } = lines;\n    const thickness = lines.thickness ?? 0;\n    const linesAndPoints = [];\n    const ratio = Math.min(pageWidth / width, pageHeight / height);\n    const xScale = ratio / pageWidth;\n    const yScale = ratio / pageHeight;\n    const newCurves = [];\n\n    for (const { points } of curves) {\n      const reducedPoints = mustSmooth ? this.#douglasPeucker(points) : points;\n      if (!reducedPoints) {\n        continue;\n      }\n      newCurves.push(reducedPoints);\n\n      const len = reducedPoints.length;\n      const newPoints = new Float32Array(len);\n      const line = new Float32Array(3 * (len === 2 ? 2 : len - 2));\n      linesAndPoints.push({ line, points: newPoints });\n\n      if (len === 2) {\n        newPoints[0] = reducedPoints[0] * xScale;\n        newPoints[1] = reducedPoints[1] * yScale;\n        line.set([NaN, NaN, NaN, NaN, newPoints[0], newPoints[1]], 0);\n        continue;\n      }\n\n      let [x1, y1, x2, y2] = reducedPoints;\n      x1 *= xScale;\n      y1 *= yScale;\n      x2 *= xScale;\n      y2 *= yScale;\n      newPoints.set([x1, y1, x2, y2], 0);\n\n      line.set([NaN, NaN, NaN, NaN, x1, y1], 0);\n      for (let i = 4; i < len; i += 2) {\n        const x = (newPoints[i] = reducedPoints[i] * xScale);\n        const y = (newPoints[i + 1] = reducedPoints[i + 1] * yScale);\n        line.set(Outline.createBezierPoints(x1, y1, x2, y2, x, y), (i - 2) * 3);\n        [x1, y1, x2, y2] = [x2, y2, x, y];\n      }\n    }\n\n    if (linesAndPoints.length === 0) {\n      return null;\n    }\n\n    const outline = areContours\n      ? new ContourDrawOutline()\n      : new InkDrawOutline();\n\n    outline.build(\n      linesAndPoints,\n      pageWidth,\n      pageHeight,\n      1,\n      rotation,\n      areContours ? 0 : thickness,\n      innerMargin\n    );\n\n    return { outline, newCurves, areContours, thickness, width, height };\n  }\n\n  static async compressSignature({\n    outlines,\n    areContours,\n    thickness,\n    width,\n    height,\n  }) {\n    // We create a single array containing all the outlines.\n    // The format is the following:\n    // - 4 bytes: data length.\n    // - 4 bytes: version.\n    // - 4 bytes: width.\n    // - 4 bytes: height.\n    // - 4 bytes: 0 if it's a contour, 1 if it's an ink.\n    // - 4 bytes: thickness.\n    // - 4 bytes: number of drawings.\n    // - 4 bytes: size of the buffer containing the diff of the coordinates.\n    // - 4 bytes: number of points in the first drawing.\n    // - 4 bytes: x coordinate of the first point.\n    // - 4 bytes: y coordinate of the first point.\n    // - 4 bytes: number of points in the second drawing.\n    // - 4 bytes: x coordinate of the first point.\n    // - 4 bytes: y coordinate of the first point.\n    // - ...\n    // - The buffer containing the diff of the coordinates.\n\n    // The coordinates are supposed to be positive integers.\n\n    // We also compute the min and max difference between two points.\n    // This will help us to determine the type of the buffer (Int8, Int16 or\n    // Int32) in order to minimize the amount of data we have.\n    let minDiff = Infinity;\n    let maxDiff = -Infinity;\n    let outlinesLength = 0;\n    for (const points of outlines) {\n      outlinesLength += points.length;\n      for (let i = 2, ii = points.length; i < ii; i++) {\n        const dx = points[i] - points[i - 2];\n        minDiff = Math.min(minDiff, dx);\n        maxDiff = Math.max(maxDiff, dx);\n      }\n    }\n\n    let bufferType;\n    if (minDiff >= -128 && maxDiff <= 127) {\n      bufferType = Int8Array;\n    } else if (minDiff >= -32768 && maxDiff <= 32767) {\n      bufferType = Int16Array;\n    } else {\n      bufferType = Int32Array;\n    }\n\n    const len = outlines.length;\n    const headerLength = BASE_HEADER_LENGTH + POINTS_PROPERTIES_NUMBER * len;\n    const header = new Uint32Array(headerLength);\n\n    let offset = 0;\n    header[offset++] =\n      headerLength * Uint32Array.BYTES_PER_ELEMENT +\n      (outlinesLength - 2 * len) * bufferType.BYTES_PER_ELEMENT;\n    header[offset++] = 0; // Version.\n    header[offset++] = width;\n    header[offset++] = height;\n    header[offset++] = areContours ? 0 : 1;\n    header[offset++] = Math.max(0, Math.floor(thickness ?? 0));\n    header[offset++] = len;\n    header[offset++] = bufferType.BYTES_PER_ELEMENT;\n    for (const points of outlines) {\n      header[offset++] = points.length - 2;\n      header[offset++] = points[0];\n      header[offset++] = points[1];\n    }\n\n    const cs = new CompressionStream(\"deflate-raw\");\n    const writer = cs.writable.getWriter();\n    await writer.ready;\n\n    writer.write(header);\n    const BufferCtor = bufferType.prototype.constructor;\n    for (const points of outlines) {\n      const diffs = new BufferCtor(points.length - 2);\n      for (let i = 2, ii = points.length; i < ii; i++) {\n        diffs[i - 2] = points[i] - points[i - 2];\n      }\n      writer.write(diffs);\n    }\n\n    writer.close();\n\n    const buf = await new Response(cs.readable).arrayBuffer();\n    const bytes = new Uint8Array(buf);\n\n    return toBase64Util(bytes);\n  }\n\n  static async decompressSignature(signatureData) {\n    try {\n      const bytes = fromBase64Util(signatureData);\n      const { readable, writable } = new DecompressionStream(\"deflate-raw\");\n      const writer = writable.getWriter();\n      await writer.ready;\n\n      // We can't await writer.write() because it'll block until the reader\n      // starts which happens few lines below.\n      writer\n        .write(bytes)\n        .then(async () => {\n          await writer.ready;\n          await writer.close();\n        })\n        .catch(() => {});\n\n      let data = null;\n      let offset = 0;\n      for await (const chunk of readable) {\n        data ||= new Uint8Array(new Uint32Array(chunk.buffer, 0, 4)[0]);\n        data.set(chunk, offset);\n        offset += chunk.length;\n      }\n\n      // We take a bit too much data for the header but it's fine.\n      const header = new Uint32Array(data.buffer, 0, data.length >> 2);\n      const version = header[1];\n      if (version !== 0) {\n        throw new Error(`Invalid version: ${version}`);\n      }\n      const width = header[2];\n      const height = header[3];\n      const areContours = header[4] === 0;\n      const thickness = header[5];\n      const numberOfDrawings = header[6];\n      const bufferType = header[7];\n      const outlines = [];\n      const diffsOffset =\n        (BASE_HEADER_LENGTH + POINTS_PROPERTIES_NUMBER * numberOfDrawings) *\n        Uint32Array.BYTES_PER_ELEMENT;\n      let diffs;\n\n      switch (bufferType) {\n        case Int8Array.BYTES_PER_ELEMENT:\n          diffs = new Int8Array(data.buffer, diffsOffset);\n          break;\n        case Int16Array.BYTES_PER_ELEMENT:\n          diffs = new Int16Array(data.buffer, diffsOffset);\n          break;\n        case Int32Array.BYTES_PER_ELEMENT:\n          diffs = new Int32Array(data.buffer, diffsOffset);\n          break;\n      }\n\n      offset = 0;\n      for (let i = 0; i < numberOfDrawings; i++) {\n        const len = header[POINTS_PROPERTIES_NUMBER * i + BASE_HEADER_LENGTH];\n        const points = new Float32Array(len + 2);\n        outlines.push(points);\n\n        for (let j = 0; j < POINTS_PROPERTIES_NUMBER - 1; j++) {\n          points[j] =\n            header[POINTS_PROPERTIES_NUMBER * i + BASE_HEADER_LENGTH + j + 1];\n        }\n        for (let j = 0; j < len; j++) {\n          points[j + 2] = points[j] + diffs[offset++];\n        }\n      }\n\n      return {\n        areContours,\n        thickness,\n        outlines,\n        width,\n        height,\n      };\n    } catch (e) {\n      warn(`decompressSignature: ${e}`);\n      return null;\n    }\n  }\n}\n\nexport { SignatureExtractor };\n","/* Copyright 2025 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorType, shadow } from \"../../shared/util.js\";\nimport { DrawingEditor, DrawingOptions } from \"./draw.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { ContourDrawOutline } from \"./drawers/contour.js\";\nimport { InkDrawingOptions } from \"./ink.js\";\nimport { InkDrawOutline } from \"./drawers/inkdraw.js\";\nimport { SignatureExtractor } from \"./drawers/signaturedraw.js\";\n\nclass SignatureOptions extends DrawingOptions {\n  constructor() {\n    super();\n\n    super.updateProperties({\n      fill: AnnotationEditor._defaultLineColor,\n      \"stroke-width\": 0,\n    });\n  }\n\n  clone() {\n    const clone = new SignatureOptions();\n    clone.updateAll(this);\n    return clone;\n  }\n}\n\nclass DrawnSignatureOptions extends InkDrawingOptions {\n  constructor(viewerParameters) {\n    super(viewerParameters);\n\n    super.updateProperties({\n      stroke: AnnotationEditor._defaultLineColor,\n      \"stroke-width\": 1,\n    });\n  }\n\n  clone() {\n    const clone = new DrawnSignatureOptions(this._viewParameters);\n    clone.updateAll(this);\n    return clone;\n  }\n}\n\n/**\n * Basic editor in order to generate an Stamp annotation annotation containing\n * a signature drawing.\n */\nclass SignatureEditor extends DrawingEditor {\n  #isExtracted = false;\n\n  #description = null;\n\n  #signatureData = null;\n\n  #signatureUUID = null;\n\n  static _type = \"signature\";\n\n  static _editorType = AnnotationEditorType.SIGNATURE;\n\n  static _defaultDrawingOptions = null;\n\n  constructor(params) {\n    super({ ...params, mustBeCommitted: true, name: \"signatureEditor\" });\n    this._willKeepAspectRatio = true;\n    this.#signatureData = params.signatureData || null;\n    this.#description = null;\n    this.defaultL10nId = \"pdfjs-editor-signature-editor1\";\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n\n    this._defaultDrawingOptions = new SignatureOptions();\n    this._defaultDrawnSignatureOptions = new DrawnSignatureOptions(\n      uiManager.viewParameters\n    );\n  }\n\n  /** @inheritdoc */\n  static getDefaultDrawingOptions(options) {\n    const clone = this._defaultDrawingOptions.clone();\n    clone.updateProperties(options);\n    return clone;\n  }\n\n  /** @inheritdoc */\n  static get supportMultipleDrawings() {\n    return false;\n  }\n\n  static get typesMap() {\n    return shadow(this, \"typesMap\", new Map());\n  }\n\n  static get isDrawer() {\n    return false;\n  }\n\n  /** @inheritdoc */\n  get telemetryFinalData() {\n    return {\n      type: \"signature\",\n      hasDescription: !!this.#description,\n    };\n  }\n\n  static computeTelemetryFinalData(data) {\n    const hasDescriptionStats = data.get(\"hasDescription\");\n    return {\n      hasAltText: hasDescriptionStats.get(true) ?? 0,\n      hasNoAltText: hasDescriptionStats.get(false) ?? 0,\n    };\n  }\n\n  /** @inheritdoc */\n  get isResizable() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  onScaleChanging() {\n    if (this._drawId === null) {\n      return;\n    }\n    super.onScaleChanging();\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    const { _isCopy } = this;\n    if (_isCopy) {\n      // No need to adjust the position when rendering in DrawingEditor.\n      this._isCopy = false;\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    super.render();\n\n    if (this._drawId === null) {\n      if (this.#signatureData) {\n        const {\n          lines,\n          mustSmooth,\n          areContours,\n          description,\n          uuid,\n          heightInPage,\n        } = this.#signatureData;\n        const {\n          rawDims: { pageWidth, pageHeight },\n          rotation,\n        } = this.parent.viewport;\n        const outline = SignatureExtractor.processDrawnLines({\n          lines,\n          pageWidth,\n          pageHeight,\n          rotation,\n          innerMargin: SignatureEditor._INNER_MARGIN,\n          mustSmooth,\n          areContours,\n        });\n        this.addSignature(outline, heightInPage, description, uuid);\n      } else {\n        // Avoid Firefox crashing (with a local build) because the description\n        // parameter is missing.\n        this.div.setAttribute(\n          \"data-l10n-args\",\n          JSON.stringify({ description: \"\" })\n        );\n        this.div.hidden = true;\n        this._uiManager.getSignature(this);\n      }\n    } else {\n      this.div.setAttribute(\n        \"data-l10n-args\",\n        JSON.stringify({ description: this.#description || \"\" })\n      );\n    }\n\n    if (_isCopy) {\n      this._isCopy = true;\n      this._moveAfterPaste(baseX, baseY);\n    }\n\n    return this.div;\n  }\n\n  setUuid(uuid) {\n    this.#signatureUUID = uuid;\n    this.addEditToolbar();\n  }\n\n  getUuid() {\n    return this.#signatureUUID;\n  }\n\n  get description() {\n    return this.#description;\n  }\n\n  set description(description) {\n    this.#description = description;\n    if (!this.div) {\n      return;\n    }\n    this.div.setAttribute(\"data-l10n-args\", JSON.stringify({ description }));\n    super.addEditToolbar().then(toolbar => {\n      toolbar?.updateEditSignatureButton(description);\n    });\n  }\n\n  getSignaturePreview() {\n    const { newCurves, areContours, thickness, width, height } =\n      this.#signatureData;\n    const maxDim = Math.max(width, height);\n    const outlineData = SignatureExtractor.processDrawnLines({\n      lines: {\n        curves: newCurves.map(points => ({ points })),\n        thickness,\n        width,\n        height,\n      },\n      pageWidth: maxDim,\n      pageHeight: maxDim,\n      rotation: 0,\n      innerMargin: 0,\n      mustSmooth: false,\n      areContours,\n    });\n    return { areContours, outline: outlineData.outline };\n  }\n\n  /** @inheritdoc */\n  get toolbarButtons() {\n    if (this._uiManager.signatureManager) {\n      return [[\"editSignature\", this._uiManager.signatureManager]];\n    }\n    return super.toolbarButtons;\n  }\n\n  addSignature(data, heightInPage, description, uuid) {\n    const { x: savedX, y: savedY } = this;\n    const { outline } = (this.#signatureData = data);\n    this.#isExtracted = outline instanceof ContourDrawOutline;\n    this.description = description;\n    let drawingOptions;\n    if (this.#isExtracted) {\n      drawingOptions = SignatureEditor.getDefaultDrawingOptions();\n    } else {\n      drawingOptions = SignatureEditor._defaultDrawnSignatureOptions.clone();\n      drawingOptions.updateProperties({ \"stroke-width\": outline.thickness });\n    }\n    this._addOutlines({\n      drawOutlines: outline,\n      drawingOptions,\n    });\n    const [, pageHeight] = this.pageDimensions;\n    let newHeight = heightInPage / pageHeight;\n    // Ensure the signature doesn't exceed the page height.\n    // If the signature is too big, we scale it down to 50% of the page height.\n    newHeight = newHeight >= 1 ? 0.5 : newHeight;\n\n    this.width *= newHeight / this.height;\n    if (this.width >= 1) {\n      newHeight *= 0.9 / this.width;\n      this.width = 0.9;\n    }\n\n    this.height = newHeight;\n    this.setDims();\n    this.x = savedX;\n    this.y = savedY;\n    this.center();\n\n    this._onResized();\n    this.onScaleChanging();\n    this.rotate();\n    this._uiManager.addToAnnotationStorage(this);\n    this.setUuid(uuid);\n\n    this._reportTelemetry({\n      action: \"pdfjs.signature.inserted\",\n      data: {\n        hasBeenSaved: !!uuid,\n        hasDescription: !!description,\n      },\n    });\n\n    this.div.hidden = false;\n  }\n\n  getFromImage(bitmap) {\n    const {\n      rawDims: { pageWidth, pageHeight },\n      rotation,\n    } = this.parent.viewport;\n    return SignatureExtractor.process(\n      bitmap,\n      pageWidth,\n      pageHeight,\n      rotation,\n      SignatureEditor._INNER_MARGIN\n    );\n  }\n\n  getFromText(text, fontInfo) {\n    const {\n      rawDims: { pageWidth, pageHeight },\n      rotation,\n    } = this.parent.viewport;\n    return SignatureExtractor.extractContoursFromText(\n      text,\n      fontInfo,\n      pageWidth,\n      pageHeight,\n      rotation,\n      SignatureEditor._INNER_MARGIN\n    );\n  }\n\n  getDrawnSignature(curves) {\n    const {\n      rawDims: { pageWidth, pageHeight },\n      rotation,\n    } = this.parent.viewport;\n    return SignatureExtractor.processDrawnLines({\n      lines: curves,\n      pageWidth,\n      pageHeight,\n      rotation,\n      innerMargin: SignatureEditor._INNER_MARGIN,\n      mustSmooth: false,\n      areContours: false,\n    });\n  }\n\n  /** @inheritdoc */\n  createDrawingOptions({ areContours, thickness }) {\n    if (areContours) {\n      this._drawingOptions = SignatureEditor.getDefaultDrawingOptions();\n    } else {\n      this._drawingOptions =\n        SignatureEditor._defaultDrawnSignatureOptions.clone();\n      this._drawingOptions.updateProperties({ \"stroke-width\": thickness });\n    }\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    const { lines, points } = this.serializeDraw(isForCopying);\n    const {\n      _drawingOptions: { \"stroke-width\": thickness },\n    } = this;\n    const serialized = Object.assign(super.serialize(isForCopying), {\n      isSignature: true,\n      areContours: this.#isExtracted,\n      color: [0, 0, 0],\n      thickness: this.#isExtracted ? 0 : thickness,\n    });\n    this.addComment(serialized);\n    if (isForCopying) {\n      serialized.paths = { lines, points };\n      serialized.uuid = this.#signatureUUID;\n      serialized.isCopy = true;\n    } else {\n      serialized.lines = lines;\n    }\n    if (this.#description) {\n      serialized.accessibilityData = { type: \"Figure\", alt: this.#description };\n    }\n    return serialized;\n  }\n\n  /** @inheritdoc */\n  static deserializeDraw(\n    pageX,\n    pageY,\n    pageWidth,\n    pageHeight,\n    innerMargin,\n    data\n  ) {\n    if (data.areContours) {\n      return ContourDrawOutline.deserialize(\n        pageX,\n        pageY,\n        pageWidth,\n        pageHeight,\n        innerMargin,\n        data\n      );\n    }\n\n    return InkDrawOutline.deserialize(\n      pageX,\n      pageY,\n      pageWidth,\n      pageHeight,\n      innerMargin,\n      data\n    );\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    const editor = await super.deserialize(data, parent, uiManager);\n    editor.#isExtracted = data.areContours;\n    editor.description = data.accessibilityData?.alt || \"\";\n    editor.#signatureUUID = data.uuid;\n    return editor;\n  }\n}\n\nexport { SignatureEditor };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorType, AnnotationPrefix } from \"../../shared/util.js\";\nimport {\n  ColorScheme,\n  OutputScale,\n  PixelsPerInch,\n  SupportedImageMimeTypes,\n} from \"../display_utils.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { StampAnnotationElement } from \"../annotation_layer.js\";\n\n/**\n * Basic text editor in order to create a FreeTex annotation.\n */\nclass StampEditor extends AnnotationEditor {\n  #bitmap = null;\n\n  #bitmapId = null;\n\n  #bitmapPromise = null;\n\n  #bitmapUrl = null;\n\n  #bitmapFile = null;\n\n  #bitmapFileName = \"\";\n\n  #canvas = null;\n\n  #missingCanvas = false;\n\n  #resizeTimeoutId = null;\n\n  #isSvg = false;\n\n  #hasBeenAddedInUndoStack = false;\n\n  static _type = \"stamp\";\n\n  static _editorType = AnnotationEditorType.STAMP;\n\n  constructor(params) {\n    super({ ...params, name: \"stampEditor\" });\n    this.#bitmapUrl = params.bitmapUrl;\n    this.#bitmapFile = params.bitmapFile;\n    this.defaultL10nId = \"pdfjs-editor-stamp-editor\";\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n  }\n\n  /** @inheritdoc */\n  static isHandlingMimeForPasting(mime) {\n    return SupportedImageMimeTypes.includes(mime);\n  }\n\n  /** @inheritdoc */\n  static paste(item, parent) {\n    parent.pasteEditor(\n      { mode: AnnotationEditorType.STAMP },\n      { bitmapFile: item.getAsFile() }\n    );\n  }\n\n  /** @inheritdoc */\n  altTextFinish() {\n    if (this._uiManager.useNewAltTextFlow) {\n      this.div.hidden = false;\n    }\n    super.altTextFinish();\n  }\n\n  /** @inheritdoc */\n  get telemetryFinalData() {\n    return {\n      type: \"stamp\",\n      hasAltText: !!this.altTextData?.altText,\n    };\n  }\n\n  static computeTelemetryFinalData(data) {\n    const hasAltTextStats = data.get(\"hasAltText\");\n    return {\n      hasAltText: hasAltTextStats.get(true) ?? 0,\n      hasNoAltText: hasAltTextStats.get(false) ?? 0,\n    };\n  }\n\n  #getBitmapFetched(data, fromId = false) {\n    if (!data) {\n      this.remove();\n      return;\n    }\n    this.#bitmap = data.bitmap;\n    if (!fromId) {\n      this.#bitmapId = data.id;\n      this.#isSvg = data.isSvg;\n    }\n    if (data.file) {\n      this.#bitmapFileName = data.file.name;\n    }\n    this.#createCanvas();\n  }\n\n  #getBitmapDone() {\n    this.#bitmapPromise = null;\n    this._uiManager.enableWaiting(false);\n    if (!this.#canvas) {\n      return;\n    }\n    if (\n      this._uiManager.useNewAltTextWhenAddingImage &&\n      this._uiManager.useNewAltTextFlow &&\n      this.#bitmap\n    ) {\n      this.addEditToolbar().then(() => {\n        this._editToolbar.hide();\n        this._uiManager.editAltText(this, /* firstTime = */ true);\n      });\n      return;\n    }\n\n    if (\n      !this._uiManager.useNewAltTextWhenAddingImage &&\n      this._uiManager.useNewAltTextFlow &&\n      this.#bitmap\n    ) {\n      this._reportTelemetry({\n        action: \"pdfjs.image.image_added\",\n        data: { alt_text_modal: false, alt_text_type: \"empty\" },\n      });\n      try {\n        // The alt-text dialog isn't opened but we still want to guess the alt\n        // text.\n        this.mlGuessAltText();\n      } catch {}\n    }\n\n    this.div.focus();\n  }\n\n  async mlGuessAltText(imageData = null, updateAltTextData = true) {\n    if (this.hasAltTextData()) {\n      return null;\n    }\n\n    const { mlManager } = this._uiManager;\n    if (!mlManager) {\n      throw new Error(\"No ML.\");\n    }\n    if (!(await mlManager.isEnabledFor(\"altText\"))) {\n      throw new Error(\"ML isn't enabled for alt text.\");\n    }\n    const { data, width, height } =\n      imageData ||\n      this.copyCanvas(null, null, /* createImageData = */ true).imageData;\n    const response = await mlManager.guess({\n      name: \"altText\",\n      request: {\n        data,\n        width,\n        height,\n        channels: data.length / (width * height),\n      },\n    });\n    if (!response) {\n      throw new Error(\"No response from the AI service.\");\n    }\n    if (response.error) {\n      throw new Error(\"Error from the AI service.\");\n    }\n    if (response.cancel) {\n      return null;\n    }\n    if (!response.output) {\n      throw new Error(\"No valid response from the AI service.\");\n    }\n    const altText = response.output;\n    await this.setGuessedAltText(altText);\n    if (updateAltTextData && !this.hasAltTextData()) {\n      this.altTextData = { alt: altText, decorative: false };\n    }\n    return altText;\n  }\n\n  #getBitmap() {\n    if (this.#bitmapId) {\n      this._uiManager.enableWaiting(true);\n      this._uiManager.imageManager\n        .getFromId(this.#bitmapId)\n        .then(data => this.#getBitmapFetched(data, /* fromId = */ true))\n        .finally(() => this.#getBitmapDone());\n      return;\n    }\n\n    if (this.#bitmapUrl) {\n      const url = this.#bitmapUrl;\n      this.#bitmapUrl = null;\n      this._uiManager.enableWaiting(true);\n      this.#bitmapPromise = this._uiManager.imageManager\n        .getFromUrl(url)\n        .then(data => this.#getBitmapFetched(data))\n        .finally(() => this.#getBitmapDone());\n      return;\n    }\n\n    if (this.#bitmapFile) {\n      const file = this.#bitmapFile;\n      this.#bitmapFile = null;\n      this._uiManager.enableWaiting(true);\n      this.#bitmapPromise = this._uiManager.imageManager\n        .getFromFile(file)\n        .then(data => this.#getBitmapFetched(data))\n        .finally(() => this.#getBitmapDone());\n      return;\n    }\n\n    const input = document.createElement(\"input\");\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      input.hidden = true;\n      input.id = \"stampEditorFileInput\";\n      document.body.append(input);\n    }\n    input.type = \"file\";\n    input.accept = SupportedImageMimeTypes.join(\",\");\n    const signal = this._uiManager._signal;\n    this.#bitmapPromise = new Promise(resolve => {\n      input.addEventListener(\n        \"change\",\n        async () => {\n          if (!input.files || input.files.length === 0) {\n            this.remove();\n          } else {\n            this._uiManager.enableWaiting(true);\n            const data = await this._uiManager.imageManager.getFromFile(\n              input.files[0]\n            );\n            this._reportTelemetry({\n              action: \"pdfjs.image.image_selected\",\n              data: { alt_text_modal: this._uiManager.useNewAltTextFlow },\n            });\n            this.#getBitmapFetched(data);\n          }\n          if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n            input.remove();\n          }\n          resolve();\n        },\n        { signal }\n      );\n      input.addEventListener(\n        \"cancel\",\n        () => {\n          this.remove();\n          resolve();\n        },\n        { signal }\n      );\n    }).finally(() => this.#getBitmapDone());\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"TESTING\")) {\n      input.click();\n    }\n  }\n\n  /** @inheritdoc */\n  remove() {\n    if (this.#bitmapId) {\n      this.#bitmap = null;\n      this._uiManager.imageManager.deleteId(this.#bitmapId);\n      this.#canvas?.remove();\n      this.#canvas = null;\n      if (this.#resizeTimeoutId) {\n        clearTimeout(this.#resizeTimeoutId);\n        this.#resizeTimeoutId = null;\n      }\n    }\n    super.remove();\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      // It's possible to have to rebuild an editor which is not on a visible\n      // page.\n      if (this.#bitmapId) {\n        this.#getBitmap();\n      }\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    if (this.#bitmapId && this.#canvas === null) {\n      this.#getBitmap();\n    }\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilting it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  /** @inheritdoc */\n  onceAdded(focus) {\n    this._isDraggable = true;\n    if (focus) {\n      this.div.focus();\n    }\n  }\n\n  /** @inheritdoc */\n  isEmpty() {\n    return !(\n      this.#bitmapPromise ||\n      this.#bitmap ||\n      this.#bitmapUrl ||\n      this.#bitmapFile ||\n      this.#bitmapId ||\n      this.#missingCanvas\n    );\n  }\n\n  /** @inheritdoc */\n  get toolbarButtons() {\n    return [[\"altText\", this.createAltText()]];\n  }\n\n  /** @inheritdoc */\n  get isResizable() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    if (this._isCopy) {\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    super.render();\n    this.div.hidden = true;\n\n    this.createAltText();\n\n    if (!this.#missingCanvas) {\n      if (this.#bitmap) {\n        this.#createCanvas();\n      } else {\n        this.#getBitmap();\n      }\n    }\n\n    if (this._isCopy) {\n      this._moveAfterPaste(baseX, baseY);\n    }\n\n    this._uiManager.addShouldRescale(this);\n\n    return this.div;\n  }\n\n  setCanvas(annotationElementId, canvas) {\n    const { id: bitmapId, bitmap } = this._uiManager.imageManager.getFromCanvas(\n      annotationElementId,\n      canvas\n    );\n    canvas.remove();\n    if (bitmapId && this._uiManager.imageManager.isValidId(bitmapId)) {\n      this.#bitmapId = bitmapId;\n      if (bitmap) {\n        this.#bitmap = bitmap;\n      }\n      this.#missingCanvas = false;\n      this.#createCanvas();\n    }\n  }\n\n  /** @inheritdoc */\n  _onResized() {\n    // We used a CSS-zoom during the resizing, but now it's resized we can\n    // rescale correctly the bitmap to fit the new dimensions.\n    this.onScaleChanging();\n  }\n\n  onScaleChanging() {\n    if (!this.parent) {\n      return;\n    }\n    if (this.#resizeTimeoutId !== null) {\n      clearTimeout(this.#resizeTimeoutId);\n    }\n    // The user's zooming the page, there is no need to redraw the bitmap at\n    // each step, hence we wait a bit before redrawing it.\n    const TIME_TO_WAIT = 200;\n    this.#resizeTimeoutId = setTimeout(() => {\n      this.#resizeTimeoutId = null;\n      this.#drawBitmap();\n    }, TIME_TO_WAIT);\n  }\n\n  #createCanvas() {\n    const { div } = this;\n    let { width, height } = this.#bitmap;\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const MAX_RATIO = 0.75;\n    if (this.width) {\n      width = this.width * pageWidth;\n      height = this.height * pageHeight;\n    } else if (\n      width > MAX_RATIO * pageWidth ||\n      height > MAX_RATIO * pageHeight\n    ) {\n      // If the image is too big compared to the page dimensions\n      // (more than MAX_RATIO) then we scale it down.\n      const factor = Math.min(\n        (MAX_RATIO * pageWidth) / width,\n        (MAX_RATIO * pageHeight) / height\n      );\n      width *= factor;\n      height *= factor;\n    }\n\n    this._uiManager.enableWaiting(false);\n    const canvas = (this.#canvas = document.createElement(\"canvas\"));\n    canvas.setAttribute(\"role\", \"img\");\n    this.addContainer(canvas);\n\n    this.width = width / pageWidth;\n    this.height = height / pageHeight;\n    this.setDims();\n\n    if (this._initialOptions?.isCentered) {\n      this.center();\n    } else {\n      this.fixAndSetPosition();\n    }\n    this._initialOptions = null;\n\n    if (\n      !this._uiManager.useNewAltTextWhenAddingImage ||\n      !this._uiManager.useNewAltTextFlow ||\n      this.annotationElementId\n    ) {\n      div.hidden = false;\n    }\n    this.#drawBitmap();\n    if (!this.#hasBeenAddedInUndoStack) {\n      this.parent.addUndoableEditor(this);\n      this.#hasBeenAddedInUndoStack = true;\n    }\n\n    // There are multiple ways to add an image to the page, so here we just\n    // count the number of times an image is added to the page whatever the way\n    // is.\n    this._reportTelemetry({\n      action: \"inserted_image\",\n    });\n    if (this.#bitmapFileName) {\n      this.div.setAttribute(\"aria-description\", this.#bitmapFileName);\n    }\n    if (!this.annotationElementId) {\n      this._uiManager.a11yAlert(\"pdfjs-editor-stamp-added-alert\");\n    }\n  }\n\n  copyCanvas(maxDataDimension, maxPreviewDimension, createImageData = false) {\n    if (!maxDataDimension) {\n      // TODO: get this value from Firefox\n      //   (https://bugzilla.mozilla.org/show_bug.cgi?id=1908184)\n      // It's the maximum dimension that the AI can handle.\n      maxDataDimension = 224;\n    }\n\n    const { width: bitmapWidth, height: bitmapHeight } = this.#bitmap;\n    const outputScale = new OutputScale();\n\n    let bitmap = this.#bitmap;\n    let width = bitmapWidth,\n      height = bitmapHeight;\n    let canvas = null;\n\n    if (maxPreviewDimension) {\n      if (\n        bitmapWidth > maxPreviewDimension ||\n        bitmapHeight > maxPreviewDimension\n      ) {\n        const ratio = Math.min(\n          maxPreviewDimension / bitmapWidth,\n          maxPreviewDimension / bitmapHeight\n        );\n        width = Math.floor(bitmapWidth * ratio);\n        height = Math.floor(bitmapHeight * ratio);\n      }\n\n      canvas = document.createElement(\"canvas\");\n      const scaledWidth = (canvas.width = Math.ceil(width * outputScale.sx));\n      const scaledHeight = (canvas.height = Math.ceil(height * outputScale.sy));\n\n      if (!this.#isSvg) {\n        bitmap = this.#scaleBitmap(scaledWidth, scaledHeight);\n      }\n\n      const ctx = canvas.getContext(\"2d\");\n      ctx.filter = this._uiManager.hcmFilter;\n\n      // Add a checkerboard pattern as a background in case the image has some\n      // transparency.\n      let white = \"white\",\n        black = \"#cfcfd8\";\n      if (this._uiManager.hcmFilter !== \"none\") {\n        black = \"black\";\n      } else if (ColorScheme.isDarkMode) {\n        white = \"#8f8f9d\";\n        black = \"#42414d\";\n      }\n      const boxDim = 15;\n      const boxDimWidth = boxDim * outputScale.sx;\n      const boxDimHeight = boxDim * outputScale.sy;\n      const pattern = new OffscreenCanvas(boxDimWidth * 2, boxDimHeight * 2);\n      const patternCtx = pattern.getContext(\"2d\");\n      patternCtx.fillStyle = white;\n      patternCtx.fillRect(0, 0, boxDimWidth * 2, boxDimHeight * 2);\n      patternCtx.fillStyle = black;\n      patternCtx.fillRect(0, 0, boxDimWidth, boxDimHeight);\n      patternCtx.fillRect(boxDimWidth, boxDimHeight, boxDimWidth, boxDimHeight);\n      ctx.fillStyle = ctx.createPattern(pattern, \"repeat\");\n      ctx.fillRect(0, 0, scaledWidth, scaledHeight);\n      ctx.drawImage(\n        bitmap,\n        0,\n        0,\n        bitmap.width,\n        bitmap.height,\n        0,\n        0,\n        scaledWidth,\n        scaledHeight\n      );\n    }\n\n    let imageData = null;\n    if (createImageData) {\n      let dataWidth, dataHeight;\n      if (\n        outputScale.symmetric &&\n        bitmap.width < maxDataDimension &&\n        bitmap.height < maxDataDimension\n      ) {\n        dataWidth = bitmap.width;\n        dataHeight = bitmap.height;\n      } else {\n        bitmap = this.#bitmap;\n        if (bitmapWidth > maxDataDimension || bitmapHeight > maxDataDimension) {\n          const ratio = Math.min(\n            maxDataDimension / bitmapWidth,\n            maxDataDimension / bitmapHeight\n          );\n          dataWidth = Math.floor(bitmapWidth * ratio);\n          dataHeight = Math.floor(bitmapHeight * ratio);\n\n          if (!this.#isSvg) {\n            bitmap = this.#scaleBitmap(dataWidth, dataHeight);\n          }\n        }\n      }\n\n      const offscreen = new OffscreenCanvas(dataWidth, dataHeight);\n      const offscreenCtx = offscreen.getContext(\"2d\", {\n        willReadFrequently: true,\n      });\n      offscreenCtx.drawImage(\n        bitmap,\n        0,\n        0,\n        bitmap.width,\n        bitmap.height,\n        0,\n        0,\n        dataWidth,\n        dataHeight\n      );\n      imageData = {\n        width: dataWidth,\n        height: dataHeight,\n        data: offscreenCtx.getImageData(0, 0, dataWidth, dataHeight).data,\n      };\n    }\n\n    return { canvas, width, height, imageData };\n  }\n\n  #scaleBitmap(width, height) {\n    const { width: bitmapWidth, height: bitmapHeight } = this.#bitmap;\n\n    let newWidth = bitmapWidth;\n    let newHeight = bitmapHeight;\n    let bitmap = this.#bitmap;\n    while (newWidth > 2 * width || newHeight > 2 * height) {\n      const prevWidth = newWidth;\n      const prevHeight = newHeight;\n\n      if (newWidth > 2 * width) {\n        // See bug 1820511 (Windows specific bug).\n        // TODO: once the above bug is fixed we could revert to:\n        // newWidth = Math.ceil(newWidth / 2);\n        newWidth =\n          newWidth >= 16384\n            ? Math.floor(newWidth / 2) - 1\n            : Math.ceil(newWidth / 2);\n      }\n      if (newHeight > 2 * height) {\n        newHeight =\n          newHeight >= 16384\n            ? Math.floor(newHeight / 2) - 1\n            : Math.ceil(newHeight / 2);\n      }\n\n      const offscreen = new OffscreenCanvas(newWidth, newHeight);\n      const ctx = offscreen.getContext(\"2d\");\n      ctx.drawImage(\n        bitmap,\n        0,\n        0,\n        prevWidth,\n        prevHeight,\n        0,\n        0,\n        newWidth,\n        newHeight\n      );\n      bitmap = offscreen.transferToImageBitmap();\n    }\n\n    return bitmap;\n  }\n\n  #drawBitmap() {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const { width, height } = this;\n    const outputScale = new OutputScale();\n    const scaledWidth = Math.ceil(width * parentWidth * outputScale.sx);\n    const scaledHeight = Math.ceil(height * parentHeight * outputScale.sy);\n    const canvas = this.#canvas;\n\n    if (\n      !canvas ||\n      (canvas.width === scaledWidth && canvas.height === scaledHeight)\n    ) {\n      return;\n    }\n\n    canvas.width = scaledWidth;\n    canvas.height = scaledHeight;\n\n    const bitmap = this.#isSvg\n      ? this.#bitmap\n      : this.#scaleBitmap(scaledWidth, scaledHeight);\n\n    const ctx = canvas.getContext(\"2d\");\n    ctx.filter = this._uiManager.hcmFilter;\n    ctx.drawImage(\n      bitmap,\n      0,\n      0,\n      bitmap.width,\n      bitmap.height,\n      0,\n      0,\n      scaledWidth,\n      scaledHeight\n    );\n  }\n\n  #serializeBitmap(toUrl) {\n    if (toUrl) {\n      if (this.#isSvg) {\n        const url = this._uiManager.imageManager.getSvgUrl(this.#bitmapId);\n        if (url) {\n          return url;\n        }\n      }\n      // We convert to a data url because it's sync and the url can live in the\n      // clipboard.\n      const canvas = document.createElement(\"canvas\");\n      ({ width: canvas.width, height: canvas.height } = this.#bitmap);\n      const ctx = canvas.getContext(\"2d\");\n      ctx.drawImage(this.#bitmap, 0, 0);\n\n      return canvas.toDataURL();\n    }\n\n    if (this.#isSvg) {\n      const [pageWidth, pageHeight] = this.pageDimensions;\n      // Multiply by PixelsPerInch.PDF_TO_CSS_UNITS in order to increase the\n      // image resolution when rasterizing it.\n      const width = Math.round(\n        this.width * pageWidth * PixelsPerInch.PDF_TO_CSS_UNITS\n      );\n      const height = Math.round(\n        this.height * pageHeight * PixelsPerInch.PDF_TO_CSS_UNITS\n      );\n      const offscreen = new OffscreenCanvas(width, height);\n      const ctx = offscreen.getContext(\"2d\");\n      ctx.drawImage(\n        this.#bitmap,\n        0,\n        0,\n        this.#bitmap.width,\n        this.#bitmap.height,\n        0,\n        0,\n        width,\n        height\n      );\n      return offscreen.transferToImageBitmap();\n    }\n\n    return structuredClone(this.#bitmap);\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    let initialData = null;\n    let missingCanvas = false;\n    if (data instanceof StampAnnotationElement) {\n      const {\n        data: {\n          rect,\n          rotation,\n          id,\n          structParent,\n          popupRef,\n          richText,\n          contentsObj,\n          creationDate,\n          modificationDate,\n        },\n        container,\n        parent: {\n          page: { pageNumber },\n        },\n        canvas,\n      } = data;\n      let bitmapId, bitmap;\n      if (canvas) {\n        delete data.canvas;\n        ({ id: bitmapId, bitmap } = uiManager.imageManager.getFromCanvas(\n          container.id,\n          canvas\n        ));\n        canvas.remove();\n      } else {\n        missingCanvas = true;\n        data._hasNoCanvas = true;\n      }\n\n      // When switching to edit mode, we wait for the structure tree to be\n      // ready (see pdf_viewer.js), so it's fine to use getAriaAttributesSync.\n      const altText =\n        (\n          await parent._structTree.getAriaAttributes(`${AnnotationPrefix}${id}`)\n        )?.get(\"aria-label\") || \"\";\n\n      initialData = data = {\n        annotationType: AnnotationEditorType.STAMP,\n        bitmapId,\n        bitmap,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        annotationElementId: id,\n        id,\n        deleted: false,\n        accessibilityData: {\n          decorative: false,\n          altText,\n        },\n        isSvg: false,\n        structParent,\n        popupRef,\n        richText,\n        comment: contentsObj?.str || null,\n        creationDate,\n        modificationDate,\n      };\n    }\n    const editor = await super.deserialize(data, parent, uiManager);\n    const { rect, bitmap, bitmapUrl, bitmapId, isSvg, accessibilityData } =\n      data;\n    if (missingCanvas) {\n      uiManager.addMissingCanvas(data.id, editor);\n      editor.#missingCanvas = true;\n    } else if (bitmapId && uiManager.imageManager.isValidId(bitmapId)) {\n      editor.#bitmapId = bitmapId;\n      if (bitmap) {\n        editor.#bitmap = bitmap;\n      }\n    } else {\n      editor.#bitmapUrl = bitmapUrl;\n    }\n    editor.#isSvg = isSvg;\n\n    const [parentWidth, parentHeight] = editor.pageDimensions;\n    editor.width = (rect[2] - rect[0]) / parentWidth;\n    editor.height = (rect[3] - rect[1]) / parentHeight;\n\n    if (accessibilityData) {\n      editor.altTextData = accessibilityData;\n    }\n    editor._initialData = initialData;\n    if (data.comment) {\n      editor.setCommentData(data);\n    }\n    // No need to be add in the undo stack if the editor is created from an\n    // existing one.\n    editor.#hasBeenAddedInUndoStack = !!initialData;\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false, context = null) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    if (this.deleted) {\n      return this.serializeDeleted();\n    }\n\n    const serialized = Object.assign(super.serialize(isForCopying), {\n      bitmapId: this.#bitmapId,\n      isSvg: this.#isSvg,\n    });\n    this.addComment(serialized);\n\n    if (isForCopying) {\n      // We don't know what's the final destination (this pdf or another one)\n      // of this annotation and the clipboard doesn't support ImageBitmaps,\n      // hence we serialize the bitmap to a data url.\n      serialized.bitmapUrl = this.#serializeBitmap(/* toUrl = */ true);\n      serialized.accessibilityData = this.serializeAltText(true);\n      serialized.isCopy = true;\n      return serialized;\n    }\n\n    const { decorative, altText } = this.serializeAltText(false);\n    if (!decorative && altText) {\n      serialized.accessibilityData = { type: \"Figure\", alt: altText };\n    }\n    if (this.annotationElementId) {\n      const changes = this.#hasElementChanged(serialized);\n      if (changes.isSame) {\n        // Nothing has been changed.\n        return null;\n      }\n      if (changes.isSameAltText) {\n        delete serialized.accessibilityData;\n      } else {\n        serialized.accessibilityData.structParent =\n          this._initialData.structParent ?? -1;\n      }\n      serialized.id = this.annotationElementId;\n      delete serialized.bitmapId;\n      return serialized;\n    }\n\n    if (context === null) {\n      return serialized;\n    }\n\n    context.stamps ||= new Map();\n    const area = this.#isSvg\n      ? (serialized.rect[2] - serialized.rect[0]) *\n        (serialized.rect[3] - serialized.rect[1])\n      : null;\n    if (!context.stamps.has(this.#bitmapId)) {\n      // We don't want to have multiple copies of the same bitmap in the\n      // annotationMap, hence we only add the bitmap the first time we meet it.\n      context.stamps.set(this.#bitmapId, { area, serialized });\n      serialized.bitmap = this.#serializeBitmap(/* toUrl = */ false);\n    } else if (this.#isSvg) {\n      // If we have multiple copies of the same svg but with different sizes,\n      // then we want to keep the biggest one.\n      const prevData = context.stamps.get(this.#bitmapId);\n      if (area > prevData.area) {\n        prevData.area = area;\n        prevData.serialized.bitmap.close();\n        prevData.serialized.bitmap = this.#serializeBitmap(/* toUrl = */ false);\n      }\n    }\n    return serialized;\n  }\n\n  #hasElementChanged(serialized) {\n    const {\n      pageIndex,\n      accessibilityData: { altText },\n    } = this._initialData;\n\n    const isSamePageIndex = serialized.pageIndex === pageIndex;\n    const isSameAltText = (serialized.accessibilityData?.alt || \"\") === altText;\n\n    return {\n      isSame:\n        !this.hasEditedComment &&\n        !this._hasBeenMoved &&\n        !this._hasBeenResized &&\n        isSamePageIndex &&\n        isSameAltText,\n      isSameAltText,\n    };\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    if (this.deleted) {\n      annotation.hide();\n      return null;\n    }\n    annotation.updateEdited({\n      rect: this.getPDFRect(),\n      popup: this.comment,\n    });\n\n    return null;\n  }\n}\n\nexport { StampEditor };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./tools.js\").AnnotationEditorUIManager} AnnotationEditorUIManager */\n/** @typedef {import(\"../display_utils.js\").PageViewport} PageViewport */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../../web/text_accessibility.js\").TextAccessibilityManager} TextAccessibilityManager */\n/** @typedef {import(\"../../../web/interfaces\").IL10n} IL10n */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../annotation_layer.js\").AnnotationLayer} AnnotationLayer */\n/** @typedef {import(\"../draw_layer.js\").DrawLayer} DrawLayer */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/struct_tree_layer_builder.js\").StructTreeLayerBuilder} StructTreeLayerBuilder */\n\nimport {\n  AnnotationEditorPrefix,\n  AnnotationEditorType,\n  FeatureTest,\n} from \"../../shared/util.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { FreeTextEditor } from \"./freetext.js\";\nimport { HighlightEditor } from \"./highlight.js\";\nimport { InkEditor } from \"./ink.js\";\nimport { setLayerDimensions } from \"../display_utils.js\";\nimport { SignatureEditor } from \"./signature.js\";\nimport { StampEditor } from \"./stamp.js\";\n\n/**\n * @typedef {Object} AnnotationEditorLayerOptions\n * @property {Object} mode\n * @property {HTMLDivElement} div\n * @property {StructTreeLayerBuilder} structTreeLayer\n * @property {AnnotationEditorUIManager} uiManager\n * @property {boolean} enabled\n * @property {TextAccessibilityManager} [accessibilityManager]\n * @property {number} pageIndex\n * @property {IL10n} l10n\n * @property {AnnotationLayer} [annotationLayer]\n * @property {HTMLDivElement} [textLayer]\n * @property {DrawLayer} drawLayer\n * @property {PageViewport} viewport\n */\n\n/**\n * @typedef {Object} RenderEditorLayerOptions\n * @property {PageViewport} viewport\n */\n\n/**\n * Manage all the different editors on a page.\n */\nclass AnnotationEditorLayer {\n  #accessibilityManager;\n\n  #allowClick = false;\n\n  #annotationLayer = null;\n\n  #clickAC = null;\n\n  #editorFocusTimeoutId = null;\n\n  #editors = new Map();\n\n  #hadPointerDown = false;\n\n  #isDisabling = false;\n\n  #isEnabling = false;\n\n  #drawingAC = null;\n\n  #focusedElement = null;\n\n  #textLayer = null;\n\n  #textSelectionAC = null;\n\n  #textLayerDblClickAC = null;\n\n  #lastPointerDownTimestamp = -1;\n\n  #uiManager;\n\n  static _initialized = false;\n\n  static #editorTypes = new Map(\n    [\n      FreeTextEditor,\n      InkEditor,\n      StampEditor,\n      HighlightEditor,\n      SignatureEditor,\n    ].map(type => [type._editorType, type])\n  );\n\n  /**\n   * @param {AnnotationEditorLayerOptions} options\n   */\n  constructor({\n    uiManager,\n    pageIndex,\n    div,\n    structTreeLayer,\n    accessibilityManager,\n    annotationLayer,\n    drawLayer,\n    textLayer,\n    viewport,\n    l10n,\n  }) {\n    const editorTypes = [...AnnotationEditorLayer.#editorTypes.values()];\n    if (!AnnotationEditorLayer._initialized) {\n      AnnotationEditorLayer._initialized = true;\n      for (const editorType of editorTypes) {\n        editorType.initialize(l10n, uiManager);\n      }\n    }\n    uiManager.registerEditorTypes(editorTypes);\n\n    this.#uiManager = uiManager;\n    this.pageIndex = pageIndex;\n    this.div = div;\n    this.#accessibilityManager = accessibilityManager;\n    this.#annotationLayer = annotationLayer;\n    this.viewport = viewport;\n    this.#textLayer = textLayer;\n    this.drawLayer = drawLayer;\n    this._structTree = structTreeLayer;\n\n    this.#uiManager.addLayer(this);\n  }\n\n  get isEmpty() {\n    return this.#editors.size === 0;\n  }\n\n  get isInvisible() {\n    return (\n      this.isEmpty && this.#uiManager.getMode() === AnnotationEditorType.NONE\n    );\n  }\n\n  /**\n   * Update the toolbar if it's required to reflect the tool currently used.\n   * @param {Object} options\n   */\n  updateToolbar(options) {\n    this.#uiManager.updateToolbar(options);\n  }\n\n  /**\n   * The mode has changed: it must be updated.\n   * @param {number} mode\n   */\n  updateMode(mode = this.#uiManager.getMode()) {\n    this.#cleanup();\n    switch (mode) {\n      case AnnotationEditorType.NONE:\n        this.div.classList.toggle(\"nonEditing\", true);\n        this.disableTextSelection();\n        this.togglePointerEvents(false);\n        this.toggleAnnotationLayerPointerEvents(true);\n        this.disableClick();\n        return;\n      case AnnotationEditorType.INK:\n        this.disableTextSelection();\n        this.togglePointerEvents(true);\n        this.enableClick();\n        break;\n      case AnnotationEditorType.HIGHLIGHT:\n        this.enableTextSelection();\n        this.togglePointerEvents(false);\n        this.disableClick();\n        break;\n      default:\n        this.disableTextSelection();\n        this.togglePointerEvents(true);\n        this.enableClick();\n    }\n\n    this.toggleAnnotationLayerPointerEvents(false);\n    const { classList } = this.div;\n    classList.toggle(\"nonEditing\", false);\n    if (mode === AnnotationEditorType.POPUP) {\n      classList.toggle(\"commentEditing\", true);\n    } else {\n      classList.toggle(\"commentEditing\", false);\n      for (const editorType of AnnotationEditorLayer.#editorTypes.values()) {\n        classList.toggle(\n          `${editorType._type}Editing`,\n          mode === editorType._editorType\n        );\n      }\n    }\n    this.div.hidden = false;\n  }\n\n  hasTextLayer(textLayer) {\n    return textLayer === this.#textLayer?.div;\n  }\n\n  /**\n   * Set the editing state.\n   * @param {boolean} isEditing\n   */\n  setEditingState(isEditing) {\n    this.#uiManager.setEditingState(isEditing);\n  }\n\n  /**\n   * Add some commands into the CommandManager (undo/redo stuff).\n   * @param {Object} params\n   */\n  addCommands(params) {\n    this.#uiManager.addCommands(params);\n  }\n\n  cleanUndoStack(type) {\n    this.#uiManager.cleanUndoStack(type);\n  }\n\n  toggleDrawing(enabled = false) {\n    this.div.classList.toggle(\"drawing\", !enabled);\n  }\n\n  togglePointerEvents(enabled = false) {\n    this.div.classList.toggle(\"disabled\", !enabled);\n  }\n\n  toggleAnnotationLayerPointerEvents(enabled = false) {\n    this.#annotationLayer?.togglePointerEvents(enabled);\n  }\n\n  get #allEditorsIterator() {\n    return this.#editors.size !== 0\n      ? this.#editors.values()\n      : this.#uiManager.getEditors(this.pageIndex);\n  }\n\n  /**\n   * Enable pointer events on the main div in order to enable\n   * editor creation.\n   */\n  async enable() {\n    this.#isEnabling = true;\n    this.div.tabIndex = 0;\n    this.togglePointerEvents(true);\n    this.div.classList.toggle(\"nonEditing\", false);\n    this.#textLayerDblClickAC?.abort();\n    this.#textLayerDblClickAC = null;\n    const annotationElementIds = new Set();\n    for (const editor of this.#allEditorsIterator) {\n      editor.enableEditing();\n      editor.show(true);\n      if (editor.annotationElementId) {\n        this.#uiManager.removeChangedExistingAnnotation(editor);\n        annotationElementIds.add(editor.annotationElementId);\n      }\n    }\n\n    const annotationLayer = this.#annotationLayer;\n    if (annotationLayer) {\n      for (const editable of annotationLayer.getEditableAnnotations()) {\n        // The element must be hidden whatever its state is.\n        editable.hide();\n        if (this.#uiManager.isDeletedAnnotationElement(editable.data.id)) {\n          continue;\n        }\n        if (annotationElementIds.has(editable.data.id)) {\n          continue;\n        }\n        const editor = await this.deserialize(editable);\n        if (!editor) {\n          continue;\n        }\n        this.addOrRebuild(editor);\n        editor.enableEditing();\n      }\n    }\n    this.#isEnabling = false;\n    this.#uiManager._eventBus.dispatch(\"editorsrendered\", {\n      source: this,\n      pageNumber: this.pageIndex + 1,\n    });\n  }\n\n  /**\n   * Disable editor creation.\n   */\n  disable() {\n    this.#isDisabling = true;\n    this.div.tabIndex = -1;\n    this.togglePointerEvents(false);\n    this.div.classList.toggle(\"nonEditing\", true);\n    if (this.#textLayer && !this.#textLayerDblClickAC) {\n      this.#textLayerDblClickAC = new AbortController();\n      const signal = this.#uiManager.combinedSignal(this.#textLayerDblClickAC);\n      this.#textLayer.div.addEventListener(\n        \"pointerdown\",\n        e => {\n          // It's the default value in Fenix:\n          // https://searchfox.org/mozilla-central/rev/beba5cde846f944c4d709e75cbe499d17af880a4/modules/libpref/init/StaticPrefList.yaml#19064\n          // and in Chrome and Windows:\n          // https://source.chromium.org/chromium/chromium/src/+/main:ui/events/event_constants.h;drc=f0f5f3ceebb00da9363ccc7a1e2c0f17b6b383ba;l=115\n          const DBL_CLICK_THRESHOLD = 500;\n          const { clientX, clientY, timeStamp } = e;\n          const lastPointerDownTimestamp = this.#lastPointerDownTimestamp;\n          if (timeStamp - lastPointerDownTimestamp > DBL_CLICK_THRESHOLD) {\n            this.#lastPointerDownTimestamp = timeStamp;\n            return;\n          }\n          this.#lastPointerDownTimestamp = -1;\n          const { classList } = this.div;\n          classList.toggle(\"getElements\", true);\n          const elements = document.elementsFromPoint(clientX, clientY);\n          classList.toggle(\"getElements\", false);\n          if (!this.div.contains(elements[0])) {\n            return;\n          }\n          let id;\n          const regex = new RegExp(`^${AnnotationEditorPrefix}[0-9]+$`);\n          for (const element of elements) {\n            if (regex.test(element.id)) {\n              id = element.id;\n              break;\n            }\n          }\n          if (!id) {\n            return;\n          }\n          const editor = this.#editors.get(id);\n          if (editor?.annotationElementId === null) {\n            e.stopPropagation();\n            e.preventDefault();\n            editor.dblclick(e);\n          }\n        },\n        { signal, capture: true }\n      );\n    }\n\n    const annotationLayer = this.#annotationLayer;\n    const needFakeAnnotation = [];\n    if (annotationLayer) {\n      const changedAnnotations = new Map();\n      const resetAnnotations = new Map();\n      for (const editor of this.#allEditorsIterator) {\n        editor.disableEditing();\n        if (!editor.annotationElementId) {\n          needFakeAnnotation.push(editor);\n          continue;\n        }\n        if (editor.serialize() !== null) {\n          changedAnnotations.set(editor.annotationElementId, editor);\n          continue;\n        } else {\n          resetAnnotations.set(editor.annotationElementId, editor);\n        }\n        this.getEditableAnnotation(editor.annotationElementId)?.show();\n        editor.remove();\n      }\n\n      // Show the annotations that were hidden in enable().\n      const editables = annotationLayer.getEditableAnnotations();\n      for (const editable of editables) {\n        const { id } = editable.data;\n        if (this.#uiManager.isDeletedAnnotationElement(id)) {\n          editable.updateEdited({ deleted: true });\n          continue;\n        }\n        let editor = resetAnnotations.get(id);\n        if (editor) {\n          editor.resetAnnotationElement(editable);\n          editor.show(false);\n          editable.show();\n          continue;\n        }\n\n        editor = changedAnnotations.get(id);\n        if (editor) {\n          this.#uiManager.addChangedExistingAnnotation(editor);\n          if (editor.renderAnnotationElement(editable)) {\n            // Content has changed, so we need to hide the editor.\n            editor.show(false);\n          }\n        }\n        editable.show();\n      }\n    }\n\n    this.#cleanup();\n    if (this.isEmpty) {\n      this.div.hidden = true;\n    }\n    const { classList } = this.div;\n    for (const editorType of AnnotationEditorLayer.#editorTypes.values()) {\n      classList.remove(`${editorType._type}Editing`);\n    }\n    this.disableTextSelection();\n    this.toggleAnnotationLayerPointerEvents(true);\n    annotationLayer?.updateFakeAnnotations(needFakeAnnotation);\n\n    this.#isDisabling = false;\n  }\n\n  getEditableAnnotation(id) {\n    return this.#annotationLayer?.getEditableAnnotation(id) || null;\n  }\n\n  /**\n   * Set the current editor.\n   * @param {AnnotationEditor} editor\n   */\n  setActiveEditor(editor) {\n    const currentActive = this.#uiManager.getActive();\n    if (currentActive === editor) {\n      return;\n    }\n\n    this.#uiManager.setActiveEditor(editor);\n  }\n\n  enableTextSelection() {\n    this.div.tabIndex = -1;\n    if (this.#textLayer?.div && !this.#textSelectionAC) {\n      this.#textSelectionAC = new AbortController();\n      const signal = this.#uiManager.combinedSignal(this.#textSelectionAC);\n\n      this.#textLayer.div.addEventListener(\n        \"pointerdown\",\n        this.#textLayerPointerDown.bind(this),\n        { signal }\n      );\n      this.#textLayer.div.classList.add(\"highlighting\");\n    }\n  }\n\n  disableTextSelection() {\n    this.div.tabIndex = 0;\n    if (this.#textLayer?.div && this.#textSelectionAC) {\n      this.#textSelectionAC.abort();\n      this.#textSelectionAC = null;\n\n      this.#textLayer.div.classList.remove(\"highlighting\");\n    }\n  }\n\n  #textLayerPointerDown(event) {\n    // Unselect all the editors in order to let the user select some text\n    // without being annoyed by an editor toolbar.\n    this.#uiManager.unselectAll();\n    const { target } = event;\n    if (\n      target === this.#textLayer.div ||\n      ((target.getAttribute(\"role\") === \"img\" ||\n        target.classList.contains(\"endOfContent\")) &&\n        this.#textLayer.div.contains(target))\n    ) {\n      const { isMac } = FeatureTest.platform;\n      if (event.button !== 0 || (event.ctrlKey && isMac)) {\n        // Do nothing on right click.\n        return;\n      }\n      this.#uiManager.showAllEditors(\n        \"highlight\",\n        true,\n        /* updateButton = */ true\n      );\n      this.#textLayer.div.classList.add(\"free\");\n      this.toggleDrawing();\n      HighlightEditor.startHighlighting(\n        this,\n        this.#uiManager.direction === \"ltr\",\n        { target: this.#textLayer.div, x: event.x, y: event.y }\n      );\n      this.#textLayer.div.addEventListener(\n        \"pointerup\",\n        () => {\n          this.#textLayer.div.classList.remove(\"free\");\n          this.toggleDrawing(true);\n        },\n        { once: true, signal: this.#uiManager._signal }\n      );\n      event.preventDefault();\n    }\n  }\n\n  enableClick() {\n    if (this.#clickAC) {\n      return;\n    }\n    this.#clickAC = new AbortController();\n    const signal = this.#uiManager.combinedSignal(this.#clickAC);\n\n    this.div.addEventListener(\"pointerdown\", this.pointerdown.bind(this), {\n      signal,\n    });\n    const pointerup = this.pointerup.bind(this);\n    this.div.addEventListener(\"pointerup\", pointerup, { signal });\n    this.div.addEventListener(\"pointercancel\", pointerup, { signal });\n  }\n\n  disableClick() {\n    this.#clickAC?.abort();\n    this.#clickAC = null;\n  }\n\n  attach(editor) {\n    this.#editors.set(editor.id, editor);\n    const { annotationElementId } = editor;\n    if (\n      annotationElementId &&\n      this.#uiManager.isDeletedAnnotationElement(annotationElementId)\n    ) {\n      this.#uiManager.removeDeletedAnnotationElement(editor);\n    }\n  }\n\n  detach(editor) {\n    this.#editors.delete(editor.id);\n    this.#accessibilityManager?.removePointerInTextLayer(editor.contentDiv);\n\n    if (!this.#isDisabling && editor.annotationElementId) {\n      this.#uiManager.addDeletedAnnotationElement(editor);\n    }\n  }\n\n  /**\n   * Remove an editor.\n   * @param {AnnotationEditor} editor\n   */\n  remove(editor) {\n    this.detach(editor);\n    this.#uiManager.removeEditor(editor);\n    editor.div.remove();\n    editor.isAttachedToDOM = false;\n  }\n\n  /**\n   * An editor can have a different parent, for example after having\n   * being dragged and dropped from a page to another.\n   * @param {AnnotationEditor} editor\n   */\n  changeParent(editor) {\n    if (editor.parent === this) {\n      return;\n    }\n\n    if (editor.parent && editor.annotationElementId) {\n      this.#uiManager.addDeletedAnnotationElement(editor);\n      AnnotationEditor.deleteAnnotationElement(editor);\n      editor.annotationElementId = null;\n    }\n\n    this.attach(editor);\n    editor.parent?.detach(editor);\n    editor.setParent(this);\n    if (editor.div && editor.isAttachedToDOM) {\n      editor.div.remove();\n      this.div.append(editor.div);\n    }\n  }\n\n  /**\n   * Add a new editor in the current view.\n   * @param {AnnotationEditor} editor\n   */\n  add(editor) {\n    if (editor.parent === this && editor.isAttachedToDOM) {\n      return;\n    }\n    this.changeParent(editor);\n    this.#uiManager.addEditor(editor);\n    this.attach(editor);\n\n    if (!editor.isAttachedToDOM) {\n      const div = editor.render();\n      this.div.append(div);\n      editor.isAttachedToDOM = true;\n    }\n\n    // The editor will be correctly moved into the DOM (see fixAndSetPosition).\n    editor.fixAndSetPosition();\n    editor.onceAdded(/* focus = */ !this.#isEnabling);\n    this.#uiManager.addToAnnotationStorage(editor);\n    editor._reportTelemetry(editor.telemetryInitialData);\n  }\n\n  moveEditorInDOM(editor) {\n    if (!editor.isAttachedToDOM) {\n      return;\n    }\n\n    const { activeElement } = document;\n    if (editor.div.contains(activeElement) && !this.#editorFocusTimeoutId) {\n      // When the div is moved in the DOM the focus can move somewhere else,\n      // so we want to be sure that the focus will stay on the editor but we\n      // don't want to call any focus callbacks, hence we disable them and only\n      // re-enable them when the editor has the focus.\n      editor._focusEventsAllowed = false;\n      this.#editorFocusTimeoutId = setTimeout(() => {\n        this.#editorFocusTimeoutId = null;\n        if (!editor.div.contains(document.activeElement)) {\n          editor.div.addEventListener(\n            \"focusin\",\n            () => {\n              editor._focusEventsAllowed = true;\n            },\n            { once: true, signal: this.#uiManager._signal }\n          );\n          activeElement.focus();\n        } else {\n          editor._focusEventsAllowed = true;\n        }\n      }, 0);\n    }\n\n    editor._structTreeParentId = this.#accessibilityManager?.moveElementInDOM(\n      this.div,\n      editor.div,\n      editor.contentDiv,\n      /* isRemovable = */ true\n    );\n  }\n\n  /**\n   * Add or rebuild depending if it has been removed or not.\n   * @param {AnnotationEditor} editor\n   */\n  addOrRebuild(editor) {\n    if (editor.needsToBeRebuilt()) {\n      editor.parent ||= this;\n      editor.rebuild();\n      editor.show();\n    } else {\n      this.add(editor);\n    }\n  }\n\n  /**\n   * Add a new editor and make this addition undoable.\n   * @param {AnnotationEditor} editor\n   */\n  addUndoableEditor(editor) {\n    const cmd = () => editor._uiManager.rebuild(editor);\n    const undo = () => {\n      editor.remove();\n    };\n\n    this.addCommands({ cmd, undo, mustExec: false });\n  }\n\n  getEditorByUID(uid) {\n    for (const editor of this.#editors.values()) {\n      if (editor.uid === uid) {\n        return editor;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Get an id for an editor.\n   * @returns {string}\n   */\n  getNextId() {\n    return this.#uiManager.getId();\n  }\n\n  get #currentEditorType() {\n    return AnnotationEditorLayer.#editorTypes.get(this.#uiManager.getMode());\n  }\n\n  combinedSignal(ac) {\n    return this.#uiManager.combinedSignal(ac);\n  }\n\n  /**\n   * Create a new editor\n   * @param {Object} params\n   * @returns {AnnotationEditor}\n   */\n  #createNewEditor(params) {\n    const editorType = this.#currentEditorType;\n    return editorType ? new editorType.prototype.constructor(params) : null;\n  }\n\n  canCreateNewEmptyEditor() {\n    return this.#currentEditorType?.canCreateNewEmptyEditor();\n  }\n\n  /**\n   * Paste some content into a new editor.\n   * @param {Object} options\n   * @param {Object} params\n   */\n  async pasteEditor(options, params) {\n    this.updateToolbar(options);\n    await this.#uiManager.updateMode(options.mode);\n\n    const { offsetX, offsetY } = this.#getCenterPoint();\n    const id = this.getNextId();\n    const editor = this.#createNewEditor({\n      parent: this,\n      id,\n      x: offsetX,\n      y: offsetY,\n      uiManager: this.#uiManager,\n      isCentered: true,\n      ...params,\n    });\n    if (editor) {\n      this.add(editor);\n    }\n  }\n\n  /**\n   * Create a new editor\n   * @param {Object} data\n   * @returns {Promise<AnnotationEditor | null>}\n   */\n  async deserialize(data) {\n    return (\n      (await AnnotationEditorLayer.#editorTypes\n        .get(data.annotationType ?? data.annotationEditorType)\n        ?.deserialize(data, this, this.#uiManager)) || null\n    );\n  }\n\n  /**\n   * Create and add a new editor.\n   * @param {PointerEvent} event\n   * @param {boolean} isCentered\n   * @param [Object] data\n   * @returns {AnnotationEditor}\n   */\n  createAndAddNewEditor(event, isCentered, data = {}) {\n    const id = this.getNextId();\n    const editor = this.#createNewEditor({\n      parent: this,\n      id,\n      x: event.offsetX,\n      y: event.offsetY,\n      uiManager: this.#uiManager,\n      isCentered,\n      ...data,\n    });\n    if (editor) {\n      this.add(editor);\n    }\n\n    return editor;\n  }\n\n  get boundingClientRect() {\n    return this.div.getBoundingClientRect();\n  }\n\n  #getCenterPoint() {\n    const { x, y, width, height } = this.boundingClientRect;\n    const tlX = Math.max(0, x);\n    const tlY = Math.max(0, y);\n    const brX = Math.min(window.innerWidth, x + width);\n    const brY = Math.min(window.innerHeight, y + height);\n    const centerX = (tlX + brX) / 2 - x;\n    const centerY = (tlY + brY) / 2 - y;\n    const [offsetX, offsetY] =\n      this.viewport.rotation % 180 === 0\n        ? [centerX, centerY]\n        : [centerY, centerX];\n\n    return { offsetX, offsetY };\n  }\n\n  /**\n   * Create and add a new editor.\n   */\n  addNewEditor(data = {}) {\n    this.createAndAddNewEditor(\n      this.#getCenterPoint(),\n      /* isCentered = */ true,\n      data\n    );\n  }\n\n  /**\n   * Set the last selected editor.\n   * @param {AnnotationEditor} editor\n   */\n  setSelected(editor) {\n    this.#uiManager.setSelected(editor);\n  }\n\n  /**\n   * Add or remove an editor the current selection.\n   * @param {AnnotationEditor} editor\n   */\n  toggleSelected(editor) {\n    this.#uiManager.toggleSelected(editor);\n  }\n\n  /**\n   * Unselect an editor.\n   * @param {AnnotationEditor} editor\n   */\n  unselect(editor) {\n    this.#uiManager.unselect(editor);\n  }\n\n  /**\n   * Pointerup callback.\n   * @param {PointerEvent} event\n   */\n  pointerup(event) {\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      // Don't create an editor on right click.\n      return;\n    }\n\n    if (event.target !== this.div) {\n      return;\n    }\n\n    if (!this.#hadPointerDown) {\n      // It can happen when the user starts a drag inside a text editor\n      // and then releases the mouse button outside of it. In such a case\n      // we don't want to create a new editor, hence we check that a pointerdown\n      // occurred on this div previously.\n      return;\n    }\n    this.#hadPointerDown = false;\n\n    if (\n      this.#currentEditorType?.isDrawer &&\n      this.#currentEditorType.supportMultipleDrawings\n    ) {\n      return;\n    }\n\n    if (!this.#allowClick) {\n      this.#allowClick = true;\n      return;\n    }\n\n    const currentMode = this.#uiManager.getMode();\n    if (\n      currentMode === AnnotationEditorType.STAMP ||\n      currentMode === AnnotationEditorType.SIGNATURE\n    ) {\n      this.#uiManager.unselectAll();\n      return;\n    }\n\n    this.createAndAddNewEditor(event, /* isCentered = */ false);\n  }\n\n  /**\n   * Pointerdown callback.\n   * @param {PointerEvent} event\n   */\n  pointerdown(event) {\n    if (this.#uiManager.getMode() === AnnotationEditorType.HIGHLIGHT) {\n      this.enableTextSelection();\n    }\n    if (this.#hadPointerDown) {\n      // It's possible to have a second pointerdown event before a pointerup one\n      // when the user puts a finger on a touchscreen and then add a second one\n      // to start a pinch-to-zoom gesture.\n      // That said, in case it's possible to have two pointerdown events with\n      // a mouse, we don't want to create a new editor in such a case either.\n      this.#hadPointerDown = false;\n      return;\n    }\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      // Do nothing on right click.\n      return;\n    }\n\n    if (event.target !== this.div) {\n      return;\n    }\n\n    this.#hadPointerDown = true;\n\n    if (this.#currentEditorType?.isDrawer) {\n      this.startDrawingSession(event);\n      return;\n    }\n\n    const editor = this.#uiManager.getActive();\n    this.#allowClick = !editor || editor.isEmpty();\n  }\n\n  startDrawingSession(event) {\n    this.div.focus({\n      preventScroll: true,\n    });\n    if (this.#drawingAC) {\n      this.#currentEditorType.startDrawing(this, this.#uiManager, false, event);\n      return;\n    }\n\n    this.#uiManager.setCurrentDrawingSession(this);\n    this.#drawingAC = new AbortController();\n    const signal = this.#uiManager.combinedSignal(this.#drawingAC);\n    this.div.addEventListener(\n      \"blur\",\n      ({ relatedTarget }) => {\n        if (relatedTarget && !this.div.contains(relatedTarget)) {\n          this.#focusedElement = null;\n          this.commitOrRemove();\n        }\n      },\n      { signal }\n    );\n    this.#currentEditorType.startDrawing(this, this.#uiManager, false, event);\n  }\n\n  pause(on) {\n    if (on) {\n      const { activeElement } = document;\n      if (this.div.contains(activeElement)) {\n        this.#focusedElement = activeElement;\n      }\n      return;\n    }\n    if (this.#focusedElement) {\n      setTimeout(() => {\n        this.#focusedElement?.focus();\n        this.#focusedElement = null;\n      }, 0);\n    }\n  }\n\n  endDrawingSession(isAborted = false) {\n    if (!this.#drawingAC) {\n      return null;\n    }\n    this.#uiManager.setCurrentDrawingSession(null);\n    this.#drawingAC.abort();\n    this.#drawingAC = null;\n    this.#focusedElement = null;\n    return this.#currentEditorType.endDrawing(isAborted);\n  }\n\n  /**\n   *\n   * @param {AnnotationEditor} editor\n   * @param {number} x\n   * @param {number} y\n   * @returns\n   */\n  findNewParent(editor, x, y) {\n    const layer = this.#uiManager.findParent(x, y);\n    if (layer === null || layer === this) {\n      return false;\n    }\n    layer.changeParent(editor);\n    return true;\n  }\n\n  commitOrRemove() {\n    if (this.#drawingAC) {\n      this.endDrawingSession();\n      return true;\n    }\n    return false;\n  }\n\n  onScaleChanging() {\n    if (!this.#drawingAC) {\n      return;\n    }\n    this.#currentEditorType.onScaleChangingWhenDrawing(this);\n  }\n\n  /**\n   * Destroy the main editor.\n   */\n  destroy() {\n    this.commitOrRemove();\n    if (this.#uiManager.getActive()?.parent === this) {\n      // We need to commit the current editor before destroying the layer.\n      this.#uiManager.commitOrRemove();\n      this.#uiManager.setActiveEditor(null);\n    }\n\n    if (this.#editorFocusTimeoutId) {\n      clearTimeout(this.#editorFocusTimeoutId);\n      this.#editorFocusTimeoutId = null;\n    }\n\n    for (const editor of this.#editors.values()) {\n      this.#accessibilityManager?.removePointerInTextLayer(editor.contentDiv);\n      editor.setParent(null);\n      editor.isAttachedToDOM = false;\n      editor.div.remove();\n    }\n    this.div = null;\n    this.#editors.clear();\n    this.#uiManager.removeLayer(this);\n  }\n\n  #cleanup() {\n    // When we're cleaning up, some editors are removed but we don't want\n    // to add a new one which will induce an addition in this.#editors, hence\n    // an infinite loop.\n    for (const editor of this.#editors.values()) {\n      if (editor.isEmpty()) {\n        editor.remove();\n      }\n    }\n  }\n\n  /**\n   * Render the main editor.\n   * @param {RenderEditorLayerOptions} parameters\n   */\n  render({ viewport }) {\n    this.viewport = viewport;\n    setLayerDimensions(this.div, viewport);\n    for (const editor of this.#uiManager.getEditors(this.pageIndex)) {\n      this.add(editor);\n      editor.rebuild();\n    }\n    // We're maybe rendering a layer which was invisible when we started to edit\n    // so we must set the different callbacks for it.\n    this.updateMode();\n  }\n\n  /**\n   * Update the main editor.\n   * @param {RenderEditorLayerOptions} parameters\n   */\n  update({ viewport }) {\n    // Editors have their dimensions/positions in percent so to avoid any\n    // issues (see #15582), we must commit the current one before changing\n    // the viewport.\n    this.#uiManager.commitOrRemove();\n    this.#cleanup();\n\n    const oldRotation = this.viewport.rotation;\n    const rotation = viewport.rotation;\n\n    this.viewport = viewport;\n    setLayerDimensions(this.div, { rotation });\n    if (oldRotation !== rotation) {\n      for (const editor of this.#editors.values()) {\n        editor.rotate(rotation);\n      }\n    }\n  }\n\n  /**\n   * Get page dimensions.\n   * @returns {Object} dimensions.\n   */\n  get pageDimensions() {\n    const { pageWidth, pageHeight } = this.viewport.rawDims;\n    return [pageWidth, pageHeight];\n  }\n\n  get scale() {\n    return this.#uiManager.viewParameters.realScale;\n  }\n}\n\nexport { AnnotationEditorLayer };\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DOMSVGFactory } from \"./svg_factory.js\";\nimport { shadow } from \"../shared/util.js\";\n\n/**\n * Manage the SVGs drawn on top of the page canvas.\n * It's important to have them directly on top of the canvas because we want to\n * be able to use mix-blend-mode for some of them.\n */\nclass DrawLayer {\n  #parent = null;\n\n  #mapping = new Map();\n\n  #toUpdate = new Map();\n\n  static #id = 0;\n\n  constructor({ pageIndex }) {\n    this.pageIndex = pageIndex;\n  }\n\n  setParent(parent) {\n    if (!this.#parent) {\n      this.#parent = parent;\n      return;\n    }\n\n    if (this.#parent !== parent) {\n      if (this.#mapping.size > 0) {\n        for (const root of this.#mapping.values()) {\n          root.remove();\n          parent.append(root);\n        }\n      }\n      this.#parent = parent;\n    }\n  }\n\n  static get _svgFactory() {\n    return shadow(this, \"_svgFactory\", new DOMSVGFactory());\n  }\n\n  static #setBox(element, [x, y, width, height]) {\n    const { style } = element;\n    style.top = `${100 * y}%`;\n    style.left = `${100 * x}%`;\n    style.width = `${100 * width}%`;\n    style.height = `${100 * height}%`;\n  }\n\n  #createSVG() {\n    const svg = DrawLayer._svgFactory.create(1, 1, /* skipDimensions = */ true);\n    this.#parent.append(svg);\n    svg.setAttribute(\"aria-hidden\", true);\n\n    return svg;\n  }\n\n  #createClipPath(defs, pathId) {\n    const clipPath = DrawLayer._svgFactory.createElement(\"clipPath\");\n    defs.append(clipPath);\n    const clipPathId = `clip_${pathId}`;\n    clipPath.setAttribute(\"id\", clipPathId);\n    clipPath.setAttribute(\"clipPathUnits\", \"objectBoundingBox\");\n    const clipPathUse = DrawLayer._svgFactory.createElement(\"use\");\n    clipPath.append(clipPathUse);\n    clipPathUse.setAttribute(\"href\", `#${pathId}`);\n    clipPathUse.classList.add(\"clip\");\n\n    return clipPathId;\n  }\n\n  #updateProperties(element, properties) {\n    for (const [key, value] of Object.entries(properties)) {\n      if (value === null) {\n        element.removeAttribute(key);\n      } else {\n        element.setAttribute(key, value);\n      }\n    }\n  }\n\n  draw(properties, isPathUpdatable = false, hasClip = false) {\n    const id = DrawLayer.#id++;\n    const root = this.#createSVG();\n\n    const defs = DrawLayer._svgFactory.createElement(\"defs\");\n    root.append(defs);\n    const path = DrawLayer._svgFactory.createElement(\"path\");\n    defs.append(path);\n    const pathId = `path_p${this.pageIndex}_${id}`;\n    path.setAttribute(\"id\", pathId);\n    path.setAttribute(\"vector-effect\", \"non-scaling-stroke\");\n\n    if (isPathUpdatable) {\n      this.#toUpdate.set(id, path);\n    }\n\n    // Create the clipping path for the editor div.\n    const clipPathId = hasClip ? this.#createClipPath(defs, pathId) : null;\n\n    const use = DrawLayer._svgFactory.createElement(\"use\");\n    root.append(use);\n    use.setAttribute(\"href\", `#${pathId}`);\n    this.updateProperties(root, properties);\n\n    this.#mapping.set(id, root);\n\n    return { id, clipPathId: `url(#${clipPathId})` };\n  }\n\n  drawOutline(properties, mustRemoveSelfIntersections) {\n    // We cannot draw the outline directly in the SVG for highlights because\n    // it composes with its parent with mix-blend-mode: multiply.\n    // But the outline has a different mix-blend-mode, so we need to draw it in\n    // its own SVG.\n    const id = DrawLayer.#id++;\n    const root = this.#createSVG();\n    const defs = DrawLayer._svgFactory.createElement(\"defs\");\n    root.append(defs);\n    const path = DrawLayer._svgFactory.createElement(\"path\");\n    defs.append(path);\n    const pathId = `path_p${this.pageIndex}_${id}`;\n    path.setAttribute(\"id\", pathId);\n    path.setAttribute(\"vector-effect\", \"non-scaling-stroke\");\n\n    let maskId;\n    if (mustRemoveSelfIntersections) {\n      const mask = DrawLayer._svgFactory.createElement(\"mask\");\n      defs.append(mask);\n      maskId = `mask_p${this.pageIndex}_${id}`;\n      mask.setAttribute(\"id\", maskId);\n      mask.setAttribute(\"maskUnits\", \"objectBoundingBox\");\n      const rect = DrawLayer._svgFactory.createElement(\"rect\");\n      mask.append(rect);\n      rect.setAttribute(\"width\", \"1\");\n      rect.setAttribute(\"height\", \"1\");\n      rect.setAttribute(\"fill\", \"white\");\n      const use = DrawLayer._svgFactory.createElement(\"use\");\n      mask.append(use);\n      use.setAttribute(\"href\", `#${pathId}`);\n      use.setAttribute(\"stroke\", \"none\");\n      use.setAttribute(\"fill\", \"black\");\n      use.setAttribute(\"fill-rule\", \"nonzero\");\n      use.classList.add(\"mask\");\n    }\n\n    const use1 = DrawLayer._svgFactory.createElement(\"use\");\n    root.append(use1);\n    use1.setAttribute(\"href\", `#${pathId}`);\n    if (maskId) {\n      use1.setAttribute(\"mask\", `url(#${maskId})`);\n    }\n    const use2 = use1.cloneNode();\n    root.append(use2);\n    use1.classList.add(\"mainOutline\");\n    use2.classList.add(\"secondaryOutline\");\n\n    this.updateProperties(root, properties);\n\n    this.#mapping.set(id, root);\n\n    return id;\n  }\n\n  finalizeDraw(id, properties) {\n    this.#toUpdate.delete(id);\n    this.updateProperties(id, properties);\n  }\n\n  updateProperties(elementOrId, properties) {\n    if (!properties) {\n      return;\n    }\n    const { root, bbox, rootClass, path } = properties;\n    const element =\n      typeof elementOrId === \"number\"\n        ? this.#mapping.get(elementOrId)\n        : elementOrId;\n    if (!element) {\n      return;\n    }\n    if (root) {\n      this.#updateProperties(element, root);\n    }\n    if (bbox) {\n      DrawLayer.#setBox(element, bbox);\n    }\n    if (rootClass) {\n      const { classList } = element;\n      for (const [className, value] of Object.entries(rootClass)) {\n        classList.toggle(className, value);\n      }\n    }\n    if (path) {\n      const defs = element.firstElementChild;\n      const pathElement = defs.firstElementChild;\n      this.#updateProperties(pathElement, path);\n    }\n  }\n\n  updateParent(id, layer) {\n    if (layer === this) {\n      return;\n    }\n    const root = this.#mapping.get(id);\n    if (!root) {\n      return;\n    }\n    layer.#parent.append(root);\n    this.#mapping.delete(id);\n    layer.#mapping.set(id, root);\n  }\n\n  remove(id) {\n    this.#toUpdate.delete(id);\n    if (this.#parent === null) {\n      return;\n    }\n    this.#mapping.get(id).remove();\n    this.#mapping.delete(id);\n  }\n\n  destroy() {\n    this.#parent = null;\n    for (const root of this.#mapping.values()) {\n      root.remove();\n    }\n    this.#mapping.clear();\n    this.#toUpdate.clear();\n  }\n}\n\nexport { DrawLayer };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./display/api\").OnProgressParameters} OnProgressParameters */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./display/api\").PDFDocumentLoadingTask} PDFDocumentLoadingTask */\n/** @typedef {import(\"./display/api\").PDFDocumentProxy} PDFDocumentProxy */\n/** @typedef {import(\"./display/api\").PDFPageProxy} PDFPageProxy */\n/** @typedef {import(\"./display/api\").RenderTask} RenderTask */\n/** @typedef {import(\"./display/display_utils\").PageViewport} PageViewport */\n\nimport {\n  AbortException,\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  AnnotationMode,\n  AnnotationType,\n  createValidAbsoluteUrl,\n  FeatureTest,\n  getUuid,\n  ImageKind,\n  InvalidPDFException,\n  MathClamp,\n  normalizeUnicode,\n  OPS,\n  PasswordResponses,\n  PermissionFlag,\n  ResponseException,\n  shadow,\n  updateUrlHash,\n  Util,\n  VerbosityLevel,\n} from \"./shared/util.js\";\nimport {\n  applyOpacity,\n  CSSConstants,\n  fetchData,\n  findContrastColor,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getRGB,\n  getXfaPageViewport,\n  isDataScheme,\n  isPdfFile,\n  noContextMenu,\n  OutputScale,\n  PDFDateString,\n  PixelsPerInch,\n  RenderingCancelledException,\n  renderRichText,\n  setLayerDimensions,\n  stopEvent,\n  SupportedImageMimeTypes,\n} from \"./display/display_utils.js\";\nimport {\n  build,\n  getDocument,\n  PDFDataRangeTransport,\n  PDFWorker,\n  version,\n} from \"./display/api.js\";\nimport { AnnotationEditorLayer } from \"./display/editor/annotation_editor_layer.js\";\nimport { AnnotationEditorUIManager } from \"./display/editor/tools.js\";\nimport { AnnotationLayer } from \"./display/annotation_layer.js\";\nimport { ColorPicker } from \"./display/editor/color_picker.js\";\nimport { DOMSVGFactory } from \"./display/svg_factory.js\";\nimport { DrawLayer } from \"./display/draw_layer.js\";\nimport { GlobalWorkerOptions } from \"./display/worker_options.js\";\nimport { HighlightOutliner } from \"./display/editor/drawers/highlight.js\";\nimport { isValidExplicitDest } from \"./display/api_utils.js\";\nimport { SignatureExtractor } from \"./display/editor/drawers/signaturedraw.js\";\nimport { TextLayer } from \"./display/text_layer.js\";\nimport { TouchManager } from \"./display/touch_manager.js\";\nimport { XfaLayer } from \"./display/xfa_layer.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING || GENERIC\")) {\n  globalThis._pdfjsTestingUtils = {\n    HighlightOutliner,\n  };\n}\n\nglobalThis.pdfjsLib = {\n  AbortException,\n  AnnotationEditorLayer,\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  AnnotationEditorUIManager,\n  AnnotationLayer,\n  AnnotationMode,\n  AnnotationType,\n  applyOpacity,\n  build,\n  ColorPicker,\n  createValidAbsoluteUrl,\n  CSSConstants,\n  DOMSVGFactory,\n  DrawLayer,\n  FeatureTest,\n  fetchData,\n  findContrastColor,\n  getDocument,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getRGB,\n  getUuid,\n  getXfaPageViewport,\n  GlobalWorkerOptions,\n  ImageKind,\n  InvalidPDFException,\n  isDataScheme,\n  isPdfFile,\n  isValidExplicitDest,\n  MathClamp,\n  noContextMenu,\n  normalizeUnicode,\n  OPS,\n  OutputScale,\n  PasswordResponses,\n  PDFDataRangeTransport,\n  PDFDateString,\n  PDFWorker,\n  PermissionFlag,\n  PixelsPerInch,\n  RenderingCancelledException,\n  renderRichText,\n  ResponseException,\n  setLayerDimensions,\n  shadow,\n  SignatureExtractor,\n  stopEvent,\n  SupportedImageMimeTypes,\n  TextLayer,\n  TouchManager,\n  updateUrlHash,\n  Util,\n  VerbosityLevel,\n  version,\n  XfaLayer,\n};\n\nexport {\n  AbortException,\n  AnnotationEditorLayer,\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  AnnotationEditorUIManager,\n  AnnotationLayer,\n  AnnotationMode,\n  AnnotationType,\n  applyOpacity,\n  build,\n  ColorPicker,\n  createValidAbsoluteUrl,\n  CSSConstants,\n  DOMSVGFactory,\n  DrawLayer,\n  FeatureTest,\n  fetchData,\n  findContrastColor,\n  getDocument,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getRGB,\n  getUuid,\n  getXfaPageViewport,\n  GlobalWorkerOptions,\n  ImageKind,\n  InvalidPDFException,\n  isDataScheme,\n  isPdfFile,\n  isValidExplicitDest,\n  MathClamp,\n  noContextMenu,\n  normalizeUnicode,\n  OPS,\n  OutputScale,\n  PasswordResponses,\n  PDFDataRangeTransport,\n  PDFDateString,\n  PDFWorker,\n  PermissionFlag,\n  PixelsPerInch,\n  RenderingCancelledException,\n  renderRichText,\n  ResponseException,\n  setLayerDimensions,\n  shadow,\n  SignatureExtractor,\n  stopEvent,\n  SupportedImageMimeTypes,\n  TextLayer,\n  TouchManager,\n  updateUrlHash,\n  Util,\n  VerbosityLevel,\n  version,\n  XfaLayer,\n};\n","'use strict';\n\nconst version = require('../../../package.json').version;\nconst defaultOptions = require('../../constants/defaultOptions');\n\n/*\n * Default options for browser worker\n */\nmodule.exports = {\n  ...defaultOptions,\n  workerPath: `https://cdn.jsdelivr.net/npm/tesseract.js@v${version}/dist/worker.min.js`,\n};\n","'use strict';\n\n/**\n *\n * Tesseract Worker adapter for browser\n *\n * @fileoverview Tesseract Worker adapter for browser\n * @author Kevin Kwok <antimatter15@gmail.com>\n * @author Guillermo Webster <gui@mit.edu>\n * @author Jerome Wu <jeromewus@gmail.com>\n */\nconst defaultOptions = require('./defaultOptions');\nconst spawnWorker = require('./spawnWorker');\nconst terminateWorker = require('./terminateWorker');\nconst onMessage = require('./onMessage');\nconst send = require('./send');\nconst loadImage = require('./loadImage');\n\nmodule.exports = {\n  defaultOptions,\n  spawnWorker,\n  terminateWorker,\n  onMessage,\n  send,\n  loadImage,\n};\n","'use strict';\n\n/**\n * spawnWorker\n *\n * @name spawnWorker\n * @function create a new Worker in browser\n * @access public\n */\nmodule.exports = ({ workerPath, workerBlobURL }) => {\n  let worker;\n  if (Blob && URL && workerBlobURL) {\n    const blob = new Blob([`importScripts(\"${workerPath}\");`], {\n      type: 'application/javascript',\n    });\n    worker = new Worker(URL.createObjectURL(blob));\n  } else {\n    worker = new Worker(workerPath);\n  }\n\n  return worker;\n};\n","'use strict';\n\n/**\n * terminateWorker\n *\n * @name terminateWorker\n * @function terminate worker\n * @access public\n */\nmodule.exports = (worker) => {\n  worker.terminate();\n};\n","function _objectWithoutPropertiesLoose(r, e) {\n  if (null == r) return {};\n  var t = {};\n  for (var n in r) if ({}.hasOwnProperty.call(r, n)) {\n    if (-1 !== e.indexOf(n)) continue;\n    t[n] = r[n];\n  }\n  return t;\n}\nmodule.exports = _objectWithoutPropertiesLoose, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","'use strict';\n\nconst getId = require('./utils/getId');\n\nlet jobCounter = 0;\n\nmodule.exports = ({\n  id: _id,\n  action,\n  payload = {},\n}) => {\n  let id = _id;\n  if (typeof id === 'undefined') {\n    id = getId('Job', jobCounter);\n    jobCounter += 1;\n  }\n\n  return {\n    id,\n    action,\n    payload,\n  };\n};\n","'use strict';\n\nlet logging = false;\n\nexports.logging = logging;\n\nexports.setLogging = (_logging) => {\n  logging = _logging;\n};\n\nexports.log = (...args) => (logging ? console.log.apply(this, args) : null);\n","'use strict';\n\n/*\n * PSM = Page Segmentation Mode\n */\nmodule.exports = {\n  OSD_ONLY: '0',\n  AUTO_OSD: '1',\n  AUTO_ONLY: '2',\n  AUTO: '3',\n  SINGLE_COLUMN: '4',\n  SINGLE_BLOCK_VERT_TEXT: '5',\n  SINGLE_BLOCK: '6',\n  SINGLE_LINE: '7',\n  SINGLE_WORD: '8',\n  CIRCLE_WORD: '9',\n  SINGLE_CHAR: '10',\n  SPARSE_TEXT: '11',\n  SPARSE_TEXT_OSD: '12',\n  RAW_LINE: '13',\n};\n","'use strict';\n\nmodule.exports = (worker, handler) => {\n  worker.onmessage = ({ data }) => { // eslint-disable-line\n    handler(data);\n  };\n};\n","'use strict';\n\n/**\n * send\n *\n * @name send\n * @function send packet to worker and create a job\n * @access public\n */\nmodule.exports = async (worker, packet) => {\n  worker.postMessage(packet);\n};\n","'use strict';\n\nmodule.exports = {\n  /*\n   * Use BlobURL for worker script by default\n   * TODO: remove this option\n   *\n   */\n  workerBlobURL: true,\n  logger: () => {},\n};\n","'use strict';\n\n/*\n * languages with existing tesseract traineddata\n * https://tesseract-ocr.github.io/tessdoc/Data-Files#data-files-for-version-400-november-29-2016\n */\n\n/**\n * @typedef {object} Languages\n * @property {string} AFR Afrikaans\n * @property {string} AMH Amharic\n * @property {string} ARA Arabic\n * @property {string} ASM Assamese\n * @property {string} AZE Azerbaijani\n * @property {string} AZE_CYRL Azerbaijani - Cyrillic\n * @property {string} BEL Belarusian\n * @property {string} BEN Bengali\n * @property {string} BOD Tibetan\n * @property {string} BOS Bosnian\n * @property {string} BUL Bulgarian\n * @property {string} CAT Catalan; Valencian\n * @property {string} CEB Cebuano\n * @property {string} CES Czech\n * @property {string} CHI_SIM Chinese - Simplified\n * @property {string} CHI_TRA Chinese - Traditional\n * @property {string} CHR Cherokee\n * @property {string} CYM Welsh\n * @property {string} DAN Danish\n * @property {string} DEU German\n * @property {string} DZO Dzongkha\n * @property {string} ELL Greek, Modern (1453-)\n * @property {string} ENG English\n * @property {string} ENM English, Middle (1100-1500)\n * @property {string} EPO Esperanto\n * @property {string} EST Estonian\n * @property {string} EUS Basque\n * @property {string} FAS Persian\n * @property {string} FIN Finnish\n * @property {string} FRA French\n * @property {string} FRK German Fraktur\n * @property {string} FRM French, Middle (ca. 1400-1600)\n * @property {string} GLE Irish\n * @property {string} GLG Galician\n * @property {string} GRC Greek, Ancient (-1453)\n * @property {string} GUJ Gujarati\n * @property {string} HAT Haitian; Haitian Creole\n * @property {string} HEB Hebrew\n * @property {string} HIN Hindi\n * @property {string} HRV Croatian\n * @property {string} HUN Hungarian\n * @property {string} IKU Inuktitut\n * @property {string} IND Indonesian\n * @property {string} ISL Icelandic\n * @property {string} ITA Italian\n * @property {string} ITA_OLD Italian - Old\n * @property {string} JAV Javanese\n * @property {string} JPN Japanese\n * @property {string} KAN Kannada\n * @property {string} KAT Georgian\n * @property {string} KAT_OLD Georgian - Old\n * @property {string} KAZ Kazakh\n * @property {string} KHM Central Khmer\n * @property {string} KIR Kirghiz; Kyrgyz\n * @property {string} KOR Korean\n * @property {string} KUR Kurdish\n * @property {string} LAO Lao\n * @property {string} LAT Latin\n * @property {string} LAV Latvian\n * @property {string} LIT Lithuanian\n * @property {string} MAL Malayalam\n * @property {string} MAR Marathi\n * @property {string} MKD Macedonian\n * @property {string} MLT Maltese\n * @property {string} MSA Malay\n * @property {string} MYA Burmese\n * @property {string} NEP Nepali\n * @property {string} NLD Dutch; Flemish\n * @property {string} NOR Norwegian\n * @property {string} ORI Oriya\n * @property {string} PAN Panjabi; Punjabi\n * @property {string} POL Polish\n * @property {string} POR Portuguese\n * @property {string} PUS Pushto; Pashto\n * @property {string} RON Romanian; Moldavian; Moldovan\n * @property {string} RUS Russian\n * @property {string} SAN Sanskrit\n * @property {string} SIN Sinhala; Sinhalese\n * @property {string} SLK Slovak\n * @property {string} SLV Slovenian\n * @property {string} SPA Spanish; Castilian\n * @property {string} SPA_OLD Spanish; Castilian - Old\n * @property {string} SQI Albanian\n * @property {string} SRP Serbian\n * @property {string} SRP_LATN Serbian - Latin\n * @property {string} SWA Swahili\n * @property {string} SWE Swedish\n * @property {string} SYR Syriac\n * @property {string} TAM Tamil\n * @property {string} TEL Telugu\n * @property {string} TGK Tajik\n * @property {string} TGL Tagalog\n * @property {string} THA Thai\n * @property {string} TIR Tigrinya\n * @property {string} TUR Turkish\n * @property {string} UIG Uighur; Uyghur\n * @property {string} UKR Ukrainian\n * @property {string} URD Urdu\n * @property {string} UZB Uzbek\n * @property {string} UZB_CYRL Uzbek - Cyrillic\n * @property {string} VIE Vietnamese\n * @property {string} YID Yiddish\n */\n\n/**\n  * @type {Languages}\n  */\nmodule.exports = {\n  AFR: 'afr',\n  AMH: 'amh',\n  ARA: 'ara',\n  ASM: 'asm',\n  AZE: 'aze',\n  AZE_CYRL: 'aze_cyrl',\n  BEL: 'bel',\n  BEN: 'ben',\n  BOD: 'bod',\n  BOS: 'bos',\n  BUL: 'bul',\n  CAT: 'cat',\n  CEB: 'ceb',\n  CES: 'ces',\n  CHI_SIM: 'chi_sim',\n  CHI_TRA: 'chi_tra',\n  CHR: 'chr',\n  CYM: 'cym',\n  DAN: 'dan',\n  DEU: 'deu',\n  DZO: 'dzo',\n  ELL: 'ell',\n  ENG: 'eng',\n  ENM: 'enm',\n  EPO: 'epo',\n  EST: 'est',\n  EUS: 'eus',\n  FAS: 'fas',\n  FIN: 'fin',\n  FRA: 'fra',\n  FRK: 'frk',\n  FRM: 'frm',\n  GLE: 'gle',\n  GLG: 'glg',\n  GRC: 'grc',\n  GUJ: 'guj',\n  HAT: 'hat',\n  HEB: 'heb',\n  HIN: 'hin',\n  HRV: 'hrv',\n  HUN: 'hun',\n  IKU: 'iku',\n  IND: 'ind',\n  ISL: 'isl',\n  ITA: 'ita',\n  ITA_OLD: 'ita_old',\n  JAV: 'jav',\n  JPN: 'jpn',\n  KAN: 'kan',\n  KAT: 'kat',\n  KAT_OLD: 'kat_old',\n  KAZ: 'kaz',\n  KHM: 'khm',\n  KIR: 'kir',\n  KOR: 'kor',\n  KUR: 'kur',\n  LAO: 'lao',\n  LAT: 'lat',\n  LAV: 'lav',\n  LIT: 'lit',\n  MAL: 'mal',\n  MAR: 'mar',\n  MKD: 'mkd',\n  MLT: 'mlt',\n  MSA: 'msa',\n  MYA: 'mya',\n  NEP: 'nep',\n  NLD: 'nld',\n  NOR: 'nor',\n  ORI: 'ori',\n  PAN: 'pan',\n  POL: 'pol',\n  POR: 'por',\n  PUS: 'pus',\n  RON: 'ron',\n  RUS: 'rus',\n  SAN: 'san',\n  SIN: 'sin',\n  SLK: 'slk',\n  SLV: 'slv',\n  SPA: 'spa',\n  SPA_OLD: 'spa_old',\n  SQI: 'sqi',\n  SRP: 'srp',\n  SRP_LATN: 'srp_latn',\n  SWA: 'swa',\n  SWE: 'swe',\n  SYR: 'syr',\n  TAM: 'tam',\n  TEL: 'tel',\n  TGK: 'tgk',\n  TGL: 'tgl',\n  THA: 'tha',\n  TIR: 'tir',\n  TUR: 'tur',\n  UIG: 'uig',\n  UKR: 'ukr',\n  URD: 'urd',\n  UZB: 'uzb',\n  UZB_CYRL: 'uzb_cyrl',\n  VIE: 'vie',\n  YID: 'yid',\n};\n","'use strict';\n\nconst isBrowser = require('./getEnvironment')('type') === 'browser';\n\nconst resolveURL = isBrowser ? s => (new URL(s, window.location.href)).href : s => s; // eslint-disable-line\n\nmodule.exports = (options) => {\n  const opts = { ...options };\n  ['corePath', 'workerPath', 'langPath'].forEach((key) => {\n    if (options[key]) {\n      opts[key] = resolveURL(opts[key]);\n    }\n  });\n  return opts;\n};\n","'use strict';\n\nconst resolvePaths = require('./utils/resolvePaths');\nconst createJob = require('./createJob');\nconst { log } = require('./utils/log');\nconst getId = require('./utils/getId');\nconst OEM = require('./constants/OEM');\nconst {\n  defaultOptions,\n  spawnWorker,\n  terminateWorker,\n  onMessage,\n  loadImage,\n  send,\n} = require('./worker/node');\n\nlet workerCounter = 0;\n\nmodule.exports = async (langs = 'eng', oem = OEM.LSTM_ONLY, _options = {}, config = {}) => {\n  const id = getId('Worker', workerCounter);\n  const {\n    logger,\n    errorHandler,\n    ...options\n  } = resolvePaths({\n    ...defaultOptions,\n    ..._options,\n  });\n  const promises = {};\n\n  // Current langs, oem, and config file.\n  // Used if the user ever re-initializes the worker using `worker.reinitialize`.\n  const currentLangs = typeof langs === 'string' ? langs.split('+') : langs;\n  let currentOem = oem;\n  let currentConfig = config;\n  const lstmOnlyCore = [OEM.DEFAULT, OEM.LSTM_ONLY].includes(oem) && !options.legacyCore;\n\n  let workerResReject;\n  let workerResResolve;\n  const workerRes = new Promise((resolve, reject) => {\n    workerResResolve = resolve;\n    workerResReject = reject;\n  });\n  const workerError = (event) => { workerResReject(event.message); };\n\n  let worker = spawnWorker(options);\n  worker.onerror = workerError;\n\n  workerCounter += 1;\n\n  const startJob = ({ id: jobId, action, payload }) => (\n    new Promise((resolve, reject) => {\n      log(`[${id}]: Start ${jobId}, action=${action}`);\n      // Using both `action` and `jobId` in case user provides non-unique `jobId`.\n      const promiseId = `${action}-${jobId}`;\n      promises[promiseId] = { resolve, reject };\n      send(worker, {\n        workerId: id,\n        jobId,\n        action,\n        payload,\n      });\n    })\n  );\n\n  const load = () => (\n    console.warn('`load` is depreciated and should be removed from code (workers now come pre-loaded)')\n  );\n\n  const loadInternal = (jobId) => (\n    startJob(createJob({\n      id: jobId, action: 'load', payload: { options: { lstmOnly: lstmOnlyCore, corePath: options.corePath, logging: options.logging } },\n    }))\n  );\n\n  const writeText = (path, text, jobId) => (\n    startJob(createJob({\n      id: jobId,\n      action: 'FS',\n      payload: { method: 'writeFile', args: [path, text] },\n    }))\n  );\n\n  const readText = (path, jobId) => (\n    startJob(createJob({\n      id: jobId,\n      action: 'FS',\n      payload: { method: 'readFile', args: [path, { encoding: 'utf8' }] },\n    }))\n  );\n\n  const removeFile = (path, jobId) => (\n    startJob(createJob({\n      id: jobId,\n      action: 'FS',\n      payload: { method: 'unlink', args: [path] },\n    }))\n  );\n\n  const FS = (method, args, jobId) => (\n    startJob(createJob({\n      id: jobId,\n      action: 'FS',\n      payload: { method, args },\n    }))\n  );\n\n  const loadLanguageInternal = (_langs, jobId) => startJob(createJob({\n    id: jobId,\n    action: 'loadLanguage',\n    payload: {\n      langs: _langs,\n      options: {\n        langPath: options.langPath,\n        dataPath: options.dataPath,\n        cachePath: options.cachePath,\n        cacheMethod: options.cacheMethod,\n        gzip: options.gzip,\n        lstmOnly: [OEM.DEFAULT, OEM.LSTM_ONLY].includes(currentOem)\n          && !options.legacyLang,\n      },\n    },\n  }));\n\n  const initializeInternal = (_langs, _oem, _config, jobId) => (\n    startJob(createJob({\n      id: jobId,\n      action: 'initialize',\n      payload: { langs: _langs, oem: _oem, config: _config },\n    }))\n  );\n\n  const reinitialize = (langs = 'eng', oem, config, jobId) => { // eslint-disable-line\n\n    if (lstmOnlyCore && [OEM.TESSERACT_ONLY, OEM.TESSERACT_LSTM_COMBINED].includes(oem)) throw Error('Legacy model requested but code missing.');\n\n    const _oem = oem || currentOem;\n    currentOem = _oem;\n\n    const _config = config || currentConfig;\n    currentConfig = _config;\n\n    // Only load langs that are not already loaded.\n    // This logic fails if the user downloaded the LSTM-only English data for a language\n    // and then uses `worker.reinitialize` to switch to the Legacy engine.\n    // However, the correct data will still be downloaded after initialization fails\n    // and this can be avoided entirely if the user loads the correct data ahead of time.\n    const langsArr = typeof langs === 'string' ? langs.split('+') : langs;\n    const _langs = langsArr.filter((x) => !currentLangs.includes(x));\n    currentLangs.push(..._langs);\n\n    if (_langs.length > 0) {\n      return loadLanguageInternal(_langs, jobId)\n        .then(() => initializeInternal(langs, _oem, _config, jobId));\n    }\n\n    return initializeInternal(langs, _oem, _config, jobId);\n  };\n\n  const setParameters = (params = {}, jobId) => (\n    startJob(createJob({\n      id: jobId,\n      action: 'setParameters',\n      payload: { params },\n    }))\n  );\n\n  const recognize = async (image, opts = {}, output = {\n    text: true,\n  }, jobId) => (\n    startJob(createJob({\n      id: jobId,\n      action: 'recognize',\n      payload: { image: await loadImage(image), options: opts, output },\n    }))\n  );\n\n  const detect = async (image, jobId) => {\n    if (lstmOnlyCore) throw Error('`worker.detect` requires Legacy model, which was not loaded.');\n\n    return startJob(createJob({\n      id: jobId,\n      action: 'detect',\n      payload: { image: await loadImage(image) },\n    }));\n  };\n\n  const terminate = async () => {\n    if (worker !== null) {\n      /*\n      await startJob(createJob({\n        id: jobId,\n        action: 'terminate',\n      }));\n      */\n      terminateWorker(worker);\n      worker = null;\n    }\n    return Promise.resolve();\n  };\n\n  onMessage(worker, ({\n    workerId, jobId, status, action, data,\n  }) => {\n    const promiseId = `${action}-${jobId}`;\n    if (status === 'resolve') {\n      log(`[${workerId}]: Complete ${jobId}`);\n      promises[promiseId].resolve({ jobId, data });\n      delete promises[promiseId];\n    } else if (status === 'reject') {\n      promises[promiseId].reject(data);\n      delete promises[promiseId];\n      if (action === 'load') workerResReject(data);\n      if (errorHandler) {\n        errorHandler(data);\n      } else {\n        throw Error(data);\n      }\n    } else if (status === 'progress') {\n      logger({ ...data, userJobId: jobId });\n    }\n  });\n\n  const resolveObj = {\n    id,\n    worker,\n    load,\n    writeText,\n    readText,\n    removeFile,\n    FS,\n    reinitialize,\n    setParameters,\n    recognize,\n    detect,\n    terminate,\n  };\n\n  loadInternal()\n    .then(() => loadLanguageInternal(langs))\n    .then(() => initializeInternal(langs, oem, config))\n    .then(() => workerResResolve(resolveObj))\n    .catch(() => {});\n\n  return workerRes;\n};\n"],"names":["readFromBlobOrFile","blob","Promise","resolve","reject","fileReader","FileReader","onload","result","onerror","_ref","target","error","code","Error","concat","readAsArrayBuffer","loadImage","async","data","image","test","atob","split","map","c","charCodeAt","resp","fetch","arrayBuffer","HTMLElement","tagName","src","poster","toBlob","OffscreenCanvas","convertToBlob","File","Blob","Uint8Array","module","exports","_objectSpread","require","createScheduler","createWorker","Tesseract","languages","OEM","PSM","setLogging","createJob","log","getId","schedulerCounter","id","workers","runningWorkers","jobQueue","getNumWorkers","Object","keys","length","dequeue","wIds","i","queue","action","payload","job","push","shift","w","apply","this","err","addWorker","addJob","_len","arguments","Array","_key","terminate","forEach","wid","getQueueLen","TESSERACT_ONLY","LSTM_ONLY","TESSERACT_LSTM_COMBINED","DEFAULT","prefix","cnt","Math","random","toString","slice","key","env","WorkerGlobalScope","type","document","process","objectWithoutPropertiesLoose","e","t","o","r","getOwnPropertySymbols","n","indexOf","propertyIsEnumerable","call","__esModule","recognize","langs","options","worker","finally","detect","_toSetter","defineProperty","set","_checkPrivateRedeclaration","has","TypeError","_classPrivateMethodInitSpec","a","add","_classPrivateFieldInitSpec","_assertClassBrand","_classPrivateGetter","s","get","_classPrivateFieldSet2","AsyncFromSyncIterator","AsyncFromSyncIteratorContinuation","done","value","then","next","prototype","isNodeJS","versions","nw","electron","FONT_IDENTITY_MATRIX","LINE_FACTOR","RenderingIntentFlag","AnnotationMode","DISABLE","ENABLE","ENABLE_FORMS","ENABLE_STORAGE","AnnotationEditorPrefix","AnnotationEditorType","NONE","FREETEXT","HIGHLIGHT","STAMP","INK","POPUP","SIGNATURE","COMMENT","AnnotationEditorParamsType","RESIZE","CREATE","FREETEXT_SIZE","FREETEXT_COLOR","FREETEXT_OPACITY","INK_COLOR","INK_THICKNESS","INK_OPACITY","HIGHLIGHT_COLOR","HIGHLIGHT_THICKNESS","HIGHLIGHT_FREE","HIGHLIGHT_SHOW_ALL","DRAW_STEP","MeshFigureType","TextRenderingMode","util_ImageKind","GRAYSCALE_1BPP","RGB_24BPP","RGBA_32BPP","AnnotationType","TEXT","LINK","LINE","SQUARE","CIRCLE","POLYGON","POLYLINE","UNDERLINE","SQUIGGLY","STRIKEOUT","CARET","FILEATTACHMENT","SOUND","MOVIE","WIDGET","SCREEN","PRINTERMARK","TRAPNET","WATERMARK","THREED","REDACT","AnnotationBorderStyleType","VerbosityLevel","ERRORS","WARNINGS","INFOS","OPS","dependency","setLineWidth","setLineCap","setLineJoin","setMiterLimit","setDash","setRenderingIntent","setFlatness","setGState","save","restore","transform","moveTo","lineTo","curveTo","curveTo2","curveTo3","closePath","rectangle","stroke","closeStroke","fill","eoFill","fillStroke","eoFillStroke","closeFillStroke","closeEOFillStroke","endPath","clip","eoClip","beginText","endText","setCharSpacing","setWordSpacing","setHScale","setLeading","setFont","setTextRenderingMode","setTextRise","moveText","setLeadingMoveText","setTextMatrix","nextLine","showText","showSpacedText","nextLineShowText","nextLineSetSpacingShowText","setCharWidth","setCharWidthAndBounds","setStrokeColorSpace","setFillColorSpace","setStrokeColor","setStrokeColorN","setFillColor","setFillColorN","setStrokeGray","setFillGray","setStrokeRGBColor","setFillRGBColor","setStrokeCMYKColor","setFillCMYKColor","shadingFill","beginInlineImage","beginImageData","endInlineImage","paintXObject","markPoint","markPointProps","beginMarkedContent","beginMarkedContentProps","endMarkedContent","beginCompat","endCompat","paintFormXObjectBegin","paintFormXObjectEnd","beginGroup","endGroup","beginAnnotation","endAnnotation","paintImageMaskXObject","paintImageMaskXObjectGroup","paintImageXObject","paintInlineImageXObject","paintInlineImageXObjectGroup","paintImageXObjectRepeat","paintImageMaskXObjectRepeat","paintSolidColorImageMask","constructPath","setStrokeTransparent","setFillTransparent","rawFillPath","DrawOPS","verbosity","setVerbosityLevel","level","Number","isInteger","getVerbosityLevel","info","msg","console","warn","unreachable","assert","cond","createValidAbsoluteUrl","url","baseUrl","undefined","addDefaultProtocol","startsWith","dots","match","tryConvertEncoding","decodeURIComponent","escape","_unused","absoluteUrl","URL","parse","protocol","_isValidProtocol","updateUrlHash","hash","allowRel","res","href","shadow","obj","prop","nonSerializable","enumerable","configurable","writable","BaseException","message","name","constructor","PasswordException","super","UnknownErrorException","details","InvalidPDFException","ResponseException","status","missing","FormatError","AbortException","bytesToString","bytes","MAX_ARGUMENT_COUNT","String","fromCharCode","strBuf","chunkEnd","min","chunk","subarray","join","stringToBytes","str","util_FeatureTest","isLittleEndian","buffer8","Uint32Array","buffer","isEvalSupported","Function","_unused2","isOffscreenCanvasSupported","isImageDecoderSupported","ImageDecoder","isFloat16ArraySupported","Float16Array","isSanitizerSupported","Sanitizer","platform","userAgent","navigator","isAndroid","includes","isLinux","isMac","isWindows","isFirefox","isCSSRoundSupported","_globalThis$CSS","_globalThis$CSS$suppo","globalThis","CSS","supports","hexNumbers","from","padStart","Util","makeHexColor","g","b","domMatrixToTransform","dm","d","f","scaleMinMax","minMax","temp","m1","m2","multiplyByDOMMatrix","m","md","applyTransform","p","pos","p0","p1","applyTransformToBezier","m0","m3","m4","m5","pI","pI1","applyInverseTransform","axialAlignedBoundingBox","rect","output","r0","r1","r2","r3","a0","a2","a1","a3","b0","b2","b1","b3","m1r0","m1r2","m2r1","m2r3","max","inverseTransform","singularValueDecompose2dScale","matrix","first","second","sqrt","normalizeRect","intersect","rect1","rect2","xLow","xHigh","yLow","yHigh","pointBoundingBox","x","y","rectBoundingBox","x0","y0","x1","y1","bezierBoundingBox","x2","y2","x3","y3","_getExtremum","_getExtremumOnCurve","mt","tt","ttt","abs","delta","sqrtDelta","_Util","NormalizeRegex","NormalizationMap","getUuid","crypto","randomUUID","buf","getRandomValues","AnnotationPrefix","MathClamp","v","toBase64Util","arr","toBase64","btoa","try","fn","args","sumPrecise","numbers","reduce","XfaText","textContent","xfa","items","styles","create","walk","node","_node$attributes","shouldBuildText","attributes","children","child","XfaLayer","setupStorage","html","element","storage","intent","storedData","getValue","addEventListener","event","setValue","xfaOn","setAttribute","xfaOff","removeAttribute","checked","getAttribute","option","selected","hasOwnProperty","selectedIndex","setAttributes","linkService","isHTMLAnchorElement","HTMLAnchorElement","entries","assign","style","addLinkAttributes","newWindow","dataId","render","parameters","annotationStorage","root","xfaHtml","rootHtml","createElement","isNotForRichText","rootDiv","div","append","viewport","textDivs","createTextNode","stack","_child$attributes","_child$children","parent","at","pop","childHtml","xmlns","createElementNS","el","querySelectorAll","update","hidden","SVG_NS","PixelsPerInch","fetchData","isValidFetchUrl","baseURI","response","ok","statusText","json","text","request","XMLHttpRequest","open","responseType","onreadystatechange","readyState","DONE","responseText","send","_PixelsPerInch","_defineProperty","PDF","PageViewport","_ref2","viewBox","userUnit","scale","rotation","offsetX","offsetY","dontFlip","centerX","centerY","rotateA","rotateB","rotateC","rotateD","offsetCanvasX","offsetCanvasY","width","height","rawDims","dims","pageWidth","pageHeight","pageX","pageY","clone","convertToViewportPoint","convertToViewportRectangle","topLeft","bottomRight","convertToPdfPoint","RenderingCancelledException","extraDelay","isDataScheme","ii","trim","substring","toLowerCase","isPdfFile","filename","StatTimer","time","started","Date","now","timeEnd","times","start","end","outBuf","longest","padEnd","noContextMenu","preventDefault","stopEvent","stopPropagation","PDFDateString","toDateObject","input","_regex","_","RegExp","matches","exec","year","parseInt","month","day","hour","minute","universalTimeRelation","offsetHour","offsetMinute","UTC","getRGB","color","colorRGB","getCurrentTransform","ctx","getTransform","getCurrentTransformInverse","invertSelf","setLayerDimensions","mustFlip","mustRotate","useRound","h","widthStr","heightStr","OutputScale","pixelRatio","sx","sy","scaled","symmetric","limitCanvas","maxPixels","maxDim","capAreaFactor","maxAreaScale","Infinity","maxWidthScale","maxHeightScale","capPixels","maxScale","devicePixelRatio","winPixels","ceil","window","screen","availWidth","availHeight","SupportedImageMimeTypes","ColorScheme","isDarkMode","_window","_window$matchMedia","matchMedia","RGBToHSL","rgb","l","HSLToRGB","hsl","floor","computeLuminance","contrastRatio","hsl1","hsl2","lum1","lum2","contrastCache","Map","renderRichText","_ref4","container","dir","className","fragment","createDocumentFragment","lines","line","firstElementChild","classList","makePathFromDrawOPS","path","Path2D","bezierCurveTo","quadraticCurveTo","EditorToolbar","editor","_EditorToolbar_brand","_toolbar","_colorPicker","_editor","_buttons","_altText","_comment","_commentButtonDivider","_signatureDescriptionButton","_classPrivateFieldSet","_l10nRemove","freeze","freetext","highlight","ink","stamp","signature","editToolbar","signal","_classPrivateFieldGet","_uiManager","_signal","AbortSignal","aborted","_pointerDown","buttons","position","toolbarPosition","direction","insetInlineEnd","top","hide","_classPrivateFieldGet2","hideDropdown","show","_classPrivateFieldGet3","_classPrivateFieldGet4","remove","shown","addDeleteButton","editorType","button","tabIndex","_addListenersToElement","delete","addAltText","altText","_get_divider","addComment","comment","beforeElement","renderForToolbar","divider","insertBefore","toolbar","addColorPicker","colorPicker","renderButton","addEditSignatureButton","signatureManager","renderEditButton","removeButton","_classPrivateFieldGet5","_classPrivateFieldGet6","removeToolbarCommentButton","addButton","tool","addButtonBefore","beforeSelector","querySelector","updateEditSignatureButton","description","title","_classPrivateFieldGet7","destroy","_focusIn","_focusEventsAllowed","_focusOut","bind","capture","_this","_buttons2","WeakMap","_toolbar2","_uiManager2","_FloatingToolbar_brand","WeakSet","FloatingToolbar","uiManager","boxes","isLTR","_getLastPoint","_render","hasCommentManager","_makeButton","commentSelection","highlightSelection","lastY","lastX","box","buttonClass","l10nId","labelL10nId","clickHandler","span","bindEvents","names","CurrentPointers","initializeAndAddPointerId","pointerId","_pointerIds","Set","setPointer","pointerType","_pointerType$_","_pointerId","_pointerType","setTimeStamp","timeStamp","_moveTimestamp","isSamePointerId","isSamePointerIdOrRemove","_pointerIds$_","isSamePointerType","isInitializedAndDifferentPointerType","isSameTimeStamp","isUsingMultiplePointers","_pointerIds$_2","size","clearPointerType","clearPointerIds","NaN","clearTimeStamp","_id","IdManager","_this$id","_this$id2","_baseId","_id2","_cache","_ImageManager_brand","ImageManager","_isSVGFittingCanvas","getContext","willReadFrequently","Image","decode","drawImage","getImageData","getFromFile","file","lastModified","_get","getFromUrl","getFromBlob","blobPromise","getFromId","bitmap","refCounter","getFromCanvas","canvas","_this$id5","_this$id6","_data2","offscreen","transferToImageBitmap","isSvg","getSvgUrl","svgUrl","deleteId","_bitmap$close","transferFromImageBitmap","close","isValidId","rawData","_data4","_this$id3","_this$id4","mustRemoveAspectRatioPromise","imageElement","imagePromise","readAsDataURL","createImageBitmap","_ImageManager","_commands","_locked","_maxSize","_position","CommandManager","maxSize","_ref5","cmd","undo","post","mustExec","overwriteIfSameType","keepUndo","splice","redo","hasSomethingToUndo","hasSomethingToRedo","cleanType","_KeyboardManager_brand","KeyboardManager","callbacks","allKeys","callback","isMacKey","self","_serialize","bubbles","checker","altKey","ctrlKey","metaKey","shiftKey","ColorManager","_colors","colors","visibility","colorScheme","body","computedColor","getComputedStyle","getColorValues","convert","RGB","every","_colorsMapping","getHexCode","_abortController","_activeEditor","_allEditableAnnotations","_allEditors","_allLayers","_altTextManager","_annotationStorage","_changedExistingAnnotations","_commandManager","_commentManager","_copyPasteAC","_currentDrawingSession","_currentPageIndex","_deletedAnnotationsElementIds","_draggingEditors","_editorTypes","_editorsToRescale","_enableHighlightFloatingButton","_enableUpdatedAddImage","_enableNewAltTextWhenAddingImage","_filterFactory","_focusMainContainerTimeoutId","_focusManagerAC","_highlightColors2","_highlightWhenShiftUp","_floatingToolbar","_idManager","_isEnabled","_isPointerDown","_isWaiting","_keyboardManagerAC","_lastActiveElement","_mainHighlightColorPicker","_missingCanvases","_mlManager","_mode","_selectedEditors","_selectedTextNode","_signatureManager","_pageColors","_showAllStates","_pdfDocument","_previousStates","_translation","_translationTimeoutId","_container","_viewer","_viewerAlert","_updateModeCapability","_AnnotationEditorUIManager_brand","AnnotationEditorUIManager","_keyboardManager","proto","arrowChecker","contains","activeElement","hasSomethingToControl","textInputChecker","_self","_ref6","HTMLInputElement","small","TRANSLATE_SMALL","big","TRANSLATE_BIG","selectAll","addNewEditorFromKeyboard","_ref7","HTMLButtonElement","isEnterHandled","_ref8","unselectAll","translateSelectedEditors","viewer","viewerAlert","altTextManager","commentManager","eventBus","pdfDocument","pageColors","highlightColors","enableHighlightFloatingButton","enableUpdatedAddImage","enableNewAltTextWhenAddingImage","mlManager","editorUndoBar","supportsPinchToZoom","AbortController","isEditing","isEmpty","hasSelectedEditor","hasSelectedText","_eventBus","_on","onEditingAction","onPageChanging","onScaleChanging","onRotationChanging","onSetPreference","evt","updateParams","_addSelectionListener","_addDragAndDropListeners","_addKeyboardManager","filterFactory","viewParameters","realScale","PDF_TO_CSS_UNITS","isShiftKeyDown","_editorUndoBar","_supportsPinchToZoom","setSidebarUiManager","_classPrivateFieldGet8","_classPrivateFieldGet9","_classPrivateFieldGet0","_classPrivateFieldGet1","_classPrivateFieldGet10","_classPrivateFieldGet11","_classPrivateFieldGet12","_classPrivateFieldGet13","_this$_editorUndoBar","abort","layer","values","clear","clearTimeout","combinedSignal","ac","any","useNewAltTextFlow","useNewAltTextWhenAddingImage","hcmFilter","addHCMFilter","foreground","background","_highlightColors","pair","toUpperCase","hasHCM","isNameForHCM","endsWith","replace","highlightColorNames","reverse","getNonHCMColor","colorName","getNonHCMColorName","setCurrentDrawingSession","disableUserSelect","setMainHighlightColorPicker","editAltText","_classPrivateFieldGet14","firstTime","editComment","posX","posY","_classPrivateFieldGet15","showDialog","selectComment","pageIndex","uid","getEditorByUID","toggleComment","updateComment","_classPrivateFieldGet16","getData","updatePopupColor","_classPrivateFieldGet17","removeComment","_classPrivateFieldGet18","removeComments","isSelected","_classPrivateFieldGet19","toggleCommentPopup","makeCommentColor","opacity","_classPrivateFieldGet20","getCommentDialogElement","_classPrivateFieldGet21","dialogElement","waitForEditorsRendered","pageNumber","promise","withResolvers","onEditorsRendered","_off","on","getSignature","_classPrivateFieldGet22","switchToMode","mode","once","dispatch","source","setPreference","_ref9","_ref0","focusMainContainer","focus","findParent","layerX","layerY","getBoundingClientRect","toggle","addShouldRescale","removeShouldRescale","_ref1","_classPrivateFieldGet23","commitOrRemove","_ref10","pagesRotation","methodOfCreation","selection","getSelection","isCollapsed","anchorNode","anchorOffset","focusNode","focusOffset","textLayer","_getAnchorElementForSelection","closest","getSelectionBoxes","empty","_getLayerForTextLayer","isNoneMode","createAndAddNewEditor","showAllEditors","getAndRemoveDataFromAnnotationStorage","annotationId","storedValue","getRawValue","addToAnnotationStorage","a11yAlert","messageId","JSON","stringify","blur","_onSelectEnd","hasSelection","lastEditor","lastActiveElement","addEditListeners","setEditingState","removeEditListeners","_removeKeyboardManager","dragOver","dataTransfer","isHandlingMimeForPasting","dropEffect","drop","item","paste","currentLayer","copy","_classPrivateFieldGet24","editors","serialized","serialize","clipboardData","setData","cut","ex","isArray","newEditors","deserializedEditor","deserialize","_addEditorToLayer","_selectEditors","addCommands","keydown","isEditorHandlingKeyboard","keyup","_ref11","_addFocusManager","_addCopyPasteListeners","_dispatchUpdateStates","_isEmpty","_removeFocusManager","_removeCopyPasteListeners","registerEditorTypes","types","_dispatchUpdateUI","defaultPropertiesToUpdate","getLayer","currentPageIndex","addLayer","enable","disable","removeLayer","updateMode","_classPrivateFieldGet25","_classPrivateFieldGet27","editId","isFromUser","isFromKeyboard","mustEnterInEditMode","_classPrivateFieldGet26","_classPrivateFieldGet28","hideSidebar","destroyPopup","_this$_editorUndoBar2","_disableAll","hideStandaloneCommentButton","addStandaloneCommentButton","loadSignatures","_enableAll","_classPrivateFieldGet29","getAnnotationsByType","editorClass","_editorType","elementIds","allComments","annotationElementId","hasComment","deleted","annotation","popupRef","contentsObj","showSidebar","setSelected","enterInEditMode","unselect","canCreateNewEmptyEditor","addNewEditor","updateToolbar","updateDefaultParams","visible","_classPrivateFieldGet30","_classPrivateFieldGet31","enableWaiting","mustWait","disableClick","enableClick","getEditors","getEditor","addEditor","removeEditor","_classPrivateFieldGet32","_classPrivateFieldGet33","setTimeout","addDeletedAnnotationElement","addChangedExistingAnnotation","isDeletedAnnotationElement","removeDeletedAnnotationElement","removeChangedExistingAnnotation","setActiveEditor","propertiesToUpdate","updateUI","_get_lastSelectedEditor","updateUIForDefaultProperties","toggleSelected","select","_classPrivateFieldGet34","ed","firstSelectedEditor","_this$_editorUndoBar3","params","cleanUndoStack","_this$currentLayer","drawingEditor","endDrawingSession","_this$_editorUndoBar4","_classPrivateFieldGet35","commit","_classPrivateFieldGet36","totalX","totalY","translateInPage","translationDone","setUpDragSession","savedX","savedY","savedPageIndex","newX","newY","newPageIndex","endDragSession","mustBeAddedInUndoStack","move","_setParentAndPosition","dragSelectedEditors","tx","ty","drag","rebuild","changeParent","addOrRebuild","_this$getActive","getActive","shouldGetKeyboardEvents","isActive","getMode","isEditingMode","imageManager","rangeCount","getRangeAt","commonAncestorContainer","parentWidth","parentHeight","rotator","range","collapsed","getClientRects","_ref12","_ref13","_classPrivateFieldGet37","renderAnnotationElement","_classPrivateFieldGet38","editorId","hasBeenModified","setMissingCanvas","_classPrivateFieldGet39","setCanvas","addMissingCanvas","_ref97","nodeType","Node","TEXT_NODE","parentElement","hasTextLayer","_displayFloatingToolbar","_selectionChange","_classPrivateFieldGet135","_classPrivateFieldGet133","_classPrivateFieldGet134","activeLayer","toggleDrawing","pointerup","_classPrivateFieldGet136","_classPrivateFieldGet137","_classPrivateFieldGet138","some","_ref98","promises","all","_this2","AltText","_AltText_brand","_altText2","_altTextDecorative","_altTextButton","_altTextButtonLabel","_altTextTooltip","_altTextTooltipTimeout","_altTextWasFromKeyBoard","_badge","_editor2","_guessedText","_textWithDisclaimer","_useNewAltTextFlow","_l10nNewButton","added","review","initialize","l10n","_AltText$_l10n","_l10n","label","onClick","_reportTelemetry","_get_label","_setState","finish","focusVisible","hasData","guessedText","setGuessedText","generatedAltText","toggleAltTextBadge","_classPrivateFieldGet40","badge","isForCopying","decorative","textWithDisclaimer","_ref14","cancel","enabled","disabled","_classPrivateFieldGet41","_classPrivateFieldGet42","_this3","_classPrivateFieldGet139","_classPrivateFieldGet140","_classPrivateFieldGet141","tooltip","DELAY_TO_SHOW_TOOLTIP","_classPrivateFieldGet142","parentNode","getElementForAltText","Comment","_Comment_brand","_commentStandaloneButton","_commentToolbarButton","_commentWasFromKeyBoard","_editor3","_initialText","_richText","_text","_date","_deleted","_popupPosition","_render2","renderForStandalone","commentButtonPosition","commentButtonColor","backgroundColor","focusButton","_ref15","_classPrivateFieldGet43","onUpdatedColor","commentButtonWidth","_classPrivateFieldGet44","_classPrivateFieldGet45","boundingClientRect","commentPopupPositionInLayer","parentX","parentY","hasDefaultPopupPosition","removeStandaloneCommentButton","_classPrivateFieldGet46","_classPrivateFieldGet47","setCommentButtonStates","_ref16","hasPopup","ariaExpanded","edit","parentDimensions","isDeleted","hasBeenEdited","richText","date","setInitialText","_classPrivateFieldGet48","_classPrivateFieldGet49","isStandalone","ariaHasPopup","ariaControls","ariaControlsElements","TouchManager","_ref17","isPinchingDisabled","isPinchingStopped","onPinchStart","onPinching","onPinchEnd","_TouchManager_brand","_container2","_isPinching","_isPinchingStopped","_isPinchingDisabled","_onPinchStart","_onPinching","_onPinchEnd","_pointerDownAC","_signal2","_touchInfo","_touchManagerAC","_touchMoveAC","_onTouchStart","passive","MIN_TOUCH_DISTANCE_TO_PINCH","_classPrivateFieldGet50","_classPrivateFieldGet51","_classPrivateFieldGet143","_classPrivateFieldGet146","touches","pointerDownAC","opts","cancelPointerDown","_classPrivateFieldGet144","_classPrivateFieldGet145","opt","_onTouchMove","onTouchEnd","_onTouchEnd","touch0","touch1","identifier","touch0X","screenX","touch0Y","screenY","touch1X","touch1Y","_classPrivateFieldGet147","screen0X","screen0Y","screen1X","screen1Y","touchInfo","pTouch0X","pTouch0Y","pTouch1X","pTouch1Y","prevGapX","prevGapY","currGapX","currGapY","distance","hypot","pDistance","origin","_classPrivateFieldGet148","_TouchManager","AnnotationEditor","_resizerKeyboardManager","resize","_resizeWithKeyboard","_stopResizingWithKeyboard","_AnnotationEditor_brand","_accessibilityData","_allResizerDivs","_altText3","_comment2","_commentStandaloneButton2","_disabled","_dragPointerId","_dragPointerType","_resizersDiv","_lastPointerCoords","_savedDimensions","_fakeAnnotation","_focusAC","_focusedResizerName","_hasBeenClicked","_initialRect","_isEditing","_isInEditMode","_isResizerEnabledForKeyboard","_moveInDOMTimeout","_prevDragX","_prevDragY","_telemetryTimeouts","_touchManager","_isDraggable","_zIndex","_willKeepAspectRatio","_initialOptions","isCentered","_structTreeParentId","creationDate","modificationDate","canAddComment","pageRotation","pageDimensions","pageTranslation","isAttachedToDOM","getPrototypeOf","_type","isDrawer","_defaultLineColor","_colorManager","deleteAnnotationElement","fakeEditor","FakeEditor","getNextId","_AnnotationEditor$_l","_l10nResizer","topMiddle","topRight","middleRight","bottomMiddle","bottomLeft","middleLeft","_borderLineWidth","documentElement","parseFloat","getPropertyValue","_value","mime","_this$div","center","parentRotation","fixAndSetPosition","setInBackground","zIndex","setInForeground","setParent","_classPrivateFieldGet52","_stopResizing","focusin","focusout","_this$parent","relatedTarget","isMultipleSelection","isInEditMode","setAt","screenToPageTranslation","_moveAfterPaste","baseX","baseY","_onTranslated","translate","_translate","scrollIntoView","block","findNewParent","bx","by","getBaseTranslation","left","toFixed","_onTranslating","_hasBeenMoved","_hasBeenResized","_mustFixPosition","moveInDOM","_rotatePoint","pageTranslationToScreen","parentScale","setDims","getInitialTranslation","_onResized","_round","round","_onResizing","altTextFinish","_classPrivateFieldGet53","toolbarButtons","addEditToolbar","_editToolbar","addCommentButton","addCommentButtonInToolbar","_this$_editToolbar","removeCommentButtonFromToolbar","_this$_editToolbar2","removeEditToolbar","_this$_editToolbar3","_classPrivateFieldGet54","addContainer","_this$_editToolbar4","editToolbarDiv","before","getClientDimensions","createAltText","altTextData","_classPrivateFieldGet55","guessedAltText","_classPrivateFieldGet56","setGuessedAltText","_classPrivateFieldGet57","serializeAltText","_classPrivateFieldGet58","hasAltText","hasAltTextData","_classPrivateFieldGet59","_classPrivateFieldGet60","focusCommentButton","_classPrivateFieldGet61","_classPrivateFieldGet62","_this$opacity","setCommentData","_ref18","updateFromAnnotationLayer","hasEditedComment","_classPrivateFieldGet63","hasDeletedComment","_classPrivateFieldGet64","setSelectedCommentButton","setSelectedButton","DEFAULT_POPUP_WIDTH","DEFAULT_POPUP_HEIGHT","trY","blX","blY","trX","popup","contents","_ref19","parentBoundingClientRect","_this$_uiManager$_edi","defaultL10nId","_isVisible","_addFocusListeners","maxWidth","maxHeight","isResizable","_touchPinchStartCallback","_touchPinchCallback","_touchPinchEndCallback","pointerdown","_setUpDragSession","_selectOnPointerEvent","_onStartDragging","_onStopDragging","_this$parent2","moveEditorInDOM","getRect","shiftX","shiftY","getRectInCurrentCoords","getPDFRect","_classPrivateFieldGet65","onceAdded","enableEditMode","disableEditMode","needsToBeRebuilt","isOnScreen","bottom","right","innerHeight","innerWidth","rotate","_angle","serializeDeleted","_this$_initialData","_initialData","_this$_initialData2","annotationType","structTreeParentId","accessibilityData","_isCopy","isCopy","_classPrivateFieldGet66","_classPrivateFieldGet67","_classPrivateFieldGet68","hideCommentPopup","timeout","makeResizable","_createResizers","commentButtonPositionInPage","commentPopupPosition","elementBeforePopup","_classPrivateFieldGet69","savedWidth","savedHeight","boundResizerKeydown","_resizerKeydown","boundResizerBlur","_resizerBlur","_resizerFocus","firstPosition","nextFirstPosition","lastElementChild","_setResizerTabIndex","stopImmediatePropagation","_resizerPointermove","deltaX","deltaY","fromKeyboard","_this$div2","_this$_editToolbar6","_classPrivateFieldGet70","_this$div3","_this$_editToolbar5","_this$div4","preventScroll","_classPrivateFieldGet71","_this$div5","_this$div6","_this$_editToolbar7","_classPrivateFieldGet72","disableEditing","enableEditing","canChangeContent","dblclick","nodeName","contentDiv","MIN_SIZE","telemetryInitialData","telemetryFinalData","_telemetryTimeout","updateFakeAnnotationElement","annotationLayer","updateEdited","addFakeAnnotation","content","prepend","resetAnnotationElement","_ref99","angle","_getRotationMatrix","classes","_resizerPointerdown","_classPrivateFieldGet149","savedDraggable","togglePointerEvents","savedParentCursor","cursor","savedCursor","pointerUpCallback","_classPrivateFieldGet150","_addResizeToUndoStack","_resize","newWidth","newHeight","minWidth","minHeight","rotationMatrix","transf","invRotationMatrix","getPoint","getOpposite","isDiagonal","isHorizontal","point","oppositePoint","transfOppositePoint","oppositeX","oppositeY","ratioX","ratioY","lastScreenX","lastScreenY","invTransf","oldDiag","_classPrivateFieldGet151","_origin","prevDistance","factor","transfCenterPoint","newTransfCenterPoint","_classPrivateFieldGet152","hasDraggingStarted","cancelDrag","clientX","clientY","isPrimary","_event$relatedTarget","_AnnotationEditor","SEED","MASK_HIGH","MASK_LOW","MurmurHash3_64","seed","h1","h2","ArrayBuffer","isView","byteLength","blockCounts","tailLength","dataUint32","k1","k2","C1","C2","C1_LOW","C2_LOW","hexdigest","SerializableEmpty","transfer","_modified","_modifiedIds","_editorsMap","_storage","_AnnotationStorage_brand","AnnotationStorage","onSetModified","onResetModified","onAnnotationEditor","defaultValue","resetModified","modified","entry","val","_setModified","print","PrintAnnotationStorage","serializable","context","hasBitmap","editorStats","stats","typeToEditor","numberOfEditedComments","numberOfDeletedComments","_stats","isCommentDeleted","_counters$get","counters","count","comments","edited","computeTelemetryFinalData","resetModifiedIds","updateEditor","_classPrivateFieldGet73","_classPrivateFieldGet74","modifiedIds","ids","Symbol","iterator","_serializable","structuredClone","FontLoader","_ref20","ownerDocument","styleElement","_systemFonts","_document","nativeFontFaces","loadingRequests","loadTestFontId","addNativeFontFace","nativeFontFace","fonts","removeNativeFontFace","insertRule","rule","getElementsByTagName","styleSheet","sheet","cssRules","loadSystemFont","_ref21","systemFontInfo","disableFontFace","_inspectFont","loadedName","isFontLoadingAPISupported","fontFace","FontFace","load","_unused8","baseFontName","font","attached","missingFile","createNativeFontFace","loaded","family","createFontFaceRule","isSyncFontLoadingSupported","_queueLoadingCallback","_prepareFontLoadEvent","_this$_document","complete","otherRequest","_loadTestFont","int32","offset","spliceString","insert","called","XXXX_VALUE","checksum","fontFamily","isFontReady","fillText","_fontData","FontFaceObject","translatedData","inspectFont","extra","charProcOperatorList","compiledGlyphs","_this$_inspectFont","cssFontInfo","css","weight","fontWeight","italicAngle","_this$_inspectFont2","mimetype","getPathGenerator","objs","character","_cmds","objId","cmds","fontExtraProperties","black","bold","_classPrivateFieldGet75","_classPrivateFieldGet76","isInvalidPDFjsFont","isType3Font","italic","remeasure","vertical","ascent","defaultWidth","descent","bbox","fontMatrix","fallbackName","clearData","defaultVMetrics","CssFontInfo","write","encoder","TextEncoder","encodedStrings","stringsLength","strings","encoded","encode","view","DataView","setUint32","_CssFontInfo_brand","_buffer","_view","_decoder","TextDecoder","_readString","index","getUint32","_CssFontInfo","_buffer2","_view2","_decoder2","_SystemFontInfo_brand","SystemFontInfo","encodedStyleStyle","encodedStyleWeight","lengthEstimate","setUint8","guessFallback","transferToFixedLength","getUint8","_readString2","styleLength","weightLength","_SystemFontInfo","_buffer3","_decoder3","_view3","_FontInfo_brand","FontInfo","_ref22","_readBoolean","_readNumber","_OFFSET_BBOX","getInt16","_OFFSET_FONT_MATRIX","getFloat64","_OFFSET_DEFAULT_VMETRICS","_readString3","_OFFSET_STRINGS","cssFontInfoLength","cssFontInfoData","systemFontInfoLength","systemFontInfoData","systemFontInfoBuffer","cssFontInfoBuffer","numBools","bools","boolByte","boolBit","_OFFSET_NUMBERS","setFloat64","coord","setInt16","metric","byteOffset","bitOffset","stringData","_FontInfo","PatternInfo","ir","kind","coords","colorStops","figures","shadingType","nCoord","nColor","nStop","nFigures","figuresSize","figure","verticesPerRow","dataView","u8data","_KIND","_HAS_BBOX","_HAS_BACKGROUND","_SHADING_TYPE","_N_COORD","_N_COLOR","_N_STOP","_N_FIGURES","Float32Array","hex","setFloat32","Int32Array","getIR","hasBBox","hasBackground","stops","getFloat32","coordsLength","figureCoords","colorsLength","figureColors","bounds","minX","maxX","minY","maxY","_buffer4","FontPathInfo","getFactoryUrlProp","isRefProxy","num","gen","isValidExplicitDest","validRef","validName","dest","page","zoom","argsLen","allowNull","arg","_listeners","_deferred","LoopbackPort","postMessage","listener","rmAbort","onAbort","removeEventListener","CallbackKind","StreamKind","onFn","wrapReason","_messageAC","_MessageHandler_brand","MessageHandler","sourceName","targetName","comObj","callbackId","streamId","streamSinks","streamControllers","callbackCapabilities","actionHandler","_onMessage","actionName","handler","ah","transfers","sendWithPromise","capability","sendWithStream","queueingStrategy","ReadableStream","controller","startCapability","startCall","pullCall","cancelCall","isClosed","desiredSize","pull","pullCapability","stream","reason","cancelCapability","_classPrivateFieldGet77","_ref100","_processStreamMessage","_createStreamSink","streamSink","enqueue","isCancelled","lastDesiredSize","sinkCapability","ready","onPull","onCancel","success","streamController","_deleteStreamController","dataReason","_streamController$sta","_streamController$pul","_streamController$can","allSettled","BaseCanvasFactory","_ref23","enableHWA","_enableHWA","_createCanvas","reset","canvasAndContext","DOMCanvasFactory","_ref24","BaseCMapReaderFactory","_ref25","isCompressed","_ref26","_fetch","cMapData","catch","DOMCMapReaderFactory","BaseFilterFactory","addFilter","maps","fgColor","bgColor","addAlphaFilter","addLuminosityFilter","addHighlightHCMFilter","filterName","newFgColor","newBgColor","_baseUrl","_cache2","_defs","_docId","_hcmCache","_id3","_DOMFilterFactory_brand","DOMFilterFactory","_ref27","docId","_this$id7","_this$id8","_get_cache","tableR","tableG","tableB","_createTables","_createUrl","filter","_createFilter","_addTransferMapConversion","_info","_get_hcmCache","_info$filter","fgRGB","_getRGB","bgRGB","_get_defs","table","_addGrayConversion","getSteps","_this$id9","_this$id0","tableA","_addTransferMapAlphaConversion","_this$id1","_this$id10","_addLuminosityConversion","_info2","_info$filter2","fgGray","bgGray","newFgRGB","newBgRGB","fg","bg","step","newStart","newStep","prev","k","j","_classPrivateFieldGet78","_classPrivateFieldGet79","_classPrivateFieldGet80","_classPrivateFieldGet81","_this4","_this5","_this6","contain","svg","mapR","mapG","mapB","bufferR","bufferG","bufferB","feColorMatrix","_appendFeFunc","feComponentTransfer","func","feFunc","rTable","gTable","bTable","aTable","BaseStandardFontDataFactory","_ref28","_ref29","DOMStandardFontDataFactory","BaseWasmFactory","_ref30","_ref31","DOMWasmFactory","node_utils_fetchData","fs","getBuiltinModule","readFile","NodeFilterFactory","NodeCanvasFactory","createRequire","import","createCanvas","NodeCMapReaderFactory","NodeStandardFontDataFactory","NodeWasmFactory","FORCED_DEPENDENCY_LABEL","expandBBox","array","EMPTY_BBOX","_bboxes","_coords","BBoxReader","bboxes","ensureDebugMetadata","dependencies","isRenderingOperation","_simple","_incremental","_namedDependencies","_savesStack","_markedContentStack","_baseTransformStack","_clipBox","_pendingBBox","_pendingBBoxIdx","_pendingDependencies","_operations","_fontBBoxTrustworthy","_canvasWidth","_canvasHeight","_bboxesCoords","_bboxes2","_debugMetadata","_CanvasDependencyTracker_brand","CanvasDependencyTracker","operationsCount","recordDebugMetadata","__proto__","sameLineText","Float64Array","_initializeBBoxes","growOperationsCount","opIdx","previous","lastSave","_ensureDebugMetadata","recordOpenMarker","idx","getOpenMarker","recordCloseMarker","_ensureDebugMetadata2","_ensureDebugMetadata3","pushBaseTransform","popBaseTransform","recordSimpleData","recordIncrementalData","resetIncrementalData","recordNamedData","recordSimpleDataFromNamed","depName","fallbackIdx","_classPrivateFieldGet82","recordFutureForcedDependency","inheritSimpleDataAsFutureForcedDependencies","inheritPendingDependenciesAsFutureForcedDependencies","dep","resetBBox","recordClipBox","clipBox","intersection","recordBBox","recordCharacterBBox","getMeasure","fontBBox","isBBoxTrustworthy","computedBBox","recordFullPageBBox","measure","actualBoundingBoxLeft","actualBoundingBoxRight","actualBoundingBoxAscent","actualBoundingBoxDescent","getSimpleIndex","dependencyName","recordDependencies","dependencyNames","pendingDependencies","simple","incremental","recordNamedDependency","recordOperation","preserve","metadata","depIdx","saveIdx","recordShowTextOperation","deps","bboxToClipBoxDropOperation","_takePendingDependencies","_extractOperation","operation","_pushPendingDependencies","take","takeDebugMetadata","oldBBoxes","Uint8ClampedArray","_dependencyTracker","_opIdx","_ignoreBBoxes","_nestingLevel","_savesLevel","CanvasNestedDependencyTracker","dependencyTracker","ignoreBBoxes","_this$savesLevel","_this$savesLevel3","_this$nestingLevel","_this$nestingLevel3","Dependencies","PathType","applyBoundingBox","region","BaseShadingPattern","isModifyingCurrentTransform","getPattern","RadialAxialShadingPattern","IR","_bbox","_colorStops","_p0","_p1","_r0","_r1","isOriginBased","isRadial","_createGradient","grad","firstPoint","secondPoint","createLinearGradient","createRadialGradient","colorStop","addColorStop","owner","inverse","pathType","pattern","baseTransform","precision","n1","n2","ps","ownerBBox","current","getClippedPathBoundingBox","tmpCanvas","cachedCanvases","getCanvas","tmpCtx","clearRect","beginPath","fillStyle","createPattern","domMatrix","DOMMatrix","setTransform","drawTriangle","p2","p3","c1","c2","c3","rowSize","tmp","scaleX","scaleY","c1r","c1g","c1b","c2r","c2g","c2b","c3r","c3g","c3b","xa","car","cag","cab","xb","cbr","cbg","cbb","x1_","x2_","drawFigure","cs","rows","cols","q","MeshShadingPattern","_figures","_bounds","_background","_createMeshCanvas","combinedScale","boundsWidth","boundsHeight","paddedWidth","BORDER_SIZE","paddedHeight","createImageData","putImageData","matrixScaleX","matrixScaleY","temporaryPatternCanvas","DummyShadingPattern","PaintType","TilingPattern","canvasGraphicsFactory","operatorList","xstep","ystep","paintType","tilingType","createPatternCanvas","_graphics$dependencyT","_graphics$dependencyT2","combinedScaleX","combinedScaleY","canvasWidth","canvasHeight","redrawHorizontally","redrawVertically","xScaledStep","yScaledStep","dimx","getSizeAndScale","dimy","graphics","createCanvasGraphics","groupLevel","setFillAndStrokeStyleToContext","clipBbox","executeOperatorList","endDrawing","dimx2","dimy2","xSize","ySize","tmpCanvas2","tmpCtx2","jj","realOutputSize","MAX_PATTERN_SIZE","bboxWidth","bboxHeight","strokeStyle","fillColor","strokeColor","convertBlackAndWhiteToRGBA","_ref32","srcPos","nonBlackColor","inverseDecode","zeroMapping","oneMapping","widthInSource","widthRemainder","srcLength","destPos","elem","FULL_CHUNK_HEIGHT","SCALE_MATRIX","XY","MIN_MAX_INIT","CachedCanvases","canvasFactory","cache","canvasEntry","drawImageAtIntegerCoords","srcImg","srcX","srcY","srcW","srcH","destX","destY","destW","destH","tlX","rTlX","tlY","rTlY","brX","rWidth","brY","rHeight","sign","CanvasExtraState","preInit","getPathBoundingBox","xStrokePad","lineWidth","yStrokePad","updateClipFromPath","startNewPathAndClipBox","isEmptyClip","putBinaryImageData","imgData","ImageData","partialChunkHeight","fullChunks","totalChunks","chunkImgData","thisChunkHeight","elemsInThisChunk","dest32","dest32DataLength","fullSrcDiff","white","srcDiff","kEnd","kEndUnrolled","mask","srcByte","putBinaryImageMask","copyCtxState","sourceCtx","destCtx","properties","property","setLineDash","getLineDash","lineDashOffset","resetCtxToDefault","fillRule","globalAlpha","lineCap","lineJoin","miterLimit","globalCompositeOperation","getImageSmoothingEnabled","interpolate","actualScale","fround","LINE_CAP_STYLES","LINE_JOIN_STYLES","NORMAL_CLIP","EO_CLIP","_CanvasGraphics_brand","CanvasGraphics","canvasCtx","commonObjs","_ref34","annotationCanvasMap","optionalContentConfig","markedContentStack","stateStack","pendingClip","pendingEOFill","xobjs","groupStack","baseTransformStack","smaskStack","smaskCounter","tempSMask","suspendedCtx","contentVisible","cachedPatterns","viewportScale","outputScaleX","outputScaleY","_cachedScaleForStroking","_cachedGetSinglePixelWidth","_cachedBitmapsMap","getObject","fallback","_this$dependencyTrack","beginDrawing","_ref35","transparency","savedFillStyle","fillRect","transparentCanvas","compositeCtx","executionStartIdx","continueCallback","stepper","operationsFilter","argsArray","fnArray","argsArrayLen","chunkOperations","endTime","steps","fnId","fnArgs","nextBreakPoint","breakIt","_argsArray$i","depObjId","_this$dependencyTrack2","objsPool","_restoreInitialState","HTMLCanvasElement","_drawFilter","_scaleImage","img","_img$width","_img$height","displayWidth","displayHeight","widthScale","heightScale","paintWidth","paintHeight","tmpCanvasId","_createMaskCanvas","_this$dependencyTrack4","isPatternFill","patternFill","currentTransform","cacheKey","maskCanvas","mainKey","cachedImage","_this$dependencyTrack3","maskToCanvas","drawnWidth","drawnHeight","fillCanvas","fillCtx","imageSmoothingEnabled","_this$dependencyTrack5","_this$dependencyTrack6","_this$dependencyTrack7","limit","_this$dependencyTrack8","dashArray","dashPhase","_this$dependencyTrack9","flatness","states","_this$dependencyTrack0","_this$dependencyTrack1","_this$dependencyTrack10","_this$dependencyTrack11","_this$dependencyTrack12","strokeAlpha","fillAlpha","activeSMask","checkSMaskState","transferMaps","inSMaskMode","beginSMaskMode","endSMaskMode","cacheId","scratchCanvas","_removeMirroring","__originalSave","__originalRestore","__originalRotate","__originalScale","__originalTranslate","__originalTransform","__originalSetTransform","__originalResetTransform","resetTransform","__originalClip","__originalMoveTo","__originalLineTo","__originalBezierCurveTo","__originalRect","__originalClosePath","__originalBeginPath","cp1x","cp1y","cp2x","cp2y","mirrorContextOperations","compose","dirtyBox","smask","composeSMask","layerCtx","layerBox","layerOffsetX","layerOffsetY","layerWidth","layerHeight","genericComposeSMask","subtype","backdrop","transferMap","maskCtx","maskOffsetX","maskOffsetY","maskX","maskY","_this$dependencyTrack13","old","_this$dependencyTrack14","_this$dependencyTrack15","op","outerExtraSize","_pathStartIdx","_this$dependencyTrack16","consumePath","newPath","addPath","multiplySelf","rescaleAndStroke","_this$dependencyTrack18","needRestore","_this$dependencyTrack17","_this$dependencyTrack19","_this$dependencyTrack20","_this$dependencyTrack21","_this$dependencyTrack22","_this$dependencyTrack23","textMatrix","textMatrixScale","lineX","lineY","paths","pendingTextPaths","fontSize","preMultiplySelf","spacing","_this$dependencyTrack24","charSpacing","_this$dependencyTrack25","wordSpacing","_this$dependencyTrack26","textHScale","leading","_this$dependencyTrack27","fontRefName","_this$dependencyTrack28","_fontObj$systemFontIn","fontObj","fontDirection","typeface","browserFontSize","fontSizeScale","_this$dependencyTrack29","textRenderingMode","rise","_this$dependencyTrack30","textRise","_this$dependencyTrack31","_this$dependencyTrack32","_this$dependencyTrack33","_this$dependencyTrack34","paintChar","patternFillTransform","patternStrokeTransform","fillStrokeMode","isAddToPathSet","patternStroke","_this$dependencyTrack35","scaledPath","_getScaledPath","invPatternTransform","_this$dependencyTrack36","measureText","_this$dependencyTrack37","strokeText","_this$dependencyTrack38","isFontSubpixelAAEnabled","glyphs","_this$dependencyTrack42","_this$dependencyTrack39","showType3Text","_this$dependencyTrack40","glyphsLength","spacingDir","widthAdvanceScale","simpleFillText","needsStroke","getSinglePixelWidth","chars","glyph","unicode","joinedChars","restoreNeeded","isSpace","fontChar","accent","scaledX","scaledY","vmetric","vx","vy","measuredWidth","characterScaleX","_this$dependencyTrack41","isInFont","scaledAccentX","scaledAccentY","spacingLength","operatorListId","xWidth","yWidth","llx","lly","urx","ury","_this$dependencyTrack43","getColorN_Pattern","renderingOpIdx","_getPattern","_this$dependencyTrack44","_len2","_key2","_this$dependencyTrack45","_len3","_key3","_this$dependencyTrack46","_this$dependencyTrack47","_this$dependencyTrack48","_this$dependencyTrack49","getShadingPattern","_this$dependencyTrack50","inv","_this$dependencyTrack51","group","_this$dependencyTrack52","currentCtx","isolated","knockout","canvasBounds","groupCtx","startTransformInverse","_this$dependencyTrack53","currentMtx","hasOwnCanvas","annotationCanvas","savedCtx","_this$dependencyTrack54","_this$dependencyTrack55","_this$dependencyTrack57","skewX","skewY","positions","_this$dependencyTrack56","trans","images","_this$dependencyTrack58","_this$dependencyTrack60","_this$dependencyTrack59","applyTransferMapsToCanvas","applyTransferMapsToBitmap","_this$dependencyTrack61","imgToPaint","_this$dependencyTrack62","_this$dependencyTrack64","_this$dependencyTrack63","_this$dependencyTrack65","tag","_this$dependencyTrack66","_this$dependencyTrack67","isVisible","isContentVisible","_this$dependencyTrack68","_this$dependencyTrack69","_this$dependencyTrack70","absDet","normX","normY","getScaleForStroking","scaledLineWidth","scaledXLineWidth","scaledYLineWidth","baseArea","saveRestore","dashes","hcmFilterId","savedFilter","GlobalWorkerOptions","workerPort","_port","Worker","workerSrc","_src","Metadata","_ref36","parsedData","_map","_data3","getRaw","_classPrivateFieldGet83","INTERNAL","_isDisplay","_isPrint","_userSet","_visible","OptionalContentGroup","renderingIntent","_ref37","usage","rbGroups","viewState","printState","_setVisible","internal","userSet","_cachedGetHash","_groups","_initialHash","_order","_OptionalContentConfig_brand","OptionalContentConfig","creator","order","groups","baseState","off","getHash","expression","_evaluateVisibilityExpression","policy","setVisibility","preserveRB","rbGroup","otherId","_classPrivateFieldGet84","setOCGState","_ref38","operator","state","hasInitialVisibility","getOrder","getGroup","PDFDataTransportStream","pdfDataRangeTransport","_ref39","disableRange","disableStream","initialData","progressiveDone","contentDispositionFilename","_queuedChunks","_progressiveDone","_contentDispositionFilename","_pdfDataRangeTransport","_isStreamingSupported","_isRangeSupported","_contentLength","_fullRequestReader","_rangeReaders","addRangeListener","begin","_onReceiveData","addProgressListener","total","_onProgress","addProgressiveReadListener","addProgressiveDoneListener","_onProgressiveDone","transportReady","_ref40","_enqueue","rangeReader","_begin","_progressiveDataLength","_this$_fullRequestRea","_this$_fullRequestRea2","_loaded","_this$_rangeReaders$","_this$_rangeReaders$$","_this$_fullRequestRea3","_this$_fullRequestRea4","onProgress","_this$_fullRequestRea5","_removeRangeReader","reader","getFullReader","queuedChunks","PDFDataTransportStreamReader","getRangeReader","PDFDataTransportStreamRangeReader","requestDataRange","cancelAllRequests","_this$_fullRequestRea6","_stream","_done","_filename","_requests","_headersReady","headersReady","isRangeSupported","isStreamingSupported","contentLength","read","requestCapability","_end","_queuedChunk","createHeaders","isHttp","httpHeaders","headers","Headers","getResponseOrigin","_URL$parse$origin","_URL$parse","validateRangeRequestCapabilities","_ref41","responseHeaders","rangeChunkSize","returnValues","allowRangeRequests","suggestedLength","extractFilenameFromHeader","contentDisposition","needsEncodingFixup","toParamRegExp","rfc2616unquote","unescape","rfc5987decode","rfc2047decode","fixupEncoding","contentDispositionStr","iter","quot","part","parts","rfc2231getparam","attributePattern","flags","textdecode","encoding","decoder","fatal","_unused9","quotindex","replaceAll","extvalue","encodingend","charset","_unused0","getFilenameFromContentDispositionHeader","_unused1","createResponseError","validateResponseStatus","createFetchOptions","withCredentials","abortController","method","credentials","redirect","getArrayBuffer","PDFFetchStream","_rangeRequestReaders","_this$_fullRequestRea7","_this$_fullRequestRea8","PDFFetchStreamReader","PDFFetchStreamRangeReader","_this$_fullRequestRea9","_reader","_withCredentials","_headersCapability","_disableRange","_rangeChunkSize","_responseOrigin","getReader","_this$onProgress","_this$_reader","_readCapability","responseOrigin","_this$onProgress2","_this$_reader2","NetworkManager","_ref42","currXhrId","pendingRequests","xhr","xhrId","pendingRequest","setRequestHeader","expectedStatus","onError","onStateChange","onprogress","onHeadersReceived","onDone","_pendingRequest$onPro","xhrStatus","network_getArrayBuffer","rangeHeader","getResponseHeader","getRequestXhr","isPendingRequest","abortRequest","PDFNetworkStream","_source","_manager","_onRangeRequestReaderClosed","PDFNetworkStreamFullRequestReader","PDFNetworkStreamRangeRequestReader","onClosed","_this$_fullRequestRea0","manager","_url","_fullRequestId","_onHeadersReceived","_onDone","_onError","_cachedChunks","_storedError","fullRequestXhrId","fullRequestXhr","responseURL","rawResponseHeaders","getAllResponseHeaders","trimStart","_this$onProgress3","lengthComputable","_requestId","_this$_manager$getReq","_close","_this$onClosed","_this$_storedError","_this$onProgress4","urlRegex","PDFNodeStream","sourceUrl","pathToFileURL","parseUrlOrPath","_this$_fullRequestRea1","_this$_fullRequestRea10","PDFNodeStreamFsFullReader","PDFNodeStreamFsRangeReader","_this$_fullRequestRea11","_readableStream","lstat","stat","_setReadableStream","createReadStream","_this$onProgress5","_error","readableStream","_this$onProgress6","INITIAL_DATA","_objs","_PDFObjects_brand","PDFObjects","_ensureObj","_data$bitmap","_classPrivateFieldGet153","_capability","_container4","_disableProcessItems","_fontInspectorEnabled","_lang","_layoutTextParams","_pageHeight3","_pageWidth3","_rootContainer","_rotation3","_scale","_styleCache","_textContentItemsStr","_textContentSource","_textDivs","_textDivProperties","_transform","_TextLayer_brand","TextLayer","_ref43","_globalThis$FontInspe","textContentSource","FontInspector","_ensureMinFontSizeComputed","setProperty","_minFontSize","_pendingTextLayers","fontFamilyMap","pump","_ref44","_classPrivateFieldGet85","lang","_processItems","_ref45","onBefore","_getCtx","_layout","_classPrivateFieldGet86","abortEx","textContentItemsStr","cleanup","_ascentCache","_canvasContexts","_classPrivateFieldGet154","_classPrivateFieldGet155","_appendText","geom","textDiv","textDivProperties","hasText","hasEOL","atan2","fontName","PI","fontSubstitution","fontHeight","fontAscent","_getAscent","sin","cos","divStyle","dataset","fontSubstitutionLoadedName","shouldScaleText","absScaleX","absScaleY","br","_ensureCtxFont","alpha","_canvasCtxFonts","cached","lineHeight","cachedAscent","metrics","fontBoundingBoxAscent","fontBoundingBoxDescent","ratio","_TextLayer","getDocument","_src$password","_src$length","task","PDFDocumentLoadingTask","location","getUrlProp","Buffer","isNaN","getDataProp","password","rangeTransport","PDFDataRangeTransport","PDFWorker","docBaseUrl","cMapUrl","cMapPacked","CMapReaderFactory","iccUrl","standardFontDataUrl","StandardFontDataFactory","wasmUrl","WasmFactory","ignoreErrors","stopAtErrors","maxImageSize","chrome","canvasMaxAreaInBytes","enableXfa","disableAutoFetch","pdfBug","CanvasFactory","FilterFactory","useWasm","useSystemFonts","useWorkerFetch","transportFactory","cMapReaderFactory","standardFontDataFactory","wasmFactory","port","_worker","docParams","apiVersion","evaluatorOptions","transportParams","loadingParams","destroyed","workerIdPromise","messageHandler","networkStream","NetworkStream","workerId","transport","WorkerTransport","_transport","_docId2","_PDFDocumentLoadingTa","_PDFDocumentLoadingTa2","_this$_worker3","_this$_worker","_this$_transport","_pendingDestroy","_this$_worker2","_capability2","_progressiveDoneListeners","_progressiveReadListeners","_progressListeners","_rangeListeners","onDataRange","onDataProgress","onDataProgressiveRead","onDataProgressiveDone","PDFDocumentProxy","pdfInfo","_pdfInfo","numPages","fingerprints","isPureXfa","_htmlForXfa","allXfaHtml","getPage","getPageIndex","ref","getDestinations","getDestination","getPageLabels","getPageLayout","getPageMode","getViewerPreferences","getOpenAction","getAttachments","pageIndexesToSkip","getJSActions","getDocJSActions","getOutline","getOptionalContentConfig","getRenderingIntent","getPermissions","getMetadata","getMarkInfo","saveDocument","extractPages","pageInfos","getDownloadInfo","downloadInfoCapability","keepLoadedFonts","startCleanup","loadingTask","cachedPageNumber","getFieldObjects","hasJSActions","getCalculationOrderIds","_pendingCleanup","_PDFPageProxy_brand","PDFPageProxy","pageInfo","_pageIndex","_pageInfo","_pdfBug","_intentStates","recordedBBoxes","getViewport","getAnnotations","getPageJSActions","getXfa","_this$_transport$_htm","_ref46","_this$_stats","_globalThis$StepperMa","_intentState","canvasContext","annotationMode","optionalContentConfigPromise","printAnnotationStorage","recordOperations","intentArgs","intentState","streamReaderCancelTimeout","intentPrint","_this$_stats2","displayReadyCapability","lastChunk","separateAnnots","_pumpOperatorList","recordForDebugger","Boolean","StepperManager","shouldRecordOperations","renderTasks","internalRenderTask","_internalRenderTask$g","gfx","setOperatorBBoxes","_globalThis$Stats","_tryCleanup","_abortOperatorList","Stats","InternalRenderTask","useRequestAnimationFrame","renderTask","_ref47","_this$_stats3","initializeGraphics","operatorListChanged","getOperatorList","opListTask","_intentState2","_this$_stats4","opListReadCapability","streamTextContent","includeMarkedContent","disableNormalization","highWaterMark","getTextContent","_ref48","_textContent$lang","getStructTree","_destroy","waitOn","force","completed","resetStats","_startRenderPage","_this$_stats5","_intentState$displayR","_renderPageChunk","operatorListChunk","_ref49","annotationStorageSerializable","streamReader","_ref50","_ref51","delay","curCacheKey","curIntentState","_capability3","_messageHandler","_port2","_webWorker","_PDFWorker_brand","_workerPorts","_initializeFromPort","_initialize","_classPrivateFieldGet87","_classPrivateFieldGet88","cachedPort","_setupFakeWorkerGlobal","_get_mainThreadWorkerMessageHandler","WorkerMessageHandler","loader","_resolve","_isWorkerDisabled","_setupFakeWorker","_isSameOrigin","_createCDNWrapper","terminateEarly","sendTest","_unused10","testObj","_unused11","_PDFWorker$fakeWorker","_PDFWorker$fakeWorker2","_fakeWorkerId","workerHandler","setup","_this7","_globalThis$pdfjsWork","pdfjsWorker","_unused12","_PDFWorker","otherUrl","base","other","wrapper","createObjectURL","fromPort","_methodPromises","_pageCache","_pagePromises","_pageRefCache","_passwordCapability","_WorkerTransport_brand","factory","fontLoader","_params","destroyCapability","_networkStream","_fullReader","_lastProgress","setupMessageHandler","isOpList","modifiedIdsHash","_classPrivateFieldGet89","terminated","_this$_networkStream","_this$messageHandler","sink","_ref52","readyReason","_loadingTask$onProgre","_loadingTask$onProgre2","_ref53","_ref54","_numPages","htmlForXfa","onPassword","updatePassword","_loadingTask$onProgre3","_ref55","_globalThis$FontInspe2","exportedData","exportedError","fontData","fontAdded","imageRef","pageProxy","dataLen","_ref56","imageData","_imageData$bitmap","_loadingTask$onProgre4","_this$_fullReader$fil","_this$_fullReader","cachedPromise","refStr","_cacheSimpleMethod","results","_this$_fullReader$fil2","_this$_fullReader2","_this$_fullReader$con","_this$_fullReader3","hasStructTree","_classPrivateFieldGet90","_internalRenderTask","RenderTask","form","_rAF","_ref57","operatorListIdx","running","graphicsReadyCallback","graphicsReady","_useRequestAnimationFrame","cancelled","_cancelBound","_continueBound","_continue","_scheduleNextBound","_scheduleNext","_nextBound","_next","_canvas","_canvasContext","_operationsFilter","_ref58","_globalThis$StepperMa2","_this$graphicsReadyCa","_canvasInUse","init","getNextBreakPoint","_this$gfx","_this$task$onError","_this$task","cancelAnimationFrame","_this$gfx$dependencyT","_this$stepper","updateOperatorList","onContinue","requestAnimationFrame","version","ColorPicker","_hideDropdownFromKeyboard","_colorSelectFromKeyboard","_moveToNext","_moveToPrevious","_moveToBeginning","_moveToEnd","_ref59","_editor$color","_classPrivateFieldGet91","_ColorPicker_brand","_button","_buttonSwatch","_defaultColor","_dropdown","_dropdownWasFromKeyboard","_isMainColorPicker","_editor4","_openDropdownAC","_uiManager3","_l10nColor","blue","green","pink","red","yellow","_openDropdown","_keyDown","swatch","ariaHidden","renderMainDropdown","dropdown","_getDropdownRoot","ariaOrientation","ariaLabelledBy","_colorSelect","_event$target$nextSib","_classPrivateFieldGet92","_get_isDropdownVisible","nextSibling","_classPrivateFieldGet93","_event$target$previou","previousSibling","_classPrivateFieldGet94","_classPrivateFieldGet95","_classPrivateFieldGet96","_classPrivateFieldGet97","_classPrivateFieldGet98","updateColor","ariaSelected","_classPrivateFieldGet99","_classPrivateFieldGet100","role","ariaMultiSelectable","detail","_pointerDown3","_classPrivateFieldGet156","_this8","_ColorPicker","_input","_editor5","_uiManager4","BasicColorPicker","_l10nColor2","colorType","_classPrivateFieldGet101","makeColorComp","scaleAndClamp","ColorConverters","CMYK_G","_ref60","G_CMYK","_ref61","G_RGB","_ref62","G_rgb","_ref63","G_HTML","_ref64","G","RGB_G","_ref65","RGB_rgb","RGB_HTML","T_HTML","T_rgb","CMYK_RGB","_ref66","CMYK_rgb","_ref67","CMYK_HTML","components","RGB_CMYK","_ref68","BaseSVGFactory","skipDimensions","_createSVG","DOMSVGFactory","GetElementsByNameSet","TIMEZONE_OFFSET","getTimezoneOffset","AnnotationElementFactory","LinkAnnotationElement","TextAnnotationElement","fieldType","TextWidgetAnnotationElement","radioButton","RadioButtonWidgetAnnotationElement","checkBox","CheckboxWidgetAnnotationElement","PushButtonWidgetAnnotationElement","ChoiceWidgetAnnotationElement","SignatureWidgetAnnotationElement","WidgetAnnotationElement","PopupAnnotationElement","FreeTextAnnotationElement","LineAnnotationElement","SquareAnnotationElement","CircleAnnotationElement","PolylineAnnotationElement","CaretAnnotationElement","InkAnnotationElement","PolygonAnnotationElement","HighlightAnnotationElement","UnderlineAnnotationElement","SquigglyAnnotationElement","StrikeOutAnnotationElement","StampAnnotationElement","FileAttachmentAnnotationElement","AnnotationElement","_updates","_hasBorder","_popupElement","_AnnotationElement_brand","isRenderable","ignoreBorder","createQuadrilaterals","downloadManager","imageResourcesPath","renderForms","svgFactory","enableComment","enableScripting","_fieldObjects","fieldObjects","hasOwnCommentButton","contentElement","_createContainer","_createQuadrilaterals","_hasPopupData","_ref69","_isEditable","isEditable","hasPopupData","commentText","commentData","_this$annotationStora","hasCommentButton","hasPopupElement","_this$annotationStora2","quadPoints","inkLists","inkList","_normalizePoint","_this$annotationStora3","_data$contentsObj","removePopup","_ref70","_classPrivateFieldGet102","_classPrivateFieldGet103","newPopup","_setRectEdited","_createPopup","resetEdited","_classPrivateFieldGet104","alternativeText","noRotate","setRotation","borderStyle","borderWidth","horizontalRadius","horizontalCornerRadius","verticalRadius","verticalCornerRadius","radius","borderRadius","borderBottomStyle","borderColor","_commonActions","setColor","jsName","styleName","colorArray","display","noView","noPrint","userName","readonly","required","_setRequired","textColor","_dispatchEventFromSandbox","actions","jsEvent","commonActions","_setDefaultPropertiesFromJS","rectBlX","rectBlY","rectTrX","rectTrY","svgBuffer","defs","clipPath","_svgBuffer","rectWidth","rectHeight","backgroundImage","popupData","titleObj","parentRect","elements","extraPopupElement","_getElementsByName","skipId","fields","fieldObj","exportValues","exportValue","domElement","getElementsByName","_this$popup","maybeShow","_this$popup2","forceHide","getElementsToTriggerPopup","addHighlightArea","triggers","_editOnDoubleClick","annotationEditorType","_this$linkService$eve","currentRect","EditorAnnotationElement","createOrUpdatePopup","removeAnnotation","_LinkAnnotationElement_brand","isTooltipOnly","link","isBound","_bindNamedAction","overlaidText","attachment","_bindAttachment","attachmentDest","_bindSetOCGState","_bindLink","Action","_bindJSAction","resetForm","_bindResetFormAction","destination","getDestinationHash","onclick","goToDestination","_setInternalLink","getAnchorUrl","executeNamedAction","_this$linkService$eve2","otherClickAction","resetFormFields","refs","resetFormRefs","include","allFields","fieldIds","fieldName","field","allIds","dispatchEvent","Event","_this$linkService$eve3","_this$downloadManager","openOrDownloadData","executeSetOCGState","showElementAndHideCanvas","_element$previousSibl","_getKeyModifier","_setEventListener","elementData","baseName","eventName","valueGetter","_this$linkService$eve4","modifier","_this$linkService$eve5","focused","_setEventListeners","getter","_this$data$actions","_this$data$actions2","_this$data$actions3","Blur","Focus","_setBackgroundColor","_setTextStyle","TEXT_ALIGNMENT","fontColor","defaultAppearanceData","computedFontSize","roundToOneDecimal","multiLine","textAlignment","textAlign","isRequired","hasAppearance","fieldValue","setPropertyOnSiblings","keyInStorage","_this$data$textConten","maxLen","charLimit","fieldFormattedValues","formattedValue","comb","userValue","lastCommittedValue","commitKey","doNotScroll","overflowY","overflowX","readOnly","datetimeFormat","datetimeType","timeStep","hasDateOrTime","maxLength","_this$data$defaultFie","defaultFieldValue","blurListener","scrollLeft","_this$data$actions6","_this$data$actions4","getHours","getMinutes","getSeconds","toISOString","_event$detail$value","selRange","setSelectionRange","_this$linkService$eve6","willCommit","selStart","selectionStart","selEnd","selectionEnd","_this$linkService$eve7","_blurListener","_this$data$actions5","valueOf","_this$linkService$eve8","Keystroke","_this$linkService$eve9","inputType","change","combWidth","letterSpacing","verticalAlign","checkbox","curChecked","buttonValue","radio","pdfButtonValue","linkElement","lastChild","selectElement","addAnEmptyEntry","combo","multiSelect","multiple","optionElement","displayValue","removeEmptyEntry","noneOptionElement","isExport","selectedValues","getItems","_removeEmptyEntry","multipleSelection","findIndex","selectChild","indices","editable","_this$linkService$eve0","changeEx","keyDown","_PopupAnnotationElement_brand","PopupElement","_commentManager2","_boundKeyDown","_boundHide","_boundShow","_boundToggle","_color","_container5","_contentsObj","_dateObj","_elements","_parent","_parentRect","_pinned","_popup","_popupAbortController","_position2","_commentButton","_commentButtonPosition","_popupPosition2","_rect","_richText2","_titleObj","_updates2","_wasVisible","_firstElement","_commentText","_PopupElement_brand","_ref71","_keyDown2","_hide","_show","_toggle","trigger","flatMap","_addEventListeners","renderCommentButton","after","_setCommentButtonPosition","hasOwnButton","togglePopup","showPopup","hidePopup","parentContainer","_updateColor","_updateCommentButtonPosition","_classPrivateFieldGet105","_classPrivateFieldGet106","_ref72","_classPrivateFieldGet107","_classPrivateFieldGet108","baseColor","outlineColor","header","dateObj","dateTime","_get_html","_ref73","_classPrivateFieldGet109","_makePopupContent","_classPrivateFieldGet110","_classPrivateFieldGet111","_classPrivateFieldGet112","_classPrivateFieldGet113","_element$container","find","_this9","_get_fontSize","_this0","_classPrivateGetter5","_get_fontColor","_this1","_classPrivateGetter6","popupLines","popupContent","lineAttributes","_setPosition","useParentRect","normalizedRect","popupLeft","popupTop","textPosition","lineSpan","_line","lineCoordinates","_square","square","_circle","circle","_polyline","containerClassName","svgElementName","vertices","points","polyline","_polylinesGroupElement","_polylines","_InkAnnotationElement_brand","it","_getTransform","thickness","mark","underline","strikeout","_trigger","_FileAttachmentAnnotationElement_brand","_this$linkService$eve1","_download","_this$downloadManager2","_accessibilityManager","_annotationCanvasMap","_annotationStorage2","_editableAnnotations","_structTreeLayer","_linkService","_elements2","_hasAriaAttributesFromStructTree","_AnnotationLayer_brand","AnnotationLayer","_ref74","accessibilityManager","annotationEditorUIManager","structTreeLayer","_annotationEditorUIManager","hasEditableAnnotations","annotations","popupToElements","popupAnnotations","elementParams","noHTML","isPopupAnnotation","rendered","_this$_annotationEdit","_addElementsToDOM","_setAnnotationCanvasMap","addLinkAnnotations","_defaultBorderStyle","_ref75","getEditableAnnotations","getEditableAnnotation","_classPrivateFieldGet114","removePointerInTextLayer","updateFakeAnnotations","rawWidth","replaceChildren","_classPrivateFieldGet157","getAriaAttributes","ariaAttributes","sort","_ref101","_ref102","mid1","mid2","_ref103","_element$extraPopupEl","addPointerInTextLayer","firstChild","replaceWith","editableAnnotation","_this$_annotationEdit2","_hasNoCanvas","EOL_PATTERN","_content","_editorDivId","_editModeAC","_fontSize","_FreeTextEditor_brand","FreeTextEditor","_translateEmpty","_defaultFontSize","_internalPadding","_updateFontSize","_updateColor2","_this$_colorPicker","editorDiv","overlayDiv","contentEditable","editorDivKeydown","editorDivFocus","editorDivBlur","editorDivInput","editorDivPaste","_classPrivateFieldGet115","_this$_initialOptions","innerText","savedText","newText","_extractText","trimEnd","setText","_setContent","_setEditorDimensions","_deserializeContent","normalize","deleteFromDocument","insertNode","collapseToStart","startContainer","startOffset","bufferBefore","bufferAfter","nodeValue","childNodes","_getNodeContent","newRange","Range","beforeLength","setStart","setEnd","removeAllRanges","addRange","padding","_serializeContent","_hasElementChanged","setFontsize","savedFontsize","col","savedColor","prevChild","_prevChild","savedDisplay","savedVisibility","_FreeTextEditor","Outline","toSVGPath","_rotation","_rescale","_rescaleAndSwap","svgRound","_normalizePagePoint","createBezierPoints","FreeDrawOutliner","_ref76","scaleFactor","innerMargin","_FreeDrawOutliner_brand","_box","_bottom","_innerMargin","_isLTR2","_top","_last","_lastX","_lastY","_min","_min_dist","_scaleFactor","_thickness","_points","_MIN_DIST","_MIN","_ref77","_classPrivateFieldGet116","diffX","diffY","diffD","K","nY","thX","thY","_toSVGPathTwoPoints","_toSVGPathEnd","_toSVGPathStart","newFreeDrawOutline","outline","FreeDrawOutline","getOutlines","_classPrivateFieldGet117","_classPrivateFieldGet118","last","_getOutlineTwoPoints","N","_getOutlineEnd","_getOutlineStart","_getLastCoords","lastTop","lastBottom","lastTopX","lastTopY","lastBottomX","lastBottomY","_box2","_bbox2","_innerMargin2","_isLTR3","_points2","_scaleFactor2","_outline","_FreeDrawOutline_brand","lastPoint","_computeMinMax","_ref78","newOutliner","getNewOutline","outliner","firstPointX","firstPointY","lastPointX","lastPointY","ltrCallback","bezierBbox","HighlightOutliner","_HighlightOutliner_brand","_box3","_firstPoint","_lastPoint","_verticalEdges","_intervals","EPSILON","shiftedMinX","shiftedMinY","lastEdge","edge","outlineVerticalEdges","_breakEdge","_insert","_remove","_getOutlines","edges","allEdges","edge1","edge2","outlines","HighlightOutline","_binarySearch","middle","_ref104","_ref105","y4","_box4","_outlines","polygon","prevX","prevY","_ref79","classNamesForOutlining","FreeHighlightOutliner","FreeHighlightOutline","HighlightEditor","_moveCaret","_HighlightEditor_brand","_anchorNode","_anchorOffset","_boxes","_clipPathId","_colorPicker2","_focusOutlines","_focusNode","_focusOffset","_highlightDiv","_highlightOutlines","_id4","_isFreeHighlight","_firstPoint2","_lastPoint2","_outlineId","_text2","_thickness2","_methodOfCreation","_defaultThickness","_defaultOpacity","highlightId","_createFreeOutlines","_addToDrawLayer","_createOutlines","numberOfColors","_uiManager$highlightC","_updateColor3","_updateThickness","_this$parent3","_classPrivateFieldGet119","drawLayer","updateProperties","_getRotation","addUndoableEditor","_cleanDrawLayer","mustBeSelected","_this$div7","_rotateBbox","_keydown","highlightDiv","pointerover","_this$parent4","rootClass","hovered","pointerleave","_this$parent5","_setCaret","_this$parent6","_this$parent7","startHighlighting","_ref80","_endHighlight","_highlightMove","_freeHighlight","_freeHighlightId","clipPathId","_freeHighlightClipId","draw","free","highlightOutlines","_serializeBoxes","_serializeOutlines","_hasElementChanged2","outlinerForOutline","_ref106","finalizeDraw","drawOutline","highlightOutline","setColorAndOpacity","opa","savedOpacity","savedThickness","setThickness","th","_changeThickness","_ref107","setPosition","_HighlightEditor","DrawingOptions","_svgProperties","updateProperty","updateSVGProperty","toSVGProperties","updateAll","_drawOutlines","_mustBeCommitted","_DrawingEditor_brand","DrawingEditor","mustBeCommitted","_addOutlines","_this$_colorPicker2","drawOutlines","_createDrawOutlines","_addToDrawLayer2","_mergeSVGProperties","p1Keys","getDefaultDrawingOptions","_options","typesMap","supportMultipleDrawings","propertyName","_defaultDrawingOptions","_currentParent","_currentDraw","_currentDrawId","_updateProperty","_drawingOptions","savedValue","setter","_this$parent8","_updateBbox","_drawId","_this$parent9","getPathResizingSVGProperties","_convertToDrawSpace","_rotateBox","_this$parent0","getPathResizedSVGProperties","_x","_y","_this$parent1","_this$parent10","getPathTranslatedSVGProperties","_this$parent11","moving","_this$parent12","_cleanDrawLayer2","_this$div8","updateRotation","updateParentDimensions","onScaleChangingWhenDrawing","drawDiv","createDrawerInstance","_parentWidth","_parentHeight","startDrawing","_isLTR","_uiManager$_editorUnd","_currentDrawingAC","_endDraw","isCancellable","removeLastElement","_drawMove","startNew","_currentDrawingOptions","defaultSVGProperties","_cleanup","drawId","lastElement","getLastElement","setLastElement","isAborted","_INNER_MARGIN","drawingOptions","createDrawingOptions","_data","deserializeDraw","_pageX","_pageY","_pageWidth","_pageHeight","_innerWidth","serializeDraw","_ref108","defaultProperties","_createDrawing","updateParent","_convertToParentSpace","_ref109","pW","pH","_DrawingEditor","InkDrawOutliner","_InkDrawOutliner_brand","_last2","_line2","_lines","_rotation4","_thickness3","_points3","_lastSVGPath","_lastIndex","_outlines2","InkDrawOutline","_parentWidth2","_parentHeight2","firstX","firstY","lastIndexOf","secondX","secondY","c1x","c1y","c2x","c2y","build","_bbox3","_currentRotation","_innerMargin3","_lines2","_parentWidth3","_parentHeight3","_parentScale","_rotation5","_thickness4","_InkDrawOutline_brand","_computeBbox","_ref81","serializedLines","serializedPoints","_getBBoxWithNoMargin","rescaleFn","_ref82","newLines","len","_updateThickness2","_ref83","oldMarginX","oldMarginY","_getMarginComponents","newMarginX","newMarginY","diffMarginX","diffMarginY","rotationTransform","_ref84","marginX","marginY","PRECISION","s1x","s1y","s2x","s2y","_ref85","_ref86","newParentWidth","newParentHeight","margin","InkDrawingOptions","viewerParameters","_viewParameters","_InkEditor_brand","InkEditor","_ref87","_hasElementChanged3","ContourDrawOutline","SignatureExtractor","extractContoursFromText","_ref88","fontStyle","SCALE","uint8Buf","_toUint","histogram","_getHistogram","threshold","_guessThreshold","contourList","_findContours","processDrawnLines","curves","mustSmooth","areContours","_getGrayPixels","_bilateralFilter","_PARAMETERS","sigmaSFactor","sigmaR","kernelSize","_ref89","_lines$thickness","linesAndPoints","xScale","yScale","newCurves","reducedPoints","_douglasPeucker","newPoints","compressSignature","_ref90","bufferType","minDiff","maxDiff","outlinesLength","dx","Int8Array","Int16Array","headerLength","BYTES_PER_ELEMENT","CompressionStream","writer","getWriter","BufferCtor","diffs","Response","readable","decompressSignature","signatureData","fromBase64","DecompressionStream","_iteratorError","_iteratorAbruptCompletion","_didIteratorError","_step","_iterator","asyncIterator","_asyncIterator","return","numberOfDrawings","diffsOffset","POINTS_PROPERTIES_NUMBER","_neighborIndexToId","i0","j0","_clockwiseNonZero","kk","_neighborIdToIndex","_counterClockwiseNonZero","lnbd","nbd","contours","ij","pix","i2","j2","isHole","contour","contour0","shiftI","shiftJ","i1","j1","i3","j3","i4","j4","ij3","_douglasPeuckerHelper","ax","ay","abx","aby","dist","nabx","naby","aa","invS","phi","atan","cosPhi","sinPhi","tmax","poly","partialPhi","dmax","sigmaS","kernel","sigmaS2","halfSize","exp","rangeValues","sigmaR2","out","sum","norm","neighbour","M","L","spos","originalBitmap","prevWidth","prevHeight","log2","isteps","grayImage","_SignatureExtractor","SignatureOptions","DrawnSignatureOptions","_isExtracted","_description","_signatureData","_signatureUUID","SignatureEditor","_defaultDrawnSignatureOptions","hasDescription","_hasDescriptionStats$","_hasDescriptionStats$2","hasDescriptionStats","hasNoAltText","uuid","heightInPage","addSignature","setUuid","getSignaturePreview","hasBeenSaved","getFromImage","getFromText","fontInfo","getDrawnSignature","_ref91","isSignature","alt","_data$accessibilityDa","StampEditor","_StampEditor_brand","_bitmap","_bitmapId","_bitmapPromise","_bitmapUrl","_bitmapFile","_bitmapFileName","_missingCanvas","_resizeTimeoutId","_isSvg","_hasBeenAddedInUndoStack","bitmapUrl","bitmapFile","pasteEditor","getAsFile","_this$altTextData","_hasAltTextStats$get","_hasAltTextStats$get2","hasAltTextStats","mlGuessAltText","updateAltTextData","isEnabledFor","copyCanvas","guess","channels","_classPrivateFieldGet120","_getBitmap","bitmapId","_drawBitmap","maxDataDimension","maxPreviewDimension","bitmapWidth","bitmapHeight","outputScale","scaledWidth","scaledHeight","_scaleBitmap","boxDim","boxDimWidth","boxDimHeight","patternCtx","dataWidth","dataHeight","offscreenCtx","missingCanvas","_await$parent$_struct","structParent","_structTree","_serializeBitmap","changes","_hasElementChanged4","isSame","_this$_initialData$st","isSameAltText","stamps","area","prevData","_getBitmapFetched","fromId","_getBitmapDone","alt_text_modal","alt_text_type","_unused13","accept","files","click","_this$_initialOptions2","MAX_RATIO","toUrl","toDataURL","_serialized$accessibi","isSamePageIndex","AnnotationEditorLayer","_ref92","_AnnotationEditorLayer_brand","_accessibilityManager2","_allowClick","_annotationLayer","_clickAC","_editorFocusTimeoutId","_editors","_hadPointerDown","_isDisabling","_isEnabling","_drawingAC","_focusedElement","_textLayer","_textSelectionAC","_textLayerDblClickAC","_lastPointerDownTimestamp","_uiManager5","editorTypes","_editorTypes2","_initialized","isInvisible","disableTextSelection","toggleAnnotationLayerPointerEvents","enableTextSelection","_classPrivateFieldGet121","_classPrivateFieldGet122","_classPrivateFieldGet123","annotationElementIds","_get_allEditorsIterator","elementsFromPoint","regex","needFakeAnnotation","changedAnnotations","resetAnnotations","_this$getEditableAnno","editables","_classPrivateFieldGet124","_classPrivateFieldGet125","_textLayerPointerDown","_classPrivateFieldGet126","_classPrivateFieldGet127","attach","detach","_classPrivateFieldGet128","_editor$parent","_classPrivateFieldGet129","moveElementInDOM","_classPrivateGetter2","_get_currentEditorType","_getCenterPoint","_createNewEditor","_editorTypes2$_$get","_data$annotationType","_classPrivateGetter3","currentMode","_classPrivateGetter4","startDrawingSession","_ref93","pause","_classPrivateFieldGet130","_classPrivateFieldGet131","_classPrivateFieldGet132","_ref94","_ref95","oldRotation","_this10","_this11","DrawLayer","_ref96","_DrawLayer_brand","_parent2","_mapping","_toUpdate","_svgFactory","_DrawLayer$id","_DrawLayer$id2","isPathUpdatable","hasClip","_id5","pathId","_createClipPath","use","mustRemoveSelfIntersections","_DrawLayer$id3","_DrawLayer$id4","maskId","use1","use2","cloneNode","elementOrId","_updateProperties","_setBox","pathElement","_ref110","clipPathUse","_DrawLayer","_pdfjsTestingUtils","pdfjsLib","applyOpacity","CSSConstants","commentForegroundColor","FeatureTest","findContrastColor","fixedColor","cachedValue","baseHSL","fixedHSL","isFixedColorDark","minContrast","mid","getFilenameFromUrl","getPdfFilenameFromUrl","defaultFilename","newURL","urlString","_unused3","_unused4","_unused5","_unused6","getURL","decoded","_unused7","pdfRegex","pathname","searchParams","hashFilename","getXfaPageViewport","xfaPage","_ref3","ImageKind","normalizeUnicode","PasswordResponses","NEED_PASSWORD","INCORRECT_PASSWORD","PermissionFlag","PRINT","MODIFY_CONTENTS","COPY","MODIFY_ANNOTATIONS","FILL_INTERACTIVE_FORMS","COPY_FOR_ACCESSIBILITY","ASSEMBLE","PRINT_HIGH_QUALITY","defaultOptions","workerPath","spawnWorker","terminateWorker","onMessage","workerBlobURL","jobCounter","logging","_logging","OSD_ONLY","AUTO_OSD","AUTO_ONLY","AUTO","SINGLE_COLUMN","SINGLE_BLOCK_VERT_TEXT","SINGLE_BLOCK","SINGLE_LINE","SINGLE_WORD","CIRCLE_WORD","SINGLE_CHAR","SPARSE_TEXT","SPARSE_TEXT_OSD","RAW_LINE","onmessage","packet","logger","AFR","AMH","ARA","ASM","AZE","AZE_CYRL","BEL","BEN","BOD","BOS","BUL","CAT","CEB","CES","CHI_SIM","CHI_TRA","CHR","CYM","DAN","DEU","DZO","ELL","ENG","ENM","EPO","EST","EUS","FAS","FIN","FRA","FRK","FRM","GLE","GLG","GRC","GUJ","HAT","HEB","HIN","HRV","HUN","IKU","IND","ISL","ITA","ITA_OLD","JAV","JPN","KAN","KAT","KAT_OLD","KAZ","KHM","KIR","KOR","KUR","LAO","LAT","LAV","LIT","MAL","MAR","MKD","MLT","MSA","MYA","NEP","NLD","NOR","ORI","PAN","POL","POR","PUS","RON","RUS","SAN","SIN","SLK","SLV","SPA","SPA_OLD","SQI","SRP","SRP_LATN","SWA","SWE","SYR","TAM","TEL","TGK","TGL","THA","TIR","TUR","UIG","UKR","URD","UZB","UZB_CYRL","VIE","YID","resolveURL","_objectWithoutProperties","_excluded","resolvePaths","workerCounter","oem","config","_resolvePaths","errorHandler","currentLangs","currentOem","currentConfig","lstmOnlyCore","legacyCore","workerResReject","workerResResolve","workerRes","startJob","jobId","promiseId","loadLanguageInternal","_langs","langPath","dataPath","cachePath","cacheMethod","gzip","lstmOnly","legacyLang","initializeInternal","_oem","_config","userJobId","resolveObj","writeText","readText","removeFile","FS","reinitialize","setParameters","corePath"],"ignoreList":[],"sourceRoot":""}